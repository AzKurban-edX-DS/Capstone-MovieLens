# Appendix A: Support Functions {#appndx_a}
## Common Helper Functions
### Logging Functions {#appndx_a.CHF.logging-funcs}

::: {.noteblock data-latex=""}
The full source code of the functions described in this section is available in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R) script on _GitHub_.
:::

#### [open_logfile](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L3) Function {#func.open_logfile}
\

A function to initialize the log file.

::: { #func.open_logfile.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
open_logfile(file_name)
```
:::

::: { #func.open_logfile.args .sidebar }
##### Arguments
\

::: { #func.open_logfile.args.file_name .sidebar }
  - **file_name:** A name used as a base to generate a unique log file name; 

:::
:::

::: { #func.open_logfile.details .sidebar }
##### Details
\

This function is a wrapper for the [logr::log_open](https://www.rdocumentation.org/packages/logr/versions/1.3.9/topics/log_open) function. It also calls internally the following functions to generate a unique file name based on the [file_name](#func.open_logfile.args.file_name) argument and _system time_:

  - [Sys.time](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/Sys.time);
  
  - [stringr::str_replace](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace);
  
  - [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace)

For more information on the _inner functions_ listed above, see the [R Documentation](https://www.rdocumentation.org/).

:::

::: { #func.open_logfile.value .sidebar }
##### Value
\

The path of the log.

:::

::: { #func.open_logfile.code .sidebar }
##### Source Code
\

The source code of the [open_logfile](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L3) function is shown below:
```{r eval=FALSE}
library(logr)
library(stringr)

open_logfile <- function(file_name){
  log_file_name <- as.character(Sys.time()) |> 
    str_replace_all(':', '_') |> 
    str_replace(' ', 'T') |>
    str_c(file_name)
  
  log_open(file_name = log_file_name)
}
```

::: {.noteblock data-latex=""}
The source code of the [open_logfile](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L3) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L3) script on _GitHub_.
:::
:::

#### [print_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L11) Function {#func.print_start_date}
\

Prints the system date and time at the time the function is called and returns the system's idea of the current date and time.

::: { #func.print_start_date.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
print_start_date()
```
:::

::: { #func.print_start_date.details .sidebar }
##### Details
\

This function internally calls [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print), [base::date](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/date), and [base::Sys.time](https://www.rdocumentation.org/link/Sys.time?package=base&version=3.6.2) `R` functions.

It first prints the value returned by the `date` function, then returns the object returned by the `Sys.time` function.
:::

::: { #func.print_start_date.value .sidebar }
##### Value
\

An object of class `POSIXct` (see [DateTimeClasses](https://www.rdocumentation.org/link/DateTimeClasses?package=base&version=3.6.2)). 

:::

::: { #func.print_start_date.code .sidebar }
##### Source Code
\

The source code of the [print_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L11) function is shown below:
```{r eval=FALSE}
print_start_date <- function(){
  print(date())
  Sys.time()
}
```

::: {.noteblock data-latex=""}
The source code of the [print_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L11) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L11) script on _GitHub_.
:::
:::

#### [put_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L15) Function {#func.put_start_date}
\

Outputs the system date and time to the currently opened log (using the [open_logfile](#func.open_logfile) function described above) at the time the function is called and returns the system's idea of the current date and time.

::: { #func.put_start_date.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
put_start_date()
```
:::

::: { #func.put_start_date.details .sidebar }
##### Details
\

This function internally calls [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print), [base::date](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/date), and [base::Sys.time](https://www.rdocumentation.org/link/Sys.time?package=base&version=3.6.2) `R` functions.

It first outputs the value returned by the `date` function to the currently opened log, then returns the object returned by the `Sys.time` function.
:::

::: { #func.put_start_date.value .sidebar }
##### Value
\

An object of class `POSIXct` (see [DateTimeClasses](https://www.rdocumentation.org/link/DateTimeClasses?package=base&version=3.6.2)). 

:::

::: { #func.put_start_date.code .sidebar }
##### Source Code
\

The source code of the [put_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L15) function is shown below:
```{r eval=FALSE}
put_start_date <- function(){
  put(date())
  Sys.time()
}
```

::: {.noteblock data-latex=""}
The source code of the [put_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L15) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L15) script on _GitHub_.
:::
:::

#### [print_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L19) Function {#func.print_end_date}
\

Prints the system date and time at the time the function is called, and then the time elapsed since the date and time specified by the [start](#func.print_end_date.args.start) argument.

::: { #func.print_end_date.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
print_end_date(start)
```
:::

::: { #func.print_end_date.args .sidebar }
##### Arguments
\

::: { #func.print_end_date.args.start .sidebar }
  - **start:** An object of class `POSIXct` representing the value of the moment from which time is measured. 

:::
:::

::: { #func.print_end_date.details .sidebar }
##### Details
\

This function internally calls [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print), [base::date](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/date), and [base::Sys.time](https://www.rdocumentation.org/link/Sys.time?package=base&version=3.6.2) `R` functions.

It first prints the value returned by the `date` function, then builds an object of class `difftime` representing the time elapsed since the date and time specified by the [start](#func.print_end_date.args.start) argument, prints the object, and, finally, returns the object to the client code.

:::

::: { #func.print_end_date.value .sidebar }
##### Value
\

An object of class `difftime` representing the time elapsed since the date and time specified by the [start](#func.print_end_date.args.start) argument. 

:::

::: { #func.print_end_date.code .sidebar }
##### Source Code
\

The source code of the [print_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L19) function is shown below:
```{r eval=FALSE}
print_end_date <- function(start){
  print(date())
  print(Sys.time() - start)
}
```

::: {.noteblock data-latex=""}
The source code of the [print_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L19) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L19) script on _GitHub_.
:::
:::

#### [put_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L23) Function {#func.put_end_date}
\

Outputs the system date and time to the currently open log (using the [open_logfile](#func.open_logfile) function described above).

The first value in the output is the system date and time at the time the function is called, and the second value is the time elapsed since the date and time specified by the [start](#func.put_end_date.args.start) argument.

::: { #func.put_end_date.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
put_end_date(start)
```
:::

::: { #func.put_end_date.args .sidebar }
##### Arguments
\

::: { #func.put_end_date.args.start .sidebar }
  - **start:** An object of class `POSIXct` representing the value of the moment from which time is measured. 

:::
:::

::: { #func.put_end_date.details .sidebar }
##### Details
\

This function works similarly to the [print_end_date](#func.print_end_date) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_end_date.value .sidebar }
##### Value
\

An object of class `difftime` representing the time elapsed since the date and time specified by the [start](#func.put_end_date.args.start) argument. 

:::

::: { #func.put_end_date.code .sidebar }
##### Source Code
\

The source code of the [put_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L23) function is shown below:
```{r eval=FALSE}
put_end_date <- function(start){
  put(date())
  put(Sys.time() - start)
}
```

::: {.noteblock data-latex=""}
The source code of the [put_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L23) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L23) script on _GitHub_.
:::
:::

#### [print_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L28) Function {#func.print_log}
\

Prints a multiline string specified by the [msg](#func.print_log.args.msg) argument.

::: { #func.print_log.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
print_log(msg)
```
:::

::: { #func.print_log.args .sidebar }
##### Arguments
\

::: { #func.print_log.args.msg .sidebar }
  - **msg:** A string to print (can be multiline). 

:::
:::

::: { #func.print_log.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` functions to print the (possibly multiline) string specified by the [msg](#func.print_log.args.msg) argument.

:::

::: { #func.print_log.value .sidebar }
##### Value
\

A glue object, as created by [glue::as_glue()](https://glue.tidyverse.org/reference/glue.html) 

:::

::: { #func.print_log.code .sidebar }
##### Source Code
\

The source code of the [print_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L28) function is shown below:
```{r eval=FALSE}
print_log <- function(msg){
  print(str_glue(msg))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L28) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L28) script on _GitHub_.
:::
:::

#### [put_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L31) Function {#func.put_log}
\

Outputs a multiline string specified by the [msg](#func.put_log.args.msg) argument to the currently opened log (using the [open_logfile](#func.open_logfile) function described above).

::: { #func.put_log.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
put_log(msg)
```
:::

::: { #func.put_log.args .sidebar }
##### Arguments
\

::: { #func.put_log.args.msg .sidebar }
  - **msg:** A string to print (can be multiline). 

:::
:::

::: { #func.put_log.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` functions to output the (possibly multiline) string specified by the [msg](#func.put_log.args.msg) argument.

The function works similarly to the [print_log](#func.print_log) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log.value .sidebar }
##### Value
\

A glue object, as created by [glue::as_glue()](https://glue.tidyverse.org/reference/glue.html) 

:::

::: { #func.put_log.code .sidebar }
##### Source Code
\

The source code of the [put_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L31) function is shown below:
```{r eval=FALSE}
put_log <- function(msg){
  put(str_glue(msg))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L31) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L31) script on _GitHub_.
:::
:::

#### [get_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L35) Function {#func.get_log1}
\

Creates a character vector from the template passed in the [msg_template](#func.get_log1.args.msg_template) argument, using the value specified by the [arg1](#func.get_log1.args.arg1) argument to replace all the occurrences of the pattern `%1` found in the template.

::: { #func.get_log1.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
get_log1(msg_template, arg1)
```
:::

::: { #func.get_log1.args .sidebar }
##### Arguments
\

::: { #func.get_log1.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of the pattern `%1` to be replaced by the value specified by the [arg1](#func.get_log1.args.arg1) argument. 

:::

::: { #func.get_log1.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the pattern `%1` in the message template passed in the [msg_template](#func.get_log1.args.msg_template) argument. 

:::
:::

::: { #func.get_log1.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` functions to form a character vector from the template passed in the [msg_template](#func.get_log1.args.msg_template) argument, using the value specified by the [arg1](#func.get_log1.args.arg1)  argument to replace all the occurrences of the pattern `%1` found in the template.

:::

::: { #func.get_log1.value .sidebar }
##### Value
\

A glue object, returned by the internally called [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) function, created from the character vector returned by the (also internally called) function [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).

:::

::: { #func.get_log1.code .sidebar }
##### Source Code
\

The source code of the [get_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L35) function is shown below:
```{r eval=FALSE}
get_log1 <- function(msg_template, arg1) {
  str_glue(str_replace_all(msg_template, "%1", as.character(arg1)))
}
```

::: {.noteblock data-latex=""}
The source code of the [get_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L35) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L35) script on _GitHub_.
:::
:::

\newpage

#### [print_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L38) Function {#func.print_log1}
\

Prints a log created from the template passed in the [msg_template](#func.print_log1.args.msg_template) argument, using the value specified by the [arg1](#func.print_log1.args.arg1) argument to replace all the occurrences of the pattern `%1` found in the template.

::: { #func.print_log1.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
print_log1(msg_template, arg1)
```
:::

::: { #func.print_log1.args .sidebar }
##### Arguments
\

::: { #func.print_log1.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of the pattern `%1` to be replaced by the value specified by the [arg1](#func.print_log1.args.arg1) argument. 

:::

::: { #func.print_log1.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the pattern `%1` in the message template passed in the [msg_template](#func.print_log1.args.msg_template) argument. 

:::
:::

::: { #func.print_log1.details .sidebar }
##### Details
\

This function internally calls the [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` function to print the object returned by the [get_log1](#func.get_log1) function (also called internally) described above.

:::

::: { #func.print_log1.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log1](#func.get_log1) described above.
:::

::: { #func.print_log1.code .sidebar }
##### Source Code
\

The source code of the [print_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L38) function is shown below:
```{r eval=FALSE}
print_log1 <- function(msg_template, arg1){
  print(get_log1(msg_template, arg1))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L38) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L38) script on _GitHub_.
:::
:::

\newpage

#### [put_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L41) Function {#func.put_log1}
\

Outputs a log to the currently open log file (using the [open_logfile](#func.open_logfile) function described above), created from the template passed in the [msg_template](#func.put_log1.args.msg_template) argument, using the value specified by the [arg1](#func.put_log1.args.arg1) argument to replace all the occurrences of the pattern `%1` found in the template.

::: { #func.put_log1.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
put_log1(msg_template, arg1)
```
:::

::: { #func.put_log1.args .sidebar }
##### Arguments
\

::: { #func.put_log1.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of the pattern `%1` to be replaced by the value specified by the [arg1](#func.put_log1.args.arg1) argument. 

:::

::: { #func.put_log1.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the pattern `%1` in the message template passed in the [msg_template](#func.put_log1.args.msg_template) argument. 

:::
:::

::: { #func.put_log1.details .sidebar }
##### Details
\

This function internally calls the [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` function to output the log object returned by the (also called internally) [get_log1](#func.get_log1) function described above.

The function works similarly to the [print_log1](#func.print_log1) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log1.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log1](#func.get_log1) described above.

:::

::: { #func.put_log1.code .sidebar }
##### Source Code
\

The source code of the [put_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L41) function is shown below:
```{r eval=FALSE}
put_log1 <- function(msg_template, arg1){
  put(get_log1(msg_template, arg1))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L41) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L41) script on _GitHub_.
:::
:::

\newpage

#### [get_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L45) Function {#func.get_log2}
\

Creates a character vector from the template passed in the [msg_template](#func.get_log2.args.msg_template) argument, using the values specified by the [arg1](#func.get_log2.args.arg1) and [arg2](#func.get_log2.args.arg2) arguments to replace all the occurrences of the placeholders `%1` and `%2`, respectively, found in the template.

::: { #func.get_log2.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
get_log2(msg_template, arg1, arg2)
```
:::

::: { #func.get_log2.args .sidebar }
##### Arguments
\

::: { #func.get_log2.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1` and `%2`, to be replaced by the values specified by the [arg1](#func.get_log2.args.arg1) and  [arg2](#func.get_log2.args.arg2) arguments, respectively.

:::

::: { #func.get_log2.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.get_log2.args.msg_template) argument. 

:::

::: { #func.get_log2.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.get_log2.args.msg_template) argument. 

:::
:::

::: { #func.get_log2.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` functions to form a character vector from the template passed in the [msg_template](#func.get_log2.args.msg_template) argument, using the values specified by the [arg1](#func.get_log2.args.arg1) and [arg2](#func.get_log2.args.arg2)  arguments to replace all the occurrences of the placeholders `%1` and `%2`, respectively, found in the template.

:::

::: { #func.get_log2.value .sidebar }
##### Value
\

A glue object, returned by the internally called [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) function, created from the character vector returned by the (also internally called) function [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).

:::

::: { #func.get_log2.code .sidebar }
##### Source Code
\

The source code of the [get_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L45) function is shown below:
```{r eval=FALSE}
get_log2 <- function(msg_template, arg1, arg2) {
  msg_template |> 
    str_replace_all("%1", as.character(arg1)) |>
    str_replace_all("%2", as.character(arg2)) |>
    str_glue()
}
```

::: {.noteblock data-latex=""}
The source code of the [get_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L45) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L45) script on _GitHub_.
:::
:::

\newpage

#### [print_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L51) Function {#func.print_log2}
\

Prints a log created from the template passed in the [msg_template](#func.print_log2.args.msg_template) argument, using the values specified by the [arg1](#func.print_log2.args.arg1) and [arg2](#func.print_log2.args.arg2) arguments to replace all the occurrences of the placeholders `%1` and `%2`, respectively, found in the template.

::: { #func.print_log2.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
print_log2(msg_template, arg1, arg2)
```
:::

::: { #func.print_log2.args .sidebar }
##### Arguments
\

::: { #func.print_log2.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1` and `%2`, to be replaced by the values specified by the [arg1](#func.print_log2.args.arg1) and  [arg2](#func.print_log2.args.arg2) arguments, respectively.

:::

::: { #func.print_log2.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.print_log2.args.msg_template) argument. 

:::

::: { #func.print_log2.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.print_log2.args.msg_template) argument. 

:::
:::

::: { #func.print_log2.details .sidebar }
##### Details
\

This function internally calls the [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` function to print the object returned by the [get_log2](#func.get_log2) function (also called internally) described above.

:::

::: { #func.print_log2.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log2](#func.get_log2) described above.

:::

::: { #func.print_log2.code .sidebar }
##### Source Code
\

The source code of the [print_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L51) function is shown below:
```{r eval=FALSE}
print_log2 <- function(msg_template, arg1, arg2){
  print(get_log2(msg_template, arg1, arg2))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L51) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L51) script on _GitHub_.
:::
:::

\newpage

#### [put_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L54) Function {#func.put_log2}
\

Outputs a log to the currently open log file (using the [open_logfile](#func.open_logfile) function described above), created from the template passed in the [msg_template](#func.put_log2.args.msg_template) argument, using the values specified by the [arg1](#func.put_log2.args.arg1) and [arg2](#func.put_log2.args.arg2) arguments to replace all the occurrences of the placeholders `%1` and `%2`, respectively, found in the template.

::: { #func.put_log2.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
put_log2(msg_template, arg1, arg2)
```
:::

::: { #func.put_log2.args .sidebar }
##### Arguments
\

::: { #func.put_log2.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1` and `%2`, to be replaced by the values specified by the [arg1](#func.put_log2.args.arg1) and  [arg2](#func.put_log2.args.arg2) arguments, respectively.

:::

::: { #func.put_log2.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.put_log2.args.msg_template) argument. 

:::

::: { #func.put_log2.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.put_log2.args.msg_template) argument. 

:::
:::

::: { #func.put_log2.details .sidebar }
##### Details
\

This function internally calls the [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` function to output the log object returned by the (also called internally) [get_log2](#func.get_log2) function described above.

The function works similarly to the [print_log2](#func.print_log2) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log2.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log2](#func.get_log2) described above.
:::

::: { #func.put_log2.code .sidebar }
##### Source Code
\

The source code of the [put_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L54) function is shown below:
```{r eval=FALSE}
put_log2 <- function(msg_template, arg1, arg2){
  put(get_log2(msg_template, arg1, arg2))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L54) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L54) script on _GitHub_.
:::
:::

\newpage

#### [get_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L58) Function {#func.get_log3}
\

Creates a character vector from the template passed in the [msg_template](#func.get_log3.args.msg_template) argument, using the values specified by the [arg1](#func.get_log3.args.arg1), [arg2](#func.get_log3.args.arg2), and [arg3](#func.get_log3.args.arg3) arguments to replace all the occurrences of the placeholders `%1`, `%2`, and `%3`, respectively, found in the template.

::: { #func.get_log3.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
get_log3(msg_template, arg1, arg2, arg3)
```
:::

::: { #func.get_log3.args .sidebar }
##### Arguments
\

::: { #func.get_log3.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1`, `%2`, and `%3` to be replaced by the values specified by the [arg1](#func.get_log3.args.arg1),  [arg2](#func.get_log3.args.arg2), and [arg3](#func.get_log3.args.arg3) arguments, respectively.

:::

::: { #func.get_log3.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.get_log3.args.msg_template) argument. 

:::

::: { #func.get_log3.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.get_log3.args.msg_template) argument. 

:::

::: { #func.get_log3.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder `%3` in the message template passed in the [msg_template](#func.get_log3.args.msg_template) argument. 

:::
:::

::: { #func.get_log3.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` functions to form a character vector from the template passed in the [msg_template](#func.get_log3.args.msg_template) argument, using the values specified by the [arg1](#func.get_log3.args.arg1), [arg2](#func.get_log3.args.arg2), and [arg3](#func.get_log3.args.arg3)  arguments to replace all the occurrences of the placeholders `%1`, `%2`, and `%3`, respectively, found in the template.

:::

::: { #func.get_log3.value .sidebar }
##### Value
\

A glue object, returned by the internally called [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) function, created from the character vector returned by the (also internally called) function [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).

:::

::: { #func.get_log3.code .sidebar }
##### Source Code
\

The source code of the [get_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L58) function is shown below:
```{r eval=FALSE}
get_log3 <- function(msg_template, arg1, arg2, arg3) {
  msg_template |> 
    str_replace_all("%1", as.character(arg1)) |>
    str_replace_all("%2", as.character(arg2)) |>
    str_replace_all("%3", as.character(arg3)) |>
    str_glue()
}
```

::: {.noteblock data-latex=""}
The source code of the [get_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L58) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L58) script on _GitHub_.
:::
:::

\newpage

#### [print_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L65) Function {#func.print_log3}
\

Prints a log created from the template passed in the [msg_template](#func.print_log3.args.msg_template) argument, using the values specified by the [arg1](#func.print_log3.args.arg1), [arg2](#func.print_log3.args.arg2), and [arg3](#func.print_log3.args.arg3) arguments to replace all the occurrences of the placeholders `%1`, `%2`, and `%3`, respectively, found in the template.

::: { #func.print_log3.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
print_log3(msg_template, arg1, arg2, arg3)
```
:::

::: { #func.print_log3.args .sidebar }
##### Arguments
\

::: { #func.print_log3.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1`, `%2`, and `%3` to be replaced by the values specified by the [arg1](#func.print_log3.args.arg1),  [arg2](#func.print_log3.args.arg2), and [arg3](#func.print_log3.args.arg3) arguments, respectively.

:::

::: { #func.print_log3.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.print_log3.args.msg_template) argument. 

:::

::: { #func.print_log3.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.print_log3.args.msg_template) argument. 

:::

::: { #func.print_log3.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder `%3` in the message template passed in the [msg_template](#func.print_log3.args.msg_template) argument. 

:::
:::

::: { #func.print_log3.details .sidebar }
##### Details
\

This function internally calls the [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` function to print the object returned by the [get_log3](#func.get_log3) function (also called internally) described above.

:::

::: { #func.print_log3.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log3](#func.get_log3) described above.

:::

::: { #func.print_log3.code .sidebar }
##### Source Code
\

The source code of the [print_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L65) function is shown below:
```{r eval=FALSE}
print_log3 <- function(msg_template, arg1, arg2, arg3){
  print(get_log3(msg_template, arg1, arg2, arg3))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L65) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L65) script on _GitHub_.
:::
:::

\newpage

#### [put_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L68) Function {#func.put_log3}
\

Outputs a log to the currently open log file (using the [open_logfile](#func.open_logfile) function described above), created from the template passed in the [msg_template](#func.put_log3.args.msg_template) argument, using the values specified by the [arg1](#func.put_log3.args.arg1), [arg2](#func.put_log3.args.arg2), and [arg3](#func.put_log3.args.arg3) arguments to replace all the occurrences of the placeholders `%1`, `%2`, and `%3`, respectively, found in the template.

::: { #func.put_log3.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
put_log3(msg_template, arg1, arg2, arg3)
```
:::

::: { #func.put_log3.args .sidebar }
##### Arguments
\

::: { #func.put_log3.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1`, `%2`, and `%3` to be replaced by the values specified by the [arg1](#func.put_log3.args.arg1),  [arg2](#func.put_log3.args.arg2), and [arg3](#func.put_log3.args.arg3) arguments, respectively.

:::

::: { #func.put_log3.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.put_log3.args.msg_template) argument. 

:::

::: { #func.put_log3.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.put_log3.args.msg_template) argument. 

:::

::: { #func.put_log3.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder `%3` in the message template passed in the [msg_template](#func.put_log3.args.msg_template) argument. 

:::
:::

::: { #func.put_log3.details .sidebar }
##### Details
\

This function internally calls the [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` function to output the log object returned by the (also called internally) [get_log3](#func.get_log3) function described above.

The function works similarly to the [print_log3](#func.print_log3) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log3.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log3](#func.get_log3) described above.

:::

::: { #func.put_log3.code .sidebar }
##### Source Code
\

The source code of the [put_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L68) function is shown below:
```{r eval=FALSE}
put_log3 <- function(msg_template, arg1, arg2, arg3){
  put(get_log3(msg_template, arg1, arg2, arg3))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L68) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L68) script on _GitHub_.
:::
:::

\newpage

#### [get_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L72) Function {#func.get_log4}
\

Creates a character vector from the template passed in the [msg_template](#func.get_log4.args.msg_template) argument, using the values specified by the [arg1](#func.get_log4.args.arg1), [arg2](#func.get_log4.args.arg2), [arg3](#func.get_log4.args.arg3), and [arg4](#func.get_log4.args.arg4) arguments to replace all the occurrences of the placeholders `%1`, `%2`, `%3`, and `%4`, respectively, found in the template.

::: { #func.get_log4.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
get_log4(msg_template, arg1, arg2, arg3, arg4)
```
:::

::: { #func.get_log4.args .sidebar }
##### Arguments
\

::: { #func.get_log4.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1`, `%2`, `%3`, and `%4` to be replaced by the values specified by the [arg1](#func.get_log4.args.arg1),  [arg2](#func.get_log4.args.arg2), [arg3](#func.get_log4.args.arg3), and [arg4](#func.get_log4.args.arg4) arguments, respectively.

:::

::: { #func.get_log4.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.get_log4.args.msg_template) argument. 

:::

::: { #func.get_log4.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.get_log4.args.msg_template) argument. 

:::

::: { #func.get_log4.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder `%3` in the message template passed in the [msg_template](#func.get_log4.args.msg_template) argument. 

:::

::: { #func.get_log4.args.arg4 .sidebar }
  - **arg4:** Value to replace all occurrences of the placeholder `%4` in the message template passed in the [msg_template](#func.get_log4.args.msg_template) argument. 

:::
:::

::: { #func.get_log4.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` functions to form a character vector from the template passed in the [msg_template](#func.get_log4.args.msg_template) argument, using the values specified by the [arg1](#func.get_log4.args.arg1), [arg2](#func.get_log4.args.arg2), [arg3](#func.get_log4.args.arg3), and [arg4](#func.get_log4.args.arg4) arguments to replace all the occurrences of the placeholders `%1`, `%2`, `%3`, and `%4`, respectively, found in the template.

:::

::: { #func.get_log4.value .sidebar }
##### Value
\

A glue object, returned by the internally called [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) function, created from the character vector returned by the (also internally called) function [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).

:::

::: { #func.get_log4.code .sidebar }
##### Source Code
\

The source code of the [get_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L72) function is shown below:
```{r eval=FALSE}
get_log4 <- function(msg_template, arg1, arg2, arg3, arg4) {
  msg_template |> 
    str_replace_all("%1", as.character(arg1)) |>
    str_replace_all("%2", as.character(arg2)) |>
    str_replace_all("%3", as.character(arg3)) |>
    str_replace_all("%4", as.character(arg4)) |>
    str_glue()
}
```

::: {.noteblock data-latex=""}
The source code of the [get_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L72) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L72) script on _GitHub_.
:::
:::

\newpage

#### [print_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L80) Function {#func.print_log4}
\

Prints a log created from the template passed in the [msg_template](#func.print_log4.args.msg_template) argument, using the values specified by the [arg1](#func.print_log4.args.arg1), [arg2](#func.print_log4.args.arg2), [arg3](#func.print_log4.args.arg3), and [arg4](#func.print_log4.args.arg4) arguments to replace all the occurrences of the placeholders `%1`, `%2`, `%3`, and `%4`, respectively, found in the template.

::: { #func.print_log4.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
print_log4(msg_template, arg1, arg2, arg3, arg4)
```
:::

::: { #func.print_log4.args .sidebar }
##### Arguments
\

::: { #func.print_log4.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1`, `%2`, `%3`, and `%4` to be replaced by the values specified by the [arg1](#func.print_log4.args.arg1),  [arg2](#func.print_log4.args.arg2), [arg3](#func.print_log4.args.arg3), and [arg4](#func.print_log4.args.arg4) arguments, respectively.

:::

::: { #func.print_log4.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.print_log4.args.msg_template) argument. 

:::

::: { #func.print_log4.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.print_log4.args.msg_template) argument. 

:::

::: { #func.print_log4.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder `%3` in the message template passed in the [msg_template](#func.print_log4.args.msg_template) argument. 

:::

::: { #func.print_log4.args.arg4 .sidebar }
  - **arg4:** Value to replace all occurrences of the placeholder `%4` in the message template passed in the [msg_template](#func.print_log4.args.msg_template) argument. 

:::
:::

::: { #func.print_log4.details .sidebar }
##### Details
\

This function internally calls the [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` function to print the object returned by the [get_log4](#func.get_log4) function (also called internally) described above.

:::

::: { #func.print_log4.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log4](#func.get_log4) described above.

:::

::: { #func.print_log4.code .sidebar }
##### Source Code
\

The source code of the [print_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L80) function is shown below:
```{r eval=FALSE}
print_log4 <- function(msg_template, arg1, arg2, arg3, arg4){
  print(get_log4(msg_template, arg1, arg2, arg3, arg4))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L80) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L80) script on _GitHub_.
:::
:::

\newpage

#### [put_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L83) Function {#func.put_log4}
\

Outputs a log to the currently open log file (using the [open_logfile](#func.open_logfile) function described above), created from the template passed in the [msg_template](#func.put_log4.args.msg_template) argument, using the values specified by the [arg1](#func.put_log4.args.arg1), [arg2](#func.put_log4.args.arg2), [arg3](#func.put_log4.args.arg3), and [arg4](#func.put_log4.args.arg4) arguments to replace all the occurrences of the placeholders `%1`, `%2`, `%3`, and `%4`, respectively, found in the template.

::: { #func.put_log4.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
put_log4(msg_template, arg1, arg2, arg3, arg4)
```
:::

::: { #func.put_log4.args .sidebar }
##### Arguments
\

::: { #func.put_log4.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1`, `%2`, `%3`, and `%4` to be replaced by the values specified by the [arg1](#func.put_log4.args.arg1),  [arg2](#func.put_log4.args.arg2), [arg3](#func.put_log4.args.arg3), and [arg4](#func.put_log4.args.arg4) arguments, respectively.

:::

::: { #func.put_log4.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.put_log4.args.msg_template) argument. 

:::

::: { #func.put_log4.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.put_log4.args.msg_template) argument. 

:::

::: { #func.put_log4.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder `%3` in the message template passed in the [msg_template](#func.put_log4.args.msg_template) argument. 

:::

::: { #func.put_log4.args.arg4 .sidebar }
  - **arg4:** Value to replace all occurrences of the placeholder `%4` in the message template passed in the [msg_template](#func.put_log4.args.msg_template) argument. 

:::
:::

::: { #func.put_log4.details .sidebar }
##### Details
\

This function internally calls the [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` function to output the log object returned by the (also called internally) [get_log4](#func.get_log4) function described above.

The function works similarly to the [print_log4](#func.print_log4) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log4.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log4](#func.get_log4) described above.
:::

::: { #func.put_log4.code .sidebar }
##### Source Code
\

The source code of the [put_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L83) function is shown below:
```{r eval=FALSE}
put_log4 <- function(msg_template, arg1, arg2, arg3, arg4){
  put(get_log4(msg_template, arg1, arg2, arg3, arg4))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L83) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L83) script on _GitHub_.
:::
:::

\newpage

### Utility Functions {#appndx_a.CHF.utility_funcs}

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L445) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L445) script on _GitHub_.
:::

#### [clamp](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L448) Function {#func.clamp}
\

Clamps the input value passed in [r](#func.clamp.args.r) argument between the values passed in [min](#func.clamp.args.min) and [max](#func.clamp.args.max) arguments. 

::: { #func.clamp.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
r_clamped <- clamp(r, min = 0.5, max = 5)
```
:::

::: { #func.clamp.args .sidebar }
##### Arguments
\

::: { #func.clamp.args.r .sidebar }
  - **r:** Value to clamp; 

:::
::: { #func.clamp.args.min .sidebar }
  - **min:** Minimum allowed value (0.5 by default); 

:::
:::
::: { #func.clamp.args.max .sidebar }
  - **max:** Maximum allowed value (5 by default); 

:::
:::

::: { #func.clamp.details .sidebar }
##### Details
\
As explained in [Section 25.1 *Case study: recommendation systems / User effects*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#user-effects) of the _Course Textbook_ we know ratings cannot be below 0.5 or above 5. For this reason, we need a function described in that section[@IDS2_25-1]:

This function is a wrapper for the [base::pmin](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/Extremes) and [base::pmax](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/Extremes) `R` functions, which are called internally to constrain the input value passed in the [r](#func.clamp.args.r) argument to be within the values passed in the [min](#func.clamp.args.min) and [max](#func.clamp.args.max) arguments, respectively.

In our project this function is used to clamp the computed movie rating values between 0.5 and 5.
:::

::: { #func.clamp.value .sidebar }
##### Value
\

The value clamped between [min](#func.clamp.args.min) and [max](#func.clamp.args.max) argument values.

:::

::: { #func.clamp.code .sidebar }
##### Source Code
\

The source code of the [clamp](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L448) function is shown below:
```{r eval=FALSE}
clamp <- function(x, min = 0.5, max = 5) pmax(pmin(x, max), min)
```

::: {.noteblock data-latex=""}
The source code of the [clamp](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L448) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L445) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L448) script on _GitHub_.
:::
:::

#### [msg.set_arg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L449) Function {#func.msg.set_arg}
\

Creates a character vector from the template passed in the [msg_template](#func.msg.set_arg.args.msg_template) argument, using the value specified by the [arg](#func.msg.set_arg.args.arg) argument to replace all the occurrences of the placeholder passed in the [arg.name](#func.msg.set_arg.args.arg.name) argument found in the template.

::: { #func.msg.set_arg.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
msg.set_arg(msg_template, arg, arg.name = "%1")
```
:::

::: { #func.msg.set_arg.args .sidebar }
##### Arguments
\

::: { #func.msg.set_arg.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of a pattern specified by the [arg.name](#func.msg.set_arg.args.arg.name) argument.
  
:::

::: { #func.msg.set_arg.args.arg.name .sidebar }
  - **arg.name:** (*Optional: `%1` by default*) Substring (pattern or *placeholder*) to replace all occurrences found in the message template passed in the [msg_template](#func.msg.set_arg.args.msg_template) argument with the value specified in the [arg](#func.msg.set_arg.args.arg) argument.

:::

::: { #func.msg.set_arg.args.arg .sidebar }
  - **arg:** Value to replace all occurrences of the pattern specified by the [arg.name](#func.msg.set_arg.args.arg.name) argument in the message template passed in the [msg_template](#func.msg.set_arg.args.msg_template) argument.
  
:::
:::

::: { #func.msg.set_arg.details .sidebar }
##### Details
\

This function is a wrapper for the [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` function, which is called internally to replace all occurrences of the pattern (placeholder) specified by the [arg_name](#func.msg.set_arg.args.arg.name) argument (`%1` by default), in the message template passed in the [msg_template](#func.msg.set_arg.args.msg_template) argument with the value specified in the [arg](#func.msg.set_arg.args.arg) argument.
:::

::: { #func.msg.set_arg.value .sidebar }
##### Value
\

The character vector returned by the internally called [stringr::str_replace_all()](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).
:::

::: { #func.msg.set_arg.code .sidebar }
##### Source Code
\

The source code of the [msg.set_arg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L449) function is shown below:
```{r eval=FALSE}
msg.set_arg <- function(msg_template, arg, arg.name = "%1") {
  msg_template |> 
    str_replace_all(arg.name, as.character(arg))
}
```

::: {.noteblock data-latex=""}
The source code of the [msg.set_arg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L449) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L445) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L449) script on _GitHub_.
:::
:::

\newpage

#### [msg.glue](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L453) Function {#func.msg.glue}
\

Creates a [glue::glue](https://glue.tidyverse.org/reference/glue.html) object from the template passed in the [msg_template](#func.msg.glue.args.msg_template) argument, using the value specified by the [arg](#func.msg.glue.args.arg) argument to replace all the occurrences of the placeholder passed in the [arg.name](#func.msg.glue.args.arg.name) argument found in the template.
  
::: { #func.msg.glue.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
msg.glue(msg_template, arg, arg, arg.name = "%1")
```
:::

::: { #func.msg.glue.args .sidebar }
##### Arguments
\

::: { #func.msg.glue.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of a pattern specified by the [arg.name](#func.msg.glue.args.arg.name) argument.
  
:::

::: { #func.msg.glue.args.arg.name .sidebar }
  - **arg.name:** (*Optional: `%1` by default*) Substring (pattern or *placeholder*) to replace all occurrences found in the message template passed in the [msg_template](#func.msg.glue.args.msg_template) argument with the value specified in the [arg](#func.msg.glue.args.arg) argument.

:::

::: { #func.msg.glue.args.arg .sidebar }
  - **arg:** Value to replace all occurrences of the pattern specified by the [arg.name](#func.msg.glue.args.arg.name) argument in the message template passed in the [msg_template](#func.msg.glue.args.msg_template) argument.

:::
:::

::: { #func.msg.glue.details .sidebar }
##### Details
\

This function internally calls the [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) `R` function to format the character vector returned by the (also called internally) [msg.set_arg](#func.msg.set_arg) function described above.

:::

::: { #func.msg.glue.value .sidebar }
##### Value
\

A [glue::glue](https://glue.tidyverse.org/reference/glue.html) object created from the character vector returned by the internally called [msg.set_arg()](#func.msg.set_arg).

:::

::: { #func.msg.glue.code .sidebar }
##### Source Code
\

The source code of the [msg.glue](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L453) function is shown below:
```{r eval=FALSE}
msg.glue <- function(msg_template, arg, arg.name = "%1"){
  msg_template |>
    msg.set_arg(arg, arg.name) |>
    str_glue()
}
```

::: {.noteblock data-latex=""}
The source code of the [msg.glue](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L453) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L445) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L453) script on _GitHub_.
:::
:::

\newpage

### (Root) Mean Squared Error Calculation

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) script on _GitHub_.
:::

#### [mse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L5) Function {#func.mse}
\

Calculates *Mean Squared Error* as described in [Section 25.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_25-1]. 

::: { #func.mse.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
mse(r)

```
:::

::: { #func.mse.args .sidebar }
##### Arguments
\

::: { #func.mse.args.r .sidebar }
  - **r:** Numeric vector representing a set of residuals as described in [Section 25.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_25-1]. 

:::
:::

::: { #func.mse.code .sidebar }
##### Source Code
\

The source code of the [mse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L5) function is shown below:
```{r eval=FALSE}
mse <- function(r) mean(r^2)
```

::: {.noteblock data-latex=""}
The source code of the [mse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L5) function is also available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L5) script on _GitHub_.
:::
:::

\newpage

#### [mse_cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L6) Function {#func.mse_cv}
\

Calculates the average value of the *Mean Squared Errors* calculated using the _K-Fold Cross Validation_ method as described in [Section 31.6 *Cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#cross-validation) of the _Course Textbook (New Edition)_[@IDS2_31-6].

::: { #func.mse_cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
mse_cv(r_list)

```
:::

::: { #func.mse_cv.args .sidebar }
##### Arguments
\

::: { #func.mse_cv.args.r_list .sidebar }
  - **r_list:** List of numeric vectors, each representing a set of residuals as described in [Section 25.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_25-1], calculated in `K`th iteration using the _K-Fold Cross Validation_ method. 

:::
:::

::: { #funcc.mse_cv.code .sidebar }
##### Source Code
\

The source code of the [mse_cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L6) function is shown below:
```{r eval=FALSE}
mse_cv <- function(r_list) {
  mses <- sapply(r_list, mse(r))
  mean(mses)
}
```

::: {.noteblock data-latex=""}
The source code of the [mse_cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L6) function is also available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L6) script on _GitHub_.
:::
:::

\newpage

#### [rmse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L10) Function {#func.rmse}
\

Calculates *Root Mean Squared Error* as described in [Section 25.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_25-1]. 

::: { #func.rmse.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
rmse(r)

```
:::

::: { #func.rmse.args .sidebar }
##### Arguments
\

::: { #func.rmse.args.r .sidebar }
  - **r:** Numeric vector representing a set of residuals as described in [Section 25.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_25-1]. 

:::
:::

::: { #func.rmse.code .sidebar }
##### Source Code
\

The source code of the [rmse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L10) function is shown below:
```{r eval=FALSE}
rmse <- function(r) sqrt(mse(r))
```

::: {.noteblock data-latex=""}
The source code of the [rmse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L10) function is also available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L10) script on _GitHub_.
:::
:::

\newpage

#### [rmse2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L11) Function {#func.rmse2}
\

Calculates *Root Mean Squared Error* as described in [Section 25.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_25-1]. 

::: { #func.rmse2.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
rmse2(true_ratings, predicted_ratings)

```
:::

::: { #func.rmse2.args .sidebar }
##### Arguments
\

::: { #func.rmse2.args.true_ratings .sidebar }
  - **true_ratings:** Numeric vector representing a set of *actual rating* values stored in the validation dataset. 

:::

::: { #func.rmse2.args.predicted_ratings .sidebar }
  - **predicted_ratings:** A numeric vector representing a set of *predicted rating* values computed from the data stored in the test dataset. 

:::
:::

::: { #func.rmse2.code .sidebar }
##### Source Code
\

The source code of the [rmse2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L11) function is shown below:
```{r eval=FALSE}
rmse2 <- function(true_ratings, predicted_ratings) {
  rmse(true_ratings - predicted_ratings)
}
```

::: {.noteblock data-latex=""}
The source code of the [rmse2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L11) function is also available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L11) script on _GitHub_.
:::
:::

\newpage

### Result RMSEs Tibble Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) script on _GitHub_.
:::

#### [CreateRMSEs_ResultTibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L16) Function {#func.CreateRMSEs_ResultTibble}
\

Creates a _RMSEs Result Tibble_ of type *data frame*.

::: { #func.CreateRMSEs_ResultTibble.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
RMSEs.ResultTibble <- CreateRMSEs_ResultTibble()
```
:::

::: { #func.CreateRMSEs_ResultTibble.details .sidebar }
##### Details
\

This function is a wrapper for the [tibble::tibble](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/tibble) function, which is called internally to construct a data frame representing the _RMSEs Result Tibble_ to store the _RMSE_ values for every model used in the project to predict movie ratings.

The result data frame, which is returned to the client code, has the following columns:

  - *Method* (chr);
  - *RMSE* (num);
  - *Comment* (chr)

::: { #func.CreateRMSEs_ResultTibble.value .sidebar }
##### Value
\

A tibble returned by the internally called [tibble::tibble()](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/tibble)

:::


::: { #func.CreateRMSEs_ResultTibble.code .sidebar }
##### Source Code
\

The source code of the [CreateRMSEs_ResultTibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L16) function is shown below:
```{r eval=FALSE}
CreateRMSEs_ResultTibble <- function(){
  tibble(Method = c("Project Objective"),
         RMSE = project_objective,
         Comment = " ")
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [CreateRMSEs_ResultTibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L16) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L16) script on _GitHub_.
:::

\newpage

#### [RMSEs.AddRow](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L21) Function {#func.RMSEs.AddRow}
\

Adds a row to the original _RMSEs Result Tibble_ passed in the [RMSEs](#func.RMSEs.AddRow.args.RMSEs) argument.

::: { #func.RMSEs.AddRow.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
RMSEs.AddRow(RMSEs, 
             method, 
             value, 
             comment = "", 
             before = NULL)
```
:::

::: { #func.RMSEs.AddRow.args .sidebar }
##### Arguments
\

::: { #func.RMSEs.AddRow.args.RMSEs .sidebar }
  - ***RMSEs:*** Original _RMSEs Result Tibble_ (of type *data frame*) to modify;

:::

::: { #func.RMSEs.AddRow.args.method .sidebar }
  - ***method:*** The _Method or Model_ being evaluated;

:::

::: { #func.RMSEs.AddRow.args.value .sidebar }
  - ***value:*** The _Root Mean Squared Error (RMSE)_ value;

:::

::: { #func.RMSEs.AddRow.args.comment .sidebar }
  - ***comment:*** Detailed information about the record or any other comment (if needed);

:::

::: { #func.RMSEs.AddRow.args.before .sidebar }
  - ***before:*** One-based row index where to add the new rows, if NULL (default): after last row;

:::
:::

::: { #func.RMSEs.AddRow.code.details .sidebar }
##### Details
\

This function is a wrapper for the [tibble::add_row](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/add_row) function, which is called internally to modify a data frame representing the original _RMSEs Result Tibble_, which stores the _RMSE_ values for the models used in the project to predict movie ratings.

For more information about the _RMSEs Result Tibble_, see the [Details](#func.CreateRMSEs_ResultTibble.details) section of the [CreateRMSEs_ResultTibble](#func.CreateRMSEs_ResultTibble) function description above.

:::

::: { #func.RMSEs.AddRow.value .sidebar }
##### Value
\

The modified tibble returned by the internally called [tibble::add_row()](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/add_row).

:::


::: { #func.RMSEs.AddRow.code .sidebar }
##### Source Code
\

The source code of the [RMSEs.AddRow](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L21) function is shown below:
```{r eval=FALSE}
RMSEs.AddRow <- function(RMSEs, 
                         method, 
                         value, 
                         comment = "", 
                         before = NULL){
  RMSEs |>
    add_row(Method = method,
            RMSE = value,
            Comment = comment,
            .before = before)
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RMSEs.AddRow](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L21) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L21) script on _GitHub_.
:::

\newpage

#### [RMSEs.AddDiffColumn](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) Function {#func.RMSEs.AddDiffColumn}
\

Adds a calculated column named _Diff_ to the _RMSEs Result Tibble_ (passed in the [RMSEs](#func.RMSEs.AddDiffColumn.args.RMSEs) argument) that contains, for each row, the difference between the value of the _RMSE_ column for the previous row and the value of the same column for the current row. This is true for each row except the first, for which the value is always zero.

::: { #func.RMSEs.AddDiffColumn.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
RMSEs.ModifiedTable <- RMSEs.AddDiffColumn(RMSEs)
```
:::

::: { #func.RMSEs.AddDiffColumn.args .sidebar }
##### Arguments
\

::: { #func.RMSEs.AddDiffColumn.args.RMSEs .sidebar }
  - ***RMSEs:*** _RMSEs Result Tibble_ to modify;

:::
:::

::: { #func.RMSEs.AddDiffColumn.details .sidebar }
##### Details
\

This function is a wrapper for the [tibble::add_column](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/add_column) function, which is called internally to modify a data frame representing the original _RMSEs Result Tibble_. It also internally uses the [RMSEs.AddRow](#func.RMSEs.AddRow) function described above to perform the necessary intermediate calculations.

For more information about the _RMSEs Result Tibble_, see the [Details](#func.CreateRMSEs_ResultTibble.details) section of the [CreateRMSEs_ResultTibble](#func.CreateRMSEs_ResultTibble) function description above.
:::


::: { #func.RMSEs.AddRow.value .sidebar }
##### Value
\

The modified tibble returned by the internally called [tibble::add_column()](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/add_column).
:::

::: { #func.RMSEs.AddDiffColumn.code .sidebar }
##### Source Code
\

The source code of the [RMSEs.AddDiffColumn](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) function is shown below:
```{r eval=FALSE}
RMSEs.AddDiffColumn <- function(RMSEs){
  RMSEs.Diff <- RMSEs |>
    RMSEs.AddRow(NULL, project_objective, before = 1) #|>

  RMSEs.Diff <- RMSEs.Diff[-nrow(RMSEs.Diff),]
    
  RMSEs |>
  add_column(Diff = RMSEs.Diff$RMSE - RMSEs$RMSE, 
             .before = "Comment")
  
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RMSEs.AddDiffColumn](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) script on _GitHub_.
:::

#### [RSME.tibble.col_width](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L66) Function {#func.RSME.tibble.col_width}
\

Converts the _RMSEs Result Tibble_ column width value passed in argument [x](#func.RSME.tibble.col_width.args.x) to a character string compatible for use as the `width` argument value to pass to the [kableExtra::column_spec](https://www.rdocumentation.org/packages/kableExtra/versions/1.3.4/topics/column_spec) function.

::: { #func.RSME.tibble.col_width.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
width_em <- RSME.tibble.col_width(x)
```
:::

::: { #func.RSME.tibble.col_width.args .sidebar }
##### Arguments
\

::: { #func.RSME.tibble.col_width.args.x .sidebar }
  - ***x:*** (Numeric) Column width value to be formatted;

:::
:::

::: { #func.RSME.tibble.col_width.details .sidebar }
##### Details
\

This is a utility function, a wrapper for the [msg.glue](#func.msg.glue) function described above, which is called internally to format the value passed in argument [x](#func.RSME.tibble.col_width.args.x) for subsequent passing to the function [kableExtra::column_spec](https://www.rdocumentation.org/packages/kableExtra/versions/1.3.4/topics/column_spec) as a value of the `width` argument.
:::

::: { #func.RSME.tibble.col_width.value .sidebar }
##### Value
\

A character string representing the formatted column width value.
:::


::: { #func.RSME.tibble.col_width.code .sidebar }
##### Source Code
\

The source code of the [RSME.tibble.col_width](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L66) function is shown below:
```{r eval=FALSE}
RSME.tibble.col_width <- function(x){
  "%1em" |> msg.glue(x)
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RSME.tibble.col_width](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L66) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L66) script on _GitHub_.
:::

\newpage

#### [RMSE_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L43) Function {#func.RMSE_kable}
\

Prints the _RMSEs Result Tibble_.

::: {.noteblock data-latex=""}
It is assumed that the tibble has the following three columns:
  
  1. *Method*;
  2. *RMSE*;
  3. *Comment*;
  
:::

::: { #func.RMSE_kable.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
RMSE_kable(RMSEs,
           col1width = 15,
           col2width = 5,
           col3width = 30)
```
:::

::: { #func.RMSE_kable.args .sidebar }
##### Arguments
\

::: { #func.RMSE_kable.args.RMSEs .sidebar }
  - ***RMSEs:*** _RMSEs Result Tibble_ to print;

:::

::: { #func.RMSE_kable.args.col1width .sidebar }
  - ***col1width:*** Width of the first column (15 by default);

:::

::: { #func.RMSE_kable.args.col2width .sidebar }
  - ***col2width:*** Width of the second column (5 by default);

:::

::: { #func.RMSE_kable.args.col3width .sidebar }
  - ***col3width:*** Width of the third column (30 by default).

:::
:::

::: { #func.RMSE_kable.details .sidebar }
##### Details
\

This function is a wrapper for the [knitr::kable](https://www.rdocumentation.org/packages/knitr/versions/1.43/topics/kable) function, which is called internally to create a table (based on the _RMSEs Result Tibble_ data), formatted for output in the project report.

The [kableExtra::column_spec](https://www.rdocumentation.org/packages/kableExtra/versions/1.3.4/topics/column_spec) function, along with the [RSME.tibble.col_width](#func.RSME.tibble.col_width) function described above, are also used internally to specify the width of the table columns.

For more information about the _RMSEs Result Tibble_, see the [Details](#func.CreateRMSEs_ResultTibble.details) section of the [CreateRMSEs_ResultTibble](#func.CreateRMSEs_ResultTibble) function description above.
:::

::: { #func.RMSE_kable.value .sidebar }
##### Value
\

The table created by the internally called [knitr::kable()](https://www.rdocumentation.org/packages/knitr/versions/1.43/topics/kable).

:::


::: { #func.RMSE_kable.code .sidebar }
##### Source Code
\

The source code of the [RMSE_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L43) function is shown below:
```{r eval=FALSE}
RMSE_kable <- function(RMSEs,
                       col1width = 15,
                       col2width = 5,
                       col3width = 30){
  RMSEs |>
    kable(align='lcl', booktabs = T, padding = 5) |> 
    row_spec(0, bold = T) |>
    column_spec(column = 1, width = RSME.tibble.col_width(col1width)) |>
    column_spec(column = 2, width = RSME.tibble.col_width(col2width)) |>
    column_spec(column = 3, width = RSME.tibble.col_width(col3width)) 
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RMSE_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L43) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L43) script on _GitHub_.
:::

\newpage


#### [RMSE.Total_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L54) Function {#func.RMSE.Total_kable}
\

Prints the _Final RMSEs Result Tibble_.

::: {.noteblock data-latex=""}
It is assumed that the tibble has the following four columns:
  
  1. *Method*;
  2. *RMSE*;
  3. *Diff*;
  4. *Comment*;
  
:::

::: { #func.RMSE.Total_kableusage .sidebar }
##### Usage
\

```{r eval=FALSE}
RMSE.Total_kable(RMSEs,
                 col1width = 15,
                 col2width = 7,
                 col3width = 5,
                 col4width = 25)
```
:::

::: { #func.RMSE.Total_kable.args .sidebar }
##### Arguments
\

::: { #func.RMSE.Total_kable.args.RMSEs .sidebar }
  - ***RMSEs:*** The _Final RMSEs Result Tibble_ to print;

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col1width:*** Width of the first column (15 by default);

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col2width:*** Width of the second column (7 by default);

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col3width:*** Width of the third column(5 by default);

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col4width:*** Width of the fourth column (25 by default);

:::
:::

::: { #func.RMSE.Total_kable.details .sidebar }
##### Details
\

This function is a wrapper for the [RMSE_kable](#func.RMSE_kable) function described above, which is called internally to print the table, created from the final _RMSEs Result Tibble_ data.

It is assumed that the  _Final RMSEs Result Tibble_ is previously constructed from the original _RMSEs Result Tibble_ using the [RMSEs.AddDiffColumn](#func.RMSEs.AddDiffColumn) function described above.

The [kableExtra::column_spec](https://www.rdocumentation.org/packages/kableExtra/versions/1.3.4/topics/column_spec) function, along with the [RSME.tibble.col_width](#func.RSME.tibble.col_width) function described above, are also used internally to set the width of the last column of the table.

For more information about the _RMSEs Result Tibble_, see the [Details](#func.CreateRMSEs_ResultTibble.details) section of the [CreateRMSEs_ResultTibble](#func.CreateRMSEs_ResultTibble) function description above.
:::

::: { #func.RMSE.Total_kable.value .sidebar }
##### Value
\

The table returned by the internally called [RMSE_kable()](#func.RMSE_kable).
:::

::: { #func.RMSE.Total_kable.code .sidebar }
##### Source Code
\

The source code of the [RMSE.Total_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L54) function is shown below:
```{r eval=FALSE}
RMSE.Total_kable <- function(RMSEs,
                       col1width = 15,
                       col2width = 7,
                       col3width = 5, 
                       col4width = 25){
  RMSEs |> 
    RMSE.Total_kable(col1width,
               col2width,
               col3width) |>
    column_spec(column = 4, 
                width = RSME.tibble.col_width(col4width)) 
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RMSE.Total_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L54) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L54) script on _GitHub_.
:::

\newpage

### Regularization Functions {#appndx_a.CHF.regularization}
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L78) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L78) script on _GitHub_.
:::

#### [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L63) Function {#func.mean_reg}
\

A general function for computing the arithmetic mean given a _regularization parameter_ $\lambda$. We will call it the _penaized mean_.

::: { #func.mean_reg.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
mean_reg(vals, lambda = 0, na.rm = TRUE)

```
:::

::: { #func.mean_reg.args .sidebar }
##### Arguments
\

::: { #func.mean_reg.args.vals .sidebar }
  - **vals:** values (usually a numeric vector) to calculate the _penalized mean_;

:::
::: { #func.mean_reg.args.lambda .sidebar }
  - **lambda:** a _regularization parameter_ $\lambda$ used in the _Regularization techniques_. 

:::
  - **na.rm:** a logical evaluating to TRUE or FALSE indicating whether NA values should be stripped before the computation proceeds.

:::


::: { #func.mean_reg.details .sidebar }
##### Details
\
We call this function internally from the functions that compute the _penalized estimates_  as described in section [23.6 Penalized Least Squares](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook_[@IDS2_23-6].

::: {.noteblock data-latex=""}
If the [lambda](#func.mean_reg.args.lambda) parameter is `0` (the default), the function is equivalent to the standard R function [base::mean](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/mean), calling with the parameter `trim = 0` (the default for the `base::mean` function).
:::
:::

::: { #func.mean_reg.code .sidebar }
##### Source Code
\

The soure code of the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L63) function is shown below:
```{r eval=FALSE}
mean_reg <- function(vals, lambda = 0, na.rm = TRUE){
  if (is.na(lambda)) {
    stop("Function: mean_reg
`lambda` is `NA`")
  }
  
  names(lambda) <- NULL
  sums <- sum(vals, na.rm = na.rm)
  N <- ifelse(na.rm, sum(!is.na(vals)), length(vals))
  sums/(N + lambda)
}
```

::: {.noteblock data-latex=""}
The source code of the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L63) is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L62) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L63) script on _GitHub_.
:::
:::

::: { #func.mean_reg.value .sidebar }
##### Value
\

The function calculates the _penalized mean_ of the [vals](#func.mean_reg.args.vals) parameter as follows:
$$
\mu(\lambda) = \frac{1}{\lambda + N} \sum_{i=1}^{N} x_i
$$

When the [lambda](#func.mean_reg.args.lambda) parameter is `0` (meaning the $\lambda = 0$), the function calculates the simple arithmetic mean as follows:
$$
\mu = \frac{1}{N} \sum_{i=1}^{N} x_i
$$

:::

#### [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L116) Function {#func.tune.model_param}
\

The function searches for the parameter value corresponding to the minimum value of the `RMSE` from the list of values specified by the `param_values` parameter.

##### Signature
\
```{r eval=FALSE}
tune.model_param <- function(param_values, 
                             fn_tune.test.param_value, 
                             break.if_min = TRUE,
                             steps.beyond_min = 2){

# ...
  list(tuned.result = data.frame(RMSE = RMSEs_tmp,
                                parameter.value = param_vals_tmp),
       best_result = param_values.best_result)
}  
```

##### Arguments
\

  - **param_values:** A list of values to search for the value corresponding to the minimum value of the `RMSE` ; 

::: { #func.tune.model_param.args.fn_tune.test.param_value .sidebar }
  - **fn_tune.test.param_value:** A helper function that calculates the value of the `RMSE` for a given parameter value.; 

:::  
  - **break.if_min = TRUE:** A Boolean parameter that determines whether the function should terminate after completing the number of steps specified by the parameter `steps.beyond_min`, after the minimum value of the `RMSE` has been found;
  
  - **steps.beyond_min = 2:** (takes effect only if `break.if_min` parameter is `TRUE`) Specifies the number of steps after finding the minimum value of the `RMSE`, upon completion of which the function should terminate.

##### Details
\
During execution, the function uses a helper function specified by the `fn_tune.test.param_value` parameter, which calculates the `RMSE` value for the given parameter from the list determined by the `param_values` parameter.

::: {.noteblock data-latex=""}
Note that the algorithm assumes that the dependence of the `RMSE` on the input parameter is a monotonically decreasing function until a minimum is reached and monotonically increasing thereafter. That is, it is assumed that the function has a single minimum on the given interval.
:::

::: { #func.tune.model_param.value .sidebar }
##### Value
\
The function returns a data structure containing the found value of the input parameter `param_values` for which the `RMSE` value is minimal, as well as the minimum `RMSE` value itself, along with a sequence of all calculated `RMSE` values:
```{r eval=FALSE}
  list(tuned.result = data.frame(RMSE = RMSEs_tmp,
                                parameter.value = param_vals_tmp),
       best_result = param_values.best_result)
```
:::

##### Source Code
\
Below is the most significant part of the source code of the [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L116) function:
```{r eval=FALSE}
tune.model_param <- function(param_values, 
                             fn_tune.test.param_value, 
                             break.if_min = TRUE,
                             steps.beyond_min = 2){
  n <- length(param_values)
  param_vals_tmp <- numeric()
  RMSEs_tmp <- numeric()
  RMSE_min <- Inf
  i_max.beyond_RMSE_min <- Inf
  prm_val.best <- NA

  # ...
  
  for (i in 1:n) {
    put_log1("Function: `tune.model_param`:
Iteration %1", i)
    prm_val <- param_values[i]
    param_vals_tmp[i] <- prm_val
    
    RMSE_tmp <- fn_tune.test.param_value(prm_val)
    RMSEs_tmp[i] <- RMSE_tmp

    plot(param_vals_tmp[RMSEs_tmp], RMSEs_tmp[RMSEs_tmp])

    if(RMSE_tmp > RMSE_min){
      warning("Function: `tune.model_param`:
`RSME` reached its minimum: ", RMSE_min, "
for parameter value: ", prm_val)
      put_log2("Function: `tune.model_param`:
Current `RMSE` value is %1 related to parameter value: %2",
               RMSE_tmp,
               prm_val)
      
      if (i > i_max.beyond_RMSE_min) {
        warning("Function: `tune.model_param`:
Operation is breaked (after `RSME` reached its minimum) on the following step: ", i)
        break
      }
      next
    }

    RMSE_min <- RMSE_tmp
    prm_val.best <- prm_val
    
    if (break.if_min) {
      i_max.beyond_RMSE_min <- i + steps.beyond_min
    }
  }
  
  param_values.best_result <- c(param.best_value = prm_val.best, 
                                best_RMSE = RMSE_min)
  
  
  list(tuned.result = data.frame(RMSE = RMSEs_tmp,
                                parameter.value = param_vals_tmp),
       best_result = param_values.best_result)
}
```

\newpage

#### [model.tune.param_range](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L198) Function {#func.model.tune.param_range}
\

The function fine-tunes the model by searching for the best possible value of the input parameter over a given interval for which the corresponding `RMSE` value is minimal.

##### Signature
\
```{r eval=FALSE}
model.tune.param_range <- function(loop_starter,
                             tune_dir_path,
                             cache_file_base_name,
                             fn_tune.test.param_value,
                             max.identical.min_RMSE.count = 4,
                             endpoint.min_diff = 0,
                             break.if_min = TRUE,
                             steps.beyond_min = 2){
  # ...
  list(best_result = param_values.best_result,
       param_values.endpoints = c(prm_val.leftmost, prm_val.rightmost, seq_increment),
       tuned.result = data.frame(parameter.value = parameter.value,
                                 RMSE = result.RMSE))
}
```

##### **Parameters**
\

::: { #func.model.tune.param_range.args.loop_starter .sidebar }
###### ***loop_starter***
\
A numeric vector of the form `c(start, end, dvs)`, where `start` and `end` are the endpoints of the interval on which the parameter value that minimizes `RMSE` is sought.
`dvs` is a divisor for splitting the interval to transform it into a sequence of values among which the value that minimizes `RMSE` is sought.
For this purpose, the sequence step is calculated as follows:
$$
step = \frac{end - start}{dvs}
$$  

The sequence obtained as a result of the transformation is equivalent to the one generated by the function `seq` as follows:
```{r eval=FALSE}
seq(start, end, step)
```  
In fact, the `seq` function is called internally to generate the sequence during the execution of the `model.tune.param_range` function.
:::

::: { #func.model.tune.param_range.args.tune_dir_path .sidebar }
###### ***tune_dir_path***
\
To improve performance, the algorithm caches intermediate results in the file system. This parameter specifies the path to the directory where the files are cached.
:::

::: { #func.model.tune.param_range.args.cache_file_base_name .sidebar }
###### ***cache_file_base_name***
\
The algorithm generates unique names for cache files based on this and the `loop_starter` parameter, as well as some other intermediate values calculated during the execution.
:::

::: { #func.model.tune.param_range.args.fn_tune.test.param_value .sidebar }
###### ***fn_tune.test.param_value***
\
This is a helper function name that is passed to the same-named parameter of the [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L116) function that is called internally during the execution (see the description of the `tune.model_param` function [above](#func.tune.model_param)). 
:::

::: { #func.model.tune.param_range.args.max.identical.min_RMSE.count .sidebar }
###### ***max.identical.min_RMSE.count = 4***
\
If more than one identical minimum `RMSE` value is calculated during execution, the number of identical minimums is limited by the value of this parameter. When it is reached, the algorithm considers the task execution to be complete.
:::

::: { #func.model.tune.param_range.args.endpoint.min_diff .sidebar }
###### ***endpoint.min_diff = 0***
\
Defines the sensitivity threshold for determining the neighborhood boundaries of the minimum `RMSE` value (for details, see the `Details` section [below](#func.model.tune.param_range.details)).
:::

::: { #func.model.tune.param_range.args.break.if_min .sidebar }
###### ***break.if_min = TRUE***
\
This is a parameter that is required for the [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L116) function that is called internally during execution (see the description of the `tune.model_param` function [above](#func.tune.model_param)). 
:::

::: { #func.model.tune.param_range.args.steps.beyond_min .sidebar }
###### ***steps.beyond_min = 2***
\
This is a parameter that is required for the [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L116) function that is called internally during execution (see the description of the `tune.model_param` function [above](#func.tune.model_param)). 

::: { #func.model.tune.param_range.details .sidebar }
##### **Details** 
\
First, the function generates a sequence of the `input parameter values` based on the `loop_starter` parameter values, as described above (see the [loop_starter](#func.model.tune.param_range.args.loop_starter) parameter description for the details), which is used as one of the input parameters for the helper function [tune.model_param](#func.tune.model_param), which is repeatedly called during the execution, performing fine-tuning of the model.

The `tune.model_param` function returns a range of input parameter values associated with the set of corresponding _Root Mean Squared Errors_ that is also guaranteed to include their minimum value, as described in the [Value](#func.tune.model_param.value) subsection of the [tune.model_param](#func.tune.model_param) function description.

Next, the function figures out the boundary indices of a range of values from the neighborhood of the minimum `RMSE` by calling internally another helper function [get_fine_tune.param.endpoints.idx](#func.get_fine_tune.param.endpoints.idx) (see the description below) and, using one more helper function [get_best_param.result](#func.get_best_param.result)  (see the description below), a pair of values,  corresponding to the best result: minimal  `RMSE` and corresponding input parameter value (which is considered the best).

The found values of the boundary indices are then used as the endpoints of a new interval to regenerate the sequence based on it in the next iteration, just as it was done based on the values of the `loop_starter` parameter at the very beginning of the execution. The value of `step divisor`, used to calculate the step of the generated sequence, remains unchanged during the entire execution (see the description of the [loop_strarter](#func.model.tune.param_range.args.loop_starter) parameter above for details).

Thus, with each subsequent iteration, the minimum `RMSE` value is calculated more accurately, over an ever-decreasing interval, with the boundary values tending to the minimum `RMSE` value, and the sequence generated with an ever-decreasing step.

The calculation is completed when subsequent calculated values of the minimum `RMSE` stop improving and reach the most accurate possible value.
:::

##### **Value**
\

A data structure containing the minimum `RMSE` value reached during the fine-tuning process, the corresponding input parameter value, and information about the final sequence, on which the best output values were found:
```{r eval=FALSE}
  list(best_result = param_values.best_result,
       param_values.endpoints = c(prm_val.leftmost, prm_val.rightmost, seq_increment),
       tuned.result = data.frame(parameter.value = parameter.value,
                                 RMSE = result.RMSE))
```

::: {#func.model.tune.param_range.code .sidebar }
##### Source Code
\
Below is the simplified version of the source code of the [model.tune.param_range](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L198) function:
```{r eval=FALSE}
model.tune.param_range <- function(loop_starter,
                             tune_dir_path,
                             cache_file_base_name,
                             fn_tune.test.param_value,
                             max.identical.min_RMSE.count = 4,
                             is.cv = TRUE,
                             endpoint.min_diff = 0, #1e-07,
                             break.if_min = TRUE,
                             steps.beyond_min = 2){

  seq_start <- loop_starter[1]
  seq_end <- loop_starter[2]
  interval_divisor <- loop_starter[3]
  
  if (interval_divisor < 4) {
    interval_divisor <- 4
  }
  
  prm_val.leftmost <- seq_start
  prm_val.rightmost <- seq_end
  
  RMSE.leftmost <- NA
  RMSE.rightmost <- NA

  best_RMSE <- NA
  param.best_value <- 0
  
  
  param_values.best_result <- c(param.best_value = param.best_value, 
                                best_RMSE = best_RMSE)
  # Start repeat loop
  repeat{
    seq_increment <- (seq_end - seq_start)/interval_divisor 
    
    if (seq_increment < 0.0000000000001) {
      warning("Function `model.tune.param_range`:
parameter value increment is too small.")
      break
    }
    
    test_param_vals <- seq(seq_start, seq_end, seq_increment)
    
    tuned_result <- tune.model_param(test_param_vals, 
                                  fn_tune.test.param_value,
                                  break.if_min,
                                  steps.beyond_min)
    
    tuned.result <- tuned_result$tuned.result
    plot(tuned.result$parameter.value, tuned.result$RMSE)
    
    bound.idx <- get_fine_tune.param.endpoints.idx(tuned.result)
    start.idx <- bound.idx["start"]
    end.idx <- bound.idx["end"]
    best_RMSE.idx <- bound.idx["best"]
    
    prm_val.leftmost.tmp <- tuned.result$parameter.value[start.idx]
    RMSE.leftmost.tmp <- tuned.result$RMSE[start.idx]

    prm_val.rightmost.tmp <- tuned.result$parameter.value[end.idx]
    RMSE.rightmost.tmp <- tuned.result$RMSE[end.idx]
    
    min_RMSE <- tuned.result$RMSE[best_RMSE.idx]
    min_RMSE.prm_val <- tuned.result$parameter.value[best_RMSE.idx]

    seq_start <- prm_val.leftmost.tmp
    seq_end <- prm_val.rightmost.tmp
    
    if (is.na(best_RMSE)) {
      prm_val.leftmost <- prm_val.leftmost.tmp
      RMSE.leftmost <- RMSE.leftmost.tmp
      
      prm_val.rightmost <- prm_val.rightmost.tmp
      RMSE.rightmost <- RMSE.rightmost.tmp
      
      param.best_value <- min_RMSE.prm_val
      best_RMSE <- min_RMSE
    }
    
    if (RMSE.leftmost.tmp - min_RMSE >= endpoint.min_diff) {
      prm_val.leftmost <- prm_val.leftmost.tmp
      RMSE.leftmost <- RMSE.leftmost.tmp
    } 
    
    if (RMSE.rightmost.tmp - min_RMSE >= endpoint.min_diff) {
      prm_val.rightmost <- prm_val.rightmost.tmp
      RMSE.rightmost <- RMSE.rightmost.tmp
    } 
    
    if (end.idx - start.idx <= 0) {
      warning("`tuned.result$parameter.value` sequential start index are the same or greater than end one.")
      break
    }
    
    if (best_RMSE == min_RMSE) {
      warning("Currently computed minimal RMSE equals the previously reached best one: ",
              best_RMSE, "
Currently computed minial value is: ", min_RMSE)

      if (sum(tuned.result$RMSE[tuned.result$RMSE == min_RMSE]) >= max.identical.min_RMSE.count) {
        warning("Minimal `RMSE`identical values count reached it maximum allowed value: ",
                max.identical.min_RMSE.count)

        param_values.best_result <-
          get_best_param.result(tuned.result$parameter.value,
                                tuned.result$RMSE)
        break
      }

    } else if (best_RMSE < min_RMSE) {
      stop("Current minimal RMSE is greater than previously computed best value: ",
           best_RMSE, "
Currently computed minial value is: ", min_RMSE)
    }

    best_RMSE <- min_RMSE
    param.best_value <- min_RMSE.prm_val

    param_values.best_result <- 
      get_best_param.result(tuned.result$parameter.value, 
                          tuned.result$RMSE)
  }
  # End repeat loop
  
  n <- length(tuned.result$parameter.value)
  parameter.value <- tuned.result$parameter.value
  result.RMSE <- tuned.result$RMSE
  
  if (result.RMSE[1] == best_RMSE) {
    parameter.value[1] <- prm_val.leftmost
    result.RMSE[1] <- RMSE.leftmost
  }
  if (result.RMSE[n] == best_RMSE) {
    parameter.value[n+1] <- prm_val.rightmost
    result.RMSE[n+1] <- RMSE.rightmost
  }
  
  list(best_result = param_values.best_result,
       param_values.endpoints = c(prm_val.leftmost, prm_val.rightmost, seq_increment),
       tuned.result = data.frame(parameter.value = parameter.value,
                                 RMSE = result.RMSE))
}
```

::: {.noteblock data-latex=""}
The complete version of the source code of the [model.tune.param_range](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L198) is available in the [Model Tuning](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L78) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L198) script on _GitHub_.
:::
:::

\newpage

#### [get_fine_tune.param.endpoints](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L80) Function {#func.get_fine_tune.param.endpoints}
\

The algorithm finds the values of the nearest neighboring elements of the element corresponding to the minimum RMSE value in the given sequence.

##### Signature
\
```{r eval=FALSE}
get_fine_tune.param.endpoints <- function(preset.result) {
  # ...
  
  c(start = preset.result$parameter.value[i], 
    end = preset.result$parameter.value[j],
    best = preset.result$parameter.value[best.idx])
}
```

##### Arguments
\

::: {#func.get_fine_tune.param.endpoints.args.preset.result .sidebar }
###### ***preset.result***
\
A data structure compatible with the `tuned.result` item of the data structure returned by the [tune.model_param](#func.tune.model_param) function (see the [Value](#func.tune.model_param.value) subsection of the `tune.model_param` function description section for more details). Here is a sample of using this parameter in the `model.tune.param_range` function [code](#func.model.tune.param_range.code):
```{r eval=FALSE}
    tuned_result <- tune.model_param(test_param_vals, 
                                  fn_tune.test.param_value,
                                  break.if_min,
                                  steps.beyond_min)
    
    tuned.result <- tuned_result$tuned.result
    # tuned.result = data.frame(RMSE, parameter.value)
    # ...
    bound.idx <- get_fine_tune.param.endpoints(tuned.result)
    # bounnd.idx =  c(start.index, end.index, min_RMSE.index)
```
::: 

##### Details
\

Under the hood, the function internally calls another helper function [get_fine_tune.param.endpoints.idx](#func.get_fine_tune.param.endpoints.idx) described below to figure out the boundary indices of the range of values from the nearest neighborhood of the value corresponding to the best `RMSE` in the data passed in the [preset.result](#func.get_fine_tune.param.endpoints.args.preset.result) parameter.

##### Value
\
A vector containing the element value corresponding to the minimum `RMSE` in a given sequence, along with the values of its nearest neighboring elements:
```{r eval=FALSE}
  c(start = preset.result$parameter.value[i], 
    end = preset.result$parameter.value[j],
    best = preset.result$parameter.value[best.idx])
```

##### Source Code
\
The source code of the [get_fine_tune.param.endpoints](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L80) function is provided below:
```{r eval=FALSE}
get_fine_tune.param.endpoints <- function(preset.result) {

  preset.result.idx <- get_fine_tune.param.endpoints.idx(preset.result)
  
  i <- preset.result.idx["start"]
  j <- preset.result.idx["end"]
  best.idx <- preset.result.idx["best"]
  
  c(start = preset.result$parameter.value[i], 
    end = preset.result$parameter.value[j],
    best = preset.result$parameter.value[best.idx])
}
```

\newpage

#### [get_fine_tune.param.endpoints.idx](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L87) Function {#func.get_fine_tune.param.endpoints.idx}
\

##### Signature
\
```{r eval=FALSE}
get_fine_tune.param.endpoints.idx <- function(preset.result) {
  # ...
    
  c(start = i, 
    end = j,
    best = best_RMSE.idx)
}
```

##### Arguments
\

::: {#func.get_fine_tune.param.endpoints.idx.args.preset.result .sidebar }
###### ***preset.result***
\
A data structure compatible with the `tuned.result` item of the data structure returned by the [tune.model_param](#func.tune.model_param) function (see the [Value](#func.tune.model_param.value) subsection of the `tune.model_param` function description section for more details). Here is a sample of using this parameter in the `model.tune.param_range` function [code](#func.model.tune.param_range.code):
```{r eval=FALSE}
    tuned_result <- tune.model_param(test_param_vals, 
                                  fn_tune.test.param_value,
                                  break.if_min,
                                  steps.beyond_min)
    
    tuned.result <- tuned_result$tuned.result
    # tuned.result = data.frame(RMSE, parameter.value)
    # ...
    bound.idx <- get_fine_tune.param.endpoints.idx(tuned.result)
    # bounnd.idx =  c(start.index, end.index, min_RMSE.index)
```
::: 

##### Details
\
The algorithm finds the indices of the nearest neighboring elements of the element corresponding to the minimum RMSE value in the given sequence.

##### Value
\
A vector containing the index of the element corresponding to the minimum `RMSE` value in a given sequence, along with the indices of its nearest neighboring elements:
```{r eval=FALSE}
  c(start, # interval start index
    end,   # interval end index
    best)  # index of the best `RMSE`
```

##### Source Code
\
The source code of the [get_fine_tune.param.endpoints.idx](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L87) function is shown below:
```{r eval=FALSE}
get_fine_tune.param.endpoints.idx <- function(preset.result) {
  best_RMSE <- min(preset.result$RMSE)
  best_RMSE.idx <- which.min(preset.result$RMSE)
  # best_lambda <- preset.result$parameter.value[best_RMSE.idx]
  
  preset.result.N <- length(preset.result$RMSE)
  i <- best_RMSE.idx
  j <- i
  
  while (i > 1) {
    i <- i - 1
    
    if (preset.result$RMSE[i] > best_RMSE) {
      break
    }
  }
  
  while (j < preset.result.N) {
    j <- j + 1
    
    if (preset.result$RMSE[j] > best_RMSE) {
      break
    }
  }
  
  c(start = i, 
    end = j,
    best = best_RMSE.idx)
}

```

\newpage

#### [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) Function {#func.get_best_param.result}
\

##### Signature
\
```{r eval=FALSE}
get_best_param.result <- function(param_values, rmses){
  # ...
  
  c(param.best_value = param_values[best_pvalue_idx], 
    best_RMSE = rmses[best_pvalue_idx])

```

##### Arguments
\
A pair of matched vectors, the first of which contains the values of the input parameters for tuning, and the second, the corresponding values of the `RMSE`.
  
  - **param_values:** A vector containing the values of the input parameters for tuning;; 
  - **rmses:** A vector containing values of the corresponding `Root Mean Squared Errors`..

##### Details
\
Extracts the best values from the input data and returns them as a vector containing a pair of the best _input parameter_ value and the corresponding _minimum `RMSE`_.

##### Value
\
A vector containing a pair of the best _input parameter_ value and the corresponding _minimum `RMSE`_:
```{r eval=FALSE}
c(param.best_value, best_RMSE)
```

##### Source Code
\
The source code of the [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) function is shown below:
```{r eval=FALSE}
get_best_param.result <- function(param_values, rmses){
  best_pvalue_idx <- which.min(rmses)
  c(param.best_value = param_values[best_pvalue_idx], 
    best_RMSE = rmses[best_pvalue_idx])
```


## Data Helper Functions {#appndx_a.data_helper.functions}
\

### Initializing Input Datasets

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the the [Initializing input datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L88) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L88) script on _GitHub_.
:::

#### [make_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L89) Function {#func.make_source_datasets}
\

Creates the major input datasets used throughout the project. 

::: { #func.make_source_datasets.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
movielens_datasets <- make_source_datasets()

```
:::

::: { #func.make_source_datasets.details .sidebar }
##### Details
\

This function produces datasets listed in the [Value](#func.make_source_datasets.value) section below and described in detail in [Appendix B: Models Training Datasets] using the `edx` as the original dataset.

::: {.noteblock data-latex=""}
The function calls internally the following functions described below:

  - [splitGenreRows](#) to create the [`edx.sgr` Object];
  - [sample_train_validation_sets](#) to create *train* and *validation* sets of the inner datasets of the [`edx_CV` Object].

:::
:::

::: { #func.make_source_datasets.value .sidebar }
##### Value
\

The list of the following datasets are returned to the client code:

  - [`edx.mx` Matrix Object];
  
  - [`edx.sgr` Object];

  - [`movie_map` Object];
  
  - [`date_days_map` Object];

  - [`edx_CV` Object].

:::

::: { #func.make_source_datasets.code .sidebar }
##### Source Code
\

The source code of the [make_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L89) function is shown below:
```{r eval=FALSE}
make_source_datasets <- function(){
  put_log("Function: `make_source_datasets`: Creating source datasets...")
  
  put_log("Function: `make_source_datasets`: Creating Rating Matrix from `edx` dataset...")
  edx.mx <- edx |> 
    mutate(userId = factor(userId),
           movieId = factor(movieId)) |>
    select(movieId, userId, rating) |>
    pivot_wider(names_from = movieId, values_from = rating) |>
    column_to_rownames("userId") |>
    as.matrix()
  
  put_log("Function: `make_source_datasets`:
Matrix created: `edx.mx` of the following dimentions:")
  put(dim(edx.mx))

  #> To be able to map movie IDs to titles we create the following lookup table:
  movie_map <- edx |> select(movieId, title, genres) |> 
    distinct(movieId, .keep_all = TRUE)
  
  put_log("Function: `make_source_datasets`: Dataset created: movie_map")
  put(summary(movie_map))
  
  put_log("Function: `make_source_datasets`: Creating Date-Days Map dataset...")
  date_days_map <- edx |>
    mutate(date_time = as_datetime(timestamp)) |>
    mutate(date = as_date(date_time)) |>
    mutate(year = year(date_time)) |>
    mutate(days = as.integer(date - min(date))) |>
    select(timestamp, date_time, date, year, days) |>
    distinct(timestamp, .keep_all = TRUE)
  
  str(date_days_map)
  put_log("Function: `make_source_datasets`: Dataset created: date_days_map")
  put(summary(date_days_map))
  
  put_log("Function: `make_source_datasets`: 
To account for the Movie Genre Effect, we need a dataset with split rows 
for movies belonging to multiple genres.")
  edx.sgr <- splitGenreRows(edx)
  
  
  
  #> We will use K-fold cross validation as explained in 
  #> Section 29.6.1: "K-fold validation" of the Cource Textbook:
  #> https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation
  #> We are going to compute the following version of the MSE introducing in that section:
  
  # $$
  #   \mbox{MSE}(\lambda) \approx\frac{1}{B} \sum_{b = 1}^B \frac{1}{N}\sum_{i = 1}^N \left(\hat{y}_i^b(\lambda) - y_i^b\right)^2 
  # $$
  
  start <- put_start_date()
  edx_CV <- lapply(kfold_index,  function(fold_i){
    
    put_log1("Method `make_source_datasets`: 
Creating K-Fold Cross Validation Datasets, Fold %1", fold_i)
    
    #> We split the initial datasets into training sets, which we will use to build 
    #> and train our models, and validation sets in which we will compute the accuracy 
    #> of our predictions, the way described in the `Section 23.1.1 Movielens data`
    #> (https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#movielens-data) 
    #> of the Course Textbook.
    
    split_sets <- edx |>
      sample_train_validation_sets(fold_i*1000)
    
    train_set <- split_sets$train_set
    validation_set <- split_sets$validation_set
    
    put_log("Function: `make_source_datasets`: 
Sampling 20% from the split-row version of the `edx` dataset...")
    split_sets.gs <- edx.sgr |>
      sample_train_validation_sets(fold_i*2000)

    train.sgr <- split_sets.gs$train_set
    validation.sgr <- split_sets.gs$validation_set
    
    # put_log("Function: `make_source_datasets`: Dataset created: validation.sgr")
    # put(summary(validation.sgr))
    
    #> We will use the array representation described in `Section 17.5 of the Textbook`
    #> (https://rafalab.dfci.harvard.edu/dsbook-part-2/linear-models/treatment-effect-models.html#sec-anova), 
    #> for the training data. 
    #> To create this matrix, we use `tidyr::pivot_wider` function:
    
    # train_set <- mutate(train_set, userId = factor(userId), movieId = factor(movieId))
    # train.sgr <- mutate(train.sgr, userId = factor(userId), movieId = factor(movieId))
    
    put_log("Function: `make_source_datasets`: Creating Rating Matrix from Train Set...")
    train_mx <- train_set |> 
      mutate(userId = factor(userId),
             movieId = factor(movieId)) |>
      select(movieId, userId, rating) |>
      pivot_wider(names_from = movieId, values_from = rating) |>
      column_to_rownames("userId") |>
      as.matrix()
    
    put_log("Function: `make_source_datasets`:
Matrix created: `train_mx` of the following dimentions:")
    put(dim(train_mx))


    list(train_set = train_set,
         train_mx = train_mx,
         train.sgr = train.sgr,
         validation_set = validation_set)
  })
  put_end_date(start)
  put_log("Function: `make_source_datasets`: 
Set of K-Fold Cross Validation datasets created: edx_CV")
  
  tuning_sets <- edx |>
    sample_train_validation_sets(5423)
  
  list(edx_CV = edx_CV,
       edx.mx = edx.mx,
       edx.sgr = edx.sgr,
       tuning_sets = tuning_sets,
       movie_map = movie_map,
       date_days_map = date_days_map)
}
```

::: {.noteblock data-latex=""}
The source code of the [make_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L89) function is also available in the [Initializing input datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L88) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L89) script on _GitHub_.
:::
:::

#### [init_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L211) Function {#func.init_source_datasets}
\

Creates the major input datasets used throughout the project. 

::: { #func.init_source_datasets.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
movielens_datasets <- init_source_datasets()

```
:::

##### Details
\

The function checks whether the required source datasets are cached on the hard disk and, if so, loads them from the cache file.

Otherwise, it calls the [make_source_datasets](#func.make_source_datasets) function, which creates all the necessary datasets using the `edx` as the original dataset.

:::

::: { #func.init_source_datasets.value .sidebar }
##### Value
\

The list of the following datasets (described in detail in [Appendix B: Models Training Datasets]) is returned to the client code:

  - [`edx.mx` Matrix Object];
  
  - [`edx.sgr` Object];

  - [`movie_map` Object];
  
  - [`date_days_map` Object];

  - [`edx_CV` Object].

:::

::: { #func.init_source_datasets.code .sidebar }
##### Source Code
\

The simplified source code of the [init_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L211) function is shown below:
```{r eval=FALSE}
init_source_datasets <- function(){
  put_log("Method `init_source_datasets`: 
Initializing sourse datasets...")
  
  if(file.exists(movielens_datasets_file_path)){
    movielens_datasets <- load_movielens_data_from_file(movielens_datasets_file_path)
  } else if(file.exists(movielens_datasets_zip)) {
    put_log("Method `init_source_datasets`: 
Unzipping MovieLens data file from zip-archive: {movielens_datasets_zip}...") 
    
    unzip(movielens_datasets_zip, movielens_datasets_file_path)
    
    if(!file.exists(movielens_datasets_file_path)) {
      put_log("Method `init_source_datasets`: 
File does not exists: {movielens_datasets_file}.")
      stop("Failed to unzip MovieLens data zip-archive.")
    }
    
    movielens_datasets <- load_movielens_data_from_file(movielens_datasets_file_path)
  } else {
    put_log("Method `init_source_datasets`: 
Creating datasets...")
    library(edx.capstone.movielens.data)
    put_log("Method `init_source_datasets`: 
Library attached: 'edx.capstone.movielens.data'")
    
    movielens_datasets <- make_source_datasets()
    put("Method `init_source_datasets`: 
All required datasets have been created.")
    
    put_log("Method `init_source_datasets`: 
Saving newly created input datasets to file...")
    save(movielens_datasets, file =  movielens_datasets_file_path)

    if(!file.exists(movielens_datasets_file_path)) {
      put_log("Method `init_source_datasets`: 
File was not created: {movielens_datasets_file}.")
      warning("MovieLens data was not saved to file.")
    } else {
      put_log("Method `init_source_datasets`: 
Datasets have been saved to file: {movielens_datasets_file_path}.") 
      
      
      put_log("Method `init_source_datasets`: 
Creating zip-archive: {movielens_datasets_zip}...") 
      
      zip(movielens_datasets_zip, movielens_datasets_file_path)
      
      put_log("Method `init_source_datasets`: 
Zip-archive created: {movielens_datasets_zip}.")
    }
  }
  movielens_datasets
}
```

::: {.noteblock data-latex=""}
The complete source code of the [init_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L211) function is available in the [Initializing input datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L88) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L211) script on _GitHub_.
:::
:::

### Data Processing Functions

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) script on _GitHub_.
:::

#### [load_movielens_data_from_file](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L4) Function {#func.load_movielens_data_from_file}
\

::: { #func.load_movielens_data_from_file.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
```
:::

::: { #func.load_movielens_data_from_file.args .sidebar }
##### Arguments
\

:::
::: { #func.load_movielens_data_from_file.args.seed .sidebar }
  - **file_path:** Data file full path. 

:::
:::

::: { #func.load_movielens_data_from_file.details .sidebar }
##### Details
\



:::

::: { #func.load_movielens_data_from_file.value .sidebar }
##### Value
\

:::

::: { #func.load_movielens_data_from_file.code .sidebar }
##### Source Code
\

The source code of the [load_movielens_data_from_file](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L4) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [load_movielens_data_from_file](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L4) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L4) script on _GitHub_.
:::
:::

#### [splitByUser](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L14) Function {#func.splitByUser}
\

::: { #func.splitByUser.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
```
:::

::: { #func.splitByUser.args .sidebar }
##### Arguments
\

::: { #func.splitByUser.args.data .sidebar }
  - **data:** ; 

:::
:::

::: { #func.splitByUser.details .sidebar }
##### Details
\



:::

::: { #func.splitByUser.value .sidebar }
##### Value
\

:::

::: { #func.splitByUser.code .sidebar }
##### Source Code
\

The source code of the [splitByUser](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L14) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [splitByUser](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L14) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L14) script on _GitHub_.
:::
:::

#### [sample_train_validation_sets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) Function {#func.sample_train_validation_sets}
\

Splits the input dataset passed in the [data](#func.sample_train_validation_sets.args.data) argument into *train* and *validation* datasets in the way described in [Section 31.6 *Cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#cross-validation) of the _Course Textbook (New Edition)_[@IDS2_31-6].

::: { #func.sample_train_validation_sets.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
split_sets <- data |>
      sample_train_validation_sets(seed)
```
:::

::: { #func.sample_train_validation_sets.args .sidebar }
##### Arguments
\

::: { #func.sample_train_validation_sets.args.data .sidebar }
  - **data:** Input dataset to split; 

:::
::: { #func.sample_train_validation_sets.args.seed .sidebar }
  - **seed:** Seed value; 

:::
:::

::: { #func.sample_train_validation_sets.details .sidebar }
##### Details
\



:::

::: { #func.sample_train_validation_sets.value .sidebar }
##### Value
\

:::

::: { #func.sample_train_validation_sets.code .sidebar }
##### Source Code
\

The source code of the [sample_train_validation_sets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) function is shown below:
```{r eval=FALSE}
sample_train_validation_sets <- function(data, seed){
  put_log("Function: `sample_train_validation_sets`: Sampling 20% of the `data` data...")
  set.seed(seed)
  validation_ind <- 
    sapply(splitByUser(data),
           function(i) sample(i, ceiling(length(i)*.2))) |> 
    unlist() |> 
    sort()
  
  put_log("Function: `sample_train_validation_sets`: 
Extracting 80% of the original `data` not used for the Validation Set, 
excluding data for users who provided no more than a specified number of ratings: {min_nratings}.")
  
  train_set <- data[-validation_ind,]
  
  put_log("Function: `sample_train_validation_sets`: Dataset created: train_set")
  put(summary(train_set))
  
  put_log("Function: `sample_train_validation_sets`: 
To make sure we dont include movies in the Training Set that should not be there, 
we exclude entries using the semi_join function from the Validation Set.")
  tmp.data <- data[validation_ind,]
  
  validation_set <- tmp.data |> 
    semi_join(train_set, by = "movieId") |> 
    semi_join(train_set, by = "userId") |>
    as.data.frame()
  
  # Add rows excluded from `validation_set` into `train_set`
  tmp.excluded <- anti_join(tmp.data, validation_set)
  train_set <- rbind(train_set, tmp.excluded)
  
  put_log("Function: `sample_train_validation_sets`: Dataset created: validation_set")
  put(summary(validation_set))

  # CV train & test sets Consistency Test
  validation.left_join.Nas <- train_set |>
    mutate(tst.col = rating) |>
    select(userId, movieId, tst.col) |>
    data.consistency.test(validation_set)
  
  put_log("Function: `sample_train_validation_sets`:
Below are the data consistency verification results")
  put(validation.left_join.Nas)
  
  # Return result datassets    
  list(train_set = train_set, 
       validation_set = validation_set)
}
```

::: {.noteblock data-latex=""}
The source code of the [sample_train_validation_sets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) script on _GitHub_.
:::
:::

#### [mutateDateTimeAndDays](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L66) Function {#func.mutateDateTimeAndDays}
\

::: { #func.mutateDateTimeAndDays.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
```
:::

::: { #func.mutateDateTimeAndDays.args .sidebar }
##### Arguments
\

::: { #func.mutateDateTimeAndDays.args.data .sidebar }
  - **data:** ; 

:::
:::

::: { #func.mutateDateTimeAndDays.details .sidebar }
##### Details
\



:::

::: { #func.mutateDateTimeAndDays.value .sidebar }
##### Value
\

:::

::: { #func.mutateDateTimeAndDays.code .sidebar }
##### Source Code
\

The source code of the [mutateDateTimeAndDays](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L66) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [mutateDateTimeAndDays](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L66) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L66) script on _GitHub_.
:::
:::

#### [splitGenreRows](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L73) Function {#func.splitGenreRows}
\
Splits rows of the original dataset passed in the [data](#) argument for movies that belong to multiple genres.

::: { #func.splitGenreRows.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
dat.sgr <- splitGenreRows(data)
```
:::

::: { #func.splitGenreRows.args .sidebar }
##### Arguments
\

::: { #func.splitGenreRows.args.data .sidebar }
  - **data:** A dataset containing rows corresponding to movies that belong to multiple genres.. 

:::
:::

::: { #func.splitGenreRows.details .sidebar }
##### Details
\

This function is used internally in the [make_source_datasets](#func.make_source_datasets) function described above in the [Initializing Input Datasets] section to create the `edx.sgr` dataset described below in the [`edx.sgr` Object] section of the [Appendix B: Models Training Datasets].

:::

::: { #func.splitGenreRows.value .sidebar }
##### Value
\

:::

::: { #func.splitGenreRows.code .sidebar }
##### Source Code
\

The source code of the [splitGenreRows](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L73) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [splitGenreRows](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L73) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L73) script on _GitHub_.
:::
:::

#### [filter_noMore_nratings](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L82) Function {#func.filter_noMore_nratings}
\

::: { #func.filter_noMore_nratings.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
```
:::

::: { #func.filter_noMore_nratings.args .sidebar }
##### Arguments
\

::: { #func.filter_noMore_nratings.args.data .sidebar }
  - **data:** ; 

:::
::: { #func.filter_noMore_nratings.args.seed .sidebar }
  - **seed:** ; 

:::
:::

::: { #func.filter_noMore_nratings.details .sidebar }
##### Details
\



:::

::: { #func.filter_noMore_nratings.value .sidebar }
##### Value
\

:::

::: { #func.filter_noMore_nratings.code .sidebar }
##### Source Code
\

The source code of the [filter_noMore_nratings](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L82) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [filter_noMore_nratings](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L82) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L82) script on _GitHub_.
:::
:::

### Models Training Functions

#### [union_cv_results](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L432) Function {#func.union_cv_results}
\

Aggregates the input data frames into a single data frame.

::: { #func.union_cv_results.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
union_cv_results(data_list = data)

```
:::

::: { #func.union_cv_results.args .sidebar }
##### Arguments
\

::: { #func.union_cv_results.args.data_list .sidebar }
  - **data_list:** List of data frames representing the results of the _N-Fold Cross Validation_ method execution.; 

:::
:::

::: { #func.union_cv_results.details .sidebar }
##### Details
\

The function is used to aggregate the _N-Fold Cross Validation_ method result data into a single data frame for further processing.

:::

::: { #func.union_cv_results.value .sidebar }
##### Value
\

A data frame that is a union of the input data frames.
:::

::: { #func.union_cv_results.code .sidebar }
##### Source Code
\

The source code of the [union_cv_results](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L432) function is shown below:
```{r eval=FALSE}
union_cv_results <- function(data_list) {
  out_dat <- data_list[[1]]
  
  for (i in 2:CVFolds_N){
    out_dat <- union(out_dat, 
                     data_list[[i]])
  }
  
  out_dat
}
```

::: {.noteblock data-latex=""}
The source code of the [union_cv_results](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L432) is also available in the [Model training](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L431) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L432) script on _GitHub_.
:::
:::





#### [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) Function {#func.get_best_param.result}
\

Selects the best parameter value and the corresponding minimum Root Mean Squared Error value from the function's input arguments.

::: { #func.get_best_param.result.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
get_best_param.result(param_values, rmses)

```
:::

::: { #func.get_best_param.result.args .sidebar }
##### Arguments
\

::: { #func.get_best_param.result.args.param_values .sidebar }
  - **param_values:** List of parameters to choose the best value.; 

:::
::: { #func.get_best_param.result.args.rmses .sidebar }
  - **rmses:** A list of Root Mean Squared Errors corresponding to the parameter values specified in the list passed by the argument [param_values](#func.get_best_param.result.args.param_values). 

:::
:::

::: { #func.get_best_param.result.details .sidebar }
##### Details
\

A parameter value that corresponds to the minimum RMSE is considered the best.

:::

::: { #func.get_best_param.result.value .sidebar }
##### Value
\

A data frame that is a union of the input data frames.
:::

::: { #func.get_best_param.result.code .sidebar }
##### Source Code
\

The soure code of the [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) function is shown below:
```{r eval=FALSE}
get_best_param.result <- function(param_values, rmses){
  best_pvalue_idx <- which.min(rmses)
  c(param.best_value = param_values[best_pvalue_idx], 
    best_RMSE = rmses[best_pvalue_idx])
}
```

::: {.noteblock data-latex=""}
The source code of the [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) is also available in the [Model training](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L431) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) script on _GitHub_.
:::
:::

### Data Visualization Functions

#### [data.plot](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L592) Function {#func.data.plot}
\

Plots a graph based on the dataset passed in the [data](#func.data.plot.args.data) parameter, using both points and a line.

::: { #func.data.plot.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
data.plot(data, 
          title, 
          xname, 
          yname, 
          xlabel = NULL, 
          ylabel = NULL,
          line_col = "blue",
          normalize = FALSE)
```
:::

::: { #func.data.plot.args .sidebar }
##### Arguments
\

::: { #func.data.plot.args.data .sidebar }
  - **data:** Dataset to use for the plot; 

:::
::: { #func.data.plot.args.title .sidebar }
  - **title:** Title of the plot; 

:::
::: { #func.data.plot.args.xname .sidebar }
  - **xname:** The name of the dataset column used as the source of the $x$ variable for the plot; 

:::
::: { #func.data.plot.args.yname .sidebar }
  - **yname:** The name of the dataset column used as the source of the $y$ variable for the plot; 

:::
::: { #func.data.plot.args.xlabel .sidebar }
  - **xlabel = NULL:** The $x$ axis label. If `NULL`, the value of the `xname` parameter is used for the label; 

:::
::: { #func.data.plot.args.ylabel .sidebar }
  - **ylabel = NULL:** The $y$ axis label. If `NULL`, the value of the `yname` parameter is used for the label.; 

:::
::: { #func.data.plot.args.line_col .sidebar }
  - **line_col = blue:** The line color; 

:::
::: { #func.data.plot.args.normalize .sidebar }
  - **normalize = FALSE:** If `TRUE`, the deviation of $y$ from its mean is used to plot, rather than $y$ values. Otherwise, the value of $y$ is used.

:::
:::

::: { #func.data.plot.details .sidebar }
##### Details
\

The function is a wrapper for the [ggplot2::ggplot](https://ggplot2.tidyverse.org/reference/ggplot.html) function and is a simple and convenient tool for visualizing the data of this project.

:::

::: { #func.data.plot.code .sidebar }
##### Source Code
\

The soure code of the [data.plot](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L592) function is shown below:
```{r eval=FALSE}
data.plot <- function(data, 
                      title, 
                      xname, 
                      yname, 
                      xlabel = NULL, 
                      ylabel = NULL,
                      line_col = "blue",
                      normalize = FALSE) {
  y <- data[, yname]
  
  if (normalize) {
    y <- y - min(y)
  }
  
  if (is.null(xlabel)) {
    xlabel = xname
  }
  if (is.null(ylabel)) {
    ylabel = yname
  }
  
  aes_mapping <- aes(x = data[, xname], y = y)
  
  data |> 
    ggplot(mapping = aes_mapping) +
    ggtitle(title) +
    xlab(xlabel) +
    ylab(ylabel) +
    geom_point() + 
    geom_line(color=line_col)
}
```

::: {.noteblock data-latex=""}
The source code of the [data.plot](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L592) is also available in the [Data Visualization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L447) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L592) script on _GitHub_.
:::
:::

#### [data.plot.left.n](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L493) Function {#func.data.plot.left.n}
\

Plots a graph based on the first $n$ rows (the $n$ is specified by the [left.n](#func.data.plot.left.n.args.left.n) parameter) of the dataset passed in the [data](#func.data.plot.left.n.args.data) parameter, using both points and a line.

::: {.noteblock data-latex=""}
The dataset passed in the [data](#func.data.plot.left.n.args.data) parameter is assumed to be sorted by the column used for the $x$ axis (specified by the column name passed in the [xname](#func.data.plot.left.n.args.xname) parameter).
:::

::: { #func.data.plot.left.n.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
data.plot.left.n <- function(data, 
                             left.n = 0,
                             title, 
                             xname, 
                             yname, 
                             xlabel, 
                             ylabel,
                             line_col = "red",
                             normalize = FALSE)
```
:::

::: { #func.data.plot.left.n.args .sidebar }
##### Arguments
\

::: { #func.data.plot.left.n.args.data .sidebar }
  - **data:** Dataset to use for the plot. 

:::
::: { #func.data.plot.left.n.args.left.n .sidebar }
  - **left.n:** If a positive numeric value, specifies the number of the first rows of the dataset to plot. Otherwise, the entire dataset data is set to plot. 

:::
::: { #func.data.plot.left.n.args.title .sidebar }
  - **title:** Title of the plot. 

:::
::: { #func.data.plot.left.n.args.xname .sidebar }
  - **xname:** The name of the dataset column used as the source of the $x$ variable for the plot. 

:::
::: { #func.data.plot.left.n.args.yname .sidebar }
  - **yname:** The name of the dataset column used as the source of the $y$ variable for the plot. 

:::
::: { #func.data.plot.left.n.args.xlabel .sidebar }
  - *xlabel = NULL*:** The $x$ axis label. If `NULL`, the value of the `xname` parameter is used for the label. 

:::
::: { #func.data.plot.left.n.args.ylabel .sidebar }
  - **ylabel = NULL:** The $y$ axis label. If `NULL`, the value of the `yname` parameter is used for the label. 

:::
::: { #func.data.plot.left.n.args.line_col .sidebar }
  - **line_col = blue:** The line color. 

:::
::: { #func.data.plot.left.n.args.normalize .sidebar }
  - **normalize = FALSE:** If `TRUE`, the deviation of $y$ from its mean is used to plot, rather than $y$ values. Otherwise, the value of $y$ is used.

:::
:::

::: { #func.data.plot.left.n.details .sidebar }
##### Details
\

The function is a wrapper for the [data.plot](#func.data.plot) function described above and is a simple and convenient tool for more detailed visualization of the left part of the graph, initially built based on the entire data set passed in the [data](#func.data.plot.left.n.args.data) parameter.
:::

::: { #func.data.plot.left.n.code .sidebar }
##### Source Code
\

The source code of the [data.plot.left.n](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L493) function is shown below:
```{r eval=FALSE}
data.plot.left.n <- function(data, 
                             left.n = 0,
                             title, 
                             xname, 
                             yname, 
                             xlabel, 
                             ylabel,
                             line_col = "red",
                             normalize = FALSE) {
  x_col <- data[, xname] 
  y_col <- data[, yname]
  
  
  data.left <- data
  
  if (left.n > 0) {
    data.left <- data |> 
      head(left.n)
  }
  
  data.left |>
    data.plot(title = title,
              xname = xname,
              yname = yname,
              xlabel = xlabel,
              ylabel = ylabel,
              line_col = line_col,
              normalize = normalize)
}
```

::: {.noteblock data-latex=""}
The source code of the [data.plot.left.n](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L493) is also available in the [Data Visualization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L447) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L493) script on _GitHub_.
:::
:::

#### [data.plot.left_detailed](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L448) Function {#func.data.plot.left_detailed}
\

Combines two graphs plotted by the internally called helper functions in a grid: the first is a standard graph plotted by the [data.plot](#func.data.plot) function described above, the second is a graph based on the first $n$ rows (the $n$ is specified by the [left.n](#func.data.plot.left.n.args.left.n) parameter) of the dataset plotted by the [data.plot.left.n](#func.data.plot.left.n) function also described above (The data for both graphs is passed in the [data]).(#func.data.plot.left.n.args.data) parameter).

::: {.noteblock data-latex=""}
The dataset passed in the [data](#func.data.plot.left.n.args.data) parameter is assumed to be sorted by the column used for the $x$ axis (specified by the column name passed in the [xname](#func.data.plot.left.n.args.xname) parameter).
:::

::: { #func.data.plot.left_detailed.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
data.plot.left_detailed <- function(data, 
                                    left.n = 0,
                                    title = NULL,
                                    title.left = NULL,
                                    xname, 
                                    yname, 
                                    xlabel1 = NULL, 
                                    xlabel2 = NULL, 
                                    ylabel1 = NULL,
                                    ylabel2 = NULL,
                                    line_col1 = "blue",
                                    line_col2 = "red",
                                    normalize = FALSE)
```
:::

::: { #func.data.plot.left_detailed.args .sidebar }
##### Arguments
\

::: { #func.data.plot.left_detailed.args.data .sidebar }
  - **data:** Dataset to use for the plot. 

:::
::: { #func.data.plot.left.n.args.left.n .sidebar }
  - **left.n:** If a positive numeric value, specifies the number of the first rows of the dataset to plot. Otherwise, the entire dataset data is set to plot. 

:::
::: { #func.data.plot.left_detailed.args.title .sidebar }
  - **title:** Title of the plot. 

:::
::: { #func.data.plot.left_detailed.args.xname .sidebar }
  - **xname:** The name of the dataset column used as the source of the $x$ variable for the plot. 

:::
::: { #func.data.plot.left_detailed.args.yname .sidebar }
  - **yname:** The name of the dataset column used as the source of the $y$ variable for the plot. 

:::
::: { #func.data.plot.left_detailed.args.xlabel1 .sidebar }
  - *xlabel1 = NULL*:** The $x$ axis label for the first plot. If `NULL`, the value of the `xname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.xlabel2 .sidebar }
  - *xlabel2 = NULL*:** The $x$ axis label for the second plot. If `NULL`, the value of the `xname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.ylabel1 .sidebar }
  - **ylabel1 = NULL:** The $y$ axis label for the first plot. If `NULL`, the value of the `yname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.ylabel2 .sidebar }
  - **ylabel2 = NULL:** The $y$ axis label for the second plot. If `NULL`, the value of the `yname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.line_col .sidebar }
  - **line_col = blue:** The line color. 

:::
::: { #func.data.plot.left_detailed.args.normalize .sidebar }
  - **normalize = FALSE:** If `TRUE`, the deviation of $y$ from its mean is used to plot, rather than $y$ values. Otherwise, the value of $y$ is used.

:::
:::

::: { #func.data.plot.left_detailed.details .sidebar }
##### Details
\

Under the hood, the function calls internally the [data.plot](#func.data.plot) and [data.plot.left.n](#func.data.plot.left.n) functions (described above) to build two graphs and combines them into a grid.
:::

::: { #func.data.plot.left_detailed.code .sidebar }
##### Source Code
\

The soure code of the [data.plot.left_detailed](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L448) function is shown below:
```{r eval=FALSE}
data.plot.left_detailed <- function(data, 
                                    left.n = 0,
                                    title = NULL,
                                    title.left = NULL,
                                    xname, 
                                    yname, 
                                    xlabel1 = NULL, 
                                    xlabel2 = NULL, 
                                    ylabel1 = NULL,
                                    ylabel2 = NULL,
                                    line_col1 = "blue",
                                    line_col2 = "red",
                                    normalize = FALSE) {
  if(is.null(xlabel1)) {
    xlabel1 <- xname
  }
  if(is.null(xlabel2)) {
    xlabel2 <- str_glue(xlabel1, " (left part)")
  }
  if(is.null(ylabel1)) {
    ylabel1 <- yname
  }
  if(is.null(ylabel2)) {
    ylabel2 <- ylabel1
  }
  
  p1 <- data |>
    data.plot(title = title,
              xname = xname, 
              yname = yname, 
              xlabel = xlabel1, 
              ylabel = ylabel1,
              line_col = line_col1)
  
  p2 <- data |>
    data.plot.left.n(left.n = left.n,
                     title = title.left,
                     xname = xname, 
                     yname = yname, 
                     xlabel = xlabel2, 
                     ylabel = ylabel2,
                     line_col = line_col2,
                     normalize = normalize)
  grid.arrange(p1, p2)
}
```

::: {.noteblock data-latex=""}
The source code of the [data.plot.left_detailed](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L448) is also available in the [Data Visualization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L447) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L448) script on _GitHub_.
:::
:::

\newpage

## Models Training: Support Functions
\

### Overal Mean Rating (OMR) Model Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the [OMR-model.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R) script on _GitHub_.
:::

#### [@@func](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/@@script.R#LX) Function {#func.@@func}
\

::: { #func.@@func.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
@@func()

```
:::

::: { #func.@@func.args .sidebar }
##### Arguments
\

::: { #func.@@func.args. .sidebar }
  - **x:** ; 

:::
:::

::: { #func.@@func.details .sidebar }
##### Details
\



:::

::: { #func.@@func.value .sidebar }
##### Value
\

:::

::: { #func.@@func.code .sidebar }
##### Source Code
\

The source code of the [@@func](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/@@script.R#LX) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [@@func](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#LX) function is also available in the [@@script.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/@@script.R#LX) script on _GitHub_.
:::
:::





# Appendix B: Models Training Datasets {#appndx_b}
\

## `edx.mx` Matrix Object
\

We use the array representation described in [Section 18.5 *Analysis of variance (ANOVA)*](https://rafalab.dfci.harvard.edu/dsbook-part-2/linear-models/treatment-effect-models.html#sec-anova) of the _Course Textbook (New Edition)_, for the training data[@IDS2_18-5]. For this purpose, we will convert the `edx` dataset into a matrix using the `tidyr::pivot_wider` function:

```{r eval=FALSE}

  put_log("Function: `make_source_datasets`: Creating Rating Matrix from `edx` dataset...")
  edx.mx <- edx |> 
    mutate(userId = factor(userId),
           movieId = factor(movieId)) |>
    select(movieId, userId, rating) |>
    pivot_wider(names_from = movieId, values_from = rating) |>
    column_to_rownames("userId") |>
    as.matrix()
  
  put_log("Function: `make_source_datasets`:
Matrix created: `edx.mx` of the following dimentions:")
  put(dim(edx.mx))
```

```{r}
  str(edx.mx)
```

## `edx.sgr` Object
\

To account for the Movie Genre Effect more accurately, we need a dataset with split rows for movies belonging to multiple genres:
```{r eval=FALSE}
  put_log("Function: `make_source_datasets`: 
To account for the Movie Genre Effect, we need a dataset with split rows 
for movies belonging to multiple genres.")
  edx.sgr <- splitGenreRows(edx)
```
```{r}
str(edx.sgr)
summary(edx.sgr)
```

Note that we use the [splitGenreRows](#func.splitGenreRows) function described above to split rows of the original dataset:
```{r eval=FALSE}
splitGenreRows <- function(data){
  put("Splitting dataset rows related to multiple genres...")
  start <- put_start_date()
  gs_splitted <- data |>
    separate_rows(genres, sep = "\\|")
  put("Dataset rows related to multiple genres have been splitted to have single genre per row.")
  put_end_date(start)
  gs_splitted
}
```

::: {.noteblock data-latex=""}
The [source code](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L73) of the function mentioned above is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R) script on _GitHub_.
:::

## `movie_map` Object
\

To be able to map movie IDs to titles we create the following lookup table:
```{r eval=FALSE}
movie_map <- edx |> select(movieId, title, genres) |> 
    distinct(movieId, .keep_all = TRUE)
  
  put_log("Function: `make_source_datasets`: Dataset created: movie_map")
```

```{r}
str(movie_map)
summary(movie_map)
```

Note that titles cannot be considered unique, so we cannot use them as IDs[@IDS2_25-1].


## `date_days_map` Object
\

We have a `timestamp` field in the `edx` dataset.
To be able to map the date, year, and number of days since the earliest record in the `edx` dataset with the corresponding value in this field, we create the following lookup table:
```{r eval=FALSE}
  put_log("Function: `make_source_datasets`: Creating Date-Days Map dataset...")
  date_days_map <- edx |>
    mutate(date_time = as_datetime(timestamp)) |>
    mutate(date = as_date(date_time)) |>
    mutate(year = year(date_time)) |>
    mutate(days = as.integer(date - min(date))) |>
    select(timestamp, date_time, date, year, days) |>
    distinct(timestamp, .keep_all = TRUE)
  
  put_log("Function: `make_source_datasets`: Dataset created: date_days_map")
```
``` {r}
  str(date_days_map)
  summary(date_days_map)
```

## `edx_CV` Object
\

Here we have a list of sample objects we need to perform the _5-Fold Cross Validation_ 
as explained in [Section 31.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_31-6]:
```{r eval=FALSE}
  start <- put_start_date()
  edx_CV <- lapply(kfold_index,  function(fold_i){
    
    put_log1("Method `make_source_datasets`: 
Creating K-Fold Cross Validation Datasets, Fold %1", fold_i)
    
    #> We split the initial datasets into training sets, which we will use to build 
    #> and train our models, and validation sets in which we will compute the accuracy 
    #> of our predictions, the way described in the `Section 23.1.1 Movielens data`
    #> (https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#movielens-data) 
    #> of the Course Textbook.
    
    split_sets <- edx |>
      sample_train_validation_sets(fold_i*1000)
    
    train_set <- split_sets$train_set
    validation_set <- split_sets$validation_set
    
    put_log("Function: `make_source_datasets`: 
Sampling 20% from the split-row version of the `edx` dataset...")
    split_sets.gs <- edx.sgr |>
      sample_train_validation_sets(fold_i*2000)

    train.sgr <- split_sets.gs$train_set
    validation.sgr <- split_sets.gs$validation_set
    
    # put_log("Function: `make_source_datasets`: Dataset created: validation.sgr")
    # put(summary(validation.sgr))
    
    #> We will use the array representation described in `Section 17.5 of the Textbook`
    #> (https://rafalab.dfci.harvard.edu/dsbook-part-2/linear-models/treatment-effect-models.html#sec-anova), 
    #> for the training data. 
    #> To create this matrix, we use `tidyr::pivot_wider` function:
    
    put_log("Function: `make_source_datasets`: Creating Rating Matrix from Train Set...")
    train_mx <- train_set |> 
      mutate(userId = factor(userId),
             movieId = factor(movieId)) |>
      select(movieId, userId, rating) |>
      pivot_wider(names_from = movieId, values_from = rating) |>
      column_to_rownames("userId") |>
      as.matrix()
    
    put_log("Function: `make_source_datasets`:
Matrix created: `train_mx` of the following dimentions:")
    put(dim(train_mx))


    list(train_set = train_set,
         train_mx = train_mx,
         train.sgr = train.sgr,
         validation_set = validation_set)
  })
  put_end_date(start)
  put_log("Function: `make_source_datasets`: 
Set of K-Fold Cross Validation datasets created: edx_CV")
```
```{r}
str(edx_CV)
```

::: {.noteblock data-latex=""}
This code snippet is a [part](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L140) of the [make_source_datasets](#func.make_source_datasets) _function_ code described above.
:::

Note that we used the [sample_train_validation_sets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) function call to split the original dataset (`edx` in this case): 
```{r eval=FALSE}
    split_sets <- edx |>
      sample_train_validation_sets(fold_i*1000)
```

which returns a pair of train/validation sets:
```{r eval=FALSE}
sample_train_validation_sets <- function(data, seed){
  put_log("Function: `sample_train_validation_sets`: Sampling 20% of the `data` data...")
  set.seed(seed)
  validation_ind <- 
    sapply(splitByUser(data),
           function(i) sample(i, ceiling(length(i)*.2))) |> 
    unlist() |> 
    sort()
  
  put_log("Function: `sample_train_validation_sets`: 
Extracting 80% of the original `data` not used for the Validation Set, 
excluding data for users who provided no more than a specified number of ratings: {min_nratings}.")
  
  train_set <- data[-validation_ind,]
  
  put_log("Function: `sample_train_validation_sets`: Dataset created: train_set")
  put(summary(train_set))
  
  put_log("Function: `sample_train_validation_sets`: 
To make sure we dont include movies in the Training Set that should not be there, 
we exclude entries using the semi_join function from the Validation Set.")
  tmp.data <- data[validation_ind,]
  
  validation_set <- tmp.data |> 
    semi_join(train_set, by = "movieId") |> 
    semi_join(train_set, by = "userId") |>
    as.data.frame()
  
  # Add rows excluded from `validation_set` into `train_set`
  tmp.excluded <- anti_join(tmp.data, validation_set)
  train_set <- rbind(train_set, tmp.excluded)
  
  put_log("Function: `sample_train_validation_sets`: Dataset created: validation_set")
  put(summary(validation_set))

  # CV train & test sets Consistency Test
  validation.left_join.Nas <- train_set |>
    mutate(tst.col = rating) |>
    select(userId, movieId, tst.col) |>
    data.consistency.test(validation_set)
  
  put_log("Function: `sample_train_validation_sets`:
Below are the data consistency verification results")
  put(validation.left_join.Nas)
  
  # Return result datassets ----------------------------------------------------    
  list(train_set = train_set, 
       validation_set = validation_set)
}

```

::: {.noteblock data-latex=""}
The [sample_train_validation_sets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) function is defined in the same script as the [make_source_datasets](#func.make_source_datasets), from which it is called.
:::

\newpage




# End of Report -------------------------------------------------------------
