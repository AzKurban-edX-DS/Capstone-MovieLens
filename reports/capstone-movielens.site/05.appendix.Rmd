# Appendix A: Support Functions {#appndx_a}
## Common Helper Functions
### Logging Functions {#appndx_a.CHF.logging-funcs}

::: {.noteblock data-latex=""}
The full source code of the functions described in this section is available in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R) script on _GitHub_.
:::

#### [open_logfile](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L3) Function {#func.open_logfile}
\

A function to initialize the log file.

::: { #func.open_logfile.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
open_logfile(file_name)
```
:::

::: { #func.open_logfile.args .sidebar }
##### Arguments
\

::: { #func.open_logfile.args.file_name .sidebar }
  - **file_name:** A name used as a base to generate a unique log file name; 

:::
:::

::: { #func.open_logfile.details .sidebar }
##### Details
\

This function is a wrapper for the [logr::log_open](https://www.rdocumentation.org/packages/logr/versions/1.3.9/topics/log_open) function. It also calls internally the following functions to generate a unique file name based on the [file_name](#func.open_logfile.args.file_name) argument and _system time_:

  - [Sys.time](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/Sys.time);
  
  - [stringr::str_replace](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace);
  
  - [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace)

For more information on the _inner functions_ listed above, see the [R Documentation](https://www.rdocumentation.org/).

:::

::: { #func.open_logfile.value .sidebar }
##### Value
\

The path of the log.

:::

::: { #func.open_logfile.code .sidebar }
##### Source Code
\

The source code of the [open_logfile](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L3) function is shown below:
```{r eval=FALSE}
library(logr)
library(stringr)

open_logfile <- function(file_name){
  log_file_name <- as.character(Sys.time()) |> 
    str_replace_all(':', '_') |> 
    str_replace(' ', 'T') |>
    str_c(file_name)
  
  log_open(file_name = log_file_name)
}
```

::: {.noteblock data-latex=""}
The source code of the [open_logfile](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L3) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L3) script on _GitHub_.
:::
:::

#### [print_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L11) Function {#func.print_start_date}
\

Prints the system date and time at the time the function is called and returns the system's idea of the current date and time.

::: { #func.print_start_date.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
print_start_date()
```
:::

::: { #func.print_start_date.details .sidebar }
##### Details
\

This function internally calls [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print), [base::date](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/date), and [base::Sys.time](https://www.rdocumentation.org/link/Sys.time?package=base&version=3.6.2) `R` functions.

It first prints the value returned by the `date` function, then returns the object returned by the `Sys.time` function.
:::

::: { #func.print_start_date.value .sidebar }
##### Value
\

An object of class `POSIXct` (see [DateTimeClasses](https://www.rdocumentation.org/link/DateTimeClasses?package=base&version=3.6.2)). 

:::

::: { #func.print_start_date.code .sidebar }
##### Source Code
\

The source code of the [print_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L11) function is shown below:
```{r eval=FALSE}
print_start_date <- function(){
  print(date())
  Sys.time()
}
```

::: {.noteblock data-latex=""}
The source code of the [print_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L11) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L11) script on _GitHub_.
:::
:::

#### [put_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L15) Function {#func.put_start_date}
\

Outputs the system date and time to the currently opened log (using the [open_logfile](#func.open_logfile) function described above) at the time the function is called and returns the system's idea of the current date and time.

::: { #func.put_start_date.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
put_start_date()
```
:::

::: { #func.put_start_date.details .sidebar }
##### Details
\

This function internally calls [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print), [base::date](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/date), and [base::Sys.time](https://www.rdocumentation.org/link/Sys.time?package=base&version=3.6.2) `R` functions.

It first outputs the value returned by the `date` function to the currently opened log, then returns the object returned by the `Sys.time` function.
:::

::: { #func.put_start_date.value .sidebar }
##### Value
\

An object of class `POSIXct` (see [DateTimeClasses](https://www.rdocumentation.org/link/DateTimeClasses?package=base&version=3.6.2)). 

:::

::: { #func.put_start_date.code .sidebar }
##### Source Code
\

The source code of the [put_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L15) function is shown below:
```{r eval=FALSE}
put_start_date <- function(){
  put(date())
  Sys.time()
}
```

::: {.noteblock data-latex=""}
The source code of the [put_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L15) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L15) script on _GitHub_.
:::
:::

#### [print_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L19) Function {#func.print_end_date}
\

Prints the system date and time at the time the function is called, and then the time elapsed since the date and time specified by the [start](#func.print_end_date.args.start) argument.

::: { #func.print_end_date.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
print_end_date(start)
```
:::

::: { #func.print_end_date.args .sidebar }
##### Arguments
\

::: { #func.print_end_date.args.start .sidebar }
  - **start:** An object of class `POSIXct` representing the value of the moment from which time is measured. 

:::
:::

::: { #func.print_end_date.details .sidebar }
##### Details
\

This function internally calls [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print), [base::date](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/date), and [base::Sys.time](https://www.rdocumentation.org/link/Sys.time?package=base&version=3.6.2) `R` functions.

It first prints the value returned by the `date` function, then builds an object of class `difftime` representing the time elapsed since the date and time specified by the [start](#func.print_end_date.args.start) argument, prints the object, and, finally, returns the object to the client code.

:::

::: { #func.print_end_date.value .sidebar }
##### Value
\

An object of class `difftime` representing the time elapsed since the date and time specified by the [start](#func.print_end_date.args.start) argument. 

:::

::: { #func.print_end_date.code .sidebar }
##### Source Code
\

The source code of the [print_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L19) function is shown below:
```{r eval=FALSE}
print_end_date <- function(start){
  print(date())
  print(Sys.time() - start)
}
```

::: {.noteblock data-latex=""}
The source code of the [print_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L19) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L19) script on _GitHub_.
:::
:::

#### [put_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L23) Function {#func.put_end_date}
\

Outputs the system date and time to the currently open log (using the [open_logfile](#func.open_logfile) function described above).

The first value in the output is the system date and time at the time the function is called, and the second value is the time elapsed since the date and time specified by the [start](#func.put_end_date.args.start) argument.

::: { #func.put_end_date.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
put_end_date(start)
```
:::

::: { #func.put_end_date.args .sidebar }
##### Arguments
\

::: { #func.put_end_date.args.start .sidebar }
  - **start:** An object of class `POSIXct` representing the value of the moment from which time is measured. 

:::
:::

::: { #func.put_end_date.details .sidebar }
##### Details
\

This function works similarly to the [print_end_date](#func.print_end_date) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_end_date.value .sidebar }
##### Value
\

An object of class `difftime` representing the time elapsed since the date and time specified by the [start](#func.put_end_date.args.start) argument. 

:::

::: { #func.put_end_date.code .sidebar }
##### Source Code
\

The source code of the [put_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L23) function is shown below:
```{r eval=FALSE}
put_end_date <- function(start){
  put(date())
  put(Sys.time() - start)
}
```

::: {.noteblock data-latex=""}
The source code of the [put_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L23) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L23) script on _GitHub_.
:::
:::

#### [print_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L28) Function {#func.print_log}
\

Prints a multiline string specified by the [msg](#func.print_log.args.msg) argument.

::: { #func.print_log.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
print_log(msg)
```
:::

::: { #func.print_log.args .sidebar }
##### Arguments
\

::: { #func.print_log.args.msg .sidebar }
  - **msg:** A string to print (can be multiline). 

:::
:::

::: { #func.print_log.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` functions to print the (possibly multiline) string specified by the [msg](#func.print_log.args.msg) argument.

:::

::: { #func.print_log.value .sidebar }
##### Value
\

A glue object, as created by [glue::as_glue()](https://glue.tidyverse.org/reference/glue.html) 

:::

::: { #func.print_log.code .sidebar }
##### Source Code
\

The source code of the [print_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L28) function is shown below:
```{r eval=FALSE}
print_log <- function(msg){
  print(str_glue(msg))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L28) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L28) script on _GitHub_.
:::
:::

#### [put_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L31) Function {#func.put_log}
\

Outputs a multiline string specified by the [msg](#func.put_log.args.msg) argument to the currently opened log (using the [open_logfile](#func.open_logfile) function described above).

::: { #func.put_log.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
put_log(msg)
```
:::

::: { #func.put_log.args .sidebar }
##### Arguments
\

::: { #func.put_log.args.msg .sidebar }
  - **msg:** A string to print (can be multiline). 

:::
:::

::: { #func.put_log.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` functions to output the (possibly multiline) string specified by the [msg](#func.put_log.args.msg) argument.

The function works similarly to the [print_log](#func.print_log) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log.value .sidebar }
##### Value
\

A glue object, as created by [glue::as_glue()](https://glue.tidyverse.org/reference/glue.html) 

:::

::: { #func.put_log.code .sidebar }
##### Source Code
\

The source code of the [put_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L31) function is shown below:
```{r eval=FALSE}
put_log <- function(msg){
  put(str_glue(msg))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L31) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L31) script on _GitHub_.
:::
:::

#### [get_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L35) Function {#func.get_log1}
\

Creates a character vector from the template passed in the [msg_template](#func.get_log1.args.msg_template) argument, using the value specified by the [arg1](#func.get_log1.args.arg1) argument to replace all the occurrences of the pattern `%1` found in the template.

::: { #func.get_log1.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
get_log1(msg_template, arg1)
```
:::

::: { #func.get_log1.args .sidebar }
##### Arguments
\

::: { #func.get_log1.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of the pattern `%1` to be replaced by the value specified by the [arg1](#func.get_log1.args.arg1) argument. 

:::

::: { #func.get_log1.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the pattern `%1` in the message template passed in the [msg_template](#func.get_log1.args.msg_template) argument. 

:::
:::

::: { #func.get_log1.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` functions to form a character vector from the template passed in the [msg_template](#func.get_log1.args.msg_template) argument, using the value specified by the [arg1](#func.get_log1.args.arg1)  argument to replace all the occurrences of the pattern `%1` found in the template.

:::

::: { #func.get_log1.value .sidebar }
##### Value
\

A glue object, returned by the internally called [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) function, created from the character vector returned by the (also internally called) function [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).

:::

::: { #func.get_log1.code .sidebar }
##### Source Code
\

The source code of the [get_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L35) function is shown below:
```{r eval=FALSE}
get_log1 <- function(msg_template, arg1) {
  str_glue(str_replace_all(msg_template, "%1", as.character(arg1)))
}
```

::: {.noteblock data-latex=""}
The source code of the [get_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L35) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L35) script on _GitHub_.
:::
:::

\newpage

#### [print_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L38) Function {#func.print_log1}
\

Prints a log created from the template passed in the [msg_template](#func.print_log1.args.msg_template) argument, using the value specified by the [arg1](#func.print_log1.args.arg1) argument to replace all the occurrences of the pattern `%1` found in the template.

::: { #func.print_log1.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
print_log1(msg_template, arg1)
```
:::

::: { #func.print_log1.args .sidebar }
##### Arguments
\

::: { #func.print_log1.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of the pattern `%1` to be replaced by the value specified by the [arg1](#func.print_log1.args.arg1) argument. 

:::

::: { #func.print_log1.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the pattern `%1` in the message template passed in the [msg_template](#func.print_log1.args.msg_template) argument. 

:::
:::

::: { #func.print_log1.details .sidebar }
##### Details
\

This function internally calls the [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` function to print the object returned by the [get_log1](#func.get_log1) function (also called internally) described above.

:::

::: { #func.print_log1.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log1](#func.get_log1) described above.
:::

::: { #func.print_log1.code .sidebar }
##### Source Code
\

The source code of the [print_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L38) function is shown below:
```{r eval=FALSE}
print_log1 <- function(msg_template, arg1){
  print(get_log1(msg_template, arg1))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L38) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L38) script on _GitHub_.
:::
:::

\newpage

#### [put_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L41) Function {#func.put_log1}
\

Outputs a log to the currently open log file (using the [open_logfile](#func.open_logfile) function described above), created from the template passed in the [msg_template](#func.put_log1.args.msg_template) argument, using the value specified by the [arg1](#func.put_log1.args.arg1) argument to replace all the occurrences of the pattern `%1` found in the template.

::: { #func.put_log1.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
put_log1(msg_template, arg1)
```
:::

::: { #func.put_log1.args .sidebar }
##### Arguments
\

::: { #func.put_log1.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of the pattern `%1` to be replaced by the value specified by the [arg1](#func.put_log1.args.arg1) argument. 

:::

::: { #func.put_log1.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the pattern `%1` in the message template passed in the [msg_template](#func.put_log1.args.msg_template) argument. 

:::
:::

::: { #func.put_log1.details .sidebar }
##### Details
\

This function internally calls the [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` function to output the log object returned by the (also called internally) [get_log1](#func.get_log1) function described above.

The function works similarly to the [print_log1](#func.print_log1) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log1.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log1](#func.get_log1) described above.

:::

::: { #func.put_log1.code .sidebar }
##### Source Code
\

The source code of the [put_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L41) function is shown below:
```{r eval=FALSE}
put_log1 <- function(msg_template, arg1){
  put(get_log1(msg_template, arg1))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L41) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L41) script on _GitHub_.
:::
:::

\newpage

#### [get_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L45) Function {#func.get_log2}
\

Creates a character vector from the template passed in the [msg_template](#func.get_log2.args.msg_template) argument, using the values specified by the [arg1](#func.get_log2.args.arg1) and [arg2](#func.get_log2.args.arg2) arguments to replace all the occurrences of the placeholders `%1` and `%2`, respectively, found in the template.

::: { #func.get_log2.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
get_log2(msg_template, arg1, arg2)
```
:::

::: { #func.get_log2.args .sidebar }
##### Arguments
\

::: { #func.get_log2.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1` and `%2`, to be replaced by the values specified by the [arg1](#func.get_log2.args.arg1) and  [arg2](#func.get_log2.args.arg2) arguments, respectively.

:::

::: { #func.get_log2.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.get_log2.args.msg_template) argument. 

:::

::: { #func.get_log2.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.get_log2.args.msg_template) argument. 

:::
:::

::: { #func.get_log2.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` functions to form a character vector from the template passed in the [msg_template](#func.get_log2.args.msg_template) argument, using the values specified by the [arg1](#func.get_log2.args.arg1) and [arg2](#func.get_log2.args.arg2)  arguments to replace all the occurrences of the placeholders `%1` and `%2`, respectively, found in the template.

:::

::: { #func.get_log2.value .sidebar }
##### Value
\

A glue object, returned by the internally called [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) function, created from the character vector returned by the (also internally called) function [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).

:::

::: { #func.get_log2.code .sidebar }
##### Source Code
\

The source code of the [get_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L45) function is shown below:
```{r eval=FALSE}
get_log2 <- function(msg_template, arg1, arg2) {
  msg_template |> 
    str_replace_all("%1", as.character(arg1)) |>
    str_replace_all("%2", as.character(arg2)) |>
    str_glue()
}
```

::: {.noteblock data-latex=""}
The source code of the [get_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L45) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L45) script on _GitHub_.
:::
:::

\newpage

#### [print_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L51) Function {#func.print_log2}
\

Prints a log created from the template passed in the [msg_template](#func.print_log2.args.msg_template) argument, using the values specified by the [arg1](#func.print_log2.args.arg1) and [arg2](#func.print_log2.args.arg2) arguments to replace all the occurrences of the placeholders `%1` and `%2`, respectively, found in the template.

::: { #func.print_log2.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
print_log2(msg_template, arg1, arg2)
```
:::

::: { #func.print_log2.args .sidebar }
##### Arguments
\

::: { #func.print_log2.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1` and `%2`, to be replaced by the values specified by the [arg1](#func.print_log2.args.arg1) and  [arg2](#func.print_log2.args.arg2) arguments, respectively.

:::

::: { #func.print_log2.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.print_log2.args.msg_template) argument. 

:::

::: { #func.print_log2.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.print_log2.args.msg_template) argument. 

:::
:::

::: { #func.print_log2.details .sidebar }
##### Details
\

This function internally calls the [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` function to print the object returned by the [get_log2](#func.get_log2) function (also called internally) described above.

:::

::: { #func.print_log2.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log2](#func.get_log2) described above.

:::

::: { #func.print_log2.code .sidebar }
##### Source Code
\

The source code of the [print_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L51) function is shown below:
```{r eval=FALSE}
print_log2 <- function(msg_template, arg1, arg2){
  print(get_log2(msg_template, arg1, arg2))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L51) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L51) script on _GitHub_.
:::
:::

\newpage

#### [put_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L54) Function {#func.put_log2}
\

Outputs a log to the currently open log file (using the [open_logfile](#func.open_logfile) function described above), created from the template passed in the [msg_template](#func.put_log2.args.msg_template) argument, using the values specified by the [arg1](#func.put_log2.args.arg1) and [arg2](#func.put_log2.args.arg2) arguments to replace all the occurrences of the placeholders `%1` and `%2`, respectively, found in the template.

::: { #func.put_log2.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
put_log2(msg_template, arg1, arg2)
```
:::

::: { #func.put_log2.args .sidebar }
##### Arguments
\

::: { #func.put_log2.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1` and `%2`, to be replaced by the values specified by the [arg1](#func.put_log2.args.arg1) and  [arg2](#func.put_log2.args.arg2) arguments, respectively.

:::

::: { #func.put_log2.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.put_log2.args.msg_template) argument. 

:::

::: { #func.put_log2.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.put_log2.args.msg_template) argument. 

:::
:::

::: { #func.put_log2.details .sidebar }
##### Details
\

This function internally calls the [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` function to output the log object returned by the (also called internally) [get_log2](#func.get_log2) function described above.

The function works similarly to the [print_log2](#func.print_log2) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log2.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log2](#func.get_log2) described above.
:::

::: { #func.put_log2.code .sidebar }
##### Source Code
\

The source code of the [put_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L54) function is shown below:
```{r eval=FALSE}
put_log2 <- function(msg_template, arg1, arg2){
  put(get_log2(msg_template, arg1, arg2))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L54) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L54) script on _GitHub_.
:::
:::

\newpage

#### [get_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L58) Function {#func.get_log3}
\

Creates a character vector from the template passed in the [msg_template](#func.get_log3.args.msg_template) argument, using the values specified by the [arg1](#func.get_log3.args.arg1), [arg2](#func.get_log3.args.arg2), and [arg3](#func.get_log3.args.arg3) arguments to replace all the occurrences of the placeholders `%1`, `%2`, and `%3`, respectively, found in the template.

::: { #func.get_log3.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
get_log3(msg_template, arg1, arg2, arg3)
```
:::

::: { #func.get_log3.args .sidebar }
##### Arguments
\

::: { #func.get_log3.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1`, `%2`, and `%3` to be replaced by the values specified by the [arg1](#func.get_log3.args.arg1),  [arg2](#func.get_log3.args.arg2), and [arg3](#func.get_log3.args.arg3) arguments, respectively.

:::

::: { #func.get_log3.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.get_log3.args.msg_template) argument. 

:::

::: { #func.get_log3.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.get_log3.args.msg_template) argument. 

:::

::: { #func.get_log3.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder `%3` in the message template passed in the [msg_template](#func.get_log3.args.msg_template) argument. 

:::
:::

::: { #func.get_log3.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` functions to form a character vector from the template passed in the [msg_template](#func.get_log3.args.msg_template) argument, using the values specified by the [arg1](#func.get_log3.args.arg1), [arg2](#func.get_log3.args.arg2), and [arg3](#func.get_log3.args.arg3)  arguments to replace all the occurrences of the placeholders `%1`, `%2`, and `%3`, respectively, found in the template.

:::

::: { #func.get_log3.value .sidebar }
##### Value
\

A glue object, returned by the internally called [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) function, created from the character vector returned by the (also internally called) function [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).

:::

::: { #func.get_log3.code .sidebar }
##### Source Code
\

The source code of the [get_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L58) function is shown below:
```{r eval=FALSE}
get_log3 <- function(msg_template, arg1, arg2, arg3) {
  msg_template |> 
    str_replace_all("%1", as.character(arg1)) |>
    str_replace_all("%2", as.character(arg2)) |>
    str_replace_all("%3", as.character(arg3)) |>
    str_glue()
}
```

::: {.noteblock data-latex=""}
The source code of the [get_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L58) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L58) script on _GitHub_.
:::
:::

\newpage

#### [print_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L65) Function {#func.print_log3}
\

Prints a log created from the template passed in the [msg_template](#func.print_log3.args.msg_template) argument, using the values specified by the [arg1](#func.print_log3.args.arg1), [arg2](#func.print_log3.args.arg2), and [arg3](#func.print_log3.args.arg3) arguments to replace all the occurrences of the placeholders `%1`, `%2`, and `%3`, respectively, found in the template.

::: { #func.print_log3.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
print_log3(msg_template, arg1, arg2, arg3)
```
:::

::: { #func.print_log3.args .sidebar }
##### Arguments
\

::: { #func.print_log3.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1`, `%2`, and `%3` to be replaced by the values specified by the [arg1](#func.print_log3.args.arg1),  [arg2](#func.print_log3.args.arg2), and [arg3](#func.print_log3.args.arg3) arguments, respectively.

:::

::: { #func.print_log3.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.print_log3.args.msg_template) argument. 

:::

::: { #func.print_log3.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.print_log3.args.msg_template) argument. 

:::

::: { #func.print_log3.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder `%3` in the message template passed in the [msg_template](#func.print_log3.args.msg_template) argument. 

:::
:::

::: { #func.print_log3.details .sidebar }
##### Details
\

This function internally calls the [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` function to print the object returned by the [get_log3](#func.get_log3) function (also called internally) described above.

:::

::: { #func.print_log3.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log3](#func.get_log3) described above.

:::

::: { #func.print_log3.code .sidebar }
##### Source Code
\

The source code of the [print_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L65) function is shown below:
```{r eval=FALSE}
print_log3 <- function(msg_template, arg1, arg2, arg3){
  print(get_log3(msg_template, arg1, arg2, arg3))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L65) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L65) script on _GitHub_.
:::
:::

\newpage

#### [put_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L68) Function {#func.put_log3}
\

Outputs a log to the currently open log file (using the [open_logfile](#func.open_logfile) function described above), created from the template passed in the [msg_template](#func.put_log3.args.msg_template) argument, using the values specified by the [arg1](#func.put_log3.args.arg1), [arg2](#func.put_log3.args.arg2), and [arg3](#func.put_log3.args.arg3) arguments to replace all the occurrences of the placeholders `%1`, `%2`, and `%3`, respectively, found in the template.

::: { #func.put_log3.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
put_log3(msg_template, arg1, arg2, arg3)
```
:::

::: { #func.put_log3.args .sidebar }
##### Arguments
\

::: { #func.put_log3.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1`, `%2`, and `%3` to be replaced by the values specified by the [arg1](#func.put_log3.args.arg1),  [arg2](#func.put_log3.args.arg2), and [arg3](#func.put_log3.args.arg3) arguments, respectively.

:::

::: { #func.put_log3.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.put_log3.args.msg_template) argument. 

:::

::: { #func.put_log3.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.put_log3.args.msg_template) argument. 

:::

::: { #func.put_log3.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder `%3` in the message template passed in the [msg_template](#func.put_log3.args.msg_template) argument. 

:::
:::

::: { #func.put_log3.details .sidebar }
##### Details
\

This function internally calls the [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` function to output the log object returned by the (also called internally) [get_log3](#func.get_log3) function described above.

The function works similarly to the [print_log3](#func.print_log3) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log3.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log3](#func.get_log3) described above.

:::

::: { #func.put_log3.code .sidebar }
##### Source Code
\

The source code of the [put_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L68) function is shown below:
```{r eval=FALSE}
put_log3 <- function(msg_template, arg1, arg2, arg3){
  put(get_log3(msg_template, arg1, arg2, arg3))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L68) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L68) script on _GitHub_.
:::
:::

\newpage

#### [get_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L72) Function {#func.get_log4}
\

Creates a character vector from the template passed in the [msg_template](#func.get_log4.args.msg_template) argument, using the values specified by the [arg1](#func.get_log4.args.arg1), [arg2](#func.get_log4.args.arg2), [arg3](#func.get_log4.args.arg3), and [arg4](#func.get_log4.args.arg4) arguments to replace all the occurrences of the placeholders `%1`, `%2`, `%3`, and `%4`, respectively, found in the template.

::: { #func.get_log4.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
get_log4(msg_template, arg1, arg2, arg3, arg4)
```
:::

::: { #func.get_log4.args .sidebar }
##### Arguments
\

::: { #func.get_log4.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1`, `%2`, `%3`, and `%4` to be replaced by the values specified by the [arg1](#func.get_log4.args.arg1),  [arg2](#func.get_log4.args.arg2), [arg3](#func.get_log4.args.arg3), and [arg4](#func.get_log4.args.arg4) arguments, respectively.

:::

::: { #func.get_log4.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.get_log4.args.msg_template) argument. 

:::

::: { #func.get_log4.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.get_log4.args.msg_template) argument. 

:::

::: { #func.get_log4.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder `%3` in the message template passed in the [msg_template](#func.get_log4.args.msg_template) argument. 

:::

::: { #func.get_log4.args.arg4 .sidebar }
  - **arg4:** Value to replace all occurrences of the placeholder `%4` in the message template passed in the [msg_template](#func.get_log4.args.msg_template) argument. 

:::
:::

::: { #func.get_log4.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` functions to form a character vector from the template passed in the [msg_template](#func.get_log4.args.msg_template) argument, using the values specified by the [arg1](#func.get_log4.args.arg1), [arg2](#func.get_log4.args.arg2), [arg3](#func.get_log4.args.arg3), and [arg4](#func.get_log4.args.arg4) arguments to replace all the occurrences of the placeholders `%1`, `%2`, `%3`, and `%4`, respectively, found in the template.

:::

::: { #func.get_log4.value .sidebar }
##### Value
\

A glue object, returned by the internally called [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) function, created from the character vector returned by the (also internally called) function [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).

:::

::: { #func.get_log4.code .sidebar }
##### Source Code
\

The source code of the [get_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L72) function is shown below:
```{r eval=FALSE}
get_log4 <- function(msg_template, arg1, arg2, arg3, arg4) {
  msg_template |> 
    str_replace_all("%1", as.character(arg1)) |>
    str_replace_all("%2", as.character(arg2)) |>
    str_replace_all("%3", as.character(arg3)) |>
    str_replace_all("%4", as.character(arg4)) |>
    str_glue()
}
```

::: {.noteblock data-latex=""}
The source code of the [get_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L72) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L72) script on _GitHub_.
:::
:::

\newpage

#### [print_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L80) Function {#func.print_log4}
\

Prints a log created from the template passed in the [msg_template](#func.print_log4.args.msg_template) argument, using the values specified by the [arg1](#func.print_log4.args.arg1), [arg2](#func.print_log4.args.arg2), [arg3](#func.print_log4.args.arg3), and [arg4](#func.print_log4.args.arg4) arguments to replace all the occurrences of the placeholders `%1`, `%2`, `%3`, and `%4`, respectively, found in the template.

::: { #func.print_log4.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
print_log4(msg_template, arg1, arg2, arg3, arg4)
```
:::

::: { #func.print_log4.args .sidebar }
##### Arguments
\

::: { #func.print_log4.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1`, `%2`, `%3`, and `%4` to be replaced by the values specified by the [arg1](#func.print_log4.args.arg1),  [arg2](#func.print_log4.args.arg2), [arg3](#func.print_log4.args.arg3), and [arg4](#func.print_log4.args.arg4) arguments, respectively.

:::

::: { #func.print_log4.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.print_log4.args.msg_template) argument. 

:::

::: { #func.print_log4.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.print_log4.args.msg_template) argument. 

:::

::: { #func.print_log4.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder `%3` in the message template passed in the [msg_template](#func.print_log4.args.msg_template) argument. 

:::

::: { #func.print_log4.args.arg4 .sidebar }
  - **arg4:** Value to replace all occurrences of the placeholder `%4` in the message template passed in the [msg_template](#func.print_log4.args.msg_template) argument. 

:::
:::

::: { #func.print_log4.details .sidebar }
##### Details
\

This function internally calls the [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` function to print the object returned by the [get_log4](#func.get_log4) function (also called internally) described above.

:::

::: { #func.print_log4.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log4](#func.get_log4) described above.

:::

::: { #func.print_log4.code .sidebar }
##### Source Code
\

The source code of the [print_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L80) function is shown below:
```{r eval=FALSE}
print_log4 <- function(msg_template, arg1, arg2, arg3, arg4){
  print(get_log4(msg_template, arg1, arg2, arg3, arg4))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L80) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L80) script on _GitHub_.
:::
:::

\newpage

#### [put_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L83) Function {#func.put_log4}
\

Outputs a log to the currently open log file (using the [open_logfile](#func.open_logfile) function described above), created from the template passed in the [msg_template](#func.put_log4.args.msg_template) argument, using the values specified by the [arg1](#func.put_log4.args.arg1), [arg2](#func.put_log4.args.arg2), [arg3](#func.put_log4.args.arg3), and [arg4](#func.put_log4.args.arg4) arguments to replace all the occurrences of the placeholders `%1`, `%2`, `%3`, and `%4`, respectively, found in the template.

::: { #func.put_log4.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
put_log4(msg_template, arg1, arg2, arg3, arg4)
```
:::

::: { #func.put_log4.args .sidebar }
##### Arguments
\

::: { #func.put_log4.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders `%1`, `%2`, `%3`, and `%4` to be replaced by the values specified by the [arg1](#func.put_log4.args.arg1),  [arg2](#func.put_log4.args.arg2), [arg3](#func.put_log4.args.arg3), and [arg4](#func.put_log4.args.arg4) arguments, respectively.

:::

::: { #func.put_log4.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder `%1` in the message template passed in the [msg_template](#func.put_log4.args.msg_template) argument. 

:::

::: { #func.put_log4.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder `%2` in the message template passed in the [msg_template](#func.put_log4.args.msg_template) argument. 

:::

::: { #func.put_log4.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder `%3` in the message template passed in the [msg_template](#func.put_log4.args.msg_template) argument. 

:::

::: { #func.put_log4.args.arg4 .sidebar }
  - **arg4:** Value to replace all occurrences of the placeholder `%4` in the message template passed in the [msg_template](#func.put_log4.args.msg_template) argument. 

:::
:::

::: { #func.put_log4.details .sidebar }
##### Details
\

This function internally calls the [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` function to output the log object returned by the (also called internally) [get_log4](#func.get_log4) function described above.

The function works similarly to the [print_log4](#func.print_log4) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log4.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log4](#func.get_log4) described above.
:::

::: { #func.put_log4.code .sidebar }
##### Source Code
\

The source code of the [put_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L83) function is shown below:
```{r eval=FALSE}
put_log4 <- function(msg_template, arg1, arg2, arg3, arg4){
  put(get_log4(msg_template, arg1, arg2, arg3, arg4))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L83) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L83) script on _GitHub_.
:::
:::

\newpage

### Utility Functions {#appndx_a.CHF.utility_funcs}

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L445) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L445) script on _GitHub_.
:::

#### [clamp](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L448) Function {#func.clamp}
\

Clamps the input value passed in [r](#func.clamp.args.r) argument between the values passed in [min](#func.clamp.args.min) and [max](#func.clamp.args.max) arguments. 

::: { #func.clamp.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
r_clamped <- clamp(r, min = 0.5, max = 5)
```
:::

::: { #func.clamp.args .sidebar }
##### Arguments
\

::: { #func.clamp.args.r .sidebar }
  - **r:** Value to clamp; 

:::
::: { #func.clamp.args.min .sidebar }
  - **min:** Minimum allowed value (0.5 by default); 

:::
:::
::: { #func.clamp.args.max .sidebar }
  - **max:** Maximum allowed value (5 by default); 

:::
:::

::: { #func.clamp.details .sidebar }
##### Details
\
As explained in [Section 24.1 *Case study: recommendation systems / User effects*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#user-effects) of the _Course Textbook_ we know ratings cannot be below 0.5 or above 5. For this reason, we need a function described in that section[@IDS2_24-1]:

This function is a wrapper for the [base::pmin](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/Extremes) and [base::pmax](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/Extremes) `R` functions, which are called internally to constrain the input value passed in the [r](#func.clamp.args.r) argument to be within the values passed in the [min](#func.clamp.args.min) and [max](#func.clamp.args.max) arguments, respectively.

In our project this function is used to clamp the computed movie rating values between 0.5 and 5.
:::

::: { #func.clamp.value .sidebar }
##### Value
\

The value clamped between [min](#func.clamp.args.min) and [max](#func.clamp.args.max) argument values.

:::

::: { #func.clamp.code .sidebar }
##### Source Code
\

The source code of the [clamp](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L448) function is shown below:
```{r eval=FALSE}
clamp <- function(x, min = 0.5, max = 5) pmax(pmin(x, max), min)
```

::: {.noteblock data-latex=""}
The source code of the [clamp](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L448) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L445) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L448) script on _GitHub_.
:::
:::

#### [msg.set_arg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L449) Function {#func.msg.set_arg}
\

Creates a character vector from the template passed in the [msg_template](#func.msg.set_arg.args.msg_template) argument, using the value specified by the [arg](#func.msg.set_arg.args.arg) argument to replace all the occurrences of the placeholder passed in the [arg.name](#func.msg.set_arg.args.arg.name) argument found in the template.

::: { #func.msg.set_arg.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
msg.set_arg(msg_template, arg, arg.name = "%1")
```
:::

::: { #func.msg.set_arg.args .sidebar }
##### Arguments
\

::: { #func.msg.set_arg.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of a pattern specified by the [arg.name](#func.msg.set_arg.args.arg.name) argument.
  
:::

::: { #func.msg.set_arg.args.arg.name .sidebar }
  - **arg.name:** (*Optional: `%1` by default*) Substring (pattern or *placeholder*) to replace all occurrences found in the message template passed in the [msg_template](#func.msg.set_arg.args.msg_template) argument with the value specified in the [arg](#func.msg.set_arg.args.arg) argument.

:::

::: { #func.msg.set_arg.args.arg .sidebar }
  - **arg:** Value to replace all occurrences of the pattern specified by the [arg.name](#func.msg.set_arg.args.arg.name) argument in the message template passed in the [msg_template](#func.msg.set_arg.args.msg_template) argument.
  
:::
:::

::: { #func.msg.set_arg.details .sidebar }
##### Details
\

This function is a wrapper for the [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` function, which is called internally to replace all occurrences of the pattern (placeholder) specified by the [arg_name](#func.msg.set_arg.args.arg.name) argument (`%1` by default), in the message template passed in the [msg_template](#func.msg.set_arg.args.msg_template) argument with the value specified in the [arg](#func.msg.set_arg.args.arg) argument.
:::

::: { #func.msg.set_arg.value .sidebar }
##### Value
\

The character vector returned by the internally called [stringr::str_replace_all()](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).
:::

::: { #func.msg.set_arg.code .sidebar }
##### Source Code
\

The source code of the [msg.set_arg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L449) function is shown below:
```{r eval=FALSE}
msg.set_arg <- function(msg_template, arg, arg.name = "%1") {
  msg_template |> 
    str_replace_all(arg.name, as.character(arg))
}
```

::: {.noteblock data-latex=""}
The source code of the [msg.set_arg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L449) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L445) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L449) script on _GitHub_.
:::
:::

\newpage

#### [msg.glue](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L453) Function {#func.msg.glue}
\

Creates a [glue::glue](https://glue.tidyverse.org/reference/glue.html) object from the template passed in the [msg_template](#func.msg.glue.args.msg_template) argument, using the value specified by the [arg](#func.msg.glue.args.arg) argument to replace all the occurrences of the placeholder passed in the [arg.name](#func.msg.glue.args.arg.name) argument found in the template.
  
::: { #func.msg.glue.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
msg.glue(msg_template, arg, arg, arg.name = "%1")
```
:::

::: { #func.msg.glue.args .sidebar }
##### Arguments
\

::: { #func.msg.glue.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of a pattern specified by the [arg.name](#func.msg.glue.args.arg.name) argument.
  
:::

::: { #func.msg.glue.args.arg.name .sidebar }
  - **arg.name:** (*Optional: `%1` by default*) Substring (pattern or *placeholder*) to replace all occurrences found in the message template passed in the [msg_template](#func.msg.glue.args.msg_template) argument with the value specified in the [arg](#func.msg.glue.args.arg) argument.

:::

::: { #func.msg.glue.args.arg .sidebar }
  - **arg:** Value to replace all occurrences of the pattern specified by the [arg.name](#func.msg.glue.args.arg.name) argument in the message template passed in the [msg_template](#func.msg.glue.args.msg_template) argument.

:::
:::

::: { #func.msg.glue.details .sidebar }
##### Details
\

This function internally calls the [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) `R` function to format the character vector returned by the (also called internally) [msg.set_arg](#func.msg.set_arg) function described above.

:::

::: { #func.msg.glue.value .sidebar }
##### Value
\

A [glue::glue](https://glue.tidyverse.org/reference/glue.html) object created from the character vector returned by the internally called [msg.set_arg()](#func.msg.set_arg).

:::

::: { #func.msg.glue.code .sidebar }
##### Source Code
\

The source code of the [msg.glue](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L453) function is shown below:
```{r eval=FALSE}
msg.glue <- function(msg_template, arg, arg.name = "%1"){
  msg_template |>
    msg.set_arg(arg, arg.name) |>
    str_glue()
}
```

::: {.noteblock data-latex=""}
The source code of the [msg.glue](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L453) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L445) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L453) script on _GitHub_.
:::
:::

\newpage

### (Root) Mean Squared Error Calculation

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) script on _GitHub_.
:::

#### [mse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L5) Function {#func.mse}
\

Calculates *Mean Squared Error* as described in [Section 24.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_24-1_LF]. 

::: { #func.mse.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
mse(r)

```
:::

::: { #func.mse.args .sidebar }
##### Arguments
\

::: { #func.mse.args.r .sidebar }
  - **r:** Numeric vector representing a set of residuals as described in [Section 24.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_24-1_LF]. 

:::
:::

::: { #func.mse.code .sidebar }
##### Source Code
\

The source code of the [mse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L5) function is shown below:
```{r eval=FALSE}
mse <- function(r) mean(r^2)
```

::: {.noteblock data-latex=""}
The source code of the [mse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L5) function is also available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L5) script on _GitHub_.
:::
:::

\newpage

#### [mse_cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L6) Function {#func.mse_cv}
\

Calculates the average value of the *Mean Squared Errors* calculated using the *K-Fold Cross-Validation* method as described in [Section 29.6 *Cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6].

::: { #func.mse_cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
mse_cv(r_list)

```
:::

::: { #func.mse_cv.args .sidebar }
##### Arguments
\

::: { #func.mse_cv.args.r_list .sidebar }
  - **r_list:** List of numeric vectors, each representing a set of residuals as described in [Section 24.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_24-1_LF], calculated in `K`th iteration using the *K-Fold Cross-Validation* method. 

:::
:::

::: { #funcc.mse_cv.code .sidebar }
##### Source Code
\

The source code of the [mse_cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L6) function is shown below:
```{r eval=FALSE}
mse_cv <- function(r_list) {
  mses <- sapply(r_list, mse(r))
  mean(mses)
}
```

::: {.noteblock data-latex=""}
The source code of the [mse_cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L6) function is also available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L6) script on _GitHub_.
:::
:::

\newpage

#### [rmse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L10) Function {#func.rmse}
\

Calculates *Root Mean Squared Error* as described in [Section 24.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_24-1_LF]. 

::: { #func.rmse.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
rmse(r)

```
:::

::: { #func.rmse.args .sidebar }
##### Arguments
\

::: { #func.rmse.args.r .sidebar }
  - **r:** Numeric vector representing a set of residuals as described in [Section 24.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_24-1_LF]. 

:::
:::

::: { #func.rmse.code .sidebar }
##### Source Code
\

The source code of the [rmse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L10) function is shown below:
```{r eval=FALSE}
rmse <- function(r) sqrt(mse(r))
```

::: {.noteblock data-latex=""}
The source code of the [rmse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L10) function is also available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L10) script on _GitHub_.
:::
:::

\newpage

#### [rmse2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L11) Function {#func.rmse2}
\

Calculates *Root Mean Squared Error* as described in [Section 24.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_24-1_LF]. 

::: { #func.rmse2.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
rmse2(true_ratings, predicted_ratings)

```
:::

::: { #func.rmse2.args .sidebar }
##### Arguments
\

::: { #func.rmse2.args.true_ratings .sidebar }
  - **true_ratings:** Numeric vector representing a set of *actual rating* values stored in the validation dataset. 

:::

::: { #func.rmse2.args.predicted_ratings .sidebar }
  - **predicted_ratings:** A numeric vector representing a set of *predicted rating* values computed from the data stored in the test dataset. 

:::
:::

::: { #func.rmse2.code .sidebar }
##### Source Code
\

The source code of the [rmse2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L11) function is shown below:
```{r eval=FALSE}
rmse2 <- function(true_ratings, predicted_ratings) {
  rmse(true_ratings - predicted_ratings)
}
```

::: {.noteblock data-latex=""}
The source code of the [rmse2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L11) function is also available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L11) script on _GitHub_.
:::
:::

\newpage

### Result RMSEs Tibble Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) script on _GitHub_.
:::

#### [CreateRMSEs_ResultTibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L16) Function {#func.CreateRMSEs_ResultTibble}
\

Creates a _RMSEs Result Tibble_ of type *data frame*.

::: { #func.CreateRMSEs_ResultTibble.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
RMSEs.ResultTibble <- CreateRMSEs_ResultTibble()
```
:::

::: { #func.CreateRMSEs_ResultTibble.details .sidebar }
##### Details
\

This function is a wrapper for the [tibble::tibble](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/tibble) function, which is called internally to construct a data frame representing the _RMSEs Result Tibble_ to store the _RMSE_ values for every model used in the project to predict movie ratings.

The result data frame, which is returned to the client code, has the following columns:

  - *Method* (chr);
  - *RMSE* (num);
  - *Comment* (chr)

::: { #func.CreateRMSEs_ResultTibble.value .sidebar }
##### Value
\

A tibble returned by the internally called [tibble::tibble()](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/tibble)

:::


::: { #func.CreateRMSEs_ResultTibble.code .sidebar }
##### Source Code
\

The source code of the [CreateRMSEs_ResultTibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L16) function is shown below:
```{r eval=FALSE}
CreateRMSEs_ResultTibble <- function(){
  tibble(Method = c("Project Objective"),
         RMSE = project_objective,
         Comment = " ")
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [CreateRMSEs_ResultTibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L16) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L16) script on _GitHub_.
:::

\newpage

#### [RMSEs.AddRow](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L21) Function {#func.RMSEs.AddRow}
\

Adds a row to the original _RMSEs Result Tibble_ passed in the [RMSEs](#func.RMSEs.AddRow.args.RMSEs) argument.

::: { #func.RMSEs.AddRow.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
RMSEs.AddRow(RMSEs, 
             method, 
             value, 
             comment = "", 
             before = NULL)
```
:::

::: { #func.RMSEs.AddRow.args .sidebar }
##### Arguments
\

::: { #func.RMSEs.AddRow.args.RMSEs .sidebar }
  - ***RMSEs:*** Original _RMSEs Result Tibble_ (of type *data frame*) to modify;

:::

::: { #func.RMSEs.AddRow.args.method .sidebar }
  - ***method:*** The _Method or Model_ being evaluated;

:::

::: { #func.RMSEs.AddRow.args.value .sidebar }
  - ***value:*** The _Root Mean Squared Error (RMSE)_ value;

:::

::: { #func.RMSEs.AddRow.args.comment .sidebar }
  - ***comment:*** Detailed information about the record or any other comment (if needed);

:::

::: { #func.RMSEs.AddRow.args.before .sidebar }
  - ***before:*** One-based row index where to add the new rows, if NULL (default): after last row;

:::
:::

::: { #func.RMSEs.AddRow.code.details .sidebar }
##### Details
\

This function is a wrapper for the [tibble::add_row](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/add_row) function, which is called internally to modify a data frame representing the original _RMSEs Result Tibble_, which stores the _RMSE_ values for the models used in the project to predict movie ratings.

For more information about the _RMSEs Result Tibble_, see the [Details](#func.CreateRMSEs_ResultTibble.details) section of the [CreateRMSEs_ResultTibble](#func.CreateRMSEs_ResultTibble) function description above.

:::

::: { #func.RMSEs.AddRow.value .sidebar }
##### Value
\

The modified tibble returned by the internally called [tibble::add_row()](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/add_row).

:::


::: { #func.RMSEs.AddRow.code .sidebar }
##### Source Code
\

The source code of the [RMSEs.AddRow](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L21) function is shown below:
```{r eval=FALSE}
RMSEs.AddRow <- function(RMSEs, 
                         method, 
                         value, 
                         comment = "", 
                         before = NULL){
  RMSEs |>
    add_row(Method = method,
            RMSE = value,
            Comment = comment,
            .before = before)
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RMSEs.AddRow](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L21) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L21) script on _GitHub_.
:::

\newpage

#### [RMSEs.AddDiffColumn](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) Function {#func.RMSEs.AddDiffColumn}
\

Adds a calculated column named _Diff_ to the _RMSEs Result Tibble_ (passed in the [RMSEs](#func.RMSEs.AddDiffColumn.args.RMSEs) argument) that contains, for each row, the difference between the value of the _RMSE_ column for the previous row and the value of the same column for the current row. This is true for each row except the first, for which the value is always zero.

::: { #func.RMSEs.AddDiffColumn.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
RMSEs.ModifiedTable <- RMSEs.AddDiffColumn(RMSEs)
```
:::

::: { #func.RMSEs.AddDiffColumn.args .sidebar }
##### Arguments
\

::: { #func.RMSEs.AddDiffColumn.args.RMSEs .sidebar }
  - ***RMSEs:*** _RMSEs Result Tibble_ to modify;

:::
:::

::: { #func.RMSEs.AddDiffColumn.details .sidebar }
##### Details
\

This function is a wrapper for the [tibble::add_column](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/add_column) function, which is called internally to modify a data frame representing the original _RMSEs Result Tibble_. It also internally uses the [RMSEs.AddRow](#func.RMSEs.AddRow) function described above to perform the necessary intermediate calculations.

For more information about the _RMSEs Result Tibble_, see the [Details](#func.CreateRMSEs_ResultTibble.details) section of the [CreateRMSEs_ResultTibble](#func.CreateRMSEs_ResultTibble) function description above.
:::


::: { #func.RMSEs.AddRow.value .sidebar }
##### Value
\

The modified tibble returned by the internally called [tibble::add_column()](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/add_column).
:::

::: { #func.RMSEs.AddDiffColumn.code .sidebar }
##### Source Code
\

The source code of the [RMSEs.AddDiffColumn](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) function is shown below:
```{r eval=FALSE}
RMSEs.AddDiffColumn <- function(RMSEs){
  RMSEs.Diff <- RMSEs |>
    RMSEs.AddRow(NULL, project_objective, before = 1) #|>

  RMSEs.Diff <- RMSEs.Diff[-nrow(RMSEs.Diff),]
    
  RMSEs |>
  add_column(Diff = RMSEs.Diff$RMSE - RMSEs$RMSE, 
             .before = "Comment")
  
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RMSEs.AddDiffColumn](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) script on _GitHub_.
:::

#### [RSME.tibble.col_width](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L66) Function {#func.RSME.tibble.col_width}
\

Converts the _RMSEs Result Tibble_ column width value passed in argument [x](#func.RSME.tibble.col_width.args.x) to a character string compatible for use as the `width` argument value to pass to the [kableExtra::column_spec](https://www.rdocumentation.org/packages/kableExtra/versions/1.3.4/topics/column_spec) function.

::: { #func.RSME.tibble.col_width.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
width_em <- RSME.tibble.col_width(x)
```
:::

::: { #func.RSME.tibble.col_width.args .sidebar }
##### Arguments
\

::: { #func.RSME.tibble.col_width.args.x .sidebar }
  - ***x:*** (Numeric) Column width value to be formatted;

:::
:::

::: { #func.RSME.tibble.col_width.details .sidebar }
##### Details
\

This is a utility function, a wrapper for the [msg.glue](#func.msg.glue) function described above, which is called internally to format the value passed in argument [x](#func.RSME.tibble.col_width.args.x) for subsequent passing to the function [kableExtra::column_spec](https://www.rdocumentation.org/packages/kableExtra/versions/1.3.4/topics/column_spec) as a value of the `width` argument.
:::

::: { #func.RSME.tibble.col_width.value .sidebar }
##### Value
\

A character string representing the formatted column width value.
:::


::: { #func.RSME.tibble.col_width.code .sidebar }
##### Source Code
\

The source code of the [RSME.tibble.col_width](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L66) function is shown below:
```{r eval=FALSE}
RSME.tibble.col_width <- function(x){
  "%1em" |> msg.glue(x)
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RSME.tibble.col_width](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L66) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L66) script on _GitHub_.
:::

\newpage

#### [RMSE_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L43) Function {#func.RMSE_kable}
\

Prints the _RMSEs Result Tibble_.

::: {.noteblock data-latex=""}
It is assumed that the tibble has the following three columns:
  
  1. *Method*;
  2. *RMSE*;
  3. *Comment*;
  
:::

::: { #func.RMSE_kable.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
RMSE_kable(RMSEs,
           col1width = 15,
           col2width = 5,
           col3width = 30)
```
:::

::: { #func.RMSE_kable.args .sidebar }
##### Arguments
\

::: { #func.RMSE_kable.args.RMSEs .sidebar }
  - ***RMSEs:*** _RMSEs Result Tibble_ to print;

:::

::: { #func.RMSE_kable.args.col1width .sidebar }
  - ***col1width:*** Width of the first column (15 by default);

:::

::: { #func.RMSE_kable.args.col2width .sidebar }
  - ***col2width:*** Width of the second column (5 by default);

:::

::: { #func.RMSE_kable.args.col3width .sidebar }
  - ***col3width:*** Width of the third column (30 by default).

:::
:::

::: { #func.RMSE_kable.details .sidebar }
##### Details
\

This function is a wrapper for the [knitr::kable](https://www.rdocumentation.org/packages/knitr/versions/1.43/topics/kable) function, which is called internally to create a table (based on the _RMSEs Result Tibble_ data), formatted for output in the project report.

The [kableExtra::column_spec](https://www.rdocumentation.org/packages/kableExtra/versions/1.3.4/topics/column_spec) function, along with the [RSME.tibble.col_width](#func.RSME.tibble.col_width) function described above, are also used internally to specify the width of the table columns.

For more information about the _RMSEs Result Tibble_, see the [Details](#func.CreateRMSEs_ResultTibble.details) section of the [CreateRMSEs_ResultTibble](#func.CreateRMSEs_ResultTibble) function description above.
:::

::: { #func.RMSE_kable.value .sidebar }
##### Value
\

The table created by the internally called [knitr::kable()](https://www.rdocumentation.org/packages/knitr/versions/1.43/topics/kable).

:::


::: { #func.RMSE_kable.code .sidebar }
##### Source Code
\

The source code of the [RMSE_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L43) function is shown below:
```{r eval=FALSE}
RMSE_kable <- function(RMSEs,
                       col1width = 15,
                       col2width = 5,
                       col3width = 30){
  RMSEs |>
    kable(align='lcl', booktabs = T, padding = 5) |> 
    row_spec(0, bold = T) |>
    column_spec(column = 1, width = RSME.tibble.col_width(col1width)) |>
    column_spec(column = 2, width = RSME.tibble.col_width(col2width)) |>
    column_spec(column = 3, width = RSME.tibble.col_width(col3width)) 
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RMSE_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L43) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L43) script on _GitHub_.
:::

\newpage


#### [RMSE.Total_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L54) Function {#func.RMSE.Total_kable}
\

Prints the _Final RMSEs Result Tibble_.

::: {.noteblock data-latex=""}
It is assumed that the tibble has the following four columns:
  
  1. *Method*;
  2. *RMSE*;
  3. *Diff*;
  4. *Comment*;
  
:::

::: { #func.RMSE.Total_kableusage .sidebar }
##### Usage
\

```{r eval=FALSE}
RMSE.Total_kable(RMSEs,
                 col1width = 15,
                 col2width = 7,
                 col3width = 5,
                 col4width = 25)
```
:::

::: { #func.RMSE.Total_kable.args .sidebar }
##### Arguments
\

::: { #func.RMSE.Total_kable.args.RMSEs .sidebar }
  - ***RMSEs:*** The _Final RMSEs Result Tibble_ to print;

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col1width:*** Width of the first column (15 by default);

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col2width:*** Width of the second column (7 by default);

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col3width:*** Width of the third column(5 by default);

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col4width:*** Width of the fourth column (25 by default);

:::
:::

::: { #func.RMSE.Total_kable.details .sidebar }
##### Details
\

This function is a wrapper for the [RMSE_kable](#func.RMSE_kable) function described above, which is called internally to print the table, created from the final _RMSEs Result Tibble_ data.

It is assumed that the  _Final RMSEs Result Tibble_ is previously constructed from the original _RMSEs Result Tibble_ using the [RMSEs.AddDiffColumn](#func.RMSEs.AddDiffColumn) function described above.

The [kableExtra::column_spec](https://www.rdocumentation.org/packages/kableExtra/versions/1.3.4/topics/column_spec) function, along with the [RSME.tibble.col_width](#func.RSME.tibble.col_width) function described above, are also used internally to set the width of the last column of the table.

For more information about the _RMSEs Result Tibble_, see the [Details](#func.CreateRMSEs_ResultTibble.details) section of the [CreateRMSEs_ResultTibble](#func.CreateRMSEs_ResultTibble) function description above.
:::

::: { #func.RMSE.Total_kable.value .sidebar }
##### Value
\

The table returned by the internally called [RMSE_kable()](#func.RMSE_kable).
:::

::: { #func.RMSE.Total_kable.code .sidebar }
##### Source Code
\

The source code of the [RMSE.Total_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L54) function is shown below:
```{r eval=FALSE}
RMSE.Total_kable <- function(RMSEs,
                       col1width = 15,
                       col2width = 7,
                       col3width = 5, 
                       col4width = 25){
  RMSEs |> 
    RMSE.Total_kable(col1width,
               col2width,
               col3width) |>
    column_spec(column = 4, 
                width = RSME.tibble.col_width(col4width)) 
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RMSE.Total_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L54) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L54) script on _GitHub_.
:::

\newpage

### Regularization Functions {#appndx_a.CHF.regularization}
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) script on _GitHub_.
:::

#### [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) Function {#func.mean_reg}
\

Calculates the arithmetic mean taking into account the _regularization parameter_ $\lambda$ passed in the [lambda](#func.mean_reg.args.lambda) argument. We will call it the _penalized mean_.

::: { #func.mean_reg.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
mean_reg(vals, lambda = 0, na.rm = TRUE)

```
:::

::: { #func.mean_reg.args .sidebar }
##### Arguments
\

::: { #func.mean_reg.args.vals .sidebar }
  - **vals:** Values (usually a numeric vector) to calculate the _penalized mean_;

:::
::: { #func.mean_reg.args.lambda .sidebar }
  - **lambda:** (0 by default) _Regularization parameter_ $\lambda$ used in the _Regularization techniques_. 

:::
  - **na.rm:** a logical evaluating to TRUE or FALSE indicating whether NA values should be stripped before the computation proceeds.

:::


::: { #func.mean_reg.details .sidebar }
##### Details
\

The function calculates the _penalized mean_ of the values passed in the [vals](#func.mean_reg.args.vals) argument as follows:
$$
\mu(\lambda) = \frac{1}{\lambda + N} \sum_{i=1}^{N} x_i
$$

When the [lambda](#func.mean_reg.args.lambda) parameter is `0` (meaning the $\lambda = 0$), the function calculates the simple arithmetic mean:
$$
\mu = \frac{1}{N} \sum_{i=1}^{N} x_i
$$

We call this function internally from the functions that compute the _penalized estimates_  as described in [Section 24.1 *Case study: recommendation systems / Penalized Least Squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the *Course Textbook (New Edition)*[@IDS2_24-1].

::: {.noteblock data-latex=""}
If the [lambda](#func.mean_reg.args.lambda) parameter is `0` (the default), the function is equivalent to the standard R function [base::mean](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/mean), calling with the parameter `trim = 0` (the default for the `base::mean` function).
:::
:::

::: { #func.mean_reg.value .sidebar }
##### Value
\

The [penalized mean](#func.mean_reg.details) of the values passed in the [vals](#func.mean_reg.args.vals) argument.
:::

::: { #func.mean_reg.code .sidebar }
##### Source Code
\

The soure code of the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) function is shown below:
```{r eval=FALSE}
mean_reg <- function(vals, lambda = 0, na.rm = TRUE){
  if (is.na(lambda)) {
    stop("Function: mean_reg
`lambda` is `NA`")
  }
  
  names(lambda) <- NULL
  sums <- sum(vals, na.rm = na.rm)
  N <- ifelse(na.rm, sum(!is.na(vals)), length(vals))
  sums/(N + lambda)
}
```

::: {.noteblock data-latex=""}
The source code of the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) script on _GitHub_.
:::
:::


\newpage

#### [get_fine_tune.param.endpoints.idx](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L81) Function {#func.get_fine_tune.param.endpoints.idx}
\

Implements an algorithm that finds in the *RMSE* column of the data frame passed in the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument the indices of the pair of the nearest neighboring elements with values greater than the minimum to the left and right of the element (or group of elements) with the minimum value.

::: {.noteblock data-latex=""}
The algorithm assumes that the set of values in the *RMSE* column is a monotonically non-increasing function of the index until the minimum is reached and monotonically non-decreasing thereafter. That is, it is assumed that the function has only one minimum on the given set.
:::


::: { #func.get_fine_tune.param.endpoints.idx.usage .sidebar }
##### Usage
\

::: {.noteblock data-latex=""}
The element named `tuned.result` of the *list* returned by the [tune.model_param](#func.tune.model_param) function described below is a *data frame* suitable for use as the value of the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument.
:::

The following code snippet shows how to use the data returned by the [tune.model_param](#func.tune.model_param) function as the value of the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument:
```{r eval=FALSE}
cv.UME.preset.result <- 
  tune.model_param(lambdas, regularize.test_lambda.UM_effect.cv)

```
```{r}
cv.UME.preset.result$tuned.result |>
  data.plot(title = "UME Model Regularization: `lambda` Range Pre-configuration",
              xname = "parameter.value",
              yname = "RMSE",
              xlabel = "Regularization parameter (`lambda`)",
              ylabel = "RMSE")

preset.result <- cv.UME.preset.result$tuned.result
preset.result.idx <- get_fine_tune.param.endpoints.idx(preset.result)
print(preset.result.idx)
```

:::

::: { #func.get_fine_tune.param.endpoints.idx.args .sidebar }
##### Arguments
\

::: {#func.get_fine_tune.param.endpoints.idx.args.preset.result .sidebar }
  - **preset.result:** Data frame that has an *RMSE* column containing the `RMSE` values corresponding to the *regularization parameter* $\lambda$ values for the model being regularized, as described in the [Details](#func.tune.model_param.details) section of the [tune.model_param](#func.tune.model_param) function description below.

:::
:::

::: { #func.get_fine_tune.param.endpoints.idx.value .sidebar }
##### Value
\

Vector containing the index of the first element corresponding to the minimum `RMSE` value in the *RMSE* column of the data frame passed in the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument, along with the indices of the pair of the nearest neighboring elements with values greater than the minimum to the left and right of the element (or group of elements) with the minimum value:
```{r eval=FALSE}
  c(start, # interval start index
    end,   # interval end index
    best)  # index of the best `RMSE`
```

In the example shown above in the [Usage](#func.get_fine_tune.param.endpoints.idx.usage) section we can see the value return by *this function*:
```{r}
str(preset.result.idx)
print(preset.result.idx)
```

:::

::: { #func.get_fine_tune.param.endpoints.idx.code .sidebar }
##### Source Code
\

The source code of the [get_fine_tune.param.endpoints.idx](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L81) function is shown below:
```{r eval=FALSE}
get_fine_tune.param.endpoints.idx <- function(preset.result) {
  best_RMSE <- min(preset.result$RMSE)
  best_RMSE.idx <- which.min(preset.result$RMSE)
  # best_lambda <- preset.result$parameter.value[best_RMSE.idx]
  
  preset.result.N <- length(preset.result$RMSE)
  i <- best_RMSE.idx
  j <- i
  
  while (i > 1) {
    i <- i - 1
    
    if (preset.result$RMSE[i] > best_RMSE) {
      break
    }
  }
  
  while (j < preset.result.N) {
    j <- j + 1
    
    if (preset.result$RMSE[j] > best_RMSE) {
      break
    }
  }
  
  c(start = i, 
    end = j,
    best = best_RMSE.idx)
}

```

::: {.noteblock data-latex=""}
The source code of the [get_fine_tune.param.endpoints.idx](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L81) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L81) script on _GitHub_.
:::
:::



#### [get_fine_tune.param.endpoints](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L109) Function {#func.get_fine_tune.param.endpoints}
\

Implements an algorithm that finds in the *RMSE* column of the data frame passed in the [preset.result](#func.get_fine_tune.param.endpoints.args.preset.result) argument the pair of the nearest neighboring elements with values greater than the minimum to the left and right of the element (or group of elements) with the minimum value.

::: {.noteblock data-latex=""}
The algorithm assumes that the set of values in the *RMSE* column is a monotonically non-increasing function of the index until the minimum is reached and monotonically non-decreasing thereafter. That is, it is assumed that the function has only one minimum on the given set.
:::


::: { #func.get_fine_tune.param.endpoints.usage .sidebar }
##### Usage
\

::: {.noteblock data-latex=""}
The element named `tuned.result` of the *list* returned by the [tune.model_param](#func.tune.model_param) function described below is a *data frame* suitable for use as the value of the [preset.result](#func.get_fine_tune.param.endpoints.args.preset.result) argument.
:::

The following code snippet shows how to use the data returned by the [tune.model_param](#func.tune.model_param) function as the value of the [preset.result](#func.get_fine_tune.param.endpoints.args.preset.result) argument:
```{r eval=FALSE}
cv.UME.preset.result <- 
  tune.model_param(lambdas, regularize.test_lambda.UM_effect.cv)

```
```{r}
cv.UME.preset.result$tuned.result |>
  data.plot(title = "UME Model Regularization: `lambda` Range Pre-configuration",
              xname = "parameter.value",
              yname = "RMSE",
              xlabel = "Regularization parameter (`lambda`)",
              ylabel = "RMSE")

preset.result <- cv.UME.preset.result$tuned.result
fine_tune.param.endpoints <- get_fine_tune.param.endpoints(preset.result)
print(fine_tune.param.endpoints)
```

:::

::: { #func.get_fine_tune.param.endpoints.args .sidebar }
##### Arguments
\

::: {#func.get_fine_tune.param.endpoints.args.preset.result .sidebar }
  - **preset.result:** Data frame that has an *RMSE* column containing the `RMSE` values corresponding to the *regularization parameter* $\lambda$ values for the model being regularized, as described in the [Details](#func.tune.model_param.details) section of the [tune.model_param](#func.tune.model_param) function description below.

:::
:::

::: { #func.get_fine_tune.param.endpoints.details .sidebar }
##### Details
\

This function internally calls [get_fine_tune.param.endpoints.idx](#func.get_fine_tune.param.endpoints.idx) function described above to figure out the indices of the elements, the values of which have to be determined.
:::

::: { #func.get_fine_tune.param.endpoints.value .sidebar }
##### Value
\

Vector containing the *regularization parameter* $\lambda$ value corresponding to the first element with the minimum `RMSE` value in the *RMSE* column of the data frame passed in the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument, along with the pair of the $\lambda$ values corresponding to the nearest neighboring elements with values greater than the minimum `RMSE` to the left and right of the element (or group of elements) with the minimum `RMSE` value:

In the example shown above in the [Usage](#func.get_fine_tune.param.endpoints.usage) section we can see the value return by *this function*:
```{r}
str(fine_tune.param.endpoints)
print(fine_tune.param.endpoints)
```

:::

::: { #func.get_fine_tune.param.endpoints.code .sidebar }
##### Source Code
\

The source code of the [get_fine_tune.param.endpoints](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L109) function is shown below:
```{r eval=FALSE}
get_fine_tune.param.endpoints <- function(preset.result) {

  preset.result.idx <- get_fine_tune.param.endpoints(preset.result)
  
  i <- preset.result.idx["start"]
  j <- preset.result.idx["end"]
  best.idx <- preset.result.idx["best"]
  
  c(start = preset.result$parameter.value[i], 
    end = preset.result$parameter.value[j],
    best = preset.result$parameter.value[best.idx])
}
```

::: {.noteblock data-latex=""}
The source code of the [get_fine_tune.param.endpoints](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L109) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L109) script on _GitHub_.
:::
:::

\newpage

#### [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L121) Function {#func.get_best_param.result}
\

Selects the best values from a pair of matched vectors: a vector of sorted *regularization parameter* $\lambda$ values and a vector of corresponding *Root Mean Squared Errors (RMSE)* values passed in the [param_values](#func.tune.model_param.args.param_values) and [RMSEs](#func.get_best_param.result.args.RMSEs) arguments, respectively.


::: { #func.get_best_param.result.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
        param_values.best_result <-
          get_best_param.result(tuned.result$parameter.value,
                                tuned.result$RMSE)
```
:::

::: { #func.get_best_param.result.args .sidebar }
##### Arguments
\

::: { #func.get_best_param.result.args.param_values .sidebar }
  - **param_values:** Numeric vector containing a sorted list of the *regularization parameter* $\lambda$ values to search for the best one during the *Model Regularization* process; 

:::
::: { #func.get_best_param.result.args.RMSEs .sidebar }
  - **RMSEs:** *RMSE* values computed during the *Model Regularization* process. 

:::
:::

::: { #func.get_best_param.result.details .sidebar }
##### Details
\

This is a *utility function* used to select the *best values* during the *Model Regularization* process, utilizing the *penalized approach* to regularize predictions as explained in [Section 24.1 *Case study: recommendation systems / A penalized approach*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#a-penalized-approach) of the *Course Textbook (New Edition)*[@IDS2_24-1].

With this approach, the best value of the *regularization parameter* $\lambda$ (we call this the *best value of the regularization parameter* or the *best value of $\lambda$*) is considered to be the value corresponding to the minimum value of the *RMSE* for the model being tested.

In *This Project*, this function is used internally in the [model.tune.param_range](#func.model.tune.param_range) function described in *This Section* below.
:::

::: { #func.get_best_param.result.value .sidebar }
##### Value
\

Numeric vector containing a pair of values: the best *regularization parameter* $\lambda$ value and corresponding *minimal RMSE*. 
:::

::: { #func.get_best_param.result.code .sidebar }
##### Source Code
\

The source code of the [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L121) function is shown below:
```{r eval=FALSE}
get_best_param.result <- function(param_values, RMSEs){
  best_pvalue_idx <- which.min(RMSEs)
  c(param.best_value = param_values[best_pvalue_idx], 
    best_RMSE = RMSEs[best_pvalue_idx])
}
```

::: {.noteblock data-latex=""}
The source code of the [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L121) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L121) script on _GitHub_.
:::
:::

\newpage


#### [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L126) Function {#func.tune.model_param}
\

Implements an algorithm for selecting the best value of the *regularization parameter* $\lambda$ from the sorted *parameter vector* passed in the [param_values](#func.tune.model_param.args.param_values) argument, using the *penalized approach* to regularize predictions as explained in [Section 24.1 *Case study: recommendation systems / A penalized approach*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#a-penalized-approach) of the *Course Textbook (New Edition)*[@IDS2_24-1].


##### Signature
\

```{r eval=FALSE}
tune.model_param <- function(param_values, 
                             fn_tune.test.param_value, 
                             break.if_min = TRUE,
                             steps.beyond_min = 2){

# ...
  list(tuned.result = data.frame(RMSE = RMSEs_tmp,
                                parameter.value = param_vals_tmp),
       best_result = param_values.best_result)
}  
```

::: { #func.tune.model_param.args .sidebar }
##### Arguments
\

::: { #func.tune.model_param.args.param_values .sidebar }
  - **param_values:** Numeric vector containing a sorted list of $\lambda$ values to search for the best one during the model regularization process; 

:::

::: { #func.tune.model_param.args.fn_tune.test.param_value .sidebar }
  - **fn_tune.test.param_value:** Model-specific helper function that validates the model by computing the model's *RMSE* value for a given value of the $\lambda$ parameter; 

:::

::: { #func.tune.model_param.args.break.if_min .sidebar }
  - **break.if_min:** (Optional, `TRUE` by default) Boolean value that determines whether the algorithm should terminate after completing the number of steps specified by the [steps.beyond_min](#func.tune.model_param.args.steps.beyond_min) argument from the moment the minimum `RMSE` value is found;

:::

::: { #func.tune.model_param.args.steps.beyond_min .sidebar }
  - **steps.beyond_min:** (Optional, 2 by default; only takes effect if [break.if_min](#func.tune.model_param.args.break.if_min) is `TRUE`) Specifies the number of steps after finding the minimum *RMSE* value after which the algorithm should terminate.

:::
:::

::: { #func.tune.model_param.details .sidebar }
##### Details
\

With the approach used in this algorithm, the best value of the *regularization parameter* $\lambda$ (we call this the *best value of the regularization parameter* or the *best value of $\lambda$*) is considered to be the value corresponding to the minimum value of the *Root Mean Square Error (RMSE)* for the model being tested.

To find the best value of the $\lambda$ parameter, the algorithm iterates over the values from the list passed in the [param_values](#func.tune.model_param.args.param_values) argument, computing the *RMSE* of the model for each of them, using the helper function specified in the [fn_tune.test.param_value](#func.tune.model_param.args.fn_tune.test.param_value) argument.

The algorithm continues iterating until the end of the  $\lambda$ parameter values list if [break.if_min](#func.tune.model_param.args.break.if_min) is `FALSE`.

Otherwise, the algorithm terminates after the number of cycles specified by the argument [steps.beyond_min](#func.tune.model_param.args.steps.beyond_min) has completed since the minimum *RMSE* value was reached.

::: {.noteblock data-latex=""}
The algorithm assumes that the set of the *RMSE* values is a monotonically non-increasing function of the *regularization parameter* $\lambda$ until the minimum is reached and monotonically non-decreasing thereafter. That is, it is assumed that the function can have only one minimum on the given set.
:::
:::

::: { #func.tune.model_param.value .sidebar }
##### Value
\

This function returns a list of two objects:
```{r eval=FALSE}
  list(tuned.result = data.frame(RMSE = RMSEs_tmp,
                                parameter.value = param_vals_tmp),
       best_result = param_values.best_result)
```

The objects comprising the return list are as follows:

  - `best_result`: Vector containing a *pair of values*: the found *best value of the regularization parameter* $\lambda$ for which the *RMSE* value is minimal, along with the minimal *RMSE* value itself;

  - `tuned.result`: Data frame containing two variables:
  
    - *parameter.value*: A vector containing all processed values of the parameter $\lambda$;
    
    - *RMSE*: A vector containing the *RMSE* values corresponding to the processed values of $\lambda$.

:::

##### Source Code
\
Below is the most significant part of the source code of the [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L126) function:
```{r eval=FALSE}
tune.model_param <- function(param_values, 
                             fn_tune.test.param_value, 
                             break.if_min = TRUE,
                             steps.beyond_min = 2){
  n <- length(param_values)
  param_vals_tmp <- numeric()
  RMSEs_tmp <- numeric()
  RMSE_min <- Inf
  i_max.beyond_RMSE_min <- Inf
  prm_val.best <- NA

  # ...
  
  for (i in 1:n) {
    put_log1("Function: `tune.model_param`:
Iteration %1", i)
    prm_val <- param_values[i]
    param_vals_tmp[i] <- prm_val
    
    RMSE_tmp <- fn_tune.test.param_value(prm_val)
    RMSEs_tmp[i] <- RMSE_tmp

    plot(param_vals_tmp[RMSEs_tmp], RMSEs_tmp[RMSEs_tmp])

    if(RMSE_tmp > RMSE_min){
      warning("Function: `tune.model_param`:
`RSME` reached its minimum: ", RMSE_min, "
for parameter value: ", prm_val)
      put_log2("Function: `tune.model_param`:
Current `RMSE` value is %1 related to parameter value: %2",
               RMSE_tmp,
               prm_val)
      
      if (i > i_max.beyond_RMSE_min) {
        warning("Function: `tune.model_param`:
Operation is breaked (after `RSME` reached its minimum) on the following step: ", i)
        break
      }
      next
    }

    RMSE_min <- RMSE_tmp
    prm_val.best <- prm_val
    
    if (break.if_min) {
      i_max.beyond_RMSE_min <- i + steps.beyond_min
    }
  }
  
  param_values.best_result <- c(param.best_value = prm_val.best, 
                                best_RMSE = RMSE_min)
  
  
  list(tuned.result = data.frame(RMSE = RMSEs_tmp,
                                parameter.value = param_vals_tmp),
       best_result = param_values.best_result)
}
```

::: {.noteblock data-latex=""}
The complete source code of the [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L126) function is available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L126) script on _GitHub_.
:::

\newpage

#### [model.tune.param_range](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L208) Function {#func.model.tune.param_range}
\

Implements an algorithm for fine-tuning the model under test by figuring out the most precise value possible of the *regularization parameter* $\lambda$ over a given interval determined by the $start$ and $end$ values of the interval passed in the [loop_starter](#func.model.tune.param_range.args.loop_starter) argument, using the *penalized approach* to regularize predictions as explained in [Section 24.1 *Case study: recommendation systems / A penalized approach*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#a-penalized-approach) of the *Course Textbook (New Edition)*[@IDS2_24-1].

##### Signature
\
```{r eval=FALSE}
model.tune.param_range <- function(loop_starter,
                             tune_dir_path,
                             cache_file_base_name,
                             fn_tune.test.param_value,
                             max.identical.min_RMSE.count = 4,
                             endpoint.min_diff = 0,
                             break.if_min = TRUE,
                             steps.beyond_min = 2){
  # ...
  list(best_result = param_values.best_result,
       param_values.endpoints = c(prm_val.leftmost, prm_val.rightmost, seq_increment),
       tuned.result = data.frame(parameter.value = parameter.value,
                                 RMSE = result.RMSE))
}
```

::: { #func.model.tune.param_range.args .sidebar }
##### Arguments
\

::: { #func.model.tune.param_range.args.loop_starter .sidebar }
###### ***loop_starter***
\
A numeric vector of the form `c(start, end, dvs)`, where `start` and `end` are the endpoints of the interval over which the value of the parameter $\lambda$ that minimizes *RMSE* has to be found.

The `dvs` is a divisor used to calculate the *step size* for partitioning the interval into a sequence of $\lambda$ values, among which the value that minimizes *RMSE* has to be found.

So the *step size* of the sequence is calculated as follows:
$$
step = \frac{end - start}{dvs}
$$  

The sequence obtained as a result of the transformation is equivalent to the one generated by the function [base::seq](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/seq) as follows:
```{r eval=FALSE}
seq(start, end, step)
```  

::: {.noteblock data-latex=""}
In the function body, the *step size* is stored in the local variable `seq_increment`, and the values of $start$, $end$, and $dvs$ are stored in the local variables `seq_start`, `seq_end`, and `interval_divisor`, respectively.
:::

In fact, the `seq` function is called internally to generate the sequence during the algorithm's execution.

Thus, the sequence is generated by the following [line of code](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L256):
```{r eval=FALSE}
    test_param_vals <- seq(seq_start, seq_end, seq_increment)
```
:::

::: { #func.model.tune.param_range.args.tune_dir_path .sidebar }
###### ***tune_dir_path***
\
To improve performance, the algorithm caches intermediate results in the file system. The value passed in *this argument* specifies the path to the directory where the files are cached.
:::

::: { #func.model.tune.param_range.args.cache_file_base_name .sidebar }
###### ***cache_file_base_name***
\
The algorithm generates unique names for cache files based on this and the [loop_starter](#func.model.tune.param_range.args.loop_starter) arguments' values, as well as a few other intermediate values calculated at runtime.
:::

::: { #func.model.tune.param_range.args.fn_tune.test.param_value .sidebar }
###### ***fn_tune.test.param_value***
\
Model-specific helper function name to pass to the [same-named argument](#func.tune.model_param.args.fn_tune.test.param_value) of the [tune.model_param](#func.tune.model_param) function (see description above) that is called internally during the execution of the algorithm.
:::

::: { #func.model.tune.param_range.args.max.identical.min_RMSE.count .sidebar }
###### ***max.identical.min_RMSE.count***
\
(Optional, 4 by default) If more than one identical minimum *RMSE* value is calculated during execution, the number of identical minimums is limited by the value of *this argument*. When it is reached, the algorithm considers the task execution to be complete.
:::

::: { #func.model.tune.param_range.args.endpoint.min_diff .sidebar }
###### ***endpoint.min_diff***
\
(Optional, 0 by default) Defines the sensitivity threshold for determining the neighborhood boundaries of the minimum `RMSE` value (see the [Details](#func.model.tune.param_range.details) section below for more details).
:::

::: { #func.model.tune.param_range.args.break.if_min .sidebar }
###### ***break.if_min***
\
(Optional, `TRUE` by default) Boolean value to pass to the [same-named argument](#func.tune.model_param.args.break.if_min) of the [tune.model_param](#func.tune.model_param) function (see description above) that is called internally during the execution of the algorithm.
:::

::: { #func.model.tune.param_range.args.steps.beyond_min .sidebar }
###### ***steps.beyond_min***
\
(Optional, 2 by default) Numeric value to pass to the [same-named argument](#func.tune.model_param.args.steps.beyond_min) of the [tune.model_param](#func.tune.model_param) function (see description above) that is called internally during the execution of the algorithm.
:::
:::

\newpage

::: { #func.model.tune.param_range.details .sidebar }
##### **Details** 
\

With the approach used in this algorithm, the best value of the *regularization parameter* $\lambda$ (we call this the *best value of the regularization parameter* or the *best value of $\lambda$*) is considered to be the value corresponding to the minimum value of the *Root Mean Square Error (RMSE)* for the model being tested.

During the execution, the algorithm organizes a cycle consisting of the following steps:

::: { #func.model.tune.param_range.details.step1 .sidebar }
  1. Calculates the step size for partitioning the interval into a sequence of $\lambda$ values and save it to the local variable `seq_increment` as described in the [loop_starter](#func.model.tune.param_range.args.loop_starter) argument description above using the following [line of code](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L240):
```{r eval=FALSE}
    seq_increment <- (seq_end - seq_start)/interval_divisor 
```

:::

::: { #func.model.tune.param_range.details.step2 .sidebar }
  2. Checks if the *step size* of the generated sequence is less than the minimum allowed value (in the current implementation, we use `1e-13`), and if so, exits the loop and goes to the [Finalizing Execution](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L426) section of the code described in the [Finalizing Execution](#func.model.tune.param_range.details.finalizing) subsection below. 
  
  - Otherwise, proceeds to the [next step](#func.model.tune.param_range.details.step3):  
```{r eval=FALSE}
    if (seq_increment < 0.0000000000001) {
      warning("Function `model.tune.param_range`:
parameter value increment is too small.")
      
      put_log2("Function `model.tune.param_range`:
Final best RMSE for `parameter value = %1`: %2",
               param_values.best_result["param.best_value"],
               param_values.best_result["best_RMSE"])
      
      put(param_values.best_result)
      # browser()
      break
    }
```

:::

::: {.noteblock data-latex=""}
In the code snippet above, we use the custom function [put_log2](#func.put_log2) described above in the [Logging Functions] section of *This Appendix*.
:::  

::: { #func.model.tune.param_range.details.step3 .sidebar }
  3. If the *step size* is no less than the minimum allowed value (`seq_increment >= 1e-13` in our case), creates a vector containing a sequence of $\lambda$ values (as described in the [loop_starter](#func.model.tune.param_range.args.loop_starter) argument description above) using the following [line of code](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L256):
```{r eval=FALSE}
    test_param_vals <- seq(seq_start, seq_end, seq_increment)
```

:::

::: { #func.model.tune.param_range.details.step4 .sidebar }
  4. Generates a unique name for the current iteration's cache file based on the values passed in the [cache_file_base_name](#func.model.tune.param_range.args.cache_file_base_name) and [loop_starter](#func.model.tune.param_range.args.loop_starter) arguments, along with the values stored in the local variables `seq_start`, `seq_end`, and `interval_divisor`, concatenates the name with the path passed in the [tune_dir_path](#func.model.tune.param_range.args.tune_dir_path) argument, and stores the value in the local variable `file_path_tmp`:  
```{r eval=FALSE}
    file_name_tmp <- cache_file_base_name |>
      str_c("_") |>
      str_c(as.character(loop_starter[1])) |>
      str_c("_") |>
      str_c(as.character(loop_starter[3])) |>
      str_c("_") |>
      str_c(as.character(interval_divisor)) |>
      str_c(".") |>
      str_c(as.character(seq_start)) |>
      str_c("-") |>
      str_c(as.character(seq_end)) |>
      str_c(".RData")
    
    file_path_tmp <- file.path(tune_dir_path, file_name_tmp)
    
    put_log1("Function `model.tune.param_range`:
File path generated: %1", file_path_tmp)
```

::: {.noteblock data-latex=""}
In the code snippet above, we use the custom function [put_log1](#func.put_log1) described above in the [Logging Functions] section of *This Appendix*.
:::
:::

  5. Checks whether a file with the full name stored in the `file_path_tmp` variable exists, and if so, loads all the necessary information for the current iteration from it and goes to [step 8](#func.model.tune.param_range.details.step8). Otherwise, proceeds to the [next step](#func.model.tune.param_range.details.step6):
```{r eval=FALSE}
    if (file.exists(file_path_tmp)) {
      put_log1("Function `model.tune.param_range`:
Loading tuning data from file: %1...", file_path_tmp)
      
      load(file_path_tmp)
      put_log1("Function `model.tune.param_range`:
Tuning data has been loaded from file: %1", file_path_tmp)
      
      tuned.result <- tuned_result$tuned.result
    } else {
      # ...
    }
```


::: { #func.model.tune.param_range.details.step6 .sidebar }
  6. Calls the helper function [tune.model_param](#func.tune.model_param) and stores the returned result in the local variable `tuned_result`, passing the vector created earlier in [step 3](#func.model.tune.param_range.details.step3) to the argument [param_values](#func.tune.model_param.args.param_values) along with the values of the remaining arguments passed in the following arguments of the same name to *this function*:
    - [fn_tune.test.param_value](#func.model.tune.param_range.args.fn_tune.test.param_value);
    - [break.if_min](#func.model.tune.param_range.args.break.if_min);
    - [steps.beyond_min](#func.model.tune.param_range.args.steps.beyond_min):
```{r eval=FALSE}
      tuned_result <- tune.model_param(test_param_vals, 
                                        fn_tune.test.param_value,
                                        break.if_min,
                                        steps.beyond_min)
```

:::

::: { #func.model.tune.param_range.details.step7 .sidebar }
  7. Extracts the data frame element stored in the variable `tuned_result$tuned.result` from the *list object* saved in the local variable `tuned_result` in the [previous step](#func.model.tune.param_range.details.step6) and stores it in the local variable `tuned.result`. Then stores the variable `tuned_result` along with the necessary auxiliary information in the cache file with the full name created earlier in [step 4](#func.model.tune.param_range.details.step4):
```{r eval=FALSE}
      tuned.result <- tuned_result$tuned.result
      
      save(tuned_result,
           param.best_value,
           seq_increment,
           interval_divisor,
           file = file_path_tmp)

      put_log1("Function `model.tune.param_range`:
File saved: %1", file_path_tmp)
```
:::



::: { #func.model.tune.param_range.details.step8 .sidebar }
  8. Determines endpoints for a new interval of $\lambda$ values in the neighborhood of the minimum *RMSE* value (figured out so far)  with use of the helper function [get_fine_tune.param.endpoints.idx](#func.get_fine_tune.param.endpoints.idx) described above, to improve the accuracy of the *RMSE* calculation in the next iteration:
```{r eval=FALSE}
    bound.idx <- get_fine_tune.param.endpoints.idx(tuned.result)
    start.idx <- bound.idx["start"]
    end.idx <- bound.idx["end"]

    prm_val.leftmost.tmp <- tuned.result$parameter.value[start.idx]
    RMSE.leftmost.tmp <- tuned.result$RMSE[start.idx]

    prm_val.rightmost.tmp <- tuned.result$parameter.value[end.idx]
    RMSE.rightmost.tmp <- tuned.result$RMSE[end.idx]
    
    min_RMSE <- tuned.result$RMSE[best_RMSE.idx]
    min_RMSE.prm_val <- tuned.result$parameter.value[best_RMSE.idx]

    seq_start <- prm_val.leftmost.tmp
    seq_end <- prm_val.rightmost.tmp
```

:::

::: { #func.model.tune.param_range.details.step9 .sidebar }
  9. Checks whether the local variable `best_RMSE` is already initialized, and if not, initializes it to the minimum *RMSE* value for the current iteration, figured out in the [previous step](#func.model.tune.param_range.details.step8), along with local variables intended to store the endpoint values:
```{r eval=FALSE}
    if (is.na(best_RMSE)) {
      prm_val.leftmost <- prm_val.leftmost.tmp
      RMSE.leftmost <- RMSE.leftmost.tmp
      
      prm_val.rightmost <- prm_val.rightmost.tmp
      RMSE.rightmost <- RMSE.rightmost.tmp
      
      param.best_value <- min_RMSE.prm_val
      best_RMSE <- min_RMSE
    }
```

:::


::: { #func.model.tune.param_range.details.step10 .sidebar }
  10. Checks deviations from the minimum *RMSE* value for the values corresponding to the endpoints of the new interval of the $\lambda$ parameter values figured out in the [step 8](#func.model.tune.param_range.details.step8) and updates in corresponding local variables those endpoint values of $\lambda$ and *RMSE* for which the corresponding deviation reaches the minimum threshold specified by the value passed in the [endpoint.min_diff](#func.model.tune.param_range.args.endpoint.min_diff) argument:
```{r eval=FALSE}
    if (RMSE.leftmost.tmp - min_RMSE >= endpoint.min_diff) {
      prm_val.leftmost <- prm_val.leftmost.tmp
      RMSE.leftmost <- RMSE.leftmost.tmp
    } 
    
    if (RMSE.rightmost.tmp - min_RMSE >= endpoint.min_diff) {
      prm_val.rightmost <- prm_val.rightmost.tmp
      RMSE.rightmost <- RMSE.rightmost.tmp
    } 
```

:::


::: { #func.model.tune.param_range.details.step11 .sidebar }
  11. Makes sure that the index of the start endpoint of the interval of the $\lambda$ parameter values figured out in the [step8](#func.model.tune.param_range.details.step8) is less than the index of the end endpoint and, if not, exits the loop with the *warning message* and goes to the [Finalizing Execution](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L426) section of the code described in the [Finalizing Execution](#func.model.tune.param_range.details.finalizing) subsection below: 
```{r eval=FALSE}
    if (end.idx - start.idx <= 0) {
      warning("`tuned.result$parameter.value` sequential start index are the same or greater than end one.")
      put_log1("Function `model.tune.param_range`:
Current minimal RMSE: %1", rmse_min)
      
      put_log2("Function `model.tune.param_range`:
Reached minimal RMSE for the test parameter value = %1: %2",
               param_values.best_result["param.best_value"],
               param_values.best_result["best_RMSE"])
      
      put(param_values.best_result)
      break
    }
```
:::

::: { #func.model.tune.param_range.details.step11 .sidebar }
  12. Checks if the minimum *RMSE* value determined so far (and stored in the local variable `best_RMSE`) is equal to the minimum *RMSE* value calculated for the current iteration (stored in the `min_RMSE`), and if so, outputs an appropriate warning message and proceeds to the [next step](#func.model.tune.param_range.details.step13). 
  
  - Otherwise, makes sure that the minimum *RMSE* value determined so far is no less than the minimum *RMSE* value calculated for the current iteration (`best_RMSE >= min_RMSE`) and goes to [step ?](#).
  
  - Otherwise, **stops execution** with the error message (considers a fatal error!):
```{r eval=FALSE}
    if (best_RMSE == min_RMSE) {
      warning("Currently computed minimal RMSE equals the previously reached best one: ",
              best_RMSE, "
Currently computed minial value is: ", min_RMSE)
      
      put_log2("Function `model.tune.param_range`:
Current minimal RMSE for `parameter value = %1`: %2",
               tuned.result$parameter.value[which.min(tuned.result$RMSE)],
               min_RMSE)
      
      put_log2("Function `model.tune.param_range`:
So far reached best RMSE for `parameter value = %1`: %2",
               param_values.best_result["param.best_value"],
               param_values.best_result["best_RMSE"])
      
      put(param_values.best_result)
      
      # goes to the next step of the current iteration
      # ...
      
    } else if (best_RMSE < min_RMSE) {
      warning("Current minimal RMSE is greater than previously computed best value: ",
              best_RMSE, "
Currently computed minial value is: ", min_RMSE)
      stop("Current minimal RMSE is greater than previously computed best value: ",
           best_RMSE, "
Currently computed minial value is: ", min_RMSE)
    }
```
:::

::: { #func.model.tune.param_range.details.step13 .sidebar }
  13. (`best_RMSE == min_RMSE`) Checks the number of matches between the minimum *RMSE* value determined so far and the minimum *RMSE* value calculated for the current iteration (`best_RMSE == min_RMSE`), and if it exceeds the value passed in the argument [max.identical.min_RMSE.count](#func.model.tune.param_range.args.max.identical.min_RMSE.count), saves the best results for the $\lambda$ and *RMSE* values figured out in the current iteration in the local variable `param_values.best_result` and exits the loop with an appropriate warning message and goes to the [Finalizing Execution](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L426) section of the code described in the [Finalizing Execution](#func.model.tune.param_range.details.finalizing) subsection below. 
  
  - Otherwise, proceeds to the [next step](#func.model.tune.param_range.details.step14):
```{r eval=FALSE}
    if (best_RMSE == min_RMSE) {
      
      # Outputs an appropriate warning message
      # ...
      
      if (sum(tuned.result$RMSE[tuned.result$RMSE == min_RMSE]) >= max.identical.min_RMSE.count) {
        warning("Minimal `RMSE`identical values count reached it maximum allowed value: ",
                max.identical.min_RMSE.count)

        put(tuned.result$RMSE)
        
        param_values.best_result <-
          get_best_param.result(tuned.result$parameter.value,
                                tuned.result$RMSE)

        put_log2("Function `model.tune.param_range`:
      Reached the best RMSE for `parameter value = %1`: %2",
                 param_values.best_result["param.best_value"],
                 param_values.best_result["best_RMSE"])
        break
      }
    } else if (best_RMSE < min_RMSE) {
      # Fatal Error! (stops the execution)
    }
```

::: {.noteblock data-latex=""}
To retrieve the best results for the current iteration from the data stored in the local variable `tuned.result`, the helper function [get_best_param.result](#func.get_best_param.result) described above is used.
:::
:::

::: { #func.model.tune.param_range.details.step14 .sidebar }
  14. Updates the following local variables: `best_RMSE` (wihich stores the current best *RMSE* value) with the minimum *RMSE* value computed for the current iteration (stored in the `min_RMSE`) and `param_values.best_result` with the best results retrieved from the  `tuned.result`, and proceeds to the next iteration from the [step 1](#func.model.tune.param_range.details.step1):
  
```{r eval=FALSE}
    # ...
    
    best_RMSE <- min_RMSE
    param.best_value <- min_RMSE.prm_val

    param_values.best_result <- 
      get_best_param.result(tuned.result$parameter.value, 
                          tuned.result$RMSE)
    
    put_log2("Function `model.tune.param_range`:
Currently reached best RMSE for `parameter value = %1`: %2",
             param_values.best_result["param.best_value"],
             param_values.best_result["best_RMSE"])
    
    put(param_values.best_result)
  }
  # End repeat loop
```
:::

::: { #func.model.tune.param_range.details.finalizing .sidebar }
###### ***Finalizing Execution***
\

Finally, the algorithm initializes the objects to be included in the return list with the results obtained during execution and returns the *list object* to the client code:
```{r eval=FALSE}
  # Finalizing execution:
  n <- length(tuned.result$parameter.value)
  
  parameter.value <- tuned.result$parameter.value
  result.RMSE <- tuned.result$RMSE
  
  if (result.RMSE[1] == best_RMSE) {
    parameter.value[1] <- prm_val.leftmost
    result.RMSE[1] <- RMSE.leftmost
  }
  
  if (result.RMSE[n] == best_RMSE) {
    parameter.value[n+1] <- prm_val.rightmost
    result.RMSE[n+1] <- RMSE.rightmost
  }
  
  list(best_result = param_values.best_result,
       param_values.endpoints = c(prm_val.leftmost, prm_val.rightmost, seq_increment),
       tuned.result = data.frame(parameter.value = parameter.value,
                                 RMSE = result.RMSE))
```
:::

::: {#func.model.tune.param_range.value .sidebar }
##### **Value**
\

This function returns a list of three objects:
```{r eval=FALSE}
  list(best_result = param_values.best_result,
       param_values.endpoints = c(prm_val.leftmost, prm_val.rightmost, seq_increment),
       tuned.result = data.frame(parameter.value = parameter.value,
                                 RMSE = result.RMSE))
```

The objects comprising the return list are as follows:

  - `best_result`: A vector containing a *pair of values*: the found *best value of the regularization parameter* $\lambda$ for which the *RMSE* value is minimal, along with the minimal *RMSE* value itself;

  - `param_values.endpoints`: Information related to the final interval of the *regularization parameter* $\lambda$ values.;

  - `tuned.result`: A data frame containing two variables:
  
    - *parameter.value*: A vector containing all processed values of the parameter $\lambda$;
    
    - *RMSE*: A vector containing the *RMSE* values corresponding to the processed values of $\lambda$.

:::

::: {#func.model.tune.param_range.code .sidebar }
##### Source Code
\

The complete source code of the function [model.tune.param_range](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L208) is available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L208) script on _GitHub_.
:::

\newpage

#### [cmmn_hlp.rglr.fn.tmpl](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#LX) Function {#func.cmmn_hlp.rglr.fn.tmpl}
\

::: { #func.cmmn_hlp.rglr.fn.tmpl.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
cmmn_hlp.rglr.fn.tmpl()

```
:::

::: { #func.cmmn_hlp.rglr.fn.tmpl.args .sidebar }
##### Arguments
\

::: { #func.cmmn_hlp.rglr.fn.tmpl.args. .sidebar }
  - **:** ; 

:::
::: { #func.cmmn_hlp.rglr.fn.tmpl.args. .sidebar }
  - **:** ; 

:::
:::

::: { #func.cmmn_hlp.rglr.fn.tmpl.details .sidebar }
##### Details
\



:::

::: { #func.cmmn_hlp.rglr.fn.tmpl.value .sidebar }
##### Value
\

:::

::: { #func.cmmn_hlp.rglr.fn.tmpl.code .sidebar }
##### Source Code
\

The source code of the [cmmn_hlp.rglr.fn.tmpl](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#LX) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [cmmn_hlp.rglr.fn.tmpl](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#LX) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#LX) script on _GitHub_.
:::
:::

\newpage

## Data Helper Functions {#appndx_a.data_helper.functions}
\

### Initializing Input Datasets

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the the [Initializing input datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L88) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L88) script on _GitHub_.
:::

#### [make_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L89) Function {#func.make_source_datasets}
\

Creates the major input datasets used throughout the project. 

::: { #func.make_source_datasets.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
movielens_datasets <- make_source_datasets()

```
:::

::: { #func.make_source_datasets.details .sidebar }
##### Details
\

This function produces datasets listed in the [Value](#func.make_source_datasets.value) section below and described in detail in [Appendix B: Models Training Datasets], using the `edx` as the original dataset.

::: {.noteblock data-latex=""}
The function calls internally the following functions described below:

  - [splitGenreRows](#) to create the [`edx.sgr` Object];
  - [sample_train_validation_sets](#) to create *train* and *validation* sets of the inner datasets of the [`edx_CV` Object].

:::
:::

::: { #func.make_source_datasets.value .sidebar }
##### Value
\

The list of the following datasets are returned to the client code:

  - [`edx.mx` Matrix Object];
  
  - [`edx.sgr` Object];

  - [`movie_map` Object];
  
  - [`date_days_map` Object];

  - [`edx_CV` Object].

:::

::: { #func.make_source_datasets.code .sidebar }
##### Source Code
\

The source code of the [make_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L89) function is shown below:
```{r eval=FALSE}
make_source_datasets <- function(){
  put_log("Function: `make_source_datasets`: Creating source datasets...")
  
  put_log("Function: `make_source_datasets`: Creating Rating Matrix from `edx` dataset...")
  edx.mx <- edx |> 
    mutate(userId = factor(userId),
           movieId = factor(movieId)) |>
    select(movieId, userId, rating) |>
    pivot_wider(names_from = movieId, values_from = rating) |>
    column_to_rownames("userId") |>
    as.matrix()
  
  put_log("Function: `make_source_datasets`:
Matrix created: `edx.mx` of the following dimentions:")
  put(dim(edx.mx))

  #> To be able to map movie IDs to titles we create the following lookup table:
  movie_map <- edx |> select(movieId, title, genres) |> 
    distinct(movieId, .keep_all = TRUE)
  
  put_log("Function: `make_source_datasets`: Dataset created: movie_map")
  put(summary(movie_map))
  
  put_log("Function: `make_source_datasets`: Creating Date-Days Map dataset...")
  date_days_map <- edx |>
    mutate(date_time = as_datetime(timestamp)) |>
    mutate(date = as_date(date_time)) |>
    mutate(year = year(date_time)) |>
    mutate(days = as.integer(date - min(date))) |>
    select(timestamp, date_time, date, year, days) |>
    distinct(timestamp, .keep_all = TRUE)
  
  str(date_days_map)
  put_log("Function: `make_source_datasets`: Dataset created: date_days_map")
  put(summary(date_days_map))
  
  put_log("Function: `make_source_datasets`: 
To account for the Movie Genre Effect, we need a dataset with split rows 
for movies belonging to multiple genres.")
  edx.sgr <- splitGenreRows(edx)
  
  
  
  #> We will use K-fold cross validation as explained in 
  #> Section 29.6.1: "K-fold validation" of the Cource Textbook:
  #> https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation
  #> We are going to compute the following version of the MSE introducing in that section:
  
  # $$
  #   \mbox{MSE}(\lambda) \approx\frac{1}{B} \sum_{b = 1}^B \frac{1}{N}\sum_{i = 1}^N \left(\hat{y}_i^b(\lambda) - y_i^b\right)^2 
  # $$
  
  start <- put_start_date()
  edx_CV <- lapply(kfold_index,  function(fold_i){
    
    put_log1("Method `make_source_datasets`: 
Creating K-Fold Cross-Validation Datasets, Fold %1", fold_i)
    
    #> We split the initial datasets into training sets, which we will use to build 
    #> and train our models, and validation sets in which we will compute the accuracy 
    #> of our predictions, the way described in the `Section 23.1.1 Movielens data`
    #> (https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#movielens-data) 
    #> of the Course Textbook.
    
    split_sets <- edx |>
      sample_train_validation_sets(fold_i*1000)
    
    train_set <- split_sets$train_set
    validation_set <- split_sets$validation_set
    
    put_log("Function: `make_source_datasets`: 
Sampling 20% from the split-row version of the `edx` dataset...")
    split_sets.gs <- edx.sgr |>
      sample_train_validation_sets(fold_i*2000)

    train.sgr <- split_sets.gs$train_set
    validation.sgr <- split_sets.gs$validation_set
    
    # put_log("Function: `make_source_datasets`: Dataset created: validation.sgr")
    # put(summary(validation.sgr))
    
    #> We will use the array representation described in `Section 17.5 of the Textbook`
    #> (https://rafalab.dfci.harvard.edu/dsbook-part-2/linear-models/treatment-effect-models.html#sec-anova), 
    #> for the training data. 
    #> To create this matrix, we use `tidyr::pivot_wider` function:
    
    # train_set <- mutate(train_set, userId = factor(userId), movieId = factor(movieId))
    # train.sgr <- mutate(train.sgr, userId = factor(userId), movieId = factor(movieId))
    
    put_log("Function: `make_source_datasets`: Creating Rating Matrix from Train Set...")
    train_mx <- train_set |> 
      mutate(userId = factor(userId),
             movieId = factor(movieId)) |>
      select(movieId, userId, rating) |>
      pivot_wider(names_from = movieId, values_from = rating) |>
      column_to_rownames("userId") |>
      as.matrix()
    
    put_log("Function: `make_source_datasets`:
Matrix created: `train_mx` of the following dimentions:")
    put(dim(train_mx))


    list(train_set = train_set,
         train_mx = train_mx,
         train.sgr = train.sgr,
         validation_set = validation_set)
  })
  put_end_date(start)
  put_log("Function: `make_source_datasets`: 
Set of K-Fold Cross-Validation datasets created: edx_CV")
  
  tuning_sets <- edx |>
    sample_train_validation_sets(5423)
  
  list(edx_CV = edx_CV,
       edx.mx = edx.mx,
       edx.sgr = edx.sgr,
       tuning_sets = tuning_sets,
       movie_map = movie_map,
       date_days_map = date_days_map)
}
```

::: {.noteblock data-latex=""}
The source code of the [make_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L89) function is also available in the [Initializing input datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L88) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L89) script on _GitHub_.
:::
:::

#### [init_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L211) Function {#func.init_source_datasets}
\

Creates the major input datasets used throughout the project. 

::: { #func.init_source_datasets.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
movielens_datasets <- init_source_datasets()

```
:::

##### Details
\

The function checks whether the required source datasets are cached on the hard disk and, if so, loads them from the cache file.

Otherwise, it calls the [make_source_datasets](#func.make_source_datasets) function, which creates all the necessary datasets using the `edx` as the original dataset.

:::

::: { #func.init_source_datasets.value .sidebar }
##### Value
\

The list of the following datasets (described in detail in [Appendix B: Models Training Datasets]) is returned to the client code:

  - [`edx.mx` Matrix Object];
  
  - [`edx.sgr` Object];

  - [`movie_map` Object];
  
  - [`date_days_map` Object];

  - [`edx_CV` Object].

:::

::: { #func.init_source_datasets.code .sidebar }
##### Source Code
\

The simplified source code of the [init_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L211) function is shown below:
```{r eval=FALSE}
init_source_datasets <- function(){
  put_log("Method `init_source_datasets`: 
Initializing sourse datasets...")
  
  if(file.exists(movielens_datasets_file_path)){
    movielens_datasets <- load_movielens_data_from_file(movielens_datasets_file_path)
  } else if(file.exists(movielens_datasets_zip)) {
    put_log("Method `init_source_datasets`: 
Unzipping MovieLens data file from zip-archive: {movielens_datasets_zip}...") 
    
    unzip(movielens_datasets_zip, movielens_datasets_file_path)
    
    if(!file.exists(movielens_datasets_file_path)) {
      put_log("Method `init_source_datasets`: 
File does not exists: {movielens_datasets_file}.")
      stop("Failed to unzip MovieLens data zip-archive.")
    }
    
    movielens_datasets <- load_movielens_data_from_file(movielens_datasets_file_path)
  } else {
    put_log("Method `init_source_datasets`: 
Creating datasets...")
    library(edx.capstone.movielens.data)
    put_log("Method `init_source_datasets`: 
Library attached: 'edx.capstone.movielens.data'")
    
    movielens_datasets <- make_source_datasets()
    put("Method `init_source_datasets`: 
All required datasets have been created.")
    
    put_log("Method `init_source_datasets`: 
Saving newly created input datasets to file...")
    save(movielens_datasets, file =  movielens_datasets_file_path)

    if(!file.exists(movielens_datasets_file_path)) {
      put_log("Method `init_source_datasets`: 
File was not created: {movielens_datasets_file}.")
      warning("MovieLens data was not saved to file.")
    } else {
      put_log("Method `init_source_datasets`: 
Datasets have been saved to file: {movielens_datasets_file_path}.") 
      
      
      put_log("Method `init_source_datasets`: 
Creating zip-archive: {movielens_datasets_zip}...") 
      
      zip(movielens_datasets_zip, movielens_datasets_file_path)
      
      put_log("Method `init_source_datasets`: 
Zip-archive created: {movielens_datasets_zip}.")
    }
  }
  movielens_datasets
}
```

::: {.noteblock data-latex=""}
The complete source code of the [init_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L211) function is available in the [Initializing input datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L88) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L211) script on _GitHub_.
:::
:::

### Data Processing Functions

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) script on _GitHub_.
:::

#### [load_movielens_data_from_file](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L4) Function {#func.load_movielens_data_from_file}
\

::: { #func.load_movielens_data_from_file.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
```
:::

::: { #func.load_movielens_data_from_file.args .sidebar }
##### Arguments
\

:::
::: { #func.load_movielens_data_from_file.args.seed .sidebar }
  - **file_path:** Data file full path. 

:::
:::

::: { #func.load_movielens_data_from_file.details .sidebar }
##### Details
\



:::

::: { #func.load_movielens_data_from_file.value .sidebar }
##### Value
\

:::

::: { #func.load_movielens_data_from_file.code .sidebar }
##### Source Code
\

The source code of the [load_movielens_data_from_file](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L4) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [load_movielens_data_from_file](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L4) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L4) script on _GitHub_.
:::
:::

#### [splitByUser](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L14) Function {#func.splitByUser}
\

::: { #func.splitByUser.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
```
:::

::: { #func.splitByUser.args .sidebar }
##### Arguments
\

::: { #func.splitByUser.args.data .sidebar }
  - **data:** ; 

:::
:::

::: { #func.splitByUser.details .sidebar }
##### Details
\



:::

::: { #func.splitByUser.value .sidebar }
##### Value
\

:::

::: { #func.splitByUser.code .sidebar }
##### Source Code
\

The source code of the [splitByUser](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L14) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [splitByUser](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L14) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L14) script on _GitHub_.
:::
:::

#### [sample_train_validation_sets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) Function {#func.sample_train_validation_sets}
\

Splits the input dataset passed in the [data](#func.sample_train_validation_sets.args.data) argument into *train* and *validation* datasets in the way described in [Section 29.6 *Cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6].

::: { #func.sample_train_validation_sets.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
split_sets <- data |>
      sample_train_validation_sets(seed)
```
:::

::: { #func.sample_train_validation_sets.args .sidebar }
##### Arguments
\

::: { #func.sample_train_validation_sets.args.data .sidebar }
  - **data:** Input dataset to split; 

:::
::: { #func.sample_train_validation_sets.args.seed .sidebar }
  - **seed:** Seed value; 

:::
:::

::: { #func.sample_train_validation_sets.details .sidebar }
##### Details
\



:::

::: { #func.sample_train_validation_sets.value .sidebar }
##### Value
\

:::

::: { #func.sample_train_validation_sets.code .sidebar }
##### Source Code
\

The source code of the [sample_train_validation_sets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) function is shown below:
```{r eval=FALSE}
sample_train_validation_sets <- function(data, seed){
  put_log("Function: `sample_train_validation_sets`: Sampling 20% of the `data` data...")
  set.seed(seed)
  validation_ind <- 
    sapply(splitByUser(data),
           function(i) sample(i, ceiling(length(i)*.2))) |> 
    unlist() |> 
    sort()
  
  put_log("Function: `sample_train_validation_sets`: 
Extracting 80% of the original `data` not used for the Validation Set, 
excluding data for users who provided no more than a specified number of ratings: {min_nratings}.")
  
  train_set <- data[-validation_ind,]
  
  put_log("Function: `sample_train_validation_sets`: Dataset created: train_set")
  put(summary(train_set))
  
  put_log("Function: `sample_train_validation_sets`: 
To make sure we dont include movies in the Training Set that should not be there, 
we exclude entries using the semi_join function from the Validation Set.")
  tmp.data <- data[validation_ind,]
  
  validation_set <- tmp.data |> 
    semi_join(train_set, by = "movieId") |> 
    semi_join(train_set, by = "userId") |>
    as.data.frame()
  
  # Add rows excluded from `validation_set` into `train_set`
  tmp.excluded <- anti_join(tmp.data, validation_set)
  train_set <- rbind(train_set, tmp.excluded)
  
  put_log("Function: `sample_train_validation_sets`: Dataset created: validation_set")
  put(summary(validation_set))

  # CV train & test sets Consistency Test
  validation.left_join.Nas <- train_set |>
    mutate(tst.col = rating) |>
    select(userId, movieId, tst.col) |>
    data.consistency.test(validation_set)
  
  put_log("Function: `sample_train_validation_sets`:
Below are the data consistency verification results")
  put(validation.left_join.Nas)
  
  # Return result datassets    
  list(train_set = train_set, 
       validation_set = validation_set)
}
```

::: {.noteblock data-latex=""}
The source code of the [sample_train_validation_sets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) script on _GitHub_.
:::
:::

#### [mutateDateTimeAndDays](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L66) Function {#func.mutateDateTimeAndDays}
\

::: { #func.mutateDateTimeAndDays.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
```
:::

::: { #func.mutateDateTimeAndDays.args .sidebar }
##### Arguments
\

::: { #func.mutateDateTimeAndDays.args.data .sidebar }
  - **data:** ; 

:::
:::

::: { #func.mutateDateTimeAndDays.details .sidebar }
##### Details
\



:::

::: { #func.mutateDateTimeAndDays.value .sidebar }
##### Value
\

:::

::: { #func.mutateDateTimeAndDays.code .sidebar }
##### Source Code
\

The source code of the [mutateDateTimeAndDays](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L66) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [mutateDateTimeAndDays](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L66) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L66) script on _GitHub_.
:::
:::

#### [splitGenreRows](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L73) Function {#func.splitGenreRows}
\
Splits rows of the original dataset passed in the [data](#func.splitGenreRows.args.data) argument for movies that belong to multiple genres.

::: { #func.splitGenreRows.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
edx.sgr <- splitGenreRows(edx)
```
:::

::: { #func.splitGenreRows.args .sidebar }
##### Arguments
\

::: { #func.splitGenreRows.args.data .sidebar }
  - **data:** A dataset containing rows corresponding to movies that belong to multiple genres.. 

:::
:::

::: { #func.splitGenreRows.details .sidebar }
##### Details
\
This function is a wrapper for the [tidyr::separate_rows](https://www.rdocumentation.org/packages/tidyr/versions/1.3.0/topics/separate_rows) `R` function used in *This Project* to split rows belonging to multiple genres of a dataset containing a `genres` column, which is passed in the [data](#func.splitGenreRows.args.data) argument.

::: {.noteblock data-latex=""}
The `splitGenreRows` function is used internally in the [make_source_datasets](#func.make_source_datasets) function described above in the [Initializing Input Datasets] section to create the `edx.sgr` dataset described below in the [`edx.sgr` Object] section of the [Appendix B: Models Training Datasets].
:::
:::

::: { #func.splitGenreRows.value .sidebar }
##### Value
\

Dataset with the same structure as the one passed in the [data](#func.splitGenreRows.args.data) argument, but with rows that belong to multiple genres split.
:::

::: { #func.splitGenreRows.code .sidebar }
##### Source Code
\

The source code of the [splitGenreRows](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L73) function is shown below:
```{r eval=FALSE}
splitGenreRows <- function(data){
  put("Splitting dataset rows related to multiple genres...")
  start <- put_start_date()
  gs_splitted <- data |>
    separate_rows(genres, sep = "\\|")
  put("Dataset rows related to multiple genres have been splitted to have single genre per row.")
  put_end_date(start)
  gs_splitted
}
```

::: {.noteblock data-latex=""}
The source code of the [splitGenreRows](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L73) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L73) script on _GitHub_.
:::
:::

#### [filter_noMore_nratings](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L82) Function {#func.filter_noMore_nratings}
\

::: { #func.filter_noMore_nratings.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
```
:::

::: { #func.filter_noMore_nratings.args .sidebar }
##### Arguments
\

::: { #func.filter_noMore_nratings.args.data .sidebar }
  - **data:** ; 

:::
::: { #func.filter_noMore_nratings.args.seed .sidebar }
  - **seed:** ; 

:::
:::

::: { #func.filter_noMore_nratings.details .sidebar }
##### Details
\



:::

::: { #func.filter_noMore_nratings.value .sidebar }
##### Value
\

:::

::: { #func.filter_noMore_nratings.code .sidebar }
##### Source Code
\

The source code of the [filter_noMore_nratings](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L82) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [filter_noMore_nratings](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L82) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L82) script on _GitHub_.
:::
:::

### Models Training Functions

#### [union_cv_results](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L432) Function {#func.union_cv_results}
\

Aggregates the input data frames into a single data frame.

::: { #func.union_cv_results.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
data_list <- as.list(data)
df <- union_cv_results(data_list)

```
:::

::: { #func.union_cv_results.args .sidebar }
##### Arguments
\

::: { #func.union_cv_results.args.data_list .sidebar }
  - **data_list:** List of data frames representing the results of the *K-Fold Cross-Validation* method execution. 

:::
:::

::: { #func.union_cv_results.details .sidebar }
##### Details
\
This function internally uses the [base::union](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/sets) `R` function to combine the data from the list of data frames (result of the *K-Fold Cross-Validation*) passed in the [data_list](#func.union_cv_results.args.data_list) argument into a single data frame for further processing.
:::

::: { #func.union_cv_results.value .sidebar }
##### Value
\

A data frame that is a union of the input list of data frames.
:::

::: { #func.union_cv_results.code .sidebar }
##### Source Code
\

The source code of the [union_cv_results](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L432) function is shown below:
```{r eval=FALSE}
union_cv_results <- function(data_list) {
  out_dat <- data_list[[1]]
  
  for (i in 2:CVFolds_N){
    out_dat <- union(out_dat, 
                     data_list[[i]])
  }
  
  out_dat
}
```

::: {.noteblock data-latex=""}
The source code of the [union_cv_results](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L432) is also available in the [Model training](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L431) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L432) script on _GitHub_.
:::
:::





#### [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) Function {#func.get_best_param.result}
\

Selects the best parameter value and the corresponding minimum Root Mean Squared Error value from the function's input arguments.

::: { #func.get_best_param.result.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
get_best_param.result(param_values, rmses)

```
:::

::: { #func.get_best_param.result.args .sidebar }
##### Arguments
\

::: { #func.get_best_param.result.args.param_values .sidebar }
  - **param_values:** List of parameters to choose the best value.; 

:::
::: { #func.get_best_param.result.args.rmses .sidebar }
  - **rmses:** A list of Root Mean Squared Errors corresponding to the parameter values specified in the list passed by the argument [param_values](#func.get_best_param.result.args.param_values). 

:::
:::

::: { #func.get_best_param.result.details .sidebar }
##### Details
\

A parameter value that corresponds to the minimum RMSE is considered the best.

:::

::: { #func.get_best_param.result.value .sidebar }
##### Value
\

A data frame that is a union of the input data frames.
:::

::: { #func.get_best_param.result.code .sidebar }
##### Source Code
\

The soure code of the [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) function is shown below:
```{r eval=FALSE}
get_best_param.result <- function(param_values, rmses){
  best_pvalue_idx <- which.min(rmses)
  c(param.best_value = param_values[best_pvalue_idx], 
    best_RMSE = rmses[best_pvalue_idx])
}
```

::: {.noteblock data-latex=""}
The source code of the [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) is also available in the [Model training](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L431) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) script on _GitHub_.
:::
:::

### Data Visualization Functions

#### [data.plot](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L592) Function {#func.data.plot}
\

Plots a graph based on the dataset passed in the [data](#func.data.plot.args.data) parameter, using both points and a line.

::: { #func.data.plot.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
data.plot(data, 
          title, 
          xname, 
          yname, 
          xlabel = NULL, 
          ylabel = NULL,
          line_col = "blue",
          normalize = FALSE)
```
:::

::: { #func.data.plot.args .sidebar }
##### Arguments
\

::: { #func.data.plot.args.data .sidebar }
  - **data:** Dataset to use for the plot; 

:::
::: { #func.data.plot.args.title .sidebar }
  - **title:** Title of the plot; 

:::
::: { #func.data.plot.args.xname .sidebar }
  - **xname:** The name of the dataset column used as the source of the $x$ variable for the plot; 

:::
::: { #func.data.plot.args.yname .sidebar }
  - **yname:** The name of the dataset column used as the source of the $y$ variable for the plot; 

:::
::: { #func.data.plot.args.xlabel .sidebar }
  - **xlabel = NULL:** The $x$ axis label. If `NULL`, the value of the `xname` parameter is used for the label; 

:::
::: { #func.data.plot.args.ylabel .sidebar }
  - **ylabel = NULL:** The $y$ axis label. If `NULL`, the value of the `yname` parameter is used for the label.; 

:::
::: { #func.data.plot.args.line_col .sidebar }
  - **line_col = blue:** The line color; 

:::
::: { #func.data.plot.args.normalize .sidebar }
  - **normalize = FALSE:** If `TRUE`, the deviation of $y$ from its mean is used to plot, rather than $y$ values. Otherwise, the value of $y$ is used.

:::
:::

::: { #func.data.plot.details .sidebar }
##### Details
\

The function is a wrapper for the [ggplot2::ggplot](https://ggplot2.tidyverse.org/reference/ggplot.html) function and is a simple and convenient tool for visualizing the data of this project.

:::

::: { #func.data.plot.code .sidebar }
##### Source Code
\

The soure code of the [data.plot](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L592) function is shown below:
```{r eval=FALSE}
data.plot <- function(data, 
                      title, 
                      xname, 
                      yname, 
                      xlabel = NULL, 
                      ylabel = NULL,
                      line_col = "blue",
                      normalize = FALSE) {
  y <- data[, yname]
  
  if (normalize) {
    y <- y - min(y)
  }
  
  if (is.null(xlabel)) {
    xlabel = xname
  }
  if (is.null(ylabel)) {
    ylabel = yname
  }
  
  aes_mapping <- aes(x = data[, xname], y = y)
  
  data |> 
    ggplot(mapping = aes_mapping) +
    ggtitle(title) +
    xlab(xlabel) +
    ylab(ylabel) +
    geom_point() + 
    geom_line(color=line_col)
}
```

::: {.noteblock data-latex=""}
The source code of the [data.plot](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L592) is also available in the [Data Visualization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L447) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L592) script on _GitHub_.
:::
:::

#### [data.plot.left.n](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L493) Function {#func.data.plot.left.n}
\

Plots a graph based on the first $n$ rows (the $n$ is specified by the [left.n](#func.data.plot.left.n.args.left.n) parameter) of the dataset passed in the [data](#func.data.plot.left.n.args.data) parameter, using both points and a line.

::: {.noteblock data-latex=""}
The dataset passed in the [data](#func.data.plot.left.n.args.data) parameter is assumed to be sorted by the column used for the $x$ axis (specified by the column name passed in the [xname](#func.data.plot.left.n.args.xname) parameter).
:::

::: { #func.data.plot.left.n.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
data.plot.left.n <- function(data, 
                             left.n = 0,
                             title, 
                             xname, 
                             yname, 
                             xlabel, 
                             ylabel,
                             line_col = "red",
                             normalize = FALSE)
```
:::

::: { #func.data.plot.left.n.args .sidebar }
##### Arguments
\

::: { #func.data.plot.left.n.args.data .sidebar }
  - **data:** Dataset to use for the plot. 

:::
::: { #func.data.plot.left.n.args.left.n .sidebar }
  - **left.n:** If a positive numeric value, specifies the number of the first rows of the dataset to plot. Otherwise, the entire dataset data is set to plot. 

:::
::: { #func.data.plot.left.n.args.title .sidebar }
  - **title:** Title of the plot. 

:::
::: { #func.data.plot.left.n.args.xname .sidebar }
  - **xname:** The name of the dataset column used as the source of the $x$ variable for the plot. 

:::
::: { #func.data.plot.left.n.args.yname .sidebar }
  - **yname:** The name of the dataset column used as the source of the $y$ variable for the plot. 

:::
::: { #func.data.plot.left.n.args.xlabel .sidebar }
  - *xlabel = NULL*:** The $x$ axis label. If `NULL`, the value of the `xname` parameter is used for the label. 

:::
::: { #func.data.plot.left.n.args.ylabel .sidebar }
  - **ylabel = NULL:** The $y$ axis label. If `NULL`, the value of the `yname` parameter is used for the label. 

:::
::: { #func.data.plot.left.n.args.line_col .sidebar }
  - **line_col = blue:** The line color. 

:::
::: { #func.data.plot.left.n.args.normalize .sidebar }
  - **normalize = FALSE:** If `TRUE`, the deviation of $y$ from its mean is used to plot, rather than $y$ values. Otherwise, the value of $y$ is used.

:::
:::

::: { #func.data.plot.left.n.details .sidebar }
##### Details
\

The function is a wrapper for the [data.plot](#func.data.plot) function described above and is a simple and convenient tool for more detailed visualization of the left part of the graph, initially built based on the entire data set passed in the [data](#func.data.plot.left.n.args.data) parameter.
:::

::: { #func.data.plot.left.n.code .sidebar }
##### Source Code
\

The source code of the [data.plot.left.n](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L493) function is shown below:
```{r eval=FALSE}
data.plot.left.n <- function(data, 
                             left.n = 0,
                             title, 
                             xname, 
                             yname, 
                             xlabel, 
                             ylabel,
                             line_col = "red",
                             normalize = FALSE) {
  x_col <- data[, xname] 
  y_col <- data[, yname]
  
  
  data.left <- data
  
  if (left.n > 0) {
    data.left <- data |> 
      head(left.n)
  }
  
  data.left |>
    data.plot(title = title,
              xname = xname,
              yname = yname,
              xlabel = xlabel,
              ylabel = ylabel,
              line_col = line_col,
              normalize = normalize)
}
```

::: {.noteblock data-latex=""}
The source code of the [data.plot.left.n](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L493) is also available in the [Data Visualization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L447) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L493) script on _GitHub_.
:::
:::

#### [data.plot.left_detailed](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L448) Function {#func.data.plot.left_detailed}
\

Combines two graphs plotted by the internally called helper functions in a grid: the first is a standard graph plotted by the [data.plot](#func.data.plot) function described above, the second is a graph based on the first $n$ rows (the $n$ is specified by the [left.n](#func.data.plot.left.n.args.left.n) parameter) of the dataset plotted by the [data.plot.left.n](#func.data.plot.left.n) function also described above (The data for both graphs is passed in the [data]).(#func.data.plot.left.n.args.data) parameter).

::: {.noteblock data-latex=""}
The dataset passed in the [data](#func.data.plot.left.n.args.data) parameter is assumed to be sorted by the column used for the $x$ axis (specified by the column name passed in the [xname](#func.data.plot.left.n.args.xname) parameter).
:::

::: { #func.data.plot.left_detailed.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
data.plot.left_detailed <- function(data, 
                                    left.n = 0,
                                    title = NULL,
                                    title.left = NULL,
                                    xname, 
                                    yname, 
                                    xlabel1 = NULL, 
                                    xlabel2 = NULL, 
                                    ylabel1 = NULL,
                                    ylabel2 = NULL,
                                    line_col1 = "blue",
                                    line_col2 = "red",
                                    normalize = FALSE)
```
:::

::: { #func.data.plot.left_detailed.args .sidebar }
##### Arguments
\

::: { #func.data.plot.left_detailed.args.data .sidebar }
  - **data:** Dataset to use for the plot. 

:::
::: { #func.data.plot.left.n.args.left.n .sidebar }
  - **left.n:** If a positive numeric value, specifies the number of the first rows of the dataset to plot. Otherwise, the entire dataset data is set to plot. 

:::
::: { #func.data.plot.left_detailed.args.title .sidebar }
  - **title:** Title of the plot. 

:::
::: { #func.data.plot.left_detailed.args.xname .sidebar }
  - **xname:** The name of the dataset column used as the source of the $x$ variable for the plot. 

:::
::: { #func.data.plot.left_detailed.args.yname .sidebar }
  - **yname:** The name of the dataset column used as the source of the $y$ variable for the plot. 

:::
::: { #func.data.plot.left_detailed.args.xlabel1 .sidebar }
  - *xlabel1 = NULL*:** The $x$ axis label for the first plot. If `NULL`, the value of the `xname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.xlabel2 .sidebar }
  - *xlabel2 = NULL*:** The $x$ axis label for the second plot. If `NULL`, the value of the `xname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.ylabel1 .sidebar }
  - **ylabel1 = NULL:** The $y$ axis label for the first plot. If `NULL`, the value of the `yname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.ylabel2 .sidebar }
  - **ylabel2 = NULL:** The $y$ axis label for the second plot. If `NULL`, the value of the `yname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.line_col .sidebar }
  - **line_col = blue:** The line color. 

:::
::: { #func.data.plot.left_detailed.args.normalize .sidebar }
  - **normalize = FALSE:** If `TRUE`, the deviation of $y$ from its mean is used to plot, rather than $y$ values. Otherwise, the value of $y$ is used.

:::
:::

::: { #func.data.plot.left_detailed.details .sidebar }
##### Details
\

Under the hood, the function calls internally the [data.plot](#func.data.plot) and [data.plot.left.n](#func.data.plot.left.n) functions (described above) to build two graphs and combines them into a grid.
:::

::: { #func.data.plot.left_detailed.code .sidebar }
##### Source Code
\

The soure code of the [data.plot.left_detailed](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L448) function is shown below:
```{r eval=FALSE}
data.plot.left_detailed <- function(data, 
                                    left.n = 0,
                                    title = NULL,
                                    title.left = NULL,
                                    xname, 
                                    yname, 
                                    xlabel1 = NULL, 
                                    xlabel2 = NULL, 
                                    ylabel1 = NULL,
                                    ylabel2 = NULL,
                                    line_col1 = "blue",
                                    line_col2 = "red",
                                    normalize = FALSE) {
  if(is.null(xlabel1)) {
    xlabel1 <- xname
  }
  if(is.null(xlabel2)) {
    xlabel2 <- str_glue(xlabel1, " (left part)")
  }
  if(is.null(ylabel1)) {
    ylabel1 <- yname
  }
  if(is.null(ylabel2)) {
    ylabel2 <- ylabel1
  }
  
  p1 <- data |>
    data.plot(title = title,
              xname = xname, 
              yname = yname, 
              xlabel = xlabel1, 
              ylabel = ylabel1,
              line_col = line_col1)
  
  p2 <- data |>
    data.plot.left.n(left.n = left.n,
                     title = title.left,
                     xname = xname, 
                     yname = yname, 
                     xlabel = xlabel2, 
                     ylabel = ylabel2,
                     line_col = line_col2,
                     normalize = normalize)
  grid.arrange(p1, p2)
}
```

::: {.noteblock data-latex=""}
The source code of the [data.plot.left_detailed](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L448) is also available in the [Data Visualization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L447) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L448) script on _GitHub_.
:::
:::

\newpage

## Models Training: Support Functions
\

### OMR Model: Helper Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the [OMR-model.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R) script on _GitHub_.
:::

#### [naive_model_MSEs](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L2) Function {#func.naive_model_MSEs}
\

Validates the *Overall Mean Rating (OMR) Model* with use of *K-Fold Cross-Validation* method as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

The `K` value for the *K-Fold Cross-Validation* method is determined by the length of the [`edx_CV` Object] described below in the [Appendix B: Models Training Datasets].


::: { #func.naive_model_MSEs.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
mu <- mean(edx$rating)
mu.MSEs <- naive_model_MSEs(mu)

```
:::

::: { #func.naive_model_MSEs.args .sidebar }
##### Arguments
\

::: { #func.naive_model_MSEs.args. .sidebar }
  - **mu:** The overall mean rating value. 

:::
:::

::: { #func.naive_model_MSEs.value .sidebar }
##### Value
\

The Mean Squared Error (MSE) values obtained from applying the *K-Fold Cross-Validation* method to the *Overall Average Rating (OMR) Model*, where the `K` value is determined by the length of the [`edx_CV` Object].


:::

::: { #func.naive_model_MSEs.code .sidebar }
##### Source Code
\

The source code of the [naive_model_MSEs](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L2) function is shown below:
```{r eval=FALSE}
naive_model_MSEs <- function(mu) {
  sapply(edx_CV, function(cv_item){
    mse(cv_item$validation_set$rating - mu)
  })
}
```

::: {.noteblock data-latex=""}
The source code of the [naive_model_MSEs](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L2) function is defined in the [OMR-model.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L2) script on _GitHub_.
:::
:::

\newpage

#### [naive_model_RMSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L7) Function {#func.naive_model_RMSE}
\
Validates the *Overall Mean Rating (OMR) Model* with use of *K-Fold Cross-Validation* method as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.naive_model_RMSE.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
mu <- mean(edx$rating)
mu.RMSE <- naive_model_RMSE(mu)
```
:::

::: { #func.naive_model_RMSE.args .sidebar }
##### Arguments
\

::: { #func.naive_model_RMSE.args. .sidebar }
  - **mu:** The overall mean rating value. 

:::
:::

::: { #func.naive_model_RMSE.details .sidebar }
##### Details
\

The `K` value for the *K-Fold Cross-Validation* method is determined by the length of the [`edx_CV` Object] described below in the [Appendix B: Models Training Datasets].

::: {.noteblock data-latex=""}
This function internally calls the [naive_model_MSEs](#func.naive_model_MSEs) function described above and then calculates the square root of the mean of the obtained results.
:::
:::

::: { #func.naive_model_RMSE.value .sidebar }
##### Value
\

The Root Mean Squared Errors (RMSE) value obtained from applying the *K-Fold Cross-Validation* method to the *Overall Average Rating (OMR) Model*, where the `K` value is determined by the length of the [`edx_CV` Object].
:::

::: { #func.naive_model_RMSE.code .sidebar }
##### Source Code
\

The source code of the [naive_model_RMSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L7) function is shown below:
```{r eval=FALSE}
naive_model_RMSE <- function(mu){
  sqrt(mean(naive_model_MSEs(mu)))
}
```

::: {.noteblock data-latex=""}
The source code of the [naive_model_RMSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L7) function is defined in the [OMR-model.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L7) script on _GitHub_.
:::
:::

\newpage

### UME Model: Utility Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) script on _GitHub_.
:::

#### [train_user_movie_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) Function {#func.train_user_movie_effect}
\

Trains (and optionally *regularizes* if the [lambda](#func.train_user_movie_effect.args.lambda) argument value is non-default) the *User+Movie Effect (UME) Model* using the training dataset passed in the [train_set](#func.train_user_movie_effect.args.train_set) argument.

::: { #func.train_user_movie_effect.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  UM_effect <- train_user_movie_effect(train_set, lambda = 0)
```
:::

::: { #func.train_user_movie_effect.args .sidebar }
##### Arguments
\

::: { #func.train_user_movie_effect.args.train_set .sidebar }
  - **train_set:** Training dataset; 

:::
::: { #func.train_user_movie_effect.args.lambda .sidebar }
  - **lambda:** (0 by default) Regularization parameter. 

:::
:::

::: { #func.train_user_movie_effect.details .sidebar }
##### Details
\

The *Regularization technique* (described in section [Section 24.1 *Case study: recommendation systems / Penalized Least Squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-1]) is applied to the model being trained only when the *Regularization parameter* value, passed in the [lambda](#func.train_user_movie_effect.args.lambda) argument, is other than default (to be more exact, greater than zero). The regularization is committed through the *penalized regression* by computing the *penalized mean* performed by the [mean_reg](#func.mean_reg) function described above in the *Common Helper Functions /* [Regularization Functions] section of *this Appendix*.
:::

::: { #func.train_user_movie_effect.value .sidebar }
##### Value
\

Data frame representing the trained (and also *regularized* if [lambda](#func.train_user_movie_effect.args.lambda) arg value other than default) *UM Effect Model*.
:::

::: { #func.train_user_movie_effect.code .sidebar }
##### Source Code
\

The source code of the [train_user_movie_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) function is shown below:
```{r eval=FALSE}
train_user_movie_effect <- function(train_set, lambda = 0){
  if (is.na(lambda)) {
    stop("Function: train_user_movie_effect
`lambda` is `NA`")
  }

  UM.effect <- train_set |>
    left_join(edx.user_effect, by = "userId") |>
    mutate(resid = rating - (mu + a)) |> 
    group_by(movieId) |>
    summarise(b = mean_reg(resid, lambda), n = n())
  
  stopifnot(!is.na(mean(UM.effect$b)))
  UM.effect
}
```

::: {.noteblock data-latex=""}
The source code of the [train_user_movie_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) script on _GitHub_.
:::
:::

\newpage

#### [train_user_movie_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L19) Function {#func.train_user_movie_effect.cv}
\

Trains (and optionally *regularizes* if the [lambda](#func.train_user_movie_effect.args.cv.lambda) argument value is non-default) the *User+Movie Effect (UME) Model* with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.train_user_movie_effect.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  cv.UM_effect <- train_user_movie_effect.cv()
```
:::

::: { #func.train_user_movie_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.train_user_movie_effect.cv.args.lambda .sidebar }
  - **lambda:** (0 by default) Regularization parameter. 

:::
:::

::: { #func.train_user_movie_effect.cv.details .sidebar }
##### Details
\

Under the hood, this function internally calls the [train_user_movie_effect](#func.train_user_movie_effect) function described above for each iteration of the *K-Fold Cross-Validation* applied to the [`edx_CV` Object] described below in the [Appendix B: Models Training Datasets]. It also calls internally the [union_cv_results](#func.union_cv_results) function described above in the *Data Helper Functions / [Models Training Functions]* section of this *Appendix* to aggregate the cross-validation results.

The `K` value for the *K-Fold Cross-Validation* method is determined by the length of the [`edx_CV` Object].

::: {.noteblock data-latex=""}
The *Regularization technique* (described in section [Section 24.1 *Case study: recommendation systems / Penalized Least Squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-1]) is applied to the model being trained only when the *Regularization parameter* value, passed in the [lambda](#func.train_user_movie_effect.cv.args.lambda) argument, is other than default (to be more exact, greater than zero).
:::
:::

::: { #func.train_user_movie_effect.cv.value .sidebar }
##### Value
\

Data frame representing the *UM Effect Model* trained (and also *regularized* if the [lambda](#func.train_user_movie_effect.cv.args.lambda) argument value is other than the default) with use of *K-Fold Cross-Validation*, where the `K` is the length of the [`edx_CV` Object]..
:::

::: { #func.train_user_movie_effect.cv.code .sidebar }
##### Source Code
\

The most important part of the source code of the [train_user_movie_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L19) function is shown below:
```{r eval=FALSE}
train_user_movie_effect.cv <- function(lambda = 0){
# ...
  start <- put_start_date()
  user_movie_effects_ls <- lapply(edx_CV, function(cv_fold_dat){
    cv_fold_dat$train_set |> train_user_movie_effect(lambda)
  })
  put_end_date(start)
  put_log("Function: train_user_movie_effect.cv:
User+Movie Effect list have been computed")
  
  user_movie_effects_united <- union_cv_results(user_movie_effects_ls)

  user_movie_effect <- user_movie_effects_united |>
    group_by(movieId) |>
    summarise(b = mean(b), n = mean(n))
  # ...
  user_movie_effect
}
```

::: {.noteblock data-latex=""}
The complete source code of the [train_user_movie_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L19) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L19) script on _GitHub_.
:::
:::

\newpage

#### [calc_user_movie_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L53) Function {#func.calc_user_movie_effect_MSE}
\

Validates the *UM Effect (UME) Model* produced by the  [train_user_movie_effect](#func.train_user_movie_effect) or [train_user_movie_effect.cv](#func.train_user_movie_effect.cv) function call.

::: { #func.calc_user_movie_effect_MSE.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
mse <- test_set |> calc_user_movie_effect_MSE(um_effect)

```
:::

::: { #func.calc_user_movie_effect_MSE.args .sidebar }
##### Arguments
\

::: { #func.calc_user_movie_effect_MSE.args.test_set .sidebar }
  - **test_set:** Validation dataset; 

:::
::: { #func.calc_user_movie_effect_MSE.args.um_effect .sidebar }
  - **um_effect:** Data frame representing the *UM Effect Model*. 

:::
:::

::: { #func.calc_user_movie_effect_MSE.details .sidebar }
##### Details
\

The function calculates *Mean Squared Error (MSE)* for the *UME Model* passed in the [um_effect](#func.calc_user_movie_effect_MSE.args.um_effect) argument using the validation dataset passed in the [test_set](#func.calc_user_movie_effect_MSE.args.test_set) arg. 


:::

::: { #func.calc_user_movie_effect_MSE.value .sidebar }
##### Value
\

*MSE* value calculated for the *UME Model*.
:::

::: { #func.calc_user_movie_effect_MSE.code .sidebar }
##### Source Code
\

The source code of the [calc_user_movie_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L53) function is shown below:
```{r eval=FALSE}
calc_user_movie_effect_MSE <- function(test_set, um_effect){
  mse.result <- test_set |>
    left_join(edx.user_effect, by = "userId") |>
    left_join(um_effect, by = "movieId") |>
    mutate(resid = rating - clamp(mu + a + b)) |> 
    pull(resid) |> mse()
  
  stopifnot(!is.na(mse.result))
  mse.result
}
```

::: {.noteblock data-latex=""}
The source code of the [calc_user_movie_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L53) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L53) script on _GitHub_.
:::
:::

\newpage

#### [calc_user_movie_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L67) Function {#func.calc_user_movie_effect_MSE.cv}
\

Validates the *UM Effect (UME) Model* (produced by the [train_user_movie_effect](#func.train_user_movie_effect) or [train_user_movie_effect.cv](#func.train_user_movie_effect.cv) function call) with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.calc_user_movie_effect_MSE.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
user_movie_effects_MSE <- calc_user_movie_effect_MSE.cv(um_effect)

```
:::

::: { #func.calc_user_movie_effect_MSE.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_user_movie_effect_MSE.cv.args.um_effect .sidebar }
  - **um_effect:** Data frame representing the *UM Effect Model*. 

:::
:::

::: { #func.calc_user_movie_effect_MSE.cv.details .sidebar }
##### Details
\

The function calculates *MSE* for the *UME Model* passed in the [um_effect](#func.calc_user_movie_effect_MSE.cv.args.um_effect) argument using the validation datasets contained in the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets].

::: {.noteblock data-latex=""}
This function internally calls the [calc_user_movie_effect_MSE](#func.calc_user_movie_effect_MSE) function for each iteration of the *K-Fold Cross-Validation*, calculating the *MSE* for the corresponding validation dataset of the [`edx_CV` Object], and then calculates the mean of the obtained results.

The `K` value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object].
:::
:::

::: { #func.calc_user_movie_effect_MSE.cv.value .sidebar }
##### Value
\

The *MSE* value calculated for the *UM Effect Model* with use of *K-Fold Cross-Validation*, where the `K` is the length of the [`edx_CV` Object].
:::

::: { #func.calc_user_movie_effect_MSE.cv.code .sidebar }
##### Source Code
\

The source code of the [calc_user_movie_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L67) function is shown below:
```{r eval=FALSE}
calc_user_movie_effect_MSE.cv <- function(um_effect){
  put_log("Function: user_movie_effects_MSE.cv:
Computing the RMSE taking into account User+Movie Effects...")
  start <- put_start_date()
  user_movie_effects_MSEs <- sapply(edx_CV, function(cv_fold_dat){
    cv_fold_dat$validation_set |> calc_user_movie_effect_MSE(um_effect)
  })
  put_end_date(start)
  
  put_log1("Function: user_movie_effects_MSE.cv:
MSE values have been plotted for the %1-Fold Cross-Validation samples.", 
           CVFolds_N)
  
  mean(user_movie_effects_MSEs)
}
```

::: {.noteblock data-latex=""}
The source code of the [calc_user_movie_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L67) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L67) script on _GitHub_.
:::
:::

\newpage

#### [calc_user_movie_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L82) Function {#func.calc_user_movie_effect_RMSE.cv}
\

Validates the *UM Effect (UME) Model* (produced by the [train_user_movie_effect](#func.train_user_movie_effect) or [train_user_movie_effect.cv](#func.train_user_movie_effect.cv) function call) with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.calc_user_movie_effect_RMSE.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
cv.UM_effect.RMSE <- calc_user_movie_effect_RMSE.cv(cv.UM_effect)

```
:::

::: { #func.calc_user_movie_effect_RMSE.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_user_movie_effect_RMSE.cv.args.um_effect .sidebar }
  - **um_effect:** Data frame representing the *UM Effect Model*. 

:::
:::

::: { #func.calc_user_movie_effect_RMSE.cv.details .sidebar }
##### Details
\

The function calculates *Root Squared Error (RMSE)* for the *UME Model* passed in the [um_effect](#func.calc_user_movie_effect_RMSE.cv.args.um_effect) argument using the validation datasets contained in the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets].

::: {.noteblock data-latex=""}
This function internally calls the [calc_user_movie_effect_MSE.cv](#func.calc_user_movie_effect_MSE.cv) function described above, to calculate the *MSE* for the *UME Model* with use of *K-Fold Cross-Validation*, and then calculates the square root of the result.

The `K` value for the *K-Fold Cross-Validation* method is determined by the length of the [`edx_CV` Object].
:::
:::

::: { #func.calc_user_movie_effect_RMSE.cv.value .sidebar }
##### Value
\

The *RMSE* value calculated for the *UM Effect Model* with use of *K-Fold Cross-Validation*, where the `K` is the length of the [`edx_CV` Object].
:::

::: { #func.calc_user_movie_effect_RMSE.cv.code .sidebar }
##### Source Code
\

The source code of the [calc_user_movie_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L82) function is shown below:
```{r eval=FALSE}
calc_user_movie_effect_RMSE.cv <- function(um_effect){
  user_movie_effects_MSE <- calc_user_movie_effect_MSE.cv(um_effect)
  um_effect_RMSE <- sqrt(user_movie_effects_MSE)
  put_log2("Function: user_movie_effects_RMSE.cv:
%1-Fold Cross-Validation ultimate RMSE: %2", length(edx_CV), um_effect_RMSE)
  um_effect_RMSE
}
```

::: {.noteblock data-latex=""}
The source code of the [calc_user_movie_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L82) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L82) script on _GitHub_.
:::
:::

\newpage

### UME Model: Regularization
\

#### [regularize.test_lambda.UM_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L91) Function {#func.regularize.test_lambda.UM_effect.cv}
\

Validates the *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.test_lambda.UM_effect.cv.args.lambda) argument for the *User+Movie Effect (UME) Model* in the *regularization process* using *penalized approach* with use of *K-Fold Cross-Validation*.

::: { #func.regularize.test_lambda.UM_effect.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  lambdas <- seq(0, 1, 0.1)
  cv.UME.preset.result <- 
    tune.model_param(lambdas, regularize.test_lambda.UM_effect.cv)
```

::: {.noteblock data-latex=""}
In the code snippet above this function is used as a parameter to the [tune.model_param](#func.tune.model_param) function described above in the section *Common Helper Functions /* [Regularization Functions] of *This Appendix*.

Such a use of this function is also noted in the [Details](#func.regularize.test_lambda.UM_effect.cv.details) section of *This Description* below.
:::
:::

::: { #func.regularize.test_lambda.UM_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.regularize.test_lambda.UM_effect.cv.args.lambda .sidebar }
  - **lambda:** *Regularization parameter* $\lambda$ used to validate the model in the *regularization process*. 

:::
:::

::: { #func.regularize.test_lambda.UM_effect.cv.details .sidebar }
##### Details
\

The function is used in the *regularization process* of the *UME Model* using the *penalized approach* to regularize predictions for the given *regularization parameter* $\lambda$ (passed in the [lambda](#func.regularize.test_lambda.UM_effect.cv.args.lambda) argument) as explained in [Section 24.1 *Case study: recommendation systems / A penalized approach*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#a-penalized-approach) of the *Course Textbook (New Edition)*[@IDS2_24-1].

Internally it uses the [train_user_movie_effect.cv](#func.train_user_movie_effect.cv) and [calc_user_movie_effect_RMSE.cv](#func.calc_user_movie_effect_RMSE.cv) functions described above to validate the *UME Model* for the given $\lambda$ with use of the *K-Fold Cross-Validation* method, as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV], where the value of `K` is determined by the length of the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets] (in our project we use `K = 5`).

::: {.noteblock data-latex=""}
This function is also intended to be passed as a parameter to the [tune.model_param](#func.tune.model_param) and [model.tune.param_range](#func.model.tune.param_range) functions described above in the *Common Helper Functions /* [Regularization Functions] section of *This Appendix*.
:::
:::

::: { #func.regularize.test_lambda.UM_effect.cv.value .sidebar }
##### Value
\

The *Root Mean Squared Errors (RMSE)* value computed for the UME Model applying the *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.test_lambda.UM_effect.cv.args.lambda) argument.

:::

::: { #func.regularize.test_lambda.UM_effect.cv.code .sidebar }
##### Source Code
\

The source code of the [regularize.test_lambda.UM_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L91) function is shown below:
```{r eval=FALSE}
regularize.test_lambda.UM_effect.cv <- function(lambda){
  if (is.na(lambda)) {
    stop("Function: regularize.test_lambda.UM_effect.cv
`lambda` is `NA`")
  }
  um_effect <- train_user_movie_effect.cv(lambda)
  calc_user_movie_effect_RMSE.cv(um_effect)
}
```

::: {.noteblock data-latex=""}
The source code of the [regularize.test_lambda.UM_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L91) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L90) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L91) script on _GitHub_.
:::
:::

\newpage

### UMGE Model: Utility Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the  [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L3) section of the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L3) script on _GitHub_.
:::

#### [train_user_movie_genre_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L42) Function {#func.train_user_movie_genre_effect}
\

Trains (and optionally *regularizes* if the [lambda](#func.train_user_movie_genre_effect.args.lambda) argument value is non-default) the *User+Movie+Genre Effect (UMGE) Model* using the training sample of the `Movielens` dataset (passed in the [train.sgr](#func.train_user_movie_genre_effect.args.train.sgr) argument), specially prepared to train the *UMGE Model*.

::: { #func.train_user_movie_genre_effect.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  rglr.UMG_effect <- edx.sgr |> train_user_movie_genre_effect(UMGE.rglr.best_lambda)
```
:::

::: { #func.train_user_movie_genre_effect.args .sidebar }
##### Arguments
\

::: { #func.train_user_movie_genre_effect.args.train.sgr .sidebar }
  - **train.sgr:** Training sample of the `Movielens` dataset with split rows belonging to multiple genres; 

:::
::: { #func.train_user_movie_genre_effect.args.lambda .sidebar }
  - **lambda:** (0 by default) Regularization parameter. 

:::
:::

::: { #func.train_user_movie_genre_effect.details .sidebar }
##### Details
\
The dataset passed in the [train.sgr](#func.train_user_movie_genre_effect.args.train.sgr) argument is assumed to be the result returned by the [splitGenreRows](#func.splitGenreRows) helper function described above in the *Data Helper Functions /* [Data Processing Functions] section of *This Appendix*.

For example, the [`edx.sgr` Object] is an appropriate dataset as the value of the [train.sgr](#func.train_user_movie_genre_effect.args.train.sgr).

::: {.noteblock data-latex=""}
The *Regularization technique* (described in section [Section 24.1 *Case study: recommendation systems / Penalized Least Squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-1]) is applied to the model being trained only when the *Regularization parameter* value, passed in the [lambda](#func.train_user_movie_genre_effect.args.lambda) argument, is other than default (to be more exact, greater than zero). The regularization is committed through the *penalized regression* by computing the *penalized mean* performed by the [mean_reg](#func.mean_reg) function described above in the *Common Helper Functions /* [Regularization Functions] section of *this Appendix*.
:::
:::

::: { #func.train_user_movie_genre_effect.value .sidebar }
##### Value
\

Data frame representing the trained (and also *regularized* if [lambda](#func.train_user_movie_genre_effect.args.lambda) arg value other than default) *UMG Effect Model*.
:::

::: { #func.train_user_movie_genre_effect.code .sidebar }
##### Source Code
\

The source code of the [train_user_movie_genre_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L42) function is shown below:
```{r eval=FALSE}
train_user_movie_genre_effect <- function(train.sgr, lambda = 0){
  if (is.na(lambda)) {
    stop("Function: train_user_movie_genre_effect
`lambda` is `NA`")
  }

  genre_bias <- train.sgr |>
      left_join(edx.user_effect, by = "userId") |>
      left_join(rglr.UM_effect, by = "movieId") |>
      mutate(resid = rating - (mu + a + b)) |>
      group_by(genres) |>
      summarise(g = mean_reg(resid, lambda), n = n())

    train.sgr |>
      left_join(genre_bias, by = "genres") |>
      left_join(rglr.UM_effect, by = "movieId") |>
      group_by(movieId) |>
      summarise(g = mean(g))
}
```

::: {.noteblock data-latex=""}
The source code of the [train_user_movie_genre_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L42) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L3) section of the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L42) script on _GitHub_.
:::
:::

\newpage

#### [train_user_movie_genre_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L61) Function {#func.train_user_movie_genre_effect.cv}
\

Trains (and optionally *regularizes* if the [lambda](#func.train_user_movie_genre_effect.cv.args.lambda) argument value is non-default) the *User+Movie+Genre Effect (UMGE) Model* with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.train_user_movie_genre_effect.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
# `lambda = 0` by default (the regularization technique is not applied)
cv.UMG_effect <- train_user_movie_genre_effect.cv()
  
umg_effect <- train_user_movie_genre_effect.cv(lambda)
```
:::

::: { #func.train_user_movie_genre_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.train_user_movie_genre_effect.cv.args.lambda .sidebar }
  - **lambda:** (0 by default) Regularization parameter. 

:::
:::

::: { #func.train_user_movie_genre_effect.cv.details .sidebar }
##### Details
\

Under the hood, this function internally calls the [train_user_movie_genre_effect](#func.train_user_movie_genre_effect) function described above for each iteration of the *K-Fold Cross-Validation* applied to the [`edx_CV` Object] described below in the [Appendix B: Models Training Datasets]. It also calls internally the [union_cv_results](#func.union_cv_results) function described above in the *Data Helper Functions / [Models Training Functions]* section of this *Appendix* to aggregate the cross-validation results.

The `K` value for the *K-Fold Cross-Validation* method is determined by the length of the [`edx_CV` Object].

::: {.noteblock data-latex=""}
The *Regularization technique* (described in section [Section 24.1 *Case study: recommendation systems / Penalized Least Squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-1]) is applied to the model being trained only when the *Regularization parameter* value, passed in the [lambda](#func.train_user_movie_genre_effect.cv.args.lambda) argument, is other than default (to be more exact, greater than zero).
:::
:::

::: { #func.train_user_movie_genre_effect.cv.value .sidebar }
##### Value
\

Data frame representing the *UMG Effect Model* trained (and also *regularized* if the [lambda](#func.train_user_movie_genre_effect.cv.args.lambda) argument value is other than the default) with use of *K-Fold Cross-Validation*, where the `K` is the length of the [`edx_CV` Object]..
:::

::: { #func.train_user_movie_genre_effect.cv.code .sidebar }
##### Source Code
\

The most important part of the source code of the [train_user_movie_genre_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L61) function is shown below:
```{r eval=FALSE}
train_user_movie_genre_effect.cv <- function(lambda = 0){
  user_movie_genre_effects_ls <- lapply(kfold_index, function(fold_i){
    cv_fold_dat <- edx_CV[[fold_i]]
    umg_effect <- cv_fold_dat$train.sgr |> train_user_movie_genre_effect(lambda)
    
    put_log2("User+Movie+Genre Effects have been computed for the Fold %1 
of the %2-Fold Cross Validation samples.",
             fold_i,
             CVFolds_N)
    
    umg_effect
  })

  user_movie_genre_effects_united <- union_cv_results(user_movie_genre_effects_ls)

  user_movie_genre_effect <- user_movie_genre_effects_united |>
    group_by(movieId) |>
    summarise(g = mean(g))
  
  if(lambda == 0) put_log("Function `train_user_movie_genre_effect.cv`:
Training completed: User+Movie+Genre Effects model.")
  else put_log1("Function `train_user_movie_genre_effect.cv`:
Training completed: User+Movie+Genre Effects model for lambda: %1...",
                lambda)
  
  user_movie_genre_effect
}
```

::: {.noteblock data-latex=""}
The complete source code of the [train_user_movie_genre_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L61) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L3) section of the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L61) script on _GitHub_.
:::
:::

\newpage

#### [calc_user_movie_genre_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L112) Function {#func.calc_user_movie_genre_effect_MSE}
\

Validates the *UMG Effect (UMGE) Model* produced by the  [train_user_movie_genre_effect](#func.train_user_movie_genre_effect) or [train_user_movie_genre_effect.cv](#func.train_user_movie_genre_effect.cv) function call.

::: { #func.calc_user_movie_genre_effect_MSE.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
umg_mse <- test_set |> calc_user_movie_genre_effect_MSE(umg_effect)
```
:::

::: { #func.calc_user_movie_genre_effect_MSE.args .sidebar }
##### Arguments
\

::: { #func.calc_user_movie_genre_effect_MSE.args.test_set .sidebar }
  - **test_set:** Validation dataset; 

:::
::: { #func.calc_user_movie_genre_effect_MSE.args.umg_effect .sidebar }
  - **umg_effect:** Data frame representing the *UMG Effect Model*. 

:::
:::

::: { #func.calc_user_movie_genre_effect_MSE.details .sidebar }
##### Details
\

The function calculates *Mean Squared Error (MSE)* for the *UMGE Model* passed in the [umg_effect](#func.calc_user_movie_genre_effect_MSE.args.umg_effect) argument using the validation dataset passed in the [test_set](#func.calc_user_movie_genre_effect_MSE.args.test_set) arg. 


:::

::: { #func.calc_user_movie_genre_effect_MSE.value .sidebar }
##### Value
\

*MSE* value calculated for the *UMGE Model*.
:::

::: { #func.calc_user_movie_genre_effect_MSE.code .sidebar }
##### Source Code
\

The source code of the [calc_user_movie_genre_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L112) function is shown below:
```{r eval=FALSE}
calc_user_movie_genre_effect_MSE <- function(test_set, umg_effect){
  test_set |>
    left_join(edx.user_effect, by = "userId") |>
    left_join(rglr.UM_effect, by = "movieId") |>
    left_join(umg_effect, by = "movieId") |>
    mutate(resid = rating - clamp(mu + a + b + g)) |> 
    pull(resid) |> mse()
}
```

::: {.noteblock data-latex=""}
The source code of the [calc_user_movie_genre_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L112) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L3) section of the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L112) script on _GitHub_.
:::
:::

\newpage

#### [calc_user_movie_genre_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L124) Function {#func.calc_user_movie_genre_effect_MSE.cv}
\

Validates the *UMG Effect (UMGE) Model* (produced by the [train_user_movie_genre_effect](#func.train_user_movie_genre_effect) or [train_user_movie_genre_effect.cv](#func.train_user_movie_genre_effect.cv) function call) with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.calc_user_movie_genre_effect_MSE.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  umg_effect_RMSE <- sqrt(calc_user_movie_genre_effect_MSE.cv(umg_effect))
```
:::

::: { #func.calc_user_movie_genre_effect_MSE.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_user_movie_genre_effect_MSE.cv.args.umg_effect .sidebar }
  - **umg_effect:** Data frame representing the *UMG Effect Model*. 

:::
:::

::: { #func.calc_user_movie_genre_effect_MSE.cv.details .sidebar }
##### Details
\

The function calculates *MSE* for the *UMGE Model* passed in the [umg_effect](#func.calc_user_movie_genre_effect_MSE.cv.args.umg_effect) argument using the validation datasets contained in the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets].

::: {.noteblock data-latex=""}
This function internally calls the [calc_user_movie_genre_effect_MSE](#func.calc_user_movie_genre_effect_MSE) function for each iteration of the *K-Fold Cross-Validation*, calculating the *MSE* for the corresponding validation dataset of the [`edx_CV` Object], and then calculates the mean of the obtained results.

The `K` value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object].
:::
:::

::: { #func.calc_user_movie_genre_effect_MSE.cv.value .sidebar }
##### Value
\

The *MSE* value calculated for the *UMG Effect Model* with use of *K-Fold Cross-Validation*, where the `K` is the length of the [`edx_CV` Object].
:::

::: { #func.calc_user_movie_genre_effect_MSE.cv.code .sidebar }
##### Source Code
\

The simplified version of the source code of the [calc_user_movie_genre_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L124) function is shown below:
```{r eval=FALSE}
calc_user_movie_genre_effect_MSE.cv <- function(umg_effect){
  user_movie_genre_effects_MSEs <- sapply(edx_CV, function(cv_dat){
    cv_dat$validation_set |> calc_user_movie_genre_effect_MSE(umg_effect)
  })

  mean(user_movie_genre_effects_MSEs)
}
```

::: {.noteblock data-latex=""}
The completed source code of the [calc_user_movie_genre_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L124) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L3) section of the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L124) script on _GitHub_.
:::
:::

\newpage

#### [calc_user_movie_genre_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L138) Function {#func.calc_user_movie_genre_effect_RMSE.cv}
\

Validates the *UMG Effect (UMGE) Model* (produced by the [train_user_movie_genre_effect](#func.train_user_movie_genre_effect) or [train_user_movie_genre_effect.cv](#func.train_user_movie_genre_effect.cv) function call) with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.calc_user_movie_genre_effect_RMSE.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
cv.UMG_effect.RMSE <- calc_user_movie_genre_effect_RMSE.cv(cv.UMG_effect)
```
:::

::: { #func.calc_user_movie_genre_effect_RMSE.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_user_movie_genre_effect_RMSE.cv.args.umg_effect .sidebar }
  - **umg_effect:** Data frame representing the *UMG Effect Model*. 

:::
:::

::: { #func.calc_user_movie_genre_effect_RMSE.cv.details .sidebar }
##### Details
\

The function calculates *Root Squared Error (RMSE)* for the *UMGE Model* passed in the [umg_effect](#func.calc_user_movie_genre_effect_RMSE.cv.args.umg_effect) argument using the validation datasets contained in the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets].

::: {.noteblock data-latex=""}
This function internally calls the [calc_user_movie_genre_effect_MSE.cv](#func.calc_user_movie_genre_effect_MSE.cv) function described above, to calculate the *MSE* for the *UMGE Model* with use of *K-Fold Cross-Validation*, and then calculates the square root of the result.

The `K` value for the *K-Fold Cross-Validation* method is determined by the length of the [`edx_CV` Object].
:::
:::

::: { #func.calc_user_movie_genre_effect_RMSE.cv.value .sidebar }
##### Value
\

The *RMSE* value calculated for the *UMG Effect Model* with use of *K-Fold Cross-Validation*, where the `K` is the length of the [`edx_CV` Object].
:::

::: { #func.calc_user_movie_genre_effect_RMSE.cv.code .sidebar }
##### Source Code
\

The simplified version of the source code of the [calc_user_movie_genre_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L138) function is shown below:
```{r eval=FALSE}
calc_user_movie_genre_effect_RMSE.cv <- function(umg_effect){
  sqrt(calc_user_movie_genre_effect_MSE.cv(umg_effect))
}
```

::: {.noteblock data-latex=""}
The complete source code of the [calc_user_movie_genre_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L138) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L3) section of the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L138) script on _GitHub_.
:::
:::

\newpage

### UMGE Model: Regularization
\

#### [regularize.test_lambda.UMG_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L148) Function {#func.regularize.test_lambda.UMG_effect.cv}
\

Validates the *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.test_lambda.UMG_effect.cv.args.lambda) argument for the *User+Movie+Genre Effect (UMGE) Model* in the *regularization process* using *penalized approach* with use of *K-Fold Cross-Validation*.

::: { #func.regularize.test_lambda.UMG_effect.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
lambdas <- seq(0, 0.2, 0.01)
cv.UMGE.preset.result <- 
  tune.model_param(lambdas, regularize.test_lambda.UMG_effect.cv)
```

::: {.noteblock data-latex=""}
In the code snippet above this function is used as a parameter to the [tune.model_param](#func.tune.model_param) function described above in the section *Common Helper Functions /* [Regularization Functions] of *This Appendix*.

Such a use of this function is also noted in the [Details](#func.regularize.test_lambda.UMG_effect.cv.details) section of *This Description* below.
:::
:::

::: { #func.regularize.test_lambda.UMG_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.regularize.test_lambda.UMG_effect.cv.args.lambda .sidebar }
  - **lambda:** *Regularization parameter* $\lambda$ used to validate the model in the *regularization process*. 

:::
:::

::: { #func.regularize.test_lambda.UMG_effect.cv.details .sidebar }
##### Details
\

The function is used in the *regularization process* of the *UMGE Model* using the *penalized approach* to regularize predictions for the given *regularization parameter* $\lambda$ (passed in the [lambda](#func.regularize.test_lambda.UMG_effect.cv.args.lambda) argument) as explained in [Section 24.1 *Case study: recommendation systems / A penalized approach*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#a-penalized-approach) of the *Course Textbook (New Edition)*[@IDS2_24-1].

Internally it uses the [train_user_movie_genre_effect.cv](#func.train_user_movie_genre_effect.cv) and [calc_user_movie_genre_effect_RMSE.cv](#func.calc_user_movie_genre_effect_RMSE.cv) functions described above to validate the *UMGE Model* for the given $\lambda$ with use of the *K-Fold Cross-Validation* method, as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV], where the value of `K` is determined by the length of the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets] (in our project we use `K = 5`).

::: {.noteblock data-latex=""}
This function is also intended to be passed as a parameter to the [tune.model_param](#func.tune.model_param) and [model.tune.param_range](#func.model.tune.param_range) functions described above in the *Common Helper Functions /* [Regularization Functions] section of *This Appendix*.
:::
:::

::: { #func.regularize.test_lambda.UMG_effect.cv.value .sidebar }
##### Value
\

The *Root Mean Squared Errors (RMSE)* value computed for the UMGE Model applying the *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.test_lambda.UMG_effect.cv.args.lambda) argument.

:::

::: { #func.regularize.test_lambda.UMG_effect.cv.code .sidebar }
##### Source Code
\

The simplified version of the source code of the [regularize.test_lambda.UMG_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L148) function is shown below:
```{r eval=FALSE}
regularize.test_lambda.UMG_effect.cv <- function(lambda){
  umg_effect <- train_user_movie_genre_effect.cv(lambda)
  calc_user_movie_genre_effect_RMSE.cv(umg_effect)
}
```

::: {.noteblock data-latex=""}
The complete source code of the [regularize.test_lambda.UMG_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L148) function is available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L147) section of the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L148) script on _GitHub_.
:::
:::

\newpage

### UMGYE Model: Utility Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the  [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) script on _GitHub_.
:::

#### [calc_date_general_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) Function {#func.calc_date_general_effect}
\

This is a helper function that calculates the _Date General Effect_ (optionally *regularizes* if the [lambda](#func.calc_date_general_effect.args.lambda) argument value is non-default)of the user ratings and is intended to be used in other functions and scripts (such as [train_UMGY_effect](#func.train_UMGY_effect)) described below.

::: { #func.calc_date_general_effect.usage .sidebar }
##### Usage
\
```{r eval=FALSE}
  train_set |>
    calc_date_general_effect(lambda) |>
    calc_UMGY_effect()
```

::: {.noteblock data-latex=""}
In the sample code snippet above the function `calc_date_general_effect` is used internally in the [train_UMGY_effect](#func.train_UMGY_effect)) described below.
:::
:::

::: { #func.calc_date_general_effect.args .sidebar }
##### Arguments
\

::: { #func.calc_date_general_effect.args.train_set .sidebar }
  - **train_set:** Training dataset; 

:::
::: { #func.calc_date_general_effect.args.lambda .sidebar }
  - **lambda:** (0 by default) Regularization parameter. 

:::
:::

::: { #func.calc_date_general_effect.details .sidebar }
##### Details
\

The *Regularization technique* (described in section [Section 24.1 *Case study: recommendation systems / Penalized Least Squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-1]) is applied to the *Date General Effect* calculated by this function only when the *Regularization parameter* value, passed in the [lambda](#func.calc_date_general_effect.args.lambda) argument, is non-default (to be more exact, greater than zero). The regularization is committed through the *penalized regression* by computing the *penalized mean* performed by the internally called [mean_reg](#func.mean_reg) function described above in the *Common Helper Functions /* [Regularization Functions] section of *this Appendix*.
:::

::: { #func.calc_date_general_effect.value .sidebar }
##### Value
\

Data frame representing (*regularized* if [lambda](#func.calc_date_general_effect.args.lambda) argument value is non-default) *Date General Effect*.
:::

::: { #func.calc_date_general_effect.code .sidebar }
##### Source Code
\

Below is a simplified version of the source code for the [calc_date_general_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) function:
```{r eval=FALSE}
  dg_effect <- train_set |> 
    left_join(edx.user_effect, by = "userId") |>
    left_join(rglr.UM_effect, by = "movieId") |>
    left_join(rglr.UMG_effect, by = "movieId") |>
    left_join(date_days_map, by = "timestamp") |>
    mutate(resid = rating - (mu + a + b + g)) |>
  group_by(days) |>
    summarise(de = mean_reg(resid, lambda), 
              year = mean(year))
  
  if(lambda == 0) put_log("Function `calc_date_general_effect`:
Date Global Effect has been computed.")
  else put_log1("Function `calc_date_general_effect`:
Date Global Effect has been computed for lambda: %1...",
                lambda)
  dg_effect
}
```

::: {.noteblock data-latex=""}
The complete source code of the [calc_date_general_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) script on _GitHub_.
:::
:::

\newpage

#### [calc_date_general_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) Function {#func.calc_date_general_effect.cv}
\

Trains (and optionally *regularizes* if the [lambda](#func.calc_date_general_effect.cv.args.lambda) argument value is non-default) the *User+Movie Effect (UME) Model* using the training dataset passed in the [train_set](#func.calc_date_general_effect.cv.args.train_set) argument.

::: { #func.calc_date_general_effect.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  UM_effect <- calc_date_general_effect.cv(train_set, lambda = 0)
```
:::

::: { #func.calc_date_general_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_date_general_effect.cv.args.lambda .sidebar }
  - **lambda:** (0 by default) Regularization parameter. 

:::
:::

::: { #func.calc_date_general_effect.cv.details .sidebar }
##### Details
\

The *Regularization technique* (described in section [Section 24.1 *Case study: recommendation systems / Penalized Least Squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-1]) is applied to the model being trained only when the *Regularization parameter* value, passed in the [lambda](#func.calc_date_general_effect.cv.args.lambda) argument, is other than default (to be more exact, greater than zero). The regularization is committed through the *penalized regression* by computing the *penalized mean* performed by the [mean_reg](#func.mean_reg) function described above in the *Common Helper Functions /* [Regularization Functions] section of *this Appendix*.
:::

::: { #func.calc_date_general_effect.cv.value .sidebar }
##### Value
\

Data frame representing the trained (and also *regularized* if [lambda](#func.calc_date_general_effect.cv.args.lambda) arg value other than default) *UM Effect Model*.
:::

::: { #func.calc_date_general_effect.cv.code .sidebar }
##### Source Code
\

The source code of the [calc_date_general_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) function is shown below:
```{r eval=FALSE}
calc_date_general_effect.cv <- function(train_set, lambda = 0){
  if (is.na(lambda)) {
    stop("Function: calc_date_general_effect.cv
`lambda` is `NA`")
  }

  UM.effect <- train_set |>
    left_join(edx.user_effect, by = "userId") |>
    mutate(resid = rating - (mu + a)) |> 
    group_by(movieId) |>
    summarise(b = mean_reg(resid, lambda), n = n())
  
  stopifnot(!is.na(mean(UM.effect$b)))
  UM.effect
}
```

::: {.noteblock data-latex=""}
The source code of the [calc_date_general_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) script on _GitHub_.
:::
:::

\newpage

#### [calc_UMGY_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#LX) Function {#func.calc_UMGY_effect}
\

::: { #func.calc_UMGY_effect.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
calc_UMGY_effect()

```
:::

::: { #func.calc_UMGY_effect.args .sidebar }
##### Arguments
\

::: { #func.calc_UMGY_effect.args. .sidebar }
  - **:** ; 

:::
:::

::: { #func.calc_UMGY_effect.details .sidebar }
##### Details
\



:::

::: { #func.calc_UMGY_effect.value .sidebar }
##### Value
\

:::

::: { #func.calc_UMGY_effect.code .sidebar }
##### Source Code
\

The source code of the [calc_UMGY_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#LX) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [calc_UMGY_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#LX) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L90) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#LX) script on _GitHub_.
:::
:::

\newpage


#### [train_UMGY_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L42) Function {#func.train_UMGY_effect}
\

Trains (and optionally *regularizes* if the [lambda](#func.train_UMGY_effect.args.lambda) argument value is non-default) the *User+Movie+Genre Effect (UMGYE) Model* using the training sample of the `Movielens` dataset (passed in the [train.sgr](#func.train_UMGY_effect.args.train.sgr) argument), specially prepared to train the *UMGYE Model*.

::: { #func.train_UMGY_effect.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  rglr.UMGY_effect <- edx |> train_UMGY_effect(UMGYE.rglr.best_lambda)
```
:::

::: { #func.train_UMGY_effect.args .sidebar }
##### Arguments
\

::: { #func.train_UMGY_effect.args.train.sgr .sidebar }
  - **train.sgr:** Training sample of the `Movielens` dataset with split rows belonging to multiple genres; 

:::
::: { #func.train_UMGY_effect.args.lambda .sidebar }
  - **lambda:** (0 by default) Regularization parameter. 

:::
:::

::: { #func.train_UMGY_effect.details .sidebar }
##### Details
\
The dataset passed in the [train.sgr](#func.train_UMGY_effect.args.train.sgr) argument is assumed to be the result returned by the [splitGenreRows](#func.splitGenreRows) helper function described above in the *Data Helper Functions /* [Data Processing Functions] section of *This Appendix*.

For example, the [`edx.sgr` Object] is an appropriate dataset as the value of the [train.sgr](#func.train_UMGY_effect.args.train.sgr).

::: {.noteblock data-latex=""}
The *Regularization technique* (described in section [Section 24.1 *Case study: recommendation systems / Penalized Least Squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-1]) is applied to the model being trained only when the *Regularization parameter* value, passed in the [lambda](#func.train_UMGY_effect.args.lambda) argument, is other than default (to be more exact, greater than zero). The regularization is committed through the *penalized regression* by computing the *penalized mean* performed by the [mean_reg](#func.mean_reg) function described above in the *Common Helper Functions /* [Regularization Functions] section of *this Appendix*.
:::
:::

::: { #func.train_UMGY_effect.value .sidebar }
##### Value
\

Data frame representing the trained (and also *regularized* if [lambda](#func.train_UMGY_effect.args.lambda) arg value other than default) *UMG Effect Model*.
:::

::: { #func.train_UMGY_effect.code .sidebar }
##### Source Code
\

The source code of the [train_UMGY_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L42) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [train_UMGY_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L42) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L42) script on _GitHub_.
:::
:::

\newpage

#### [train_UMGY_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L61) Function {#func.train_UMGY_effect.cv}
\

Trains (and optionally *regularizes* if the [lambda](#func.train_UMGY_effect.cv.args.lambda) argument value is non-default) the *User+Movie+Genre Effect (UMGYE) Model* with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.train_UMGY_effect.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  cv.UMGY_effect <- train_UMGY_effect.cv()
```
:::

::: { #func.train_UMGY_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.train_UMGY_effect.cv.args.lambda .sidebar }
  - **lambda:** (0 by default) Regularization parameter. 

:::
:::

::: { #func.train_UMGY_effect.cv.details .sidebar }
##### Details
\

Under the hood, this function internally calls the [train_user_movie_genre_effect](#func.train_user_movie_genre_effect) function described above for each iteration of the *K-Fold Cross-Validation* applied to the [`edx_CV` Object] described below in the [Appendix B: Models Training Datasets]. It also calls internally the [union_cv_results](#func.union_cv_results) function described above in the *Data Helper Functions / [Models Training Functions]* section of this *Appendix* to aggregate the cross-validation results.

The `K` value for the *K-Fold Cross-Validation* method is determined by the length of the [`edx_CV` Object].

::: {.noteblock data-latex=""}
The *Regularization technique* (described in section [Section 24.1 *Case study: recommendation systems / Penalized Least Squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-1]) is applied to the model being trained only when the *Regularization parameter* value, passed in the [lambda](#func.train_UMGY_effect.cv.args.lambda) argument, is other than default (to be more exact, greater than zero).
:::
:::

::: { #func.train_UMGY_effect.cv.value .sidebar }
##### Value
\

Data frame representing the *UMG Effect Model* trained (and also *regularized* if the [lambda](#func.train_UMGY_effect.cv.args.lambda) argument value is other than the default) with use of *K-Fold Cross-Validation*, where the `K` is the length of the [`edx_CV` Object]..
:::

::: { #func.train_UMGY_effect.cv.code .sidebar }
##### Source Code
\

The most important part of the source code of the [train_UMGY_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L61) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The complete source code of the [train_UMGY_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L61) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L61) script on _GitHub_.
:::
:::

\newpage

#### [calc_UMGY_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L112) Function {#func.calc_UMGY_effect_MSE}
\

Validates the *UMG Effect (UMGYE) Model* produced by the  [train_user_movie_genre_effect](#func.train_user_movie_genre_effect) or [train_user_movie_genre_effect.cv](#func.train_user_movie_genre_effect.cv) function call.

::: { #func.calc_UMGY_effect_MSE.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
```
:::

::: { #func.calc_UMGY_effect_MSE.args .sidebar }
##### Arguments
\

::: { #func.calc_UMGY_effect_MSE.args.test_set .sidebar }
  - **test_set:** Validation dataset; 

:::
::: { #func.calc_UMGY_effect_MSE.args.umg_effect .sidebar }
  - **umg_effect:** Data frame representing the *UMG Effect Model*. 

:::
:::

::: { #func.calc_UMGY_effect_MSE.details .sidebar }
##### Details
\

The function calculates *Mean Squared Error (MSE)* for the *UMGYE Model* passed in the [umg_effect](#func.calc_UMGY_effect_MSE.args.umg_effect) argument using the validation dataset passed in the [test_set](#func.calc_UMGY_effect_MSE.args.test_set) arg. 


:::

::: { #func.calc_UMGY_effect_MSE.value .sidebar }
##### Value
\

*MSE* value calculated for the *UMGYE Model*.
:::

::: { #func.calc_UMGY_effect_MSE.code .sidebar }
##### Source Code
\

The source code of the [calc_UMGY_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L112) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [calc_UMGY_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L112) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L112) script on _GitHub_.
:::
:::

\newpage

#### [calc_UMGY_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L124) Function {#func.calc_UMGY_effect_MSE.cv}
\

Validates the *UMG Effect (UMGYE) Model* (produced by the [train_user_movie_genre_effect](#func.train_user_movie_genre_effect) or [train_user_movie_genre_effect.cv](#func.train_user_movie_genre_effect.cv) function call) with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.calc_UMGY_effect_MSE.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
```
:::

::: { #func.calc_UMGY_effect_MSE.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_UMGY_effect_MSE.cv.args.umg_effect .sidebar }
  - **umg_effect:** Data frame representing the *UMG Effect Model*. 

:::
:::

::: { #func.calc_UMGY_effect_MSE.cv.details .sidebar }
##### Details
\

The function calculates *MSE* for the *UMGYE Model* passed in the [umg_effect](#func.calc_UMGY_effect_MSE.cv.args.umg_effect) argument using the validation datasets contained in the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets].

::: {.noteblock data-latex=""}
This function internally calls the [calc_user_movie_genre_effect_MSE](#func.calc_user_movie_genre_effect_MSE) function for each iteration of the *K-Fold Cross-Validation*, calculating the *MSE* for the corresponding validation dataset of the [`edx_CV` Object], and then calculates the mean of the obtained results.

The `K` value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object].
:::
:::

::: { #func.calc_UMGY_effect_MSE.cv.value .sidebar }
##### Value
\

The *MSE* value calculated for the *UMG Effect Model* with use of *K-Fold Cross-Validation*, where the `K` is the length of the [`edx_CV` Object].
:::

::: { #func.calc_UMGY_effect_MSE.cv.code .sidebar }
##### Source Code
\

The simplified version of the source code of the [calc_UMGY_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L124) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The completed source code of the [calc_UMGY_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L124) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L124) script on _GitHub_.
:::
:::

\newpage

#### [calc_UMGY_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L138) Function {#func.calc_UMGY_effect_RMSE.cv}
\

Validates the *UMG Effect (UMGYE) Model* (produced by the [train_user_movie_genre_effect](#func.train_user_movie_genre_effect) or [train_user_movie_genre_effect.cv](#func.train_user_movie_genre_effect.cv) function call) with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.calc_UMGY_effect_RMSE.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
```
:::

::: { #func.calc_UMGY_effect_RMSE.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_UMGY_effect_RMSE.cv.args.umg_effect .sidebar }
  - **umg_effect:** Data frame representing the *UMG Effect Model*. 

:::
:::

::: { #func.calc_UMGY_effect_RMSE.cv.details .sidebar }
##### Details
\

The function calculates *Root Squared Error (RMSE)* for the *UMGYE Model* passed in the [umg_effect](#func.calc_UMGY_effect_RMSE.cv.args.umg_effect) argument using the validation datasets contained in the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets].

::: {.noteblock data-latex=""}
This function internally calls the [calc_user_movie_genre_effect_MSE.cv](#func.calc_user_movie_genre_effect_MSE.cv) function described above, to calculate the *MSE* for the *UMGYE Model* with use of *K-Fold Cross-Validation*, and then calculates the square root of the result.

The `K` value for the *K-Fold Cross-Validation* method is determined by the length of the [`edx_CV` Object].
:::
:::

::: { #func.calc_UMGY_effect_RMSE.cv.value .sidebar }
##### Value
\

The *RMSE* value calculated for the *UMG Effect Model* with use of *K-Fold Cross-Validation*, where the `K` is the length of the [`edx_CV` Object].
:::

::: { #func.calc_UMGY_effect_RMSE.cv.code .sidebar }
##### Source Code
\

The simplified version of the source code of the [calc_UMGY_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L138) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The complete source code of the [calc_UMGY_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L138) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L138) script on _GitHub_.
:::
:::

\newpage

### Matrix Factorization Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the [MF.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R) script on _GitHub_.
:::

#### [mf.residual.dataframe](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L3) Function {#func.mf.residual.dataframe}
\


::: { #func.mf.residual.dataframe.usage .sidebar }
##### Usage
\

```{r eval=FALSE}

```
:::

::: { #func.mf.residual.dataframe.args .sidebar }
##### Arguments
\

::: { #func.mf.residual.dataframe.args.file_name .sidebar }
  - **train_set:** ; 

:::
:::

::: { #func.mf.residual.dataframe.details .sidebar }
##### Details
\


:::

::: { #func.mf.residual.dataframe.value .sidebar }
##### Value
\


:::

::: { #func.mf.residual.dataframe.code .sidebar }
##### Source Code
\

The source code of the [mf.residual.dataframe](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L3) function is shown below:
```{r eval=FALSE}
mf.residual.dataframe <- function(train_set){
  train_set |> 
    left_join(edx.user_effect, by = "userId") |>
    left_join(rglr.UM_effect, by = "movieId") |>
    left_join(rglr.UMG_effect, by = "movieId") |>
    left_join(date_days_map, by = "timestamp") |>
    left_join(rglr.UMGY_effect, by='year') |>
    left_join(rglr.UMGYD_effect, by='days') |>
    mutate(rsdl = rating - (mu + a + b + g + ye + de_smoothed)) |>
    select(userId, movieId, rsdl)
}
```

::: {.noteblock data-latex=""}
The source code of the [mf.residual.dataframe](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L3) function is defined in the [MF.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L3) script on _GitHub_.
:::
:::

#### [UMGYDE_model.predict](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L14) Function {#func.UMGYDE_model.predict}
\


::: { #func.UMGYDE_model.predict.usage .sidebar }
##### Usage
\

```{r eval=FALSE}

```
:::

::: { #func.UMGYDE_model.predict.args .sidebar }
##### Arguments
\

::: { #func.UMGYDE_model.predict.args.file_name .sidebar }
  - **test_set:** ; 

:::
:::

::: { #func.UMGYDE_model.predict.details .sidebar }
##### Details
\


:::

::: { #func.UMGYDE_model.predict.value .sidebar }
##### Value
\


:::

::: { #func.UMGYDE_model.predict.code .sidebar }
##### Source Code
\

The source code of the [UMGYDE_model.predict](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L14) function is shown below:
```{r eval=FALSE}
UMGYDE_model.predict <- function(test_set) {
  test_set |>
    UMGY_SmoothedDay_effect.predict(rglr.UMGYD_effect)
}
```

::: {.noteblock data-latex=""}
The source code of the [UMGYDE_model.predict](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L14) function is defined in the [MF.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L14) script on _GitHub_.
:::
:::































# Appendix B: Models Training Datasets {#appndx_b}
\

## `edx.mx` Matrix Object {#appndx_b.edx.mx}
\

We use the array representation described in [Section 17.6 *Analysis of variance (ANOVA)*](https://rafalab.dfci.harvard.edu/dsbook-part-2/linear-models/treatment-effect-models.html#sec-anova) of the _Course Textbook (New Edition)_, for the training data[@IDS2_17-6]. For this purpose, we will convert the `edx` dataset into a matrix using the [tidyr::pivot_wider](https://www.rdocumentation.org/packages/tidyr/versions/1.3.0/topics/pivot_wider) function:

```{r eval=FALSE}

  put_log("Function: `make_source_datasets`: Creating Rating Matrix from `edx` dataset...")
  edx.mx <- edx |> 
    mutate(userId = factor(userId),
           movieId = factor(movieId)) |>
    select(movieId, userId, rating) |>
    pivot_wider(names_from = movieId, values_from = rating) |>
    column_to_rownames("userId") |>
    as.matrix()
  
  put_log("Function: `make_source_datasets`:
Matrix created: `edx.mx` of the following dimentions:")
  put(dim(edx.mx))
```

::: {.noteblock data-latex=""}
To create the `edx.mx` object, the above code snippet is used in the [make_source_datasets](#func.make_source_datasets) function described in the [Initializing Input Datasets] section of [Appendix A: Support Functions].
:::

```{r}
  str(edx.mx)
```

\newpage

## `edx.sgr` Object {#appndx_b.edx.sgr}
\

To account for the Movie Genre Effect more accurately, we need a dataset with split rows for movies belonging to multiple genres:
```{r eval=FALSE}
  put_log("Function: `make_source_datasets`: 
To account for the Movie Genre Effect, we need a dataset with split rows 
for movies belonging to multiple genres.")
  edx.sgr <- splitGenreRows(edx)
```

::: {.noteblock data-latex=""}
To create the `edx.sgr` object, the above code snippet is used in the [make_source_datasets](#func.make_source_datasets) function described in the [Initializing Input Datasets] section of [Appendix A: Support Functions].

The custom function [splitGenreRows](#func.splitGenreRows) used in the code snippet to split the rows of the original dataset (`edx` in this case) is described in the [Data Processing Functions] section of [Appendix A: Support Functions].
:::

```{r}
str(edx.sgr)
summary(edx.sgr)
```

\newpage

## `movie_map` Object {#appndx_b.movie_map}
\

To be able to map movie IDs to titles we create the following lookup table:
```{r eval=FALSE}
movie_map <- edx |> select(movieId, title, genres) |> 
    distinct(movieId, .keep_all = TRUE)
  
  put_log("Function: `make_source_datasets`: Dataset created: movie_map")
```

::: {.noteblock data-latex=""}
To create the `movie_map` object, the above code snippet is used in the [make_source_datasets](#func.make_source_datasets) function described in the [Initializing Input Datasets] section of [Appendix A: Support Functions].
:::

```{r}
str(movie_map)
summary(movie_map)
```

Note that titles cannot be considered unique, so we cannot use them as IDs[@IDS2_24-1].

\newpage

## `date_days_map` Object {#appndx_b.date_days_map}
\

We have a `timestamp` field in the `edx` dataset.
To be able to map the date, year, and number of days since the earliest record in the `edx` dataset with the corresponding value in this field, we create the following lookup table:
```{r eval=FALSE}
  put_log("Function: `make_source_datasets`: Creating Date-Days Map dataset...")
  date_days_map <- edx |>
    mutate(date_time = as_datetime(timestamp)) |>
    mutate(date = as_date(date_time)) |>
    mutate(year = year(date_time)) |>
    mutate(days = as.integer(date - min(date))) |>
    select(timestamp, date_time, date, year, days) |>
    distinct(timestamp, .keep_all = TRUE)
  
  put_log("Function: `make_source_datasets`: Dataset created: date_days_map")
```

::: {.noteblock data-latex=""}
To create the `date_days_map` object, the above code snippet is used in the [make_source_datasets](#func.make_source_datasets) function described in the [Initializing Input Datasets] section of [Appendix A: Support Functions].
:::

``` {r}
  str(date_days_map)
  summary(date_days_map)
```

\newpage

## `edx_CV` Object {#appndx_b.edx_CV}
\

`edx_CV` object is a list of sample objects we need to perform the *K-Fold Cross-Validation* 
as explained in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV]:
```{r eval=FALSE}
  start <- put_start_date()
  edx_CV <- lapply(kfold_index,  function(fold_i){
    
    put_log1("Method `make_source_datasets`: 
Creating K-Fold Cross-Validation Datasets, Fold %1", fold_i)
    
    #> We split the initial datasets into training sets, which we will use to build 
    #> and train our models, and validation sets in which we will compute the accuracy 
    #> of our predictions, the way described in the `Section 23.1.1 Movielens data`
    #> (https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#movielens-data) 
    #> of the Course Textbook.
    
    split_sets <- edx |>
      sample_train_validation_sets(fold_i*1000)
    
    train_set <- split_sets$train_set
    validation_set <- split_sets$validation_set
    
    put_log("Function: `make_source_datasets`: 
Sampling 20% from the split-row version of the `edx` dataset...")
    split_sets.gs <- edx.sgr |>
      sample_train_validation_sets(fold_i*2000)

    train.sgr <- split_sets.gs$train_set
    validation.sgr <- split_sets.gs$validation_set
    
    # put_log("Function: `make_source_datasets`: Dataset created: validation.sgr")
    # put(summary(validation.sgr))
    
    #> We will use the array representation described in `Section 17.5 of the Textbook`
    #> (https://rafalab.dfci.harvard.edu/dsbook-part-2/linear-models/treatment-effect-models.html#sec-anova), 
    #> for the training data. 
    #> To create this matrix, we use `tidyr::pivot_wider` function:
    
    put_log("Function: `make_source_datasets`: Creating Rating Matrix from Train Set...")
    train_mx <- train_set |> 
      mutate(userId = factor(userId),
             movieId = factor(movieId)) |>
      select(movieId, userId, rating) |>
      pivot_wider(names_from = movieId, values_from = rating) |>
      column_to_rownames("userId") |>
      as.matrix()
    
    put_log("Function: `make_source_datasets`:
Matrix created: `train_mx` of the following dimentions:")
    put(dim(train_mx))


    list(train_set = train_set,
         train_mx = train_mx,
         train.sgr = train.sgr,
         validation_set = validation_set)
  })
  put_end_date(start)
  put_log("Function: `make_source_datasets`: 
Set of K-Fold Cross-Validation datasets created: edx_CV")
```

To create the `edx_CV` object, the above code snippet is used in the [make_source_datasets](#func.make_source_datasets) function described in the [Initializing Input Datasets] section of [Appendix A: Support Functions].

The `K` value for the *K-Fold Cross-Validation* is determined by the length of the list composing the `edx_CV` object. In *this Project*, we choose `K = 5`.

::: {.noteblock data-latex=""}
The custom function [sample_train_validation_sets](#func.sample_train_validation_sets) used in the code snippet to split the original dataset (`edx` in this case) into *train* and *validation* datasets, is described in the [Data Processing Functions] section of [Appendix A: Support Functions].
:::

```{r}
str(edx_CV)
```

\newpage

