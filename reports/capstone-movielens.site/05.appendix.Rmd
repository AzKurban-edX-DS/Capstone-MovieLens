# Appendix A: Support Functions {#appndx_a}
## Common Helper Functions
### Logging Functions {#appndx_a.CHF.logging-funcs}

::: {.noteblock data-latex=""}
The full source code of the functions described in this section is available in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R) script on _GitHub_.
:::

#### [open_logfile](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L3) Function {#func.open_logfile}
\

A function to initialize the log file.

::: { #func.open_logfile.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L5)
\

```{r main-script@l5u, eval=FALSE}
open_logfile(".data-analysis")
```
:::

::: { #func.open_logfile.args .sidebar }
##### Arguments
\

::: { #func.open_logfile.args.file_name .sidebar }
  - **file_name:** A name used as a base to generate a unique log file name; 

:::
:::

::: { #func.open_logfile.details .sidebar }
##### Details
\

This function is a wrapper for the [logr::log_open](https://www.rdocumentation.org/packages/logr/versions/1.3.9/topics/log_open) function. It also calls internally the following functions to generate a unique file name based on the [file_name](#func.open_logfile.args.file_name) argument and _system time_:

- [Sys.time](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/Sys.time);

- [stringr::str_replace](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace);

- [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace)

For more information on the _inner functions_ listed above, see the [R Documentation](https://www.rdocumentation.org/).

:::

::: { #func.open_logfile.value .sidebar }
##### Value
\

The path of the log.

:::

\newpage

::: { #func.open_logfile.code .sidebar }
##### Source Code
\

The source code of the [open_logfile](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L3) function is shown below:
```{r eval=FALSE}
library(logr)
library(stringr)

open_logfile <- function(file_name){
  log_file_name <- as.character(Sys.time()) |> 
    str_replace_all(':', '_') |> 
    str_replace(' ', 'T') |>
    str_c(file_name)
  
  log_open(file_name = log_file_name)
}
```

::: {.noteblock data-latex=""}
The source code of the [open_logfile](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L3) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L3) script on _GitHub_.
:::
:::

#### [print_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L11) Function {#func.print_start_date}
\

Prints the system date and time at the time the function is called and returns the system's idea of the current date and time.

::: { #func.print_start_date.usage .sidebar }
##### Usage
\

```{r}
start_date <- print_start_date()
start_date
```
:::

::: { #func.print_start_date.details .sidebar }
##### Details
\

This function internally calls [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print), [base::date](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/date), and [base::Sys.time](https://www.rdocumentation.org/link/Sys.time?package=base&version=3.6.2) `R` functions.

It first prints the value returned by the `date` function, then returns the object returned by the `Sys.time` function.
:::

::: { #func.print_start_date.value .sidebar }
##### Value
\

An object of class `POSIXct` (see [DateTimeClasses](https://www.rdocumentation.org/link/DateTimeClasses?package=base&version=3.6.2)). 

:::

::: { #func.print_start_date.code .sidebar }
##### Source Code
\

The source code of the [print_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L11) function is shown below:
```{r eval=FALSE}
print_start_date <- function(){
  print(date())
  Sys.time()
}
```

::: {.noteblock data-latex=""}
The source code of the [print_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L11) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L11) script on _GitHub_.
:::
:::

#### [put_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L15) Function {#func.put_start_date}
\

Outputs the system date and time to the currently opened log (using the [open_logfile](#func.open_logfile) function described above) at the time the function is called and returns the system's idea of the current date and time.

::: { #func.put_start_date.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L99)
\

```{r main-script@l99u, eval=FALSE}
  start <- put_start_date()
```
:::

::: { #func.put_start_date.details .sidebar }
##### Details
\

This function internally calls [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print), [base::date](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/date), and [base::Sys.time](https://www.rdocumentation.org/link/Sys.time?package=base&version=3.6.2) `R` functions.

It first outputs the value returned by the `date` function to the currently opened log, then returns the object returned by the `Sys.time` function.
:::

::: { #func.put_start_date.value .sidebar }
##### Value
\

An object of class `POSIXct` (see [DateTimeClasses](https://www.rdocumentation.org/link/DateTimeClasses?package=base&version=3.6.2)). 

:::

::: { #func.put_start_date.code .sidebar }
##### Source Code
\

The source code of the [put_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L15) function is shown below:
```{r eval=FALSE}
put_start_date <- function(){
  put(date())
  Sys.time()
}
```

::: {.noteblock data-latex=""}
The source code of the [put_start_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L15) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L15) script on _GitHub_.
:::
:::

#### [print_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L19) Function {#func.print_end_date}
\

Prints the system date and time at the time the function is called, and then the time elapsed since the date and time specified by the [start](#func.print_end_date.args.start) argument.

::: { #func.print_end_date.usage .sidebar }
##### Usage
\

```{r}
start_date <- print_start_date()
Sys.sleep(3)
print_end_date(start_date)
```
:::

::: { #func.print_end_date.args .sidebar }
##### Arguments
\

::: { #func.print_end_date.args.start .sidebar }
  - **start:** An object of class `POSIXct` representing the value of the moment from which time is measured. 

:::
:::

::: { #func.print_end_date.details .sidebar }
##### Details
\

This function internally calls [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print), [base::date](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/date), and [base::Sys.time](https://www.rdocumentation.org/link/Sys.time?package=base&version=3.6.2) `R` functions.

It first prints the value returned by the `date` function, then builds an object of class `difftime` representing the time elapsed since the date and time specified by the [start](#func.print_end_date.args.start) argument, prints the object, and, finally, returns the object to the client code.

:::

::: { #func.print_end_date.value .sidebar }
##### Value
\

An object of class `difftime` representing the time elapsed since the date and time specified by the [start](#func.print_end_date.args.start) argument. 

:::

::: { #func.print_end_date.code .sidebar }
##### Source Code
\

The source code of the [print_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L19) function is shown below:
```{r eval=FALSE}
print_end_date <- function(start){
  print(date())
  print(Sys.time() - start)
}
```

::: {.noteblock data-latex=""}
The source code of the [print_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L19) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L19) script on _GitHub_.
:::
:::

#### [put_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L23) Function {#func.put_end_date}
\

Outputs the system date and time to the currently open log (using the [open_logfile](#func.open_logfile) function described above).

The first value in the output is the system date and time at the time the function is called, and the second value is the time elapsed since the date and time specified by the [start](#func.put_end_date.args.start) argument.

::: { #func.put_end_date.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L101)
\

```{r main-script@l101u, eval=FALSE}
put_end_date(start)
```
:::

::: { #func.put_end_date.args .sidebar }
##### Arguments
\

::: { #func.put_end_date.args.start .sidebar }
  - **start:** An object of class `POSIXct` representing the value of the moment from which time is measured. 

:::
:::

::: { #func.put_end_date.details .sidebar }
##### Details
\

This function works similarly to the [print_end_date](#func.print_end_date) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_end_date.value .sidebar }
##### Value
\

An object of class `difftime` representing the time elapsed since the date and time specified by the [start](#func.put_end_date.args.start) argument. 

:::

::: { #func.put_end_date.code .sidebar }
##### Source Code
\

The source code of the [put_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L23) function is shown below:
```{r eval=FALSE}
put_end_date <- function(start){
  put(date())
  put(Sys.time() - start)
}
```

::: {.noteblock data-latex=""}
The source code of the [put_end_date](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L23) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L23) script on _GitHub_.
:::
:::

\newpage

#### [print_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L28) Function {#func.print_log}
\

Prints a multiline string specified by the [msg](#func.print_log.args.msg) argument.

::: { #func.print_log.usage .sidebar }
##### Usage
\

```{r}
print_log("Hello World!")
```
:::

::: { #func.print_log.args .sidebar }
##### Arguments
\

::: { #func.print_log.args.msg .sidebar }
  - **msg:** A string to print (can be multiline). 

:::
:::

::: { #func.print_log.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` functions to print the (possibly multiline) string specified by the [msg](#func.print_log.args.msg) argument.

:::

::: { #func.print_log.value .sidebar }
##### Value
\

A [glue object](https://glue.tidyverse.org/reference/glue.html), as created by [glue::as_glue()](https://glue.tidyverse.org/reference/as_glue.html). 
:::

::: { #func.print_log.code .sidebar }
##### Source Code
\

The source code of the [print_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L28) function is shown below:
```{r eval=FALSE}
print_log <- function(msg){
  print(str_glue(msg))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L28) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L28) script on _GitHub_.
:::
:::

\newpage

#### [put_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L31) Function {#func.put_log}
\

Outputs a multiline string specified by the [msg](#func.put_log.args.msg) argument to the currently opened log (using the [open_logfile](#func.open_logfile) function described above).

::: { #func.put_log.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L231)
\

```{r main-script@l1231u, eval=FALSE}
put_log("Computing Average Ratings per User (User Mean Ratings)...")
```
```{r, echo=FALSE}
print_log("Computing Average Ratings per User (User Mean Ratings)...")
```
:::

::: { #func.put_log.args .sidebar }
##### Arguments
\

::: { #func.put_log.args.msg .sidebar }
  - **msg:** A string to print (can be multiline). 

:::
:::

::: { #func.put_log.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` functions to output the (possibly multiline) string specified by the [msg](#func.put_log.args.msg) argument.

The function works similarly to the [print_log](#func.print_log) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log.value .sidebar }
##### Value
\

A [glue object](https://glue.tidyverse.org/reference/glue.html), as created by [glue::as_glue()](https://glue.tidyverse.org/reference/as_glue.html).
:::

::: { #func.put_log.code .sidebar }
##### Source Code
\

The source code of the [put_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L31) function is shown below:
```{r eval=FALSE}
put_log <- function(msg){
  put(str_glue(msg))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L31) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L31) script on _GitHub_.
:::
:::

\newpage

#### [get_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L35) Function {#func.get_log1}
\

Creates a character vector from the template passed in the [msg_template](#func.get_log1.args.msg_template) argument, using the value specified by the [arg1](#func.get_log1.args.arg1) argument to replace all the occurrences of the pattern *"%1"* found in the template.

::: { #func.get_log1.usage .sidebar }
##### Usage
\

```{r logging-functions@l42u, eval=FALSE}
  put(get_log1(msg_template, arg1))
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L42) above, the function `get_log1` is called internally from the [put_log1](#func.put_log1) function described below in *this Section*.
:::
:::

::: { #func.get_log1.args .sidebar }
##### Arguments
\

::: { #func.get_log1.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of the pattern *"%1"* to be replaced by the value specified by the [arg1](#func.get_log1.args.arg1) argument. 

:::

::: { #func.get_log1.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the pattern *"%1"* in the message template passed in the [msg_template](#func.get_log1.args.msg_template) argument. 

:::
:::

::: { #func.get_log1.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` functions to form a character vector from the template passed in the [msg_template](#func.get_log1.args.msg_template) argument, using the value specified by the [arg1](#func.get_log1.args.arg1)  argument to replace all the occurrences of the pattern *"%1"* found in the template.

::: {.noteblock data-latex=""}
This is an auxiliary function intended for use in other custom logging functions, such as the [put_log1](#func.put_log1) (as shown in the [Usage](#func.get_log1.usage) section of *this Description*) and [print_log1](#func.print_log1) described below in *this Section*.
:::
:::

::: { #func.get_log1.value .sidebar }
##### Value
\

A glue object, returned by the internally called [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) function, created from the character vector returned by the (also internally called) function [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).
:::

\newpage

::: { #func.get_log1.code .sidebar }
##### Source Code
\

The source code of the [get_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L35) function is shown below:
```{r eval=FALSE}
get_log1 <- function(msg_template, arg1) {
  str_glue(str_replace_all(msg_template, "%1", as.character(arg1)))
}
```

::: {.noteblock data-latex=""}
The source code of the [get_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L35) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L35) script on _GitHub_.
:::
:::

\newpage

#### [print_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L38) Function {#func.print_log1}
\

Prints a log created from the template passed in the [msg_template](#func.print_log1.args.msg_template) argument, using the value specified by the [arg1](#func.print_log1.args.arg1) argument to replace all the occurrences of the pattern *"%1"* found in the template.

::: { #func.print_log1.usage .sidebar }
##### [Usage](#chunk.main_script.l177m)
\

```{r chunk.main-script@l177m}
which_min_deviation <- deviation[which.min(deviation.RMSE)]
min_rmse = min(deviation.RMSE)

print_log1("Minimum RMSE is achieved when the deviation from the mean is: %1",
         which_min_deviation)

print_log1("Is the previously computed RMSE the best for the current model: %1",
         mu.RMSE == min_rmse)
```
:::

::: { #func.print_log1.args .sidebar }
##### Arguments
\

::: { #func.print_log1.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of the pattern *"%1"* to be replaced by the value specified by the [arg1](#func.print_log1.args.arg1) argument. 

:::

::: { #func.print_log1.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the pattern *"%1"* in the message template passed in the [msg_template](#func.print_log1.args.msg_template) argument. 

:::
:::

::: { #func.print_log1.details .sidebar }
##### Details
\

This function internally calls the [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` function to print the object returned by the [get_log1](#func.get_log1) function (also called internally) described above.

:::

::: { #func.print_log1.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log1](#func.get_log1) described above.
:::

\newpage

::: { #func.print_log1.code .sidebar }
##### Source Code
\

The source code of the [print_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L38) function is shown below:
```{r eval=FALSE}
print_log1 <- function(msg_template, arg1){
  print(get_log1(msg_template, arg1))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L38) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L38) script on _GitHub_.
:::
:::

\newpage

#### [put_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L41) Function {#func.put_log1}
\

Outputs a log to the currently open log file (using the [open_logfile](#func.open_logfile) function described above), created from the template passed in the [msg_template](#func.put_log1.args.msg_template) argument, using the value specified by the [arg1](#func.put_log1.args.arg1) argument to replace all the occurrences of the pattern *"%1"* found in the template.

::: { #func.put_log1.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L177)
\

```{r main-script@l177u}
which_min_deviation <- deviation[which.min(deviation.RMSE)]
min_rmse = min(deviation.RMSE)
```
```{r eval=FALSE}
put_log1("Minimum RMSE is achieved when the deviation from the mean is: %1",
         which_min_deviation)

put_log1("Is the previously computed RMSE the best for the current model: %1",
         mu.RMSE == min_rmse)
```
```{r echo=FALSE}
print_log1("Minimum RMSE is achieved when the deviation from the mean is: %1",
         which_min_deviation)

print_log1("Is the previously computed RMSE the best for the current model: %1",
         mu.RMSE == min_rmse)
```
:::

::: { #func.put_log1.args .sidebar }
##### Arguments
\

::: { #func.put_log1.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of the pattern *"%1"* to be replaced by the value specified by the [arg1](#func.put_log1.args.arg1) argument. 

:::

::: { #func.put_log1.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the pattern *"%1"* in the message template passed in the [msg_template](#func.put_log1.args.msg_template) argument. 

:::
:::

::: { #func.put_log1.details .sidebar }
##### Details
\

This function internally calls the [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` function to output the log object returned by the (also called internally) [get_log1](#func.get_log1) function described above.

The function works similarly to the [print_log1](#func.print_log1) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log1.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log1](#func.get_log1) described above.
:::

\newpage

::: { #func.put_log1.code .sidebar }
##### Source Code
\

The source code of the [put_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L41) function is shown below:
```{r eval=FALSE}
put_log1 <- function(msg_template, arg1){
  put(get_log1(msg_template, arg1))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L41) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L41) script on _GitHub_.
:::
:::

\newpage

#### [get_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L45) Function {#func.get_log2}
\

Creates a character vector from the template passed in the [msg_template](#func.get_log2.args.msg_template) argument, using the values specified by the [arg1](#func.get_log2.args.arg1) and [arg2](#func.get_log2.args.arg2) arguments to replace all the occurrences of the placeholders *"%1"* and *"%2"*, respectively, found in the template.

::: { #func.get_log2.usage .sidebar }
##### Usage
\

```{r logging-func@l55, eval=FALSE}
  put(get_log2(msg_template, arg1, arg2))
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L55) above, the function `get_log2` is called internally from the [put_log2](#func.put_log2) function described below in *this Section*.
:::
:::

::: { #func.get_log2.args .sidebar }
##### Arguments
\

::: { #func.get_log2.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders *"%1"* and *"%2"*, to be replaced by the values specified by the [arg1](#func.get_log2.args.arg1) and  [arg2](#func.get_log2.args.arg2) arguments, respectively.

:::

::: { #func.get_log2.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder *"%1"* in the message template passed in the [msg_template](#func.get_log2.args.msg_template) argument. 

:::

::: { #func.get_log2.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder *"%2"* in the message template passed in the [msg_template](#func.get_log2.args.msg_template) argument. 

:::
:::

::: { #func.get_log2.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` functions to form a character vector from the template passed in the [msg_template](#func.get_log2.args.msg_template) argument, using the values specified by the [arg1](#func.get_log2.args.arg1) and [arg2](#func.get_log2.args.arg2)  arguments to replace all the occurrences of the placeholders *"%1"* and *"%2"*, respectively, found in the template.

::: {.noteblock data-latex=""}
This is an auxiliary function intended for use in other custom logging functions, such as the [put_log2](#func.put_log2) (as shown in the [Usage](#func.get_log2.usage) section of *this Description*) and [print_log2](#func.print_log2) described below in *this Section*.
:::
:::

::: { #func.get_log2.value .sidebar }
##### Value
\

A glue object, returned by the internally called [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) function, created from the character vector returned by the (also internally called) function [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).

:::

::: { #func.get_log2.code .sidebar }
##### Source Code
\

The source code of the [get_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L45) function is shown below:
```{r eval=FALSE}
get_log2 <- function(msg_template, arg1, arg2) {
  msg_template |> 
    str_replace_all("%1", as.character(arg1)) |>
    str_replace_all("%2", as.character(arg2)) |>
    str_glue()
}
```

::: {.noteblock data-latex=""}
The source code of the [get_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L45) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L45) script on _GitHub_.
:::
:::

\newpage

#### [print_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L51) Function {#func.print_log2}
\

Prints a log created from the template passed in the [msg_template](#func.print_log2.args.msg_template) argument, using the values specified by the [arg1](#func.print_log2.args.arg1) and [arg2](#func.print_log2.args.arg2) arguments to replace all the occurrences of the placeholders *"%1"* and *"%2"*, respectively, found in the template.

::: { #func.print_log2.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L119)
\

```{r main-script@l119um}
  print_log2("%1-Fold Cross Validation ultimate RMSE: %2", CVFolds_N, mu.RMSE)
```
:::

::: { #func.print_log2.args .sidebar }
##### Arguments
\

::: { #func.print_log2.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders *"%1"* and *"%2"*, to be replaced by the values specified by the [arg1](#func.print_log2.args.arg1) and  [arg2](#func.print_log2.args.arg2) arguments, respectively.

:::

::: { #func.print_log2.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder *"%1"* in the message template passed in the [msg_template](#func.print_log2.args.msg_template) argument. 

:::

::: { #func.print_log2.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder *"%2"* in the message template passed in the [msg_template](#func.print_log2.args.msg_template) argument. 

:::
:::

::: { #func.print_log2.details .sidebar }
##### Details
\

This function internally calls the [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` function to print the object returned by the [get_log2](#func.get_log2) function (also called internally) described above.

:::

::: { #func.print_log2.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log2](#func.get_log2) described above.

:::

::: { #func.print_log2.code .sidebar }
##### Source Code
\

The source code of the [print_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L51) function is shown below:
```{r eval=FALSE}
print_log2 <- function(msg_template, arg1, arg2){
  print(get_log2(msg_template, arg1, arg2))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L51) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L51) script on _GitHub_.
:::
:::

\newpage

#### [put_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L54) Function {#func.put_log2}
\

Outputs a log to the currently open log file (using the [open_logfile](#func.open_logfile) function described above), created from the template passed in the [msg_template](#func.put_log2.args.msg_template) argument, using the values specified by the [arg1](#func.put_log2.args.arg1) and [arg2](#func.put_log2.args.arg2) arguments to replace all the occurrences of the placeholders *"%1"* and *"%2"*, respectively, found in the template.

::: { #func.put_log2.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L119)
\

```{r main-script@l119u, eval=FALSE}
  put_log2("%1-Fold Cross Validation ultimate RMSE: %2", CVFolds_N, mu.RMSE)
```
```{r echo=FALSE}
  print_log2("%1-Fold Cross Validation ultimate RMSE: %2", CVFolds_N, mu.RMSE)
```
:::

::: { #func.put_log2.args .sidebar }
##### Arguments
\

::: { #func.put_log2.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders *"%1"* and *"%2"*, to be replaced by the values specified by the [arg1](#func.put_log2.args.arg1) and  [arg2](#func.put_log2.args.arg2) arguments, respectively.

:::

::: { #func.put_log2.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder *"%1"* in the message template passed in the [msg_template](#func.put_log2.args.msg_template) argument. 

:::

::: { #func.put_log2.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder *"%2"* in the message template passed in the [msg_template](#func.put_log2.args.msg_template) argument. 

:::
:::

::: { #func.put_log2.details .sidebar }
##### Details
\

This function internally calls the [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` function to output the log object returned by the (also called internally) [get_log2](#func.get_log2) function described above.

The function works similarly to the [print_log2](#func.print_log2) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log2.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log2](#func.get_log2) described above.
:::

\newpage

::: { #func.put_log2.code .sidebar }
##### Source Code
\

The source code of the [put_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L54) function is shown below:
```{r eval=FALSE}
put_log2 <- function(msg_template, arg1, arg2){
  put(get_log2(msg_template, arg1, arg2))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L54) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L54) script on _GitHub_.
:::
:::

\newpage

#### [get_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L58) Function {#func.get_log3}
\

Creates a character vector from the template passed in the [msg_template](#func.get_log3.args.msg_template) argument, using the values specified by the [arg1](#func.get_log3.args.arg1), [arg2](#func.get_log3.args.arg2), and [arg3](#func.get_log3.args.arg3) arguments to replace all the occurrences of the placeholders *"%1"*, *"%2"*, and *"%3"*, respectively, found in the template.

::: { #func.get_log3.usage .sidebar }
##### Usage
\

```{r logging-func@l69, eval=FALSE}
  put(get_log3(msg_template, arg1, arg2, arg3))
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L69) above, the function `get_log3` is called internally from the [put_log3](#func.put_log3) function described below in *this Section*.
:::
:::

::: { #func.get_log3.args .sidebar }
##### Arguments
\

::: { #func.get_log3.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders *"%1"*, *"%2"*, and *"%3"* to be replaced by the values specified by the [arg1](#func.get_log3.args.arg1),  [arg2](#func.get_log3.args.arg2), and [arg3](#func.get_log3.args.arg3) arguments, respectively.

:::

::: { #func.get_log3.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder *"%1"* in the message template passed in the [msg_template](#func.get_log3.args.msg_template) argument. 

:::

::: { #func.get_log3.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder *"%2"* in the message template passed in the [msg_template](#func.get_log3.args.msg_template) argument. 

:::

::: { #func.get_log3.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder *"%3"* in the message template passed in the [msg_template](#func.get_log3.args.msg_template) argument. 

:::
:::

::: { #func.get_log3.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` functions to form a character vector from the template passed in the [msg_template](#func.get_log3.args.msg_template) argument, using the values specified by the [arg1](#func.get_log3.args.arg1), [arg2](#func.get_log3.args.arg2), and [arg3](#func.get_log3.args.arg3)  arguments to replace all the occurrences of the placeholders *"%1"*, *"%2"*, and *"%3"*, respectively, found in the template.

::: {.noteblock data-latex=""}
This is an auxiliary function intended for use in other custom logging functions, such as the [put_log3](#func.put_log3) (as shown in the [Usage](#func.get_log3.usage) section of *this Description*) and [print_log3](#func.print_log3) described below in *this Section*.
:::
:::

::: { #func.get_log3.value .sidebar }
##### Value
\

A glue object, returned by the internally called [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) function, created from the character vector returned by the (also internally called) function [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).

:::

::: { #func.get_log3.code .sidebar }
##### Source Code
\

The source code of the [get_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L58) function is shown below:
```{r eval=FALSE}
get_log3 <- function(msg_template, arg1, arg2, arg3) {
  msg_template |> 
    str_replace_all("%1", as.character(arg1)) |>
    str_replace_all("%2", as.character(arg2)) |>
    str_replace_all("%3", as.character(arg3)) |>
    str_glue()
}
```

::: {.noteblock data-latex=""}
The source code of the [get_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L58) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L58) script on _GitHub_.
:::
:::

\newpage

#### [print_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L65) Function {#func.print_log3}
\

Prints a log created from the template passed in the [msg_template](#func.print_log3.args.msg_template) argument, using the values specified by the [arg1](#func.print_log3.args.arg1), [arg2](#func.print_log3.args.arg2), and [arg3](#func.print_log3.args.arg3) arguments to replace all the occurrences of the placeholders *"%1"*, *"%2"*, and *"%3"*, respectively, found in the template.

::: { #func.print_log3.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L2009)
\

```{r main-script@l2009um}
print_log3("RMSE value has been computed using `loess` function 
with the best parameters for the %1-Fold Cross Validation samples:
degree = %2;
span = %3.",
        CVFolds_N,
        lss.best_degree,
        lss.best_span)
```
:::

::: { #func.print_log3.args .sidebar }
##### Arguments
\

::: { #func.print_log3.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders *"%1"*, *"%2"*, and *"%3"* to be replaced by the values specified by the [arg1](#func.print_log3.args.arg1),  [arg2](#func.print_log3.args.arg2), and [arg3](#func.print_log3.args.arg3) arguments, respectively.

:::

::: { #func.print_log3.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder *"%1"* in the message template passed in the [msg_template](#func.print_log3.args.msg_template) argument. 

:::

::: { #func.print_log3.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder *"%2"* in the message template passed in the [msg_template](#func.print_log3.args.msg_template) argument. 

:::

::: { #func.print_log3.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder *"%3"* in the message template passed in the [msg_template](#func.print_log3.args.msg_template) argument. 

:::
:::

::: { #func.print_log3.details .sidebar }
##### Details
\

This function internally calls the [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` function to print the object returned by the [get_log3](#func.get_log3) function (also called internally) described above.

:::

::: { #func.print_log3.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log3](#func.get_log3) described above.
:::

\newpage

::: { #func.print_log3.code .sidebar }
##### Source Code
\

The source code of the [print_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L65) function is shown below:
```{r eval=FALSE}
print_log3 <- function(msg_template, arg1, arg2, arg3){
  print(get_log3(msg_template, arg1, arg2, arg3))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L65) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L65) script on _GitHub_.
:::
:::

\newpage

#### [put_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L68) Function {#func.put_log3}
\

Outputs a log to the currently open log file (using the [open_logfile](#func.open_logfile) function described above), created from the template passed in the [msg_template](#func.put_log3.args.msg_template) argument, using the values specified by the [arg1](#func.put_log3.args.arg1), [arg2](#func.put_log3.args.arg2), and [arg3](#func.put_log3.args.arg3) arguments to replace all the occurrences of the placeholders *"%1"*, *"%2"*, and *"%3"*, respectively, found in the template.

::: { #func.put_log3.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#2009)
\

```{r main-script@l2009u, eval=FALSE}
put_log3("RMSE value has been computed using `loess` function 
with the best parameters for the %1-Fold Cross Validation samples:
degree = %2;
span = %3.",
        CVFolds_N,
        lss.best_degree,
        lss.best_span)
```
```{r, echo=FALSE}
print_log3("RMSE value has been computed using `loess` function 
with the best parameters for the %1-Fold Cross Validation samples:
degree = %2;
span = %3.",
        CVFolds_N,
        lss.best_degree,
        lss.best_span)
```
:::

::: { #func.put_log3.args .sidebar }
##### Arguments
\

::: { #func.put_log3.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders *"%1"*, *"%2"*, and *"%3"* to be replaced by the values specified by the [arg1](#func.put_log3.args.arg1),  [arg2](#func.put_log3.args.arg2), and [arg3](#func.put_log3.args.arg3) arguments, respectively.

:::

::: { #func.put_log3.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder *"%1"* in the message template passed in the [msg_template](#func.put_log3.args.msg_template) argument. 

:::

::: { #func.put_log3.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder *"%2"* in the message template passed in the [msg_template](#func.put_log3.args.msg_template) argument. 

:::

::: { #func.put_log3.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder *"%3"* in the message template passed in the [msg_template](#func.put_log3.args.msg_template) argument. 

:::
:::

::: { #func.put_log3.details .sidebar }
##### Details
\

This function internally calls the [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` function to output the log object returned by the (also called internally) [get_log3](#func.get_log3) function described above.

The function works similarly to the [print_log3](#func.print_log3) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log3.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log3](#func.get_log3) described above.
:::

::: { #func.put_log3.code .sidebar }
##### Source Code
\

The source code of the [put_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L68) function is shown below:
```{r eval=FALSE}
put_log3 <- function(msg_template, arg1, arg2, arg3){
  put(get_log3(msg_template, arg1, arg2, arg3))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log3](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L68) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L68) script on _GitHub_.
:::
:::

\newpage

#### [get_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L72) Function {#func.get_log4}
\

Creates a character vector from the template passed in the [msg_template](#func.get_log4.args.msg_template) argument, using the values specified by the [arg1](#func.get_log4.args.arg1), [arg2](#func.get_log4.args.arg2), [arg3](#func.get_log4.args.arg3), and [arg4](#func.get_log4.args.arg4) arguments to replace all the occurrences of the placeholders *"%1"*, *"%2"*, *"%3"*, and *"%4"*, respectively, found in the template.

::: { #func.get_log4.usage .sidebar }
##### Usage
\

```{r logging-func@l84, eval=FALSE}
  put(get_log4(msg_template, arg1, arg2, arg3, arg4))
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L84) above, the function `get_log4` is called internally from the [put_log4](#func.put_log4) function described below in *this Section*.
:::
:::

::: { #func.get_log4.args .sidebar }
##### Arguments
\

::: { #func.get_log4.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders *"%1"*, *"%2"*, *"%3"*, and *"%4"* to be replaced by the values specified by the [arg1](#func.get_log4.args.arg1),  [arg2](#func.get_log4.args.arg2), [arg3](#func.get_log4.args.arg3), and [arg4](#func.get_log4.args.arg4) arguments, respectively.

:::

::: { #func.get_log4.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder *"%1"* in the message template passed in the [msg_template](#func.get_log4.args.msg_template) argument. 

:::

::: { #func.get_log4.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder *"%2"* in the message template passed in the [msg_template](#func.get_log4.args.msg_template) argument. 

:::

::: { #func.get_log4.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder *"%3"* in the message template passed in the [msg_template](#func.get_log4.args.msg_template) argument. 

:::

::: { #func.get_log4.args.arg4 .sidebar }
  - **arg4:** Value to replace all occurrences of the placeholder *"%4"* in the message template passed in the [msg_template](#func.get_log4.args.msg_template) argument. 

:::
:::

::: { #func.get_log4.details .sidebar }
##### Details
\

This function internally calls [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) and [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` functions to form a character vector from the template passed in the [msg_template](#func.get_log4.args.msg_template) argument, using the values specified by the [arg1](#func.get_log4.args.arg1), [arg2](#func.get_log4.args.arg2), [arg3](#func.get_log4.args.arg3), and [arg4](#func.get_log4.args.arg4) arguments to replace all the occurrences of the placeholders *"%1"*, *"%2"*, *"%3"*, and *"%4"*, respectively, found in the template.

::: {.noteblock data-latex=""}
This is an auxiliary function intended for use in other custom logging functions, such as the [put_log4](#func.put_log4) (as shown in the [Usage](#func.get_log4.usage) section of *this Description*) and [print_log4](#func.print_log4) described below in *this Section*.
:::
:::

::: { #func.get_log4.value .sidebar }
##### Value
\

A glue object, returned by the internally called [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) function, created from the character vector returned by the (also internally called) function [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).

:::

::: { #func.get_log4.code .sidebar }
##### Source Code
\

The source code of the [get_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L72) function is shown below:
```{r eval=FALSE}
get_log4 <- function(msg_template, arg1, arg2, arg3, arg4) {
  msg_template |> 
    str_replace_all("%1", as.character(arg1)) |>
    str_replace_all("%2", as.character(arg2)) |>
    str_replace_all("%3", as.character(arg3)) |>
    str_replace_all("%4", as.character(arg4)) |>
    str_glue()
}
```

::: {.noteblock data-latex=""}
The source code of the [get_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L72) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L72) script on _GitHub_.
:::
:::

\newpage

#### [print_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L80) Function {#func.print_log4}
\

Prints a log created from the template passed in the [msg_template](#func.print_log4.args.msg_template) argument, using the values specified by the [arg1](#func.print_log4.args.arg1), [arg2](#func.print_log4.args.arg2), [arg3](#func.print_log4.args.arg3), and [arg4](#func.print_log4.args.arg4) arguments to replace all the occurrences of the placeholders *"%1"*, *"%2"*, *"%3"*, and *"%4"*, respectively, found in the template.

::: { #func.print_log4.usage .sidebar }
##### [Usage](https://www.pragmaticinstitute.com/resources/articles/data/4-important-aspects-of-data-science/)[@IADS_4]
\

```{r print_log4@example1}
arg1 <- "Data Collection"
arg2 <- "Data Cleaning and Transformation"
arg3 <- "Statistical Analysis"
arg4 <- "Data Visualization"

msg_template <- "The 4 Important Aspects of Data Science are as follows:
  1. %1;
  2. %2;
  3. %3;
  4. %4."

print_log4(msg_template, arg1, arg2, arg3, arg4)
```
:::

::: { #func.print_log4.args .sidebar }
##### Arguments
\

::: { #func.print_log4.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders *"%1"*, *"%2"*, *"%3"*, and *"%4"* to be replaced by the values specified by the [arg1](#func.print_log4.args.arg1),  [arg2](#func.print_log4.args.arg2), [arg3](#func.print_log4.args.arg3), and [arg4](#func.print_log4.args.arg4) arguments, respectively.

:::

::: { #func.print_log4.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder *"%1"* in the message template passed in the [msg_template](#func.print_log4.args.msg_template) argument. 

:::

::: { #func.print_log4.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder *"%2"* in the message template passed in the [msg_template](#func.print_log4.args.msg_template) argument. 

:::

::: { #func.print_log4.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder *"%3"* in the message template passed in the [msg_template](#func.print_log4.args.msg_template) argument. 

:::

::: { #func.print_log4.args.arg4 .sidebar }
  - **arg4:** Value to replace all occurrences of the placeholder *"%4"* in the message template passed in the [msg_template](#func.print_log4.args.msg_template) argument. 

:::
:::

::: { #func.print_log4.details .sidebar }
##### Details
\

This function internally calls the [base::print](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print) `R` function to print the object returned by the [get_log4](#func.get_log4) function (also called internally) described above.

:::

::: { #func.print_log4.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log4](#func.get_log4) described above.
:::

::: { #func.print_log4.code .sidebar }
##### Source Code
\

The source code of the [print_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L80) function is shown below:
```{r eval=FALSE}
print_log4 <- function(msg_template, arg1, arg2, arg3, arg4){
  print(get_log4(msg_template, arg1, arg2, arg3, arg4))
}
```

::: {.noteblock data-latex=""}
The source code of the [print_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L80) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L80) script on _GitHub_.
:::
:::

\newpage

#### [put_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L83) Function {#func.put_log4}
\

Outputs a log to the currently open log file (using the [open_logfile](#func.open_logfile) function described above), created from the template passed in the [msg_template](#func.put_log4.args.msg_template) argument, using the values specified by the [arg1](#func.put_log4.args.arg1), [arg2](#func.put_log4.args.arg2), [arg3](#func.put_log4.args.arg3), and [arg4](#func.put_log4.args.arg4) arguments to replace all the occurrences of the placeholders *"%1"*, *"%2"*, *"%3"*, and *"%4"*, respectively, found in the template.

::: { #func.put_log4.usage .sidebar }
##### [Usage](https://www.pragmaticinstitute.com/resources/articles/data/4-important-aspects-of-data-science/)[@IADS_4]
\

```{r put_log4@example1}
arg1 <- "Data Collection"
arg2 <- "Data Cleaning and Transformation"
arg3 <- "Statistical Analysis"
arg4 <- "Data Visualization"

msg_template <- "The 4 Important Aspects of Data Science are as follows:
  1. %1;
  2. %2;
  3. %3;
  4. %4."
```
```{r eval=FALSE}
put_log4(msg_template, arg1, arg2, arg3, arg4)
```
```{r, echo=FALSE}
print_log4(msg_template, arg1, arg2, arg3, arg4)
```
:::

::: { #func.put_log4.args .sidebar }
##### Arguments
\

::: { #func.put_log4.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of each of the placeholders *"%1"*, *"%2"*, *"%3"*, and *"%4"* to be replaced by the values specified by the [arg1](#func.put_log4.args.arg1),  [arg2](#func.put_log4.args.arg2), [arg3](#func.put_log4.args.arg3), and [arg4](#func.put_log4.args.arg4) arguments, respectively.

:::

::: { #func.put_log4.args.arg1 .sidebar }
  - **arg1:** Value to replace all occurrences of the placeholder *"%1"* in the message template passed in the [msg_template](#func.put_log4.args.msg_template) argument. 

:::

::: { #func.put_log4.args.arg2 .sidebar }
  - **arg2:** Value to replace all occurrences of the placeholder *"%2"* in the message template passed in the [msg_template](#func.put_log4.args.msg_template) argument. 

:::

::: { #func.put_log4.args.arg3 .sidebar }
  - **arg3:** Value to replace all occurrences of the placeholder *"%3"* in the message template passed in the [msg_template](#func.put_log4.args.msg_template) argument. 

:::

::: { #func.put_log4.args.arg4 .sidebar }
  - **arg4:** Value to replace all occurrences of the placeholder *"%4"* in the message template passed in the [msg_template](#func.put_log4.args.msg_template) argument. 

:::
:::

::: { #func.put_log4.details .sidebar }
##### Details
\

This function internally calls the [logr::put](https://www.rdocumentation.org/packages/logr/versions/1.3.4/topics/log_print) `R` function to output the log object returned by the (also called internally) [get_log4](#func.get_log4) function described above.

The function works similarly to the [print_log4](#func.print_log4) function described above, but unlike the latter, it outputs the information to the currently open log file.

:::

::: { #func.put_log4.value .sidebar }
##### Value
\

A glue object, returned by the internally called function [get_log4](#func.get_log4) described above.
:::

::: { #func.put_log4.code .sidebar }
##### Source Code
\

The source code of the [put_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L83) function is shown below:
```{r eval=FALSE}
put_log4 <- function(msg_template, arg1, arg2, arg3, arg4){
  put(get_log4(msg_template, arg1, arg2, arg3, arg4))
}
```

::: {.noteblock data-latex=""}
The source code of the [put_log4](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L83) function is defined in the [logging-functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/logging-functions.R#L83) script on _GitHub_.
:::
:::

\newpage

### Utility Functions {#appndx_a.CHF.utility_funcs}

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L445) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L445) script on _GitHub_.
:::

#### [clamp](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L448) Function {#func.clamp}
\

Clamps the input value passed in [r](#func.clamp.args.r) argument between the values passed in [min](#func.clamp.args.min) and [max](#func.clamp.args.max) arguments. 

::: { #func.clamp.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L347)
\

```{r main-script@l347u_clamp, eval=FALSE}
edx.user_effect.MSEs <- sapply(edx_CV, function(cv_fold_dat){
  cv_fold_dat$validation_set |>
    left_join(edx.user_effect, by = "userId") |>
    mutate(resid = rating - clamp(mu + a)) |> 
    pull(resid) |> mse()
})
```
```{r main-script@l355u_clamp}
data.frame(fold_No = 1:5, MSE = edx.user_effect.MSEs) |>
  data.plot(title = "MSE resuls of the 5-fold CV method applied to the User Effect Model",
            xname = "fold_No", 
            yname = "MSE")
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L355) above, we use the custom data visualization function [data.plot](#func.data.plot) described in section [Data Visualization Functions] of *this Appendix*.
:::
:::

::: { #func.clamp.args .sidebar }
##### Arguments
\

::: { #func.clamp.args.r .sidebar }
  - **r:** Value to clamp; 

:::
::: { #func.clamp.args.min .sidebar }
  - **min:** (Optional, 0.5 by default) Minimum allowed value; 

:::
:::
::: { #func.clamp.args.max .sidebar }
  - **max:** (Optional, 5 by default) Maximum allowed value; 

:::
:::

::: { #func.clamp.details .sidebar }
##### Details
\
As explained in [Section 24.1 *Case study: recommendation systems / User effects*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#user-effects) of the _Course Textbook_ we know ratings cannot be below 0.5 or above 5. For this reason, we need a function described in that section[@IDS2_24-1]:

This function is a wrapper for the [base::pmin](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/Extremes) and [base::pmax](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/Extremes) `R` functions, which are called internally to constrain the input value passed in the [r](#func.clamp.args.r) argument to be within the values passed in the [min](#func.clamp.args.min) and [max](#func.clamp.args.max) arguments, respectively.

in *this Project* this function is used to clamp the computed movie rating values between 0.5 and 5.
:::

::: { #func.clamp.value .sidebar }
##### Value
\

The value clamped between [min](#func.clamp.args.min) and [max](#func.clamp.args.max) argument values.

:::

::: { #func.clamp.code .sidebar }
##### Source Code
\

The source code of the [clamp](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L448) function is shown below:
```{r eval=FALSE}
clamp <- function(x, min = 0.5, max = 5) pmax(pmin(x, max), min)
```

::: {.noteblock data-latex=""}
The source code of the [clamp](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L448) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L445) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L448) script on _GitHub_.
:::
:::

\newpage

#### [msg.set_arg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L453) Function {#func.msg.set_arg}
\

Creates a character vector from the template passed in the [msg_template](#func.msg.set_arg.args.msg_template) argument, using the value specified by the [arg](#func.msg.set_arg.args.arg) argument to replace all the occurrences of the placeholder passed in the [arg.name](#func.msg.set_arg.args.arg.name) argument found in the template.

::: { #func.msg.set_arg.usage .sidebar }
##### Usage
\

```{r common-helper.func@l458, eval=FALSE}
  msg_template |>
    msg.set_arg(arg, arg.name) |>
    str_glue()
```

::: {.noteblock data-latex=""}
In the above [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L458), the `msg.set_arg` function is called internally from the [msg.glue](#func.msg.glue) function described below in *this Section*.
:::
:::

::: { #func.msg.set_arg.args .sidebar }
##### Arguments
\

::: { #func.msg.set_arg.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of a pattern specified by the [arg.name](#func.msg.set_arg.args.arg.name) argument.
  
:::

::: { #func.msg.set_arg.args.arg.name .sidebar }
  - **arg.name:** (Optional, *"%1"* by default) Substring (pattern or *placeholder*) to replace all occurrences found in the message template passed in the [msg_template](#func.msg.set_arg.args.msg_template) argument with the value specified in the [arg](#func.msg.set_arg.args.arg) argument.

:::

::: { #func.msg.set_arg.args.arg .sidebar }
  - **arg:** Value to replace all occurrences of the pattern specified by the [arg.name](#func.msg.set_arg.args.arg.name) argument in the message template passed in the [msg_template](#func.msg.set_arg.args.msg_template) argument.
  
:::
:::

::: { #func.msg.set_arg.details .sidebar }
##### Details
\

This function is a wrapper for the [stringr::str_replace_all](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace) `R` function, which is called internally to replace all occurrences of the pattern (placeholder) specified by the [arg_name](#func.msg.set_arg.args.arg.name) argument (*"%1"* by default), in the message template passed in the [msg_template](#func.msg.set_arg.args.msg_template) argument with the value specified in the [arg](#func.msg.set_arg.args.arg) argument.

::: {.noteblock data-latex=""}
This is an auxiliary function intended to be called internally from the [msg.glue](#func.msg.glue) function (described below in *this Section*) as shown above in the [Usage](#func.msg.set_arg.usage) section of *this Description*.
:::

:::

::: { #func.msg.set_arg.value .sidebar }
##### Value
\

The character vector returned by the internally called [stringr::str_replace_all()](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_replace).
:::

::: { #func.msg.set_arg.code .sidebar }
##### Source Code
\

The source code of the [msg.set_arg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L453) function is shown below:
```{r eval=FALSE}
msg.set_arg <- function(msg_template, arg, arg.name = "%1") {
  msg_template |> 
    str_replace_all(arg.name, as.character(arg))
}
```

::: {.noteblock data-latex=""}
The source code of the [msg.set_arg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L453) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L449) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L453) script on _GitHub_.
:::
:::

\newpage

#### [msg.glue](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L457) Function {#func.msg.glue}
\

Creates a [glue::glue](https://glue.tidyverse.org/reference/glue.html) object from the template passed in the [msg_template](#func.msg.glue.args.msg_template) argument, using the value specified by the [arg](#func.msg.glue.args.arg) argument to replace all the occurrences of the placeholder passed in the [arg.name](#func.msg.glue.args.arg.name) argument found in the template.
  
::: { #func.msg.glue.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L719)
\

```{r main-script@l719u_msg.glue, eval=FALSE}
#### Add a row to the RMSE Result Table for the Regularized User+Movie Effect Model --------
RMSEs.ResultTibble.rglr.UME <- RMSEs.ResultTibble.UME |> 
  RMSEs.AddRow("Regularized UME Model", 
               UME.rglr.retrain.RMSE,
               comment = "Computed for `lambda` = %1" |>
                 msg.glue(UME.rglr.best_lambda))
```
```{r main-script@l725u_msg.glue}
RMSE_kable(RMSEs.ResultTibble.rglr.UME)
```

::: {.noteblock data-latex=""}
In the *code snippet* above, we use the [RMSEs.AddRow](#func.RMSEs.AddRow) and [RMSE_kable](#func.RMSE_kable) functions described in section [Result RMSEs Tibble Functions] of *this Appendix*.
:::
:::

::: { #func.msg.glue.args .sidebar }
##### Arguments
\

::: { #func.msg.glue.args.msg_template .sidebar }
  - **msg_template:** Any object coercible to a character vector containing at least one message template element, i.e., a string (possibly multiline) containing at least one occurrence of a pattern specified by the [arg.name](#func.msg.glue.args.arg.name) argument.
  
:::

::: { #func.msg.glue.args.arg.name .sidebar }
  - **arg.name:** (Optional, *"%1"* by default) Substring (pattern or *placeholder*) to replace all occurrences found in the message template passed in the [msg_template](#func.msg.glue.args.msg_template) argument with the value specified in the [arg](#func.msg.glue.args.arg) argument.

:::

::: { #func.msg.glue.args.arg .sidebar }
  - **arg:** Value to replace all occurrences of the pattern specified by the [arg.name](#func.msg.glue.args.arg.name) argument in the message template passed in the [msg_template](#func.msg.glue.args.msg_template) argument.

:::
:::

::: { #func.msg.glue.details .sidebar }
##### Details
\

This function internally calls the [stringr::str_glue](https://www.rdocumentation.org/packages/stringr/versions/1.5.0/topics/str_glue) `R` function to format the character vector returned by the (also called internally) [msg.set_arg](#func.msg.set_arg) function described above in *this Section*.

:::

::: { #func.msg.glue.value .sidebar }
##### Value
\

A [glue::glue](https://glue.tidyverse.org/reference/glue.html) object created from the character vector returned by the internally called [msg.set_arg()](#func.msg.set_arg).

:::

::: { #func.msg.glue.code .sidebar }
##### Source Code
\

The source code of the [msg.glue](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L457) function is shown below:
```{r eval=FALSE}
msg.glue <- function(msg_template, arg, arg.name = "%1"){
  msg_template |>
    msg.set_arg(arg, arg.name) |>
    str_glue()
}
```

::: {.noteblock data-latex=""}
The source code of the [msg.glue](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L457) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L449) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L457) script on _GitHub_.
:::
:::

\newpage

### (Root) Mean Squared Error Calculation

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) script on _GitHub_.
:::

#### [mse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L5) Function {#func.mse}
\

Calculates *Mean Squared Error* of the set of *residuals* (passed in the [r](#func.mse.args.r) argument) as described in [Section 24.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_24-1_LF]. 

::: { #func.mse.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L347)
\

```{r main-script@l347u_mse, eval=FALSE}
edx.user_effect.MSEs <- sapply(edx_CV, function(cv_fold_dat){
  cv_fold_dat$validation_set |>
    left_join(edx.user_effect, by = "userId") |>
    mutate(resid = rating - clamp(mu + a)) |> 
    pull(resid) |> mse()
})
```
```{r}
data.frame(fold_No = 1:5, MSE = edx.user_effect.MSEs) |>
  data.plot(title = "MSE resuls of the 5-fold CV method applied to the User Effect Model",
            xname = "fold_No", 
            yname = "MSE")
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L355) above, we use the custom data visualization function [data.plot](#func.data.plot) described in section [Data Visualization Functions] of *this Appendix*.
:::
:::

::: { #func.mse.args .sidebar }
##### Arguments
\

::: { #func.mse.args.r .sidebar }
  - **r:** Numeric vector representing a set of *residuals* (for example of computing a *residuals* vector, see section [Usage](#func.mse.usage) of *this Description*. 

:::
:::

::: { #func.mse.code .sidebar }
##### Source Code
\

The source code of the [mse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L5) function is shown below:
```{r eval=FALSE}
mse <- function(r) mean(r^2)
```

::: {.noteblock data-latex=""}
The source code of the [mse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L5) function is also available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L5) script on _GitHub_.
:::
:::

\newpage

#### [mse_cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L6) Function {#func.mse_cv}
\

Calculates the average value of the *Mean Squared Errors* calculated with the use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: {.noteblock data-latex=""}
The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets] (in *this Project*, we use $K = 5$).
:::

::: { #func.mse_cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
mse_cv(r_list)

```
:::

::: { #func.mse_cv.args .sidebar }
##### Arguments
\

::: { #func.mse_cv.args.r_list .sidebar }
  - **r_list:** A list of numeric vectors, each representing a set of residuals as described in [Section 24.1 *Case Study: Recommender Systems / Loss Function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the *Course Textbook (New Edition)*[@IDS2_24-1_LF], computed in the corresponding iteration of *K-Fold Cross-Validation* (the $K$ is $5$ for *this Project*).

:::
:::

::: { #funcc.mse_cv.code .sidebar }
##### Source Code
\

The source code of the [mse_cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L6) function is shown below:
```{r eval=FALSE}
mse_cv <- function(r_list) {
  mses <- sapply(r_list, mse(r))
  mean(mses)
}
```

::: {.noteblock data-latex=""}
The source code of the [mse_cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L6) function is also available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L6) script on _GitHub_.
:::
:::

\newpage

#### [rmse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L10) Function {#func.rmse}
\

Calculates *Root Mean Squared Error* as described in [Section 24.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_24-1_LF]. 

::: { #func.rmse.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
rmse(r)

```
:::

::: { #func.rmse.args .sidebar }
##### Arguments
\

::: { #func.rmse.args.r .sidebar }
  - **r:** Numeric vector representing a set of residuals as described in [Section 24.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_24-1_LF]. 

:::
:::

::: { #func.rmse.code .sidebar }
##### Source Code
\

The source code of the [rmse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L10) function is shown below:
```{r eval=FALSE}
rmse <- function(r) sqrt(mse(r))
```

::: {.noteblock data-latex=""}
The source code of the [rmse](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L10) function is also available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L10) script on _GitHub_.
:::
:::

\newpage

#### [rmse2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L11) Function {#func.rmse2}
\

Calculates *Root Mean Squared Error* as described in [Section 24.1 *Case study: recommendation systems / Loss function*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#sec-netflix-loss-function) of the _Course Textbook (New Edition)_[@IDS2_24-1_LF]. 

::: { #func.rmse2.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
rmse2(true_ratings, predicted_ratings)

```
:::

::: { #func.rmse2.args .sidebar }
##### Arguments
\

::: { #func.rmse2.args.true_ratings .sidebar }
  - **true_ratings:** Numeric vector representing a set of *actual rating* values stored in the validation dataset. 

:::

::: { #func.rmse2.args.predicted_ratings .sidebar }
  - **predicted_ratings:** A numeric vector representing a set of *predicted rating* values computed from the data stored in the test dataset. 

:::
:::

::: { #func.rmse2.code .sidebar }
##### Source Code
\

The source code of the [rmse2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L11) function is shown below:
```{r eval=FALSE}
rmse2 <- function(true_ratings, predicted_ratings) {
  rmse(true_ratings - predicted_ratings)
}
```

::: {.noteblock data-latex=""}
The source code of the [rmse2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L11) function is also available in the [(R)MSE-related functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L11) script on _GitHub_.
:::
:::

\newpage

### Result RMSEs Tibble Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) script on _GitHub_.
:::

#### [CreateRMSEs_ResultTibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L16) Function {#func.CreateRMSEs_ResultTibble}
\

Creates a _RMSEs Result Tibble_ of type *data frame*.

::: { #func.CreateRMSEs_ResultTibble.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L87)
\

```{r main-script@l87u, eval=FALSE}
# Create the table and add a first row for the Project Objective
RMSEs.ResultTibble <- CreateRMSEs_ResultTibble()
```
:::

::: { #func.CreateRMSEs_ResultTibble.details .sidebar }
##### Details
\

This function is a wrapper for the [tibble::tibble](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/tibble) function, which is called internally to construct a data frame object representing the _RMSEs Result Tibble_ to store the _RMSE_ values for every model used in the project to predict movie ratings.

The result data frame, which is returned to the client code, has the following columns:

  - *Method* (chr);
  - *RMSE* (num);
  - *Comment* (chr)

::: { #func.CreateRMSEs_ResultTibble.value .sidebar }
##### Value
\

A tibble returned by the internally called [tibble::tibble()](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/tibble)

:::


::: { #func.CreateRMSEs_ResultTibble.code .sidebar }
##### Source Code
\

The source code of the [CreateRMSEs_ResultTibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L16) function is shown below:
```{r eval=FALSE}
CreateRMSEs_ResultTibble <- function(){
  tibble(Method = c("Project Objective"),
         RMSE = project_objective,
         Comment = " ")
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [CreateRMSEs_ResultTibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L16) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L16) script on _GitHub_.
:::

\newpage

#### [RMSEs.AddRow](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L21) Function {#func.RMSEs.AddRow}
\

Adds a row to the original _RMSEs Result Tibble_ passed in the [RMSEs](#func.RMSEs.AddRow.args.RMSEs) argument.

::: { #func.RMSEs.AddRow.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L199)
\

```{r main-script@l199u, eval=FALSE}
### Add a row to the RMSE Result Tibble ---------------------------------------- 
RMSEs.ResultTibble.OMR <- RMSEs.ResultTibble |> 
  RMSEs.AddRow("OMR Model", 
               mu.RMSE,
               comment = "Overall Mean Rating (OMR) Model")
```
```{r main-script@l205u.add_row}
RMSE_kable(RMSEs.ResultTibble.OMR)
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L205) above, we use the [RMSE_kable](#func.RMSE_kable) functions described below in *this Section*.
:::
:::

::: { #func.RMSEs.AddRow.args .sidebar }
##### Arguments
\

::: { #func.RMSEs.AddRow.args.RMSEs .sidebar }
  - ***RMSEs:*** Original _RMSEs Result Tibble_ (of type *data frame*) to modify;

:::

::: { #func.RMSEs.AddRow.args.method .sidebar }
  - ***method:*** The _Method or Model_ being evaluated;

:::

::: { #func.RMSEs.AddRow.args.value .sidebar }
  - ***value:*** The _Root Mean Squared Error (RMSE)_ value;

:::

::: { #func.RMSEs.AddRow.args.comment .sidebar }
  - ***comment:*** (Optional, *Empty string* by default) Detailed information about the record or any other comment (if needed);

:::

::: { #func.RMSEs.AddRow.args.before .sidebar }
  - ***before:*** (Optional, *Integer*, `NULL` by default) One-based row index where to add the new rows, if NULL (default): after last row;

:::
:::

::: { #func.RMSEs.AddRow.code.details .sidebar }
##### Details
\

This function is a wrapper for the [tibble::add_row](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/add_row) function, which is called internally to modify a data frame object representing the original _RMSEs Result Tibble_, which stores the _RMSE_ values for the models used in the project to predict movie ratings.

For more information about the _RMSEs Result Tibble_, see the [Details](#func.CreateRMSEs_ResultTibble.details) section of the [CreateRMSEs_ResultTibble](#func.CreateRMSEs_ResultTibble) function description above.

:::

::: { #func.RMSEs.AddRow.value .sidebar }
##### Value
\

The modified tibble returned by the internally called [tibble::add_row()](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/add_row).

:::


::: { #func.RMSEs.AddRow.code .sidebar }
##### Source Code
\

The source code of the [RMSEs.AddRow](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L21) function is shown below:
```{r eval=FALSE}
RMSEs.AddRow <- function(RMSEs, 
                         method, 
                         value, 
                         comment = "", 
                         before = NULL){
  RMSEs |>
    add_row(Method = method,
            RMSE = value,
            Comment = comment,
            .before = before)
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RMSEs.AddRow](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L21) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L21) script on _GitHub_.
:::

\newpage

#### [RMSEs.AddDiffColumn](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) Function {#func.RMSEs.AddDiffColumn}
\

Adds a calculated column named _Diff_ to the _RMSEs Result Tibble_ (passed in the [RMSEs](#func.RMSEs.AddDiffColumn.args.RMSEs) argument) that contains, for each row, the difference between the value of the _RMSE_ column for the previous row and the value of the same column for the current row. This is true for each row except the first, for which the value is always zero.

::: { #func.RMSEs.AddDiffColumn.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L2389)
\

```{r main-script@l2389u, eval=FALSE}
total.RMSEs.ResultTibble <- RMSEs.AddDiffColumn(final.MF.RMSEs.ResultTibble)
```
```{r main-script@l2390u.add_diff_column}
RMSE.Total_kable(total.RMSEs.ResultTibble)
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L2390) above, we use the [RMSE.Total_kable](#func.RMSE.Total_kable) functions described below in *this Section*.
:::
:::

::: { #func.RMSEs.AddDiffColumn.args .sidebar }
##### Arguments
\

::: { #func.RMSEs.AddDiffColumn.args.RMSEs .sidebar }
  - ***RMSEs:*** _RMSEs Result Tibble_ to modify;

:::
:::

::: { #func.RMSEs.AddDiffColumn.details .sidebar }
##### Details
\

This function is a wrapper for the [tibble::add_column](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/add_column) function, which is called internally to modify a data frame object representing the original _RMSEs Result Tibble_. It also internally uses the [RMSEs.AddRow](#func.RMSEs.AddRow) function described above to perform the necessary intermediate calculations.

For more information about the _RMSEs Result Tibble_, see the [Details](#func.CreateRMSEs_ResultTibble.details) section of the [CreateRMSEs_ResultTibble](#func.CreateRMSEs_ResultTibble) function description above.
:::


::: { #func.RMSEs.AddRow.value .sidebar }
##### Value
\

The modified tibble returned by the internally called [tibble::add_column()](https://www.rdocumentation.org/packages/tibble/versions/3.2.1/topics/add_column).
:::

::: { #func.RMSEs.AddDiffColumn.code .sidebar }
##### Source Code
\

The source code of the [RMSEs.AddDiffColumn](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) function is shown below:
```{r eval=FALSE}
RMSEs.AddDiffColumn <- function(RMSEs){
  RMSEs.Diff <- RMSEs |>
    RMSEs.AddRow(NULL, project_objective, before = 1) #|>

  RMSEs.Diff <- RMSEs.Diff[-nrow(RMSEs.Diff),]
    
  RMSEs |>
  add_column(Diff = RMSEs.Diff$RMSE - RMSEs$RMSE, 
             .before = "Comment")
  
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RMSEs.AddDiffColumn](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) script on _GitHub_.
:::

#### [RSME.tibble.col_width](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L66) Function {#func.RSME.tibble.col_width}
\

Converts the _RMSEs Result Tibble_ column width value passed in argument [x](#func.RSME.tibble.col_width.args.x) to a character string compatible for use as the `width` argument value to pass to the [kableExtra::column_spec](https://www.rdocumentation.org/packages/kableExtra/versions/1.3.4/topics/column_spec) function.

::: { #func.RSME.tibble.col_width.usage .sidebar }
##### Usage
\

```{r common-helper.func@l47u, eval=FALSE}
  RMSEs |>
    kable(align='lcl', booktabs = T, padding = 5) |> 
    row_spec(0, bold = T) |>
    column_spec(column = 1, width = RSME.tibble.col_width(col1width)) |>
    column_spec(column = 2, width = RSME.tibble.col_width(col2width)) |>
    column_spec(column = 3, width = RSME.tibble.col_width(col3width)) 
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L47) above, the function `RSME.tibble.col_width` is called internally from the [RMSE_kable](#func.RMSE_kable) function described below in *this Section*.
:::
:::

::: { #func.RSME.tibble.col_width.args .sidebar }
##### Arguments
\

::: { #func.RSME.tibble.col_width.args.x .sidebar }
  - ***x:*** (Numeric) Column width value to be formatted;

:::
:::

::: { #func.RSME.tibble.col_width.details .sidebar }
##### Details
\

This is a utility function, a wrapper for the [msg.glue](#func.msg.glue) function described in section [Utility Functions] of *this Appendix*, which is called internally to format the value passed in argument [x](#func.RSME.tibble.col_width.args.x) for subsequent passing to the function [kableExtra::column_spec](https://www.rdocumentation.org/packages/kableExtra/versions/1.3.4/topics/column_spec) as a value of the `width` argument.

::: {.noteblock data-latex=""}
As a utility, this function is intended for use in other user-defined functions, such as the [RMSE_kable](#func.RMSE_kable) (as shown above in the [Usage](#func.RSME.tibble.col_width.usage) section of *this Description*) and [RMSE.Total_kable](#func.RMSE.Total_kable) described below in *this Section*.
:::
:::

::: { #func.RSME.tibble.col_width.value .sidebar }
##### Value
\

A character string representing the formatted column width value.
:::


::: { #func.RSME.tibble.col_width.code .sidebar }
##### Source Code
\

The source code of the [RSME.tibble.col_width](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L66) function is shown below:
```{r eval=FALSE}
RSME.tibble.col_width <- function(x){
  "%1em" |> msg.glue(x)
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RSME.tibble.col_width](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L66) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L66) script on _GitHub_.
:::

\newpage

#### [RMSE_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L43) Function {#func.RMSE_kable}
\

Prints the _RMSEs Result Tibble_.

::: {.noteblock data-latex=""}
It is assumed that the tibble has the following three columns:
  
  1. *Method*;
  2. *RMSE*;
  3. *Comment*;
  
:::

::: { #func.RMSE_kable.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L205)
\

```{r main-script@l205u}
RMSE_kable(RMSEs.ResultTibble.OMR)
```
:::

::: { #func.RMSE_kable.args .sidebar }
##### Arguments
\

::: { #func.RMSE_kable.args.RMSEs .sidebar }
  - ***RMSEs:*** _RMSEs Result Tibble_ to print;

:::

::: { #func.RMSE_kable.args.col1width .sidebar }
  - ***col1width:*** Width of the first column (Optional, 15 by default);

:::

::: { #func.RMSE_kable.args.col2width .sidebar }
  - ***col2width:*** Width of the second column (Optional, 5 by default);

:::

::: { #func.RMSE_kable.args.col3width .sidebar }
  - ***col3width:*** Width of the third column (Optional, 30 by default).

:::
:::

::: { #func.RMSE_kable.details .sidebar }
##### Details
\

This function is a wrapper for the [knitr::kable](https://www.rdocumentation.org/packages/knitr/versions/1.43/topics/kable) function, which is called internally to create a table (based on the _RMSEs Result Tibble_ data), formatted for output in the project report.

The [kableExtra::column_spec](https://www.rdocumentation.org/packages/kableExtra/versions/1.3.4/topics/column_spec) function, along with the [RSME.tibble.col_width](#func.RSME.tibble.col_width) function described above, are also used internally to specify the width of the table columns.

For more information about the _RMSEs Result Tibble_, see the [Details](#func.CreateRMSEs_ResultTibble.details) section of the [CreateRMSEs_ResultTibble](#func.CreateRMSEs_ResultTibble) function description above.
:::

::: { #func.RMSE_kable.value .sidebar }
##### Value
\

The table created by the internally called [knitr::kable()](https://www.rdocumentation.org/packages/knitr/versions/1.43/topics/kable).

:::


::: { #func.RMSE_kable.code .sidebar }
##### Source Code
\

The source code of the [RMSE_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L43) function is shown below:
```{r eval=FALSE}
RMSE_kable <- function(RMSEs,
                       col1width = 15,
                       col2width = 5,
                       col3width = 30){
  RMSEs |>
    kable(align='lcl', booktabs = T, padding = 5) |> 
    row_spec(0, bold = T) |>
    column_spec(column = 1, width = RSME.tibble.col_width(col1width)) |>
    column_spec(column = 2, width = RSME.tibble.col_width(col2width)) |>
    column_spec(column = 3, width = RSME.tibble.col_width(col3width)) 
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RMSE_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L43) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L43) script on _GitHub_.
:::

\newpage


#### [RMSE.Total_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L54) Function {#func.RMSE.Total_kable}
\

Prints the _Final RMSEs Result Tibble_.

::: {.noteblock data-latex=""}
It is assumed that the tibble has the following four columns:
  
1. *Method*;
2. *RMSE*;
3. *Diff*;
4. *Comment*;
  
:::

::: { #func.RMSE.Total_kableusage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L2390)
\

```{r main-script@l2390u}
RMSE.Total_kable(total.RMSEs.ResultTibble)
```
:::

\newpage

::: { #func.RMSE.Total_kable.args .sidebar }
##### Arguments
\

::: { #func.RMSE.Total_kable.args.RMSEs .sidebar }
  - ***RMSEs:*** The _Final RMSEs Result Tibble_ to print;

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col1width:*** (Optional, 15 by default) Width of the first column;

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col2width:*** (Optional, 7 by default) Width of the second column;

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col3width:*** (Optional, 5 by default) Width of the third column;

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col4width:*** (Optional, 25 by default) Width of the fourth column;

:::
:::

::: { #func.RMSE.Total_kable.details .sidebar }
##### Details
\

This function is a wrapper for the [RMSE_kable](#func.RMSE_kable) function described above, which is called internally to print the table, created from the final _RMSEs Result Tibble_ data.

It is assumed that the  _Final RMSEs Result Tibble_ is previously constructed from the original _RMSEs Result Tibble_ using the [RMSEs.AddDiffColumn](#func.RMSEs.AddDiffColumn) function described above.

The [kableExtra::column_spec](https://www.rdocumentation.org/packages/kableExtra/versions/1.3.4/topics/column_spec) function, along with the [RSME.tibble.col_width](#func.RSME.tibble.col_width) function described above, are also used internally to set the width of the last column of the table.

For more information about the _RMSEs Result Tibble_, see the [Details](#func.CreateRMSEs_ResultTibble.details) section of the [CreateRMSEs_ResultTibble](#func.CreateRMSEs_ResultTibble) function description above.
:::

::: { #func.RMSE.Total_kable.value .sidebar }
##### Value
\

The table returned by the internally called [RMSE_kable()](#func.RMSE_kable).
:::

::: { #func.RMSE.Total_kable.code .sidebar }
##### Source Code
\

The source code of the [RMSE.Total_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L54) function is shown below:
```{r eval=FALSE}
RMSE.Total_kable <- function(RMSEs,
                       col1width = 15,
                       col2width = 7,
                       col3width = 5, 
                       col4width = 25){
  RMSEs |> 
    RMSE.Total_kable(col1width,
               col2width,
               col3width) |>
    column_spec(column = 4, 
                width = RSME.tibble.col_width(col4width)) 
}
```
:::

::: {.noteblock data-latex=""}
The source code of the [RMSE.Total_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L54) function is also available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L15) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L54) script on _GitHub_.
:::

\newpage

### Model Tuning Utils {#appndx_a.CHF.model_tuning_utils}
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) script on _GitHub_.
:::

#### [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) Function {#func.mean_reg}
\

Calculates the arithmetic mean taking into account the _regularization parameter_ $\lambda$ passed in the [lambda](#func.mean_reg.args.lambda) argument. We will call it the _penalized mean_.

::: { #func.mean_reg.usage .sidebar }
##### Usage
\

```{r UM-effect.func@l10, eval=FALSE}
  UM.effect <- train_set |>
    left_join(edx.user_effect, by = "userId") |>
    mutate(resid = rating - (mu + a)) |> 
    group_by(movieId) |>
    summarise(b = mean_reg(resid, lambda), n = n())
```

::: {.noteblock data-latex=""}
In the [sample code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L10) above, the `mean_reg` function is called internally from the [train_user_movie_effect](#func.train_user_movie_effect) function described below in section [UME Model: Utility Functions] of *this Appendix*.
:::
:::

::: { #func.mean_reg.args .sidebar }
##### Arguments
\

::: { #func.mean_reg.args.vals .sidebar }
  - **vals:** Values (usually a numeric vector) to calculate the _penalized mean_;

:::
::: { #func.mean_reg.args.lambda .sidebar }
  - **lambda:** (Optional, *Numeric*, 0 by default) _Regularization parameter_ $\lambda$. 

:::
::: { #func.mean_reg.args.na.rm .sidebar }
  - **na.rm:** (Optional, *Boolean*, `TRUE` by default) Logical value indicating whether `NA` values should be stripped before the computation proceeds.

:::
:::

\newpage

::: { #func.mean_reg.details .sidebar }
##### Details
\

This function is used in the *regularization technique* (described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2]) to calculate the _penalized mean_ of the values passed in the [vals](#func.mean_reg.args.vals) argument as follows:
$$
\mu(\lambda) = \frac{1}{\lambda + N} \sum_{i=1}^{N} x_i
$$

::: {.noteblock data-latex=""}
This is a helper function intended for use in other helper functions (such as, for instance, [train_user_movie_effect](#func.train_user_movie_effect) as shown above in the [Usage](#func.mean_reg.usage) section of *this Description*) that compute *penalized estimates* during the *regularization* process of the models being trained[@IDS2_24-2]. All these functions are described below in section [Models Training: Support Functions] of *this Appendix*.
:::

When the [lambda](#func.mean_reg.args.lambda) parameter is `0` (meaning the $\lambda = 0$), the function calculates the simple arithmetic mean:
$$
\mu = \frac{1}{N} \sum_{i=1}^{N} x_i
$$

::: {.noteblock data-latex=""}
If the [lambda](#func.mean_reg.args.lambda) parameter is `0` (the default), the function is equivalent to the standard R function [base::mean](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/mean), calling with the parameter `trim = 0` (the default for the `base::mean` function).
:::
:::

::: { #func.mean_reg.value .sidebar }
##### Value
\

(Numeric) *Penalized mean* of the values passed in the [vals](#func.mean_reg.args.vals) argument.
:::

::: { #func.mean_reg.code .sidebar }
##### Source Code
\

The source code of the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) function is shown below:
```{r eval=FALSE}
mean_reg <- function(vals, lambda = 0, na.rm = TRUE){
  if (is.na(lambda)) {
    stop("Function: mean_reg
`lambda` is `NA`")
  }
  
  names(lambda) <- NULL
  sums <- sum(vals, na.rm = na.rm)
  N <- ifelse(na.rm, sum(!is.na(vals)), length(vals))
  sums/(N + lambda)
}
```

::: {.noteblock data-latex=""}
The source code of the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) script on _GitHub_.
:::
:::


\newpage

#### [get_fine_tune.param.endpoints.idx](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L81) Function {#func.get_fine_tune.param.endpoints.idx}
\

Implements an algorithm that finds in the *RMSE* column of the data frame passed in the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument the indices of the pair of the nearest neighboring elements with values greater than the minimum to the left and right of the element (or group of elements) with the minimum value.

::: {.noteblock data-latex=""}
The algorithm assumes that the set of values in the *RMSE* column is a monotonically non-increasing function of the index until the minimum is reached and monotonically non-decreasing thereafter. That is, it is assumed that the function has only one minimum on the given set.
:::


::: { #func.get_fine_tune.param.endpoints.idx.usage .sidebar }
##### Usage
\

The following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L571) creates the object `cv.UME.preset.result` as a result of the [tune.model_param](#func.tune.model_param) function call, which we can subsequently use to extract a value to pass in the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument to the function *being described here*:
```{r main-script@l571u.ft_param_endpoints.idx, eval=FALSE}
lambdas <- seq(0, 1, 0.1)
cv.UME.preset.result <- 
  tune.model_param(lambdas, regularize.test_lambda.UM_effect.cv)
```
```{r}
str(cv.UME.preset.result)
```

::: {.noteblock data-latex=""}
The *custom helper function* [tune.model_param](#func.tune.model_param) used in the *code snippet above* is described below in *this Section*.
:::

The following code snippet provides an example of passing the data contained in the object created in the *code snippet above* to the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument of the function *being described*:
```{r common-helper.func@l111}
  preset.result <- cv.UME.preset.result$tuned.result
  print(preset.result)
  
  # Internal call from the user-defined function `get_fine_tune.param.endpoints` 
  preset.result.idx <- get_fine_tune.param.endpoints.idx(preset.result)
  preset.result.idx
```

::: {.noteblock data-latex=""}
In the above [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L111), the `get_fine_tune.param.endpoints.idx` function is called internally from the [get_fine_tune.param.endpoints](#func.get_fine_tune.param.endpoints) function described below in *this Section*.
:::
:::

::: { #func.get_fine_tune.param.endpoints.idx.args .sidebar }
##### Arguments
\

::: {#func.get_fine_tune.param.endpoints.idx.args.preset.result .sidebar }
* **preset.result:** Data frame that has an *RMSE* column containing the `RMSE` values corresponding to the *regularization parameter* $\lambda$ values for the model being regularized, as described in section [Details](#func.tune.model_param.details) of the [tune.model_param](#func.tune.model_param) function description below.

:::
:::

::: { #func.get_fine_tune.param.endpoints.idx.details .sidebar }
##### Details
\

This is an auxiliary function intended to be called internally from the other user-defined functions, such as the [get_fine_tune.param.endpoints](#func.get_fine_tune.param.endpoints) (as shown above in the [Usage](#func.get_fine_tune.param.endpoints.idx.usage) section of *this Description*) and [model.tune.param_range](#func.model.tune.param_range) (both described below in *this Section*).

::: {.noteblock data-latex=""}
The element stored in the `$tuned.result` variable of the *list* object returned by the [tune.model_param](#func.tune.model_param) function (described below *in this Section*), is a *data frame* suitable for use as the value of the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument.
:::

::: { #func.get_fine_tune.param.endpoints.idx.value .sidebar }
##### Value
\

Vector containing the index of the first element corresponding to the minimum `RMSE` value in the *RMSE* column of the data frame passed in the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument, along with the indices of the pair of the nearest neighboring elements with values greater than the minimum to the left and right of the element (or group of elements) with the minimum value:
```{r eval=FALSE}
  c(start, # interval start index
    end,   # interval end index
    best)  # index of the best `RMSE`
```

The [Usage](#func.get_fine_tune.param.endpoints.idx.usage) section of *this Description* above provides an example of the value returned by the function *being described*.
:::

\newpage

::: { #func.get_fine_tune.param.endpoints.idx.code .sidebar }
##### Source Code
\

The source code of the [get_fine_tune.param.endpoints.idx](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L81) function is shown below:
```{r eval=FALSE}
get_fine_tune.param.endpoints.idx <- function(preset.result) {
  best_RMSE <- min(preset.result$RMSE)
  best_RMSE.idx <- which.min(preset.result$RMSE)
  # best_lambda <- preset.result$parameter.value[best_RMSE.idx]
  
  preset.result.N <- length(preset.result$RMSE)
  i <- best_RMSE.idx
  j <- i
  
  while (i > 1) {
    i <- i - 1
    
    if (preset.result$RMSE[i] > best_RMSE) {
      break
    }
  }
  
  while (j < preset.result.N) {
    j <- j + 1
    
    if (preset.result$RMSE[j] > best_RMSE) {
      break
    }
  }
  
  c(start = i, 
    end = j,
    best = best_RMSE.idx)
}

```

::: {.noteblock data-latex=""}
The source code of the [get_fine_tune.param.endpoints.idx](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L81) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L81) script on _GitHub_.
:::
:::

\newpage

#### [get_fine_tune.param.endpoints](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L109) Function {#func.get_fine_tune.param.endpoints}
\

Implements an algorithm that finds in the *RMSE* column of the data frame passed in the [preset.result](#func.get_fine_tune.param.endpoints.args.preset.result) argument the pair of the nearest neighboring elements with values greater than the minimum to the left and right of the element (or group of elements) with the minimum value.

::: {.noteblock data-latex=""}
The algorithm assumes that the set of values in the *RMSE* column is a monotonically non-increasing function of the index until the minimum is reached and monotonically non-decreasing thereafter. That is, it is assumed that the function has only one minimum on the given set.
:::


::: { #func.get_fine_tune.param.endpoints.usage .sidebar }
##### Usage
\

The following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L571) creates the object `cv.UME.preset.result` as a result of the [tune.model_param](#func.tune.model_param) function call, which we can subsequently use to extract a value to pass in the [preset.result](#func.get_fine_tune.param.endpoints.args.preset.result) argument to the function *being described here*:
```{r main-script@l571u.ft_param_endpoints, eval=FALSE}
lambdas <- seq(0, 1, 0.1)
cv.UME.preset.result <- 
  tune.model_param(lambdas, regularize.test_lambda.UM_effect.cv)
```
```{r}
str(cv.UME.preset.result)

# Object to be passed to the `preset.result` argument of the `get_fine_tune.param.endpoints` function:
print(cv.UME.preset.result$tuned.result)
```

::: {.noteblock data-latex=""}
The *custom helper function* [tune.model_param](#func.tune.model_param) used in the *code snippet above* is described below in *this Section*.
:::

\newpage

In the following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L608), the data stored in the `$tuned.result` variable of the *list* object returned by the [tune.model_param](#func.tune.model_param) function in the *code snippet above*, is passed in the [preset.result](#func.get_fine_tune.param.endpoints.args.preset.result) argument to the function *being described*: 
```{r main-script@l608u}
endpoints <- 
  get_fine_tune.param.endpoints(cv.UME.preset.result$tuned.result)

endpoints
```

:::

::: { #func.get_fine_tune.param.endpoints.args .sidebar }
##### Arguments
\

::: {#func.get_fine_tune.param.endpoints.args.preset.result .sidebar }
* **preset.result:** Data frame that has an *RMSE* column containing the `RMSE` values corresponding to the *regularization parameter* $\lambda$ values for the model being regularized, as described in section [Details](#func.tune.model_param.details) of the [tune.model_param](#func.tune.model_param) function description below.

:::
:::

::: { #func.get_fine_tune.param.endpoints.details .sidebar }
##### Details
\

This function internally calls [get_fine_tune.param.endpoints.idx](#func.get_fine_tune.param.endpoints.idx) function described above in *this Section* to figure out the indices of the elements, the values of which have to be determined.

::: {.noteblock data-latex=""}
The element stored in the `$tuned.result` variable of the *list* object returned by the [tune.model_param](#func.tune.model_param) function (described below *in this Section*), is a *data frame* suitable for use as the value of the [preset.result](#func.get_fine_tune.param.endpoints.args.preset.result) argument.
:::

::: { #func.get_fine_tune.param.endpoints.value .sidebar }
##### Value
\

Vector containing the *regularization parameter* $\lambda$ value corresponding to the first element with the minimum `RMSE` value in the *RMSE* column of the data frame passed in the [preset.result](#func.get_fine_tune.param.endpoints.args.preset.result) argument, along with the pair of the $\lambda$ values corresponding to the nearest neighboring elements with values greater than the minimum `RMSE` to the left and right of the element (or group of elements) with the minimum `RMSE` value:

The [Usage](#func.get_fine_tune.param.endpoints.usage) section of *this Description* above provides an example of the value returned by the function *being described*.
:::

\newpage

::: { #func.get_fine_tune.param.endpoints.code .sidebar }
##### Source Code
\

The source code of the [get_fine_tune.param.endpoints](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L109) function is shown below:
```{r eval=FALSE}
get_fine_tune.param.endpoints <- function(preset.result) {

  preset.result.idx <- get_fine_tune.param.endpoints(preset.result)
  
  i <- preset.result.idx["start"]
  j <- preset.result.idx["end"]
  best.idx <- preset.result.idx["best"]
  
  c(start = preset.result$parameter.value[i], 
    end = preset.result$parameter.value[j],
    best = preset.result$parameter.value[best.idx])
}
```

::: {.noteblock data-latex=""}
The source code of the [get_fine_tune.param.endpoints](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L109) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L109) script on _GitHub_.
:::
:::

\newpage

#### [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L121) Function {#func.get_best_param.result}
\

Selects the best values from a pair of matched vectors: a vector of sorted *tuning parameter* values and a vector of corresponding *Root Mean Squared Errors (RMSE)* values passed in the [param_values](#func.get_best_param.result.args.param_values) and [RMSEs](#func.get_best_param.result.args.RMSEs) arguments, respectively.


::: { #func.get_best_param.result.usage .sidebar }
##### Usage
\

In the following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L413), the `get_best_param.result` function is called internally from the [model.tune.param_range](#func.model.tune.param_range) function described below in *this Section*:
```{r common-helper.func@l413u, eval=FALSE}
    param_values.best_result <- 
      get_best_param.result(tuned.result$parameter.value, 
                          tuned.result$RMSE)
    
    put_log2("Function `model.tune.param_range`:
Currently reached best RMSE for `parameter value = %1`: %2",
             param_values.best_result["param.best_value"],
             param_values.best_result["best_RMSE"])
```

::: {.noteblock data-latex=""}
In the code snippet above, we use the custom function [put_log2](#func.put_log2) described in section [Logging Functions] of *this Appendix*.
:::  
:::

::: { #func.get_best_param.result.args .sidebar }
##### Arguments
\

::: { #func.get_best_param.result.args.param_values .sidebar }
  - **param_values:** *Numeric vector* containing a sorted list of the *tuning parameter* values to search for the best one during the *Model Regularization* process; 

:::
::: { #func.get_best_param.result.args.RMSEs .sidebar }
  - **RMSEs:** *Numeric vector* containing a list of *RMSE* values computed during the *Model Regularization* process. 

:::
:::

::: { #func.get_best_param.result.details .sidebar }
##### Details
\

This is a *auxiliary function* used to select the *best values* during the *Model Parameter Tuning* process (including the *Model Regularization* procedure that utilizes the *penalized approach* to regularize predictions as explained in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2]).

With this approach, the best value of the *tuning parameter* is considered to be the value corresponding to the minimum value of the *RMSE* for the model being tested.

::: {.noteblock data-latex=""}
In *This Project*, this function is used internally in the [model.tune.param_range](#func.model.tune.param_range) custom helper function (as shown above in the [Usage](#func.get_best_param.result.usage) section of *this Description*) described below in *this Section*.
:::
:::

::: { #func.get_best_param.result.value .sidebar }
##### Value
\

*Numeric vector* containing a pair of values: the *best tuning parameter* value and corresponding *minimal RMSE*. 
:::

::: { #func.get_best_param.result.code .sidebar }
##### Source Code
\

The source code of the [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L121) function is shown below:
```{r eval=FALSE}
get_best_param.result <- function(param_values, RMSEs){
  best_pvalue_idx <- which.min(RMSEs)
  c(param.best_value = param_values[best_pvalue_idx], 
    best_RMSE = RMSEs[best_pvalue_idx])
}
```

::: {.noteblock data-latex=""}
The source code of the [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L121) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L121) script on _GitHub_.
:::
:::

\newpage


#### [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L126) Function {#func.tune.model_param}
\

Implements an algorithm for selecting the best value of the *tuning parameter* from the sorted *parameter vector* passed in the [param_values](#func.tune.model_param.args.param_values) argument.

::: { #func.tune.model_param.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L571)
\

```{r main-script@l571u.tune.model_param, eval=FALSE}
  lambdas <- seq(0, 1, 0.1)
  cv.UME.preset.result <- 
    tune.model_param(lambdas, regularize.test_lambda.UM_effect.cv)
```
```{r}
print(cv.UME.preset.result)
```
::: {.noteblock data-latex=""}
In the *code snippet* above, the `tune.model_param` function accepts a pointer to the auxiliary function [regularize.test_lambda.UM_effect.cv](#func.regularize.test_lambda.UM_effect.cv) (described below in section [UME Model: Regularization] of *this Appendix*), as a value of an argument [fn_tune.test.param_value](#func.tune.model_param.args.fn_tune.test.param_value).
:::
:::

::: { #func.tune.model_param.args .sidebar }
##### Arguments
\

::: { #func.tune.model_param.args.param_values .sidebar }
  - **param_values:** Numeric vector containing a sorted list of parameter values to search for the best one during the model regularization process; 

:::

::: { #func.tune.model_param.args.fn_tune.test.param_value .sidebar }
  - **fn_tune.test.param_value:** Model-specific helper function that validates the model by computing the model's *RMSE* value for a given parameter value; 

:::

::: { #func.tune.model_param.args.break.if_min .sidebar }
  - **break.if_min:** (Optional, `TRUE` by default) Boolean value that determines whether the algorithm should terminate after completing the number of steps specified by the [steps.beyond_min](#func.tune.model_param.args.steps.beyond_min) argument from the moment the minimum `RMSE` value is found;

:::

::: { #func.tune.model_param.args.steps.beyond_min .sidebar }
  - **steps.beyond_min:** (Optional, 2 by default; only takes effect if [break.if_min](#func.tune.model_param.args.break.if_min) is `TRUE`) Specifies the number of steps after finding the minimum *RMSE* value after which the algorithm should terminate.

:::
:::

::: { #func.tune.model_param.details .sidebar }
##### Details
\

With the approach used in this algorithm, the best value of the *tuning parameter* is considered to be the value corresponding to the minimum value of the *Root Mean Square Error (RMSE)* for the model being tested.

To find the best value, the algorithm iterates over the values from the list passed in the [param_values](#func.tune.model_param.args.param_values) argument, computing the *RMSE* of the model for each of them, using the helper function specified in the [fn_tune.test.param_value](#func.tune.model_param.args.fn_tune.test.param_value) argument.

The algorithm continues iterating until the end of the parameter values list if [break.if_min](#func.tune.model_param.args.break.if_min) is `FALSE`.

Otherwise, the algorithm terminates after the number of cycles specified by the argument [steps.beyond_min](#func.tune.model_param.args.steps.beyond_min) has completed since the minimum *RMSE* value was reached.

::: {.noteblock data-latex=""}
The algorithm assumes that the set of the *RMSE* values is a monotonically non-increasing function of the *tuning parameter* until the minimum is reached and monotonically non-decreasing thereafter. That is, it is assumed that the function can have only one minimum on the given set.
:::
:::

::: { #func.tune.model_param.value .sidebar }
##### Value
\

This function returns a list of two objects:
```{r eval=FALSE}
  list(tuned.result = data.frame(RMSE = RMSEs_tmp,
                                parameter.value = param_vals_tmp),
       best_result = param_values.best_result)
```

The objects comprising the return list are as follows:

  - `best_result`: Vector containing a *pair of values*: the found *best value of the tuning parameter* for which the *RMSE* value is minimal, along with the minimal *RMSE* value itself;

  - `tuned.result`: Data frame containing two variables:
  
    - *parameter.value*: A vector containing all processed values of the *tuning parameter*;
    
    - *RMSE*: A vector containing the *RMSE* values corresponding to the processed values of the *tuning parameter*.

:::

\newpage

##### Source Code
\
Below is the simplified version of the source code of the [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L126) function:
```{r func.tune.model_param@l126, eval=FALSE}
tune.model_param <- function(param_values, 
                             fn_tune.test.param_value, 
                             break.if_min = TRUE,
                             steps.beyond_min = 2){
  n <- length(param_values)
  param_vals_tmp <- numeric()
  RMSEs_tmp <- numeric()
  RMSE_min <- Inf
  i_max.beyond_RMSE_min <- Inf
  prm_val.best <- NA
  
  # ...
  
  for (i in 1:n) {
    put_log1("Function: `tune.model_param`: Iteration %1", i)
    prm_val <- param_values[i]
    param_vals_tmp[i] <- prm_val
    
    RMSE_tmp <- fn_tune.test.param_value(prm_val)
    RMSEs_tmp[i] <- RMSE_tmp

    plot(param_vals_tmp[RMSEs_tmp], RMSEs_tmp[RMSEs_tmp])

    if(RMSE_tmp > RMSE_min){
      warning("Function: `tune.model_param`: `RSME` reached its minimum: ", 
              RMSE_min, "for parameter value: ", prm_val)

      if (i > i_max.beyond_RMSE_min) {
        warning("Function: `tune.model_param`:
Operation is breaked (after `RSME` reached its minimum) on the following step: ", i)
        break
      }
      next
    }

    RMSE_min <- RMSE_tmp
    prm_val.best <- prm_val
    
    if (break.if_min) {
      i_max.beyond_RMSE_min <- i + steps.beyond_min
    }
  }
  
  param_values.best_result <- c(param.best_value = prm_val.best, 
                                best_RMSE = RMSE_min)

  list(tuned.result = data.frame(RMSE = RMSEs_tmp,
                                parameter.value = param_vals_tmp),
       best_result = param_values.best_result)
}
```

::: {.noteblock data-latex=""}
The complete source code of the [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L126) function is available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L126) script on _GitHub_.
:::

#### [model.tune.param_range](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L208) Function {#func.model.tune.param_range}
\

Implements an algorithm for fine-tuning the model under test by figuring out the most precise value possible of the *tuning parameter* over a given interval determined by the $start$ and $end$ values of the interval passed in the [loop_starter](#func.model.tune.param_range.args.loop_starter) argument.

::: { #func.model.tune.param_range.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L608)
\

```{r main-script@l608u.model.tune.param_range, eval=FALSE}
endpoints <- 
  get_fine_tune.param.endpoints(cv.UME.preset.result$tuned.result)

UM_effect.loop_starter <- c(endpoints["start"], 
                            endpoints["end"], 
                            8)
```
```{r}
UM_effect.loop_starter
```

::: {.noteblock data-latex=""}
In the code snippet above, we use the user-defined auxiliary function [get_fine_tune.param.endpoints](#func.get_fine_tune.param.endpoints) described above in *this Section*. 
:::

```{r main-script@l617u.model.tune.param_range, eval=FALSE}
UME.rglr.fine_tune.cache.base_name <- "UME.rglr.fine-tune"

UME.rglr.fine_tune.results <- 
  model.tune.param_range(UM_effect.loop_starter,
                         UME.rglr.fine_tune.cache.path,
                         UME.rglr.fine_tune.cache.base_name,
                         regularize.test_lambda.UM_effect.cv)

UME.rglr.fine_tune.RMSE.best <- UME.rglr.fine_tune.results$best_result["best_RMSE"]
```
```{r}
str(UME.rglr.fine_tune.results)
```

\newpage

```{r}
print(UME.rglr.fine_tune.results)
```
:::

::: { #func.model.tune.param_range.args .sidebar }
##### Arguments
\

::: { #func.model.tune.param_range.args.loop_starter .sidebar }
###### ***loop_starter***
\
A numeric vector of the form `c(start, end, dvs)`, where `start` and `end` are the endpoints of the interval over which the value of the *tuning parameter* that minimizes *RMSE* has to be found.

The `dvs` is a divisor used to calculate the *step size* for partitioning the interval into a sequence of parameter values, among which the value that minimizes *RMSE* has to be found.

So the *step size* of the sequence is calculated as follows:
$$
step = \frac{end - start}{dvs}
$$  

The sequence obtained as a result of the transformation is equivalent to the one generated by the function [base::seq](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/seq) as follows:
```{r eval=FALSE}
seq(start, end, step)
```  

::: {.noteblock data-latex=""}
In the function body, the *step size* is stored in the local variable `seq_increment`, and the values of $start$, $end$, and $dvs$ are stored in the local variables `seq_start`, `seq_end`, and `interval_divisor`, respectively.
:::

\newpage

In fact, the [seq](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/seq) function is called internally to generate the sequence during the algorithm's execution by the following [line of code](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L256):
```{r eval=FALSE}
    test_param_vals <- seq(seq_start, seq_end, seq_increment)
```
:::

::: { #func.model.tune.param_range.args.tune_dir_path .sidebar }
###### ***tune_dir_path***
\

To improve performance, the algorithm caches intermediate results in the file system. The value passed in *this argument* specifies the path to the directory where the files are cached.
:::

::: { #func.model.tune.param_range.args.cache_file_base_name .sidebar }
###### ***cache_file_base_name***
\

The algorithm generates unique names for cache files based on this and the [loop_starter](#func.model.tune.param_range.args.loop_starter) arguments' values, as well as a few other intermediate values calculated at runtime.
:::

::: { #func.model.tune.param_range.args.fn_tune.test.param_value .sidebar }
###### ***fn_tune.test.param_value***
\

Name of a model-specific helper function to pass to the [same-named argument](#func.tune.model_param.args.fn_tune.test.param_value) of the [tune.model_param](#func.tune.model_param) function (see description above) that is called internally during the execution of the algorithm.
:::

::: { #func.model.tune.param_range.args.max.identical.min_RMSE.count .sidebar }
###### ***max.identical.min_RMSE.count***
\
(Optional, 4 by default) If more than one identical minimum *RMSE* value is calculated during execution, the number of identical minimums is limited by the value of *this argument*. When it is reached, the algorithm considers the task execution to be complete.
:::

::: { #func.model.tune.param_range.args.endpoint.min_diff .sidebar }
###### ***endpoint.min_diff***
\
(Optional, 0 by default) Defines the sensitivity threshold for determining the neighborhood boundaries of the minimum `RMSE` value (see the [Details](#func.model.tune.param_range.details) section below for more details).
:::

::: { #func.model.tune.param_range.args.break.if_min .sidebar }
###### ***break.if_min***
\
(Optional, `TRUE` by default) Boolean value to pass to the [same-named argument](#func.tune.model_param.args.break.if_min) of the [tune.model_param](#func.tune.model_param) function (see description above) that is called internally during the execution of the algorithm.
:::

::: { #func.model.tune.param_range.args.steps.beyond_min .sidebar }
###### ***steps.beyond_min***
\

(Optional, 2 by default) Numeric value to pass to the [same-named argument](#func.tune.model_param.args.steps.beyond_min) of the [tune.model_param](#func.tune.model_param) function (see description above) that is called internally during the execution of the algorithm.
:::
:::

\newpage

::: { #func.model.tune.param_range.details .sidebar }
##### **Details** 
\

With the approach used in this algorithm, the best value of the *tuning parameter* (we call this the *best value of the tuning parameter*) is considered to be the value corresponding to the minimum value of the *Root Mean Square Error (RMSE)* for the model being tested.

During the execution, the algorithm organizes a cycle consisting of the following steps:

::: { #func.model.tune.param_range.details.step1 .sidebar }
1. Calculates the step size for partitioning the interval into a sequence of values and save it to the local variable `seq_increment` as described in section [loop_starter](#func.model.tune.param_range.args.loop_starter) argument description above using the following [line of code](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L240):
```{r common-helper.func@l240d, eval=FALSE}
    seq_increment <- (seq_end - seq_start)/interval_divisor 
```

:::

::: { #func.model.tune.param_range.details.step2 .sidebar }
2. As shown in the following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L242),  checks if the *step size* of the generated sequence is less than the minimum allowed value (in the current implementation, we use `1e-13`):
```{r common-helper.func@l242d, eval=FALSE}
    if (seq_increment < 0.0000000000001) {
      warning("Function `model.tune.param_range`:
parameter value increment is too small.")
      
      put_log2("Function `model.tune.param_range`:
Final best RMSE for `parameter value = %1`: %2",
               param_values.best_result["param.best_value"],
               param_values.best_result["best_RMSE"])
      
      put(param_values.best_result)
      break
    }
```

If the check condition is met, the loop is terminated, and the execution proceeds to the [Finalizing Execution](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L426) section of the code described in [Finalizing Execution](#func.model.tune.param_range.details.finalizing) subsection below:

Otherwise, proceeds to the [next step](#func.model.tune.param_range.details.step3):  

::: {.noteblock data-latex=""}
In the code snippet above, we use the custom function [put_log2](#func.put_log2) described in section [Logging Functions] of *this Appendix*.
:::  
:::

::: { #func.model.tune.param_range.details.step3 .sidebar }
3. (The *step size* is no less than the minimum allowed value: `seq_increment >= 1e-13`) Creates a vector containing a sequence of parameter values (as described in section [loop_starter](#func.model.tune.param_range.args.loop_starter) argument description above) using the following [line of code](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L256):
```{r common-helper.func@l256d, eval=FALSE}
    test_param_vals <- seq(seq_start, seq_end, seq_increment)
```

:::

::: { #func.model.tune.param_range.details.step4 .sidebar }
4. Generates a unique name for the current iteration's cache file based on the values passed in the [cache_file_base_name](#func.model.tune.param_range.args.cache_file_base_name) and [loop_starter](#func.model.tune.param_range.args.loop_starter) arguments, along with the values stored in the local variables `seq_start`, `seq_end`, and `interval_divisor`, concatenates the name with the path passed in the [tune_dir_path](#func.model.tune.param_range.args.tune_dir_path) argument, and stores the value in the local variable `file_path_tmp`.

\newpage

The following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L258) performs this step of execution:
```{r common-helper.func@l258d, eval=FALSE}
    file_name_tmp <- cache_file_base_name |>
      str_c("_") |>
      str_c(as.character(loop_starter[1])) |>
      str_c("_") |>
      str_c(as.character(loop_starter[3])) |>
      str_c("_") |>
      str_c(as.character(interval_divisor)) |>
      str_c(".") |>
      str_c(as.character(seq_start)) |>
      str_c("-") |>
      str_c(as.character(seq_end)) |>
      str_c(".RData")
    
    file_path_tmp <- file.path(tune_dir_path, file_name_tmp)
    
    put_log1("Function `model.tune.param_range`:
File path generated: %1", file_path_tmp)
```

::: {.noteblock data-latex=""}
In the code snippet above, we use the custom logging function [put_log1](#func.put_log1) described above in section [Logging Functions] of *this Appendix*.
:::
:::

5. Checks whether a file with the full name stored in the `file_path_tmp` variable exists, and if so, loads all the necessary information for the current iteration from it and goes to [step 8](#func.model.tune.param_range.details.step8). Otherwise, proceeds to the [next step](#func.model.tune.param_range.details.step6).

The following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L276) performs this step of execution:
```{r common-helper.func@l276d, eval=FALSE}
    if (file.exists(file_path_tmp)) {
      put_log1("Function `model.tune.param_range`:
Loading tuning data from file: %1...", file_path_tmp)
      
      load(file_path_tmp)
      put_log1("Function `model.tune.param_range`:
Tuning data has been loaded from file: %1", file_path_tmp)
      
      tuned.result <- tuned_result$tuned.result
    } else {
      # ...
    }
```


::: { #func.model.tune.param_range.details.step6 .sidebar }
6. Calls the helper function [tune.model_param](#func.tune.model_param) and stores the returned result in the local variable `tuned_result`, passing the vector created earlier in [step 3](#func.model.tune.param_range.details.step3) to the argument [param_values](#func.tune.model_param.args.param_values) along with the values of the remaining arguments passed in the following arguments of the same name to *this function*:
  * [fn_tune.test.param_value](#func.model.tune.param_range.args.fn_tune.test.param_value);
  * [break.if_min](#func.model.tune.param_range.args.break.if_min);
  * [steps.beyond_min](#func.model.tune.param_range.args.steps.beyond_min).
  
The following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L292) performs this step of execution:
```{r common-helper.func@l292d, eval=FALSE}
      tuned_result <- tune.model_param(test_param_vals, 
                                        fn_tune.test.param_value,
                                        break.if_min,
                                        steps.beyond_min)
```

:::

::: { #func.model.tune.param_range.details.step7 .sidebar }
7. Extracts the data frame element stored in the variable `tuned_result$tuned.result` from the *list object* saved in the local variable `tuned_result` in the [previous step](#func.model.tune.param_range.details.step6) and stores it in the local variable `tuned.result`. Then stores the variable `tuned_result` (along with the necessary auxiliary information) in the cache file with the full name created earlier in [step 4](#func.model.tune.param_range.details.step4).
  
The following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L297) performs this step of execution:
```{r common-helper.func@l297d, eval=FALSE}
      tuned.result <- tuned_result$tuned.result
      
      save(tuned_result,
           param.best_value,
           seq_increment,
           interval_divisor,
           file = file_path_tmp)

      put_log1("Function `model.tune.param_range`:
File saved: %1", file_path_tmp)
```
:::



::: { #func.model.tune.param_range.details.step8 .sidebar }
8. Determines endpoints for a new interval of the *tuning parameter* values in the neighborhood of the current minimum *RMSE* value (figured out so far)  with use of the helper function [get_fine_tune.param.endpoints.idx](#func.get_fine_tune.param.endpoints.idx) (described above in *this Section*), to improve the accuracy of the *RMSE* calculation in the next iteration.
  
The following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L310) performs this step of execution:
```{r common-helper.func@l310d, eval=FALSE}
    bound.idx <- get_fine_tune.param.endpoints.idx(tuned.result)
    start.idx <- bound.idx["start"]
    end.idx <- bound.idx["end"]

    prm_val.leftmost.tmp <- tuned.result$parameter.value[start.idx]
    RMSE.leftmost.tmp <- tuned.result$RMSE[start.idx]

    prm_val.rightmost.tmp <- tuned.result$parameter.value[end.idx]
    RMSE.rightmost.tmp <- tuned.result$RMSE[end.idx]
    
    min_RMSE <- tuned.result$RMSE[best_RMSE.idx]
    min_RMSE.prm_val <- tuned.result$parameter.value[best_RMSE.idx]

    seq_start <- prm_val.leftmost.tmp
    seq_end <- prm_val.rightmost.tmp
```

:::

::: { #func.model.tune.param_range.details.step9 .sidebar }
9. Checks whether the local variable `best_RMSE` is already initialized, and if not, initializes it to the minimum *RMSE* value for the current iteration, figured out in the [previous step](#func.model.tune.param_range.details.step8), along with local variables intended to store the endpoint values.

The following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L327) performs this step of execution:
```{r common-helper.func@l327d, eval=FALSE}
    if (is.na(best_RMSE)) {
      prm_val.leftmost <- prm_val.leftmost.tmp
      RMSE.leftmost <- RMSE.leftmost.tmp
      
      prm_val.rightmost <- prm_val.rightmost.tmp
      RMSE.rightmost <- RMSE.rightmost.tmp
      
      param.best_value <- min_RMSE.prm_val
      best_RMSE <- min_RMSE
    }
```
:::

::: { #func.model.tune.param_range.details.step10 .sidebar }
10. Checks the deviations from the minimum *RMSE* value (stored in `min_RMSE` local variable) for the values, corresponding to the endpoints of the new interval of the *tuning parameter* values (figured out earlier in [step 8](#func.model.tune.param_range.details.step8)), and updates the corresponding local variables related to the endpoints, if the deviation reached the minimum threshold specified by the [endpoint.min_diff](#func.model.tune.param_range.args.endpoint.min_diff) argument.

The following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L340) performs this step of execution:
```{r common-helper.func@l340d, eval=FALSE}
    if (RMSE.leftmost.tmp - min_RMSE >= endpoint.min_diff) {
      prm_val.leftmost <- prm_val.leftmost.tmp
      RMSE.leftmost <- RMSE.leftmost.tmp
    } 
    
    if (RMSE.rightmost.tmp - min_RMSE >= endpoint.min_diff) {
      prm_val.rightmost <- prm_val.rightmost.tmp
      RMSE.rightmost <- RMSE.rightmost.tmp
    } 
```
:::


::: { #func.model.tune.param_range.details.step11 .sidebar }
11. Makes sure that the index of the start endpoint of the parameter interval figured out in the [step8](#func.model.tune.param_range.details.step8) is less than the index of the end endpoint and, if not, the loop is terminated with a corresponding *warning message* and execution proceeds to the [Finalizing Execution](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L426) section of the code described below in section [Finalizing Execution](#func.model.tune.param_range.details.finalizing) subsection of *this Description*.

Otherwise, proceeds to the [next step](#func.model.tune.param_range.details.step11).

The following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L352) performs this step of execution:
```{r common-helper.func@l352d, eval=FALSE}
    if (end.idx - start.idx <= 0) {
      warning("`tuned.result$parameter.value` sequential start index are the same or greater than end one.")
      put_log1("Function `model.tune.param_range`:
Current minimal RMSE: %1", rmse_min)
      
      put_log2("Function `model.tune.param_range`:
Reached minimal RMSE for the test parameter value = %1: %2",
               param_values.best_result["param.best_value"],
               param_values.best_result["best_RMSE"])
      
      put(param_values.best_result)
      break
    }
```

::: {.noteblock data-latex=""}
In the code snippet above, we use the custom logging functions [put_log1](#func.put_log1) and  [put_log2](#func.put_log2) described above in section [Logging Functions] of *this Appendix*.
:::
:::

::: { #func.model.tune.param_range.details.step11 .sidebar }
12.   Makes sure that the minimum *RMSE* value achieved so far (and stored in the local variable `best_RMSE`) is no less than the minimum *RMSE* value calculated for the current iteration and stored in the local variable `min_RMSE` (that is `best_RMSE >= min_RMSE`) and, if not, ***terminates the execution*** with an error message (this case is considered a **fatal error!**)

Otherwise, the further execution depends on the following condition:

* If `best_RMSE == min_RMSE`, proceeds to the [next step](#func.model.tune.param_range.details.step13) with a corresponding *warning message*;
* Otherwise, proceeds to [step 14](#func.model.tune.param_range.details.step14).

The following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L367) performs this step of execution:
```{r common-helper.func@l367d12, eval=FALSE}
    if (best_RMSE == min_RMSE) {
      
            warning("Currently computed minimal RMSE equals the previously reached best one: ",
              best_RMSE, "
Currently computed minial value is: ", min_RMSE)
      
      put_log2("Function `model.tune.param_range`:
Current minimal RMSE for `parameter value = %1`: %2",
               tuned.result$parameter.value[which.min(tuned.result$RMSE)],
               min_RMSE)
      
      put_log2("Function `model.tune.param_range`:
So far reached best RMSE for `parameter value = %1`: %2",
               param_values.best_result["param.best_value"],
               param_values.best_result["best_RMSE"])
      
      put(param_values.best_result)
      

      # the next step of the current iteration
      # ...
      
    } else if (best_RMSE < min_RMSE) {
      # Fatal Error! (stops the execution)
      
      warning("Current minimal RMSE is greater than previously computed best value: ",
              best_RMSE, "
Currently computed minial value is: ", min_RMSE)
      stop("Current minimal RMSE is greater than previously computed best value: ",
           best_RMSE, "
Currently computed minial value is: ", min_RMSE)
    }

    # step 14 of the current iteration
```
:::

\newpage

::: { #func.model.tune.param_range.details.step13 .sidebar }
13. (`best_RMSE == min_RMSE`) Checks if the number of equal values of the *best RMSE* in the *tuned result* for the current iteration (stored in the local variable `tuned.result$RMSE`) reached the value specified by the value passed in the argument [max.identical.min_RMSE.count](#func.model.tune.param_range.args.max.identical.min_RMSE.count), and, if so, saves the best values of the *tuning parameter* and corresponding *RMSE* in the local variable `param_values.best_result`, terminates the loop with a corresponding warning message, and proceeds to the [Finalizing Execution](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L426) section of the code described below in section [Finalizing Execution](#func.model.tune.param_range.details.finalizing) subsection of *this Description*.
  
Otherwise, proceeds to the [next step](#func.model.tune.param_range.details.step14).

The following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L384) performs this step of execution:
```{r common-helper.func@l384d13, eval=FALSE}
      if (sum(tuned.result$RMSE[tuned.result$RMSE == min_RMSE]) >= max.identical.min_RMSE.count) {
        warning("Minimal `RMSE`identical values count reached it maximum allowed value: ",
                max.identical.min_RMSE.count)

        put(tuned.result$RMSE)
        
        param_values.best_result <-
          get_best_param.result(tuned.result$parameter.value,
                                tuned.result$RMSE)

        put_log2("Function `model.tune.param_range`:
      Reached the best RMSE for `parameter value = %1`: %2",
                 param_values.best_result["param.best_value"],
                 param_values.best_result["best_RMSE"])
        break
      }

      # proceed to the next step of the current iteration
      # ...
```

::: {.noteblock data-latex=""}
To retrieve the best results for the current iteration from the data stored in the local variable `tuned.result`, the helper function [get_best_param.result](#func.get_best_param.result) described above is used.
:::
:::

::: { #func.model.tune.param_range.details.step14 .sidebar }
14. (`best_RMSE >= min_RMSE`) Updates the following local variables: 
  * `best_RMSE` with the value stored in the `min_RMSE`(meaning the best *RMSE* has been possibly improved in the current iteration);
  * `param.best_value` with the corresponding *best parameter value* (stored in the `min_RMSE.prm_val`)
  * `param_values.best_result` with the best results retrieved from the  `tuned.result`.

\newpage

The following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L410) performs this step of execution:
```{r common-helper.func@l410d, eval=FALSE}
    best_RMSE <- min_RMSE
    param.best_value <- min_RMSE.prm_val

    param_values.best_result <- 
      get_best_param.result(tuned.result$parameter.value, 
                          tuned.result$RMSE)
    
    put_log2("Function `model.tune.param_range`:
Currently reached best RMSE for `parameter value = %1`: %2",
             param_values.best_result["param.best_value"],
             param_values.best_result["best_RMSE"])
    
    put(param_values.best_result)
  }
  # End repeat loop
```

::: {.noteblock data-latex=""}
In the code snippet above, we use the user-defined auxiliary function [get_best_param.result](#func.get_best_param.result) described above in *this Section*. 
:::
:::

::: { #func.model.tune.param_range.details.step15 .sidebar }
15. Proceeds to the next iteration, starting from [step 1](#func.model.tune.param_range.details.step1)
:::

::: { #func.model.tune.param_range.details.finalizing .sidebar }
###### ***Finalizing Execution***
\

Finally, the algorithm initializes the objects to be included in the return list with the results obtained during execution and returns the *list object* to the client code.

The following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L427) performs this step of execution:
```{r common-helper.func@l3d, eval=FALSE}
  # Finalizing execution:
  n <- length(tuned.result$parameter.value)
  
  parameter.value <- tuned.result$parameter.value
  result.RMSE <- tuned.result$RMSE
  
  if (result.RMSE[1] == best_RMSE) {
    parameter.value[1] <- prm_val.leftmost
    result.RMSE[1] <- RMSE.leftmost
  }
  
  if (result.RMSE[n] == best_RMSE) {
    parameter.value[n+1] <- prm_val.rightmost
    result.RMSE[n+1] <- RMSE.rightmost
  }
  
  list(best_result = param_values.best_result,
       param_values.endpoints = c(prm_val.leftmost, prm_val.rightmost, seq_increment),
       tuned.result = data.frame(parameter.value = parameter.value,
                                 RMSE = result.RMSE))
```
:::

\newpage

::: {#func.model.tune.param_range.value .sidebar }
##### **Value**
\

From the [source code](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L443) of the function *being described here*, we can see that it returns a list of three objects:
```{r eval=FALSE}
  list(best_result = param_values.best_result,
       param_values.endpoints = c(prm_val.leftmost, prm_val.rightmost, seq_increment),
       tuned.result = data.frame(parameter.value = parameter.value,
                                 RMSE = result.RMSE))
```

The objects comprising the return list are as follows:

- `best_result`: A vector containing a *pair of values*: the found *best value of the tuning parameter* for which the *RMSE* value is minimal, along with the minimal *RMSE* value itself;

- `param_values.endpoints`: Information related to the final interval of the *tuning parameter* values;

- `tuned.result`: A data frame containing two variables:

  - *parameter.value*: A vector containing all processed values of the *tuning parameter*;
  
  - *RMSE*: A vector containing the *RMSE* values corresponding to the processed *tuning parameter* values.

:::

::: {#func.model.tune.param_range.code .sidebar }
##### Source Code
\

The complete source code of the function [model.tune.param_range](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L208) is available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L208) script on _GitHub_.

::: {.noteblock data-latex=""}
The essential parts of the source code are also provided and explained in the [Details](#func.model.tune.param_range.details) section of *this Description*.
:::
:::

\newpage

## Data Helper Functions {#appndx_a.data_helper.functions}
\

### Initializing Input Datasets

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the the [Initializing input datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L88) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L88) script on _GitHub_.
:::

#### [make_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L89) Function {#func.make_source_datasets}
\

Creates the major input datasets (*Movielens Datasets*) used throughout the project. 

::: { #func.make_source_datasets.usage .sidebar }
##### Usage
\

```{r data-helper.func@l240, eval=FALSE}
movielens_datasets <- make_source_datasets()
```

::: {.noteblock data-latex=""}
The above [line of code](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L240) creates the *Movielens Datasets* using the function `make_source_datasets`, which is called internally from the custom helper function [init_source_datasets](#func.init_source_datasets) described below in  *this Section*.
:::
:::

::: { #func.make_source_datasets.details .sidebar }
##### Details
\

To produce the *Movielens Datasets* (listed in the [Value](#func.make_source_datasets.value) section of *this Appendix* below), the function uses the `edx` as the original dataset, and, during the execution, it calls internally the following *user-defined data helper functions* described below in section [Data Processing Functions] of *this Appendix*:

* [splitGenreRows](#func.splitGenreRows) to create the [`edx.sgr` Object];
* [sample_train_validation_sets](#func.sample_train_validation_sets) to create *Train* and *Validation* sets of the *inner datasets* of the [`edx_CV` Object].

Additionally, it also calls the following *custom logging functions* described above in section [Logging Functions] of *this Appendix*:

* [put_start_date](#func.put_start_date);
* [put_end_date](#func.put_end_date);
* [put_log](#func.put_log);
* [put_log1](#func.put_log1).

::: {.noteblock data-latex=""}
The function being described is a utility and is used internally in the [init_source_datasets](#func.init_source_datasets) function as shown above in the [Usage](#func.make_source_datasets.usage) section of *this Description*.
:::
:::

\newpage

::: { #func.make_source_datasets.value .sidebar }
##### Value
\

The list of the following datasets (described in detail in [Appendix B: Models Training Datasets]) are returned to the client code:

  - [`edx.mx` Matrix Object];
  
  - [`edx.sgr` Object];

  - [`movie_map` Object];
  
  - [`date_days_map` Object];

  - [`edx_CV` Object].

:::

::: { #func.make_source_datasets.code .sidebar }
##### Source Code
\

The source code of the [make_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L89) function is shown below:
```{r eval=FALSE}
make_source_datasets <- function(){
  put_log("Function: `make_source_datasets`: Creating source datasets...")
  
  put_log("Function: `make_source_datasets`: Creating Rating Matrix from `edx` dataset...")
  edx.mx <- edx |> 
    mutate(userId = factor(userId),
           movieId = factor(movieId)) |>
    select(movieId, userId, rating) |>
    pivot_wider(names_from = movieId, values_from = rating) |>
    column_to_rownames("userId") |>
    as.matrix()
  
  put_log("Function: `make_source_datasets`:
Matrix created: `edx.mx` of the following dimentions:")
  put(dim(edx.mx))

  #> To be able to map movie IDs to titles we create the following lookup table:
  movie_map <- edx |> select(movieId, title, genres) |> 
    distinct(movieId, .keep_all = TRUE)
  
  put_log("Function: `make_source_datasets`: Dataset created: movie_map")
  put(summary(movie_map))
  
  put_log("Function: `make_source_datasets`: Creating Date-Days Map dataset...")
  date_days_map <- edx |>
    mutate(date_time = as_datetime(timestamp)) |>
    mutate(date = as_date(date_time)) |>
    mutate(year = year(date_time)) |>
    mutate(days = as.integer(date - min(date))) |>
    select(timestamp, date_time, date, year, days) |>
    distinct(timestamp, .keep_all = TRUE)
  
  put_log("Function: `make_source_datasets`: Dataset created: date_days_map")
  put(summary(date_days_map))
  
  put_log("Function: `make_source_datasets`: 
To account for the Movie Genre Effect, we need a dataset with split rows 
for movies belonging to multiple genres.")
  edx.sgr <- splitGenreRows(edx)
  
  
  
  #> We will use K-fold cross validation as explained in 
  #> Section 29.6.1: "K-fold validation" of the Cource Textbook:
  #> https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation
  #> We are going to compute the following version of the MSE introducing in that section:
  
  # $$
  #   \mbox{MSE}(\lambda) \approx\frac{1}{B} \sum_{b = 1}^B \frac{1}{N}\sum_{i = 1}^N \left(\hat{y}_i^b(\lambda) - y_i^b\right)^2 
  # $$
  
  start <- put_start_date()
  edx_CV <- lapply(kfold_index,  function(fold_i){
    
    put_log1("Method `make_source_datasets`: 
Creating K-Fold Cross-Validation Datasets, Fold %1", fold_i)
    
    #> We split the initial datasets into training sets, which we will use to build 
    #> and train our models, and validation sets in which we will compute the accuracy 
    #> of our predictions, the way described in the `Section 23.1.1 Movielens data`
    #> (https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#movielens-data) 
    #> of the Course Textbook.
    
    split_sets <- edx |>
      sample_train_validation_sets(fold_i*1000)
    
    train_set <- split_sets$train_set
    validation_set <- split_sets$validation_set
    
    put_log("Function: `make_source_datasets`: 
Sampling 20% from the split-row version of the `edx` dataset...")
    split_sets.gs <- edx.sgr |>
      sample_train_validation_sets(fold_i*2000)

    train.sgr <- split_sets.gs$train_set
    validation.sgr <- split_sets.gs$validation_set
    
    # put_log("Function: `make_source_datasets`: Dataset created: validation.sgr")
    # put(summary(validation.sgr))
    
    #> We will use the array representation described in `Section 17.5 of the Textbook`
    #> (https://rafalab.dfci.harvard.edu/dsbook-part-2/linear-models/treatment-effect-models.html#sec-anova), 
    #> for the training data. 
    #> To create this matrix, we use `tidyr::pivot_wider` function:
    
    # train_set <- mutate(train_set, userId = factor(userId), movieId = factor(movieId))
    # train.sgr <- mutate(train.sgr, userId = factor(userId), movieId = factor(movieId))
    
    put_log("Function: `make_source_datasets`: Creating Rating Matrix from Train Set...")
    train_mx <- train_set |> 
      mutate(userId = factor(userId),
             movieId = factor(movieId)) |>
      select(movieId, userId, rating) |>
      pivot_wider(names_from = movieId, values_from = rating) |>
      column_to_rownames("userId") |>
      as.matrix()
    
    put_log("Function: `make_source_datasets`:
Matrix created: `train_mx` of the following dimentions:")
    put(dim(train_mx))


    list(train_set = train_set,
         train_mx = train_mx,
         train.sgr = train.sgr,
         validation_set = validation_set)
  })
  put_end_date(start)
  put_log("Function: `make_source_datasets`: 
Set of K-Fold Cross-Validation datasets created: edx_CV")
  
  tuning_sets <- edx |>
    sample_train_validation_sets(5423)
  
  list(edx_CV = edx_CV,
       edx.mx = edx.mx,
       edx.sgr = edx.sgr,
       tuning_sets = tuning_sets,
       movie_map = movie_map,
       date_days_map = date_days_map)
}
```

::: {.noteblock data-latex=""}
The source code of the [make_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L89) function is also available in the [Initializing input datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L88) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L89) script on _GitHub_.
:::
:::

\newpage

#### [init_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L211) Function {#func.init_source_datasets}
\

Creates or loads from the *Local Cache* file the major input datasets used throughout the project. 

::: { #func.init_source_datasets.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/_startup/1.init.R#L132)
\

```{r eval=FALSE}
movielens_datasets <- init_source_datasets()

```
:::

##### Details
\

The function checks whether the *Movielens Datasets* are cached on the hard disk, calling the [base::file.exists](https://www.rdocumentation.org/packages/base/versions/3.3.0/topics/files) `R` function, and, if so, loads them from the *Local Cache* file calling the [load_movielens_data_from_file](#func.load_movielens_data_from_file) user-defined auxiliary function described below in section [Data Processing Functions] of *this Appendix*.

Otherwise, it calls the [make_source_datasets](#func.make_source_datasets) function described above in *this Section*, which creates all the necessary datasets using the `edx` as the original dataset, saves the result datasets in a dedicated cache file using the [base::save](https://www.rdocumentation.org/packages/base/versions/3.3.0/topics/save) 'R' function, and returns the datasets to the client code.
:::

::: { #func.init_source_datasets.value .sidebar }
##### Value
\

The list of the following datasets (described in detail in [Appendix B: Models Training Datasets]) is returned to the client code:

- [`edx.mx` Matrix Object];
- [`edx.sgr` Object];
- [`movie_map` Object];
- [`date_days_map` Object];
- [`edx_CV` Object].
:::

\newpage

::: { #func.init_source_datasets.code .sidebar }
##### Source Code
\

The simplified version of the source code of the [init_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L211) function is shown below:
```{r eval=FALSE}
init_source_datasets <- function(){
  if(file.exists(movielens_datasets_file_path)){
    movielens_datasets <- load_movielens_data_from_file(movielens_datasets_file_path)
  } else if(file.exists(movielens_datasets_zip)) {
    unzip(movielens_datasets_zip, movielens_datasets_file_path)

    if(!file.exists(movielens_datasets_file_path)) {
      put_log("Method `init_source_datasets`: 
File does not exists: {movielens_datasets_file}.")
      stop("Failed to unzip MovieLens data zip-archive.")
    }
    movielens_datasets <- load_movielens_data_from_file(movielens_datasets_file_path)
  } else {
    library(edx.capstone.movielens.data)
    movielens_datasets <- make_source_datasets()
    put("Method `init_source_datasets`: 
All required datasets have been created.")
    
    save(movielens_datasets, file =  movielens_datasets_file_path)

    if(!file.exists(movielens_datasets_file_path)) {
      warning("MovieLens data was not saved to file.")
    } else {
      put_log("Method `init_source_datasets`: 
Datasets have been saved to file: {movielens_datasets_file_path}.") 

      zip(movielens_datasets_zip, movielens_datasets_file_path)

      if(!file.exists(movielens_datasets_zip)){
        warning("Failed to zip MovieLens data file.")
      } else {
        put_log("Method `init_source_datasets`: 
Zip-archive created: {movielens_datasets_zip}.")
      }
    }
  }
  movielens_datasets
}
```

::: {.noteblock data-latex=""}
The complete source code of the [init_source_datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L211) function is available in the [Initializing input datasets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L88) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L211) script on _GitHub_.
:::
:::

\newpage

### Data Processing Functions

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) script on _GitHub_.
:::

#### [load_movielens_data_from_file](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L4) Function {#func.load_movielens_data_from_file}
\

Reloads *Movielens* datasets from the cache file (previously created by the user-defined helper function [init_source_datasets](#func.init_source_datasets) described above in section [Initializing Input Datasets] to *this Appendix*) using the path passed in the [file_path](#func.load_movielens_data_from_file.args.file_path) argument.

::: { #func.load_movielens_data_from_file.usage .sidebar }
##### Usage
\

```{r data-helper.func@l216, eval=FALSE}
    movielens_datasets <- load_movielens_data_from_file(movielens_datasets_file_path)
```

::: {.noteblock data-latex=""}
The above [line of code](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L216) loads the *Movielens Datasets* using the function `load_movielens_data_from_file`, which is called internally from the function [init_source_datasets](#func.init_source_datasets) mentioned above in the *current Description*.
:::
:::

::: { #func.load_movielens_data_from_file.args .sidebar }
##### Arguments
\

:::
::: { #func.load_movielens_data_from_file.args.file_path .sidebar }
  - **file_path:** Full path to the *cache file*. 

:::
:::

::: { #func.load_movielens_data_from_file.details .sidebar }
##### Details
\

This function is a wrapper for the `R` function [base::load](https://www.rdocumentation.org/packages/base/versions/3.3.0/topics/load). It also internally calls the auxiliary `R` function [base::file.exists](https://www.rdocumentation.org/packages/base/versions/3.3.0/topics/files) to check for the existence of the *cache file* at the path specified by the [file_path](#func.load_movielens_data_from_file.args.file_path) argument, as well as the following custom logging functions described in section [Logging Functions] of *this Appendix*:

* [put_start_date](#func.put_start_date);
* [put_end_date](#func.put_end_date).
* [put_log1](#func.put_log1);

::: {.noteblock data-latex=""}
This is an auxiliary function that is used internally in the [init_source_datasets](#func.init_source_datasets) function as shown above in the [Usage](#func.load_movielens_data_from_file.usage) section of *this Description*.
:::
:::

::: { #func.load_movielens_data_from_file.value .sidebar }
##### Value
\

The list of the following datasets (described in detail in [Appendix B: Models Training Datasets]) is returned to the client code:

- [`edx.mx` Matrix Object];
- [`edx.sgr` Object];
- [`movie_map` Object];
- [`date_days_map` Object];
- [`edx_CV` Object].
:::

::: { #func.load_movielens_data_from_file.code .sidebar }
##### Source Code
\

The source code of the [load_movielens_data_from_file](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L4) function is shown below:
```{r eval=FALSE}
load_movielens_data_from_file <- function(file_path){
  put_log1("Loading MovieLens datasets from file: %1...", 
           file_path)
  start <- put_start_date()
  load(file_path)
  put_end_date(start)
  put_log1("MoviLens datasets have been loaded from file: %s.", 
           file_path)
  movielens_datasets
}
```

::: {.noteblock data-latex=""}
The source code of the [load_movielens_data_from_file](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L4) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L4) script on _GitHub_.
:::
:::

\newpage

#### [splitByUser](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L14) Function {#func.splitByUser}
\

Divides the set of *row indices* of the dataset passed in the [data](#func.splitByUser.args.data) argument into the groups defined by the `.$userId` variable in that dataset.

::: { #func.splitByUser.usage .sidebar }
##### Usage
\

```{r data-helper.func@l21, eval=FALSE}
    sapply(splitByUser(data),
           function(i) sample(i, ceiling(length(i)*.2))) |> 
    unlist() |> 
    sort()
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L21) above, the function `splitByUser` is called internally from the [sample_train_validation_sets](#func.sample_train_validation_sets) function described below in *this Section*.
:::
:::

::: { #func.splitByUser.args .sidebar }
##### Arguments
\

::: { #func.splitByUser.args.data .sidebar }
* **data:** Dataset to *split by user*; 

:::
:::

::: { #func.splitByUser.details .sidebar }
##### Details
\

This function is a wrapper for the [base::split](https://www.rdocumentation.org/packages/base/versions/3.3/topics/split) `R` function, which is called internally to divide the *set of row indices* of the *dataset* passed in the [data](#func.splitByUser.args.data) argument into the groups defined by the variable `.$userId`.

::: {.noteblock data-latex=""}
This is an auxiliary function intended for use in the [sample_train_validation_sets](#func.sample_train_validation_sets) function as shown in the [Usage](#func.splitByUser.usage) section above of the *current Description*.
:::
:::

::: { #func.splitByUser.value .sidebar }
##### Value
\

 List of vectors containing the values (corresponding *row indices* of the dataset passed in the [data](#)) for the `.$userId` groups. The components of the list are named by the values of the `.$userId` (after converting to a factor). For more details, please refer to the documentation of the [base::split](https://www.rdocumentation.org/packages/base/versions/3.3/topics/split) function, which, in fact, forms the return value. 
:::

::: { #func.splitByUser.code .sidebar }
##### Source Code
\

The source code of the [splitByUser](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L14) function is shown below:
```{r eval=FALSE}
splitByUser <- function(data){
  split(1:nrow(data), data$userId)
}
```

::: {.noteblock data-latex=""}
The source code of the [splitByUser](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L14) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L14) script on _GitHub_.
:::
:::

#### [sample_train_validation_sets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) Function {#func.sample_train_validation_sets}
\

Implements an algorithm to split the input dataset passed in the [data](#func.sample_train_validation_sets.args.data) argument into *Train* and *Validation* sets in the way described in [Section 29.6 *Cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6].

::: { #func.sample_train_validation_sets.usage .sidebar }
##### Usage
\

```{r data-helper.func@l153, eval=FALSE}
split_sets <- edx |>
  sample_train_validation_sets(fold_i*1000)
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L153) above, the function `sample_train_validation_sets` is called internally from the [make_source_datasets](#func.make_source_datasets) function described above in section [Initializing Input Datasets] of *this Appendix*.
:::
:::

::: { #func.sample_train_validation_sets.args .sidebar }
##### Arguments
\

::: { #func.sample_train_validation_sets.args.data .sidebar }
- **data:** Input dataset to split; 

:::
::: { #func.sample_train_validation_sets.args.seed .sidebar }
- **seed:** Seed value; 

:::
:::

::: { #func.sample_train_validation_sets.details .sidebar }
##### Details
\

::: {.noteblock data-latex=""}
This is an auxiliary function intended for use in the [make_source_datasets](#func.make_source_datasets) function as shown in the [Usage](#func.sample_train_validation_sets.usage) section above of the *current Description*.
:::

To split the dataset passed in the [data](#func.sample_train_validation_sets.args.data) argument, the algorithm first takes a sample of 20% of the size of the set of its *row indices* for each user and sorts them by their corresponding `.$userId` value.

Next, the algorithm creates a *Train Set* from the rows with indices that *IS NOT* in the *set of samples* taken in the previous step.

Finally, it creates a *Validation Set* from the remaining data, including *ONLY THOSE ROWS* that have `.$userId` and `.$movieId` contained in the *Train Set*.

::: {.noteblock data-latex=""}
During its execution, the algorithm internally calls the user-defined helper function [splitByUser](#func.splitByUser) described above in *this Section*, as well as the custom logging function [put_log](#func.put_log) described above in section [Logging Functions] of *this Appendix*.
:::
:::

::: { #func.sample_train_validation_sets.value .sidebar }
##### Value
\

List of size 2, consisting of the *Training* and *Testing* datasets created during the algorithm execution.
:::

::: { #func.sample_train_validation_sets.code .sidebar }
##### Source Code
\

Below is a simplified version of the source code of the [sample_train_validation_sets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) function:
```{r eval=FALSE}
sample_train_validation_sets <- function(data, seed){
  put_log("Function: `sample_train_validation_sets`: Sampling 20% of the `data` data...")
  set.seed(seed)
  validation_ind <- 
    sapply(splitByUser(data),
           function(i) sample(i, ceiling(length(i)*.2))) |> 
    unlist() |> 
    sort()
  
  put_log("Function: `sample_train_validation_sets`: 
Extracting 80% of the original `data` not used for the Validation Set, 
excluding data for users who provided no more than a specified number of ratings: {min_nratings}.")
  train_set <- data[-validation_ind,]

  put_log("Function: `sample_train_validation_sets`: 
To make sure we dont include movies in the Training Set that should not be there, 
we exclude entries using the semi_join function from the Validation Set.")
  tmp.data <- data[validation_ind,]
  
  validation_set <- tmp.data |> 
    semi_join(train_set, by = "movieId") |> 
    semi_join(train_set, by = "userId") |>
    as.data.frame()
  
  # Add rows excluded from `validation_set` into `train_set`
  tmp.excluded <- anti_join(tmp.data, validation_set)
  train_set <- rbind(train_set, tmp.excluded)

  # Return result datassets    
  list(train_set = train_set, 
       validation_set = validation_set)
}
```

::: {.noteblock data-latex=""}
The complete source code of the [sample_train_validation_sets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) function is available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) script on _GitHub_.
:::
:::

\newpage

#### [splitGenreRows](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L73) Function {#func.splitGenreRows}
\
Splits rows of the original dataset passed in the [data](#func.splitGenreRows.args.data) argument for movies that belong to multiple genres.

::: { #func.splitGenreRows.usage .sidebar }
##### Usage
\

```{r data-helper.func@l128, eval=FALSE}
edx.sgr <- splitGenreRows(edx)
```

::: {.noteblock data-latex=""}
The above [line of code](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L128) splits rows of the `edx` dataset using the function `splitGenreRows`, which is called internally from the function [make_source_datasets](#func.make_source_datasets) described above in section [Initializing Input Datasets] of *this Appendix*.
:::
:::

::: { #func.splitGenreRows.args .sidebar }
##### Arguments
\

::: { #func.splitGenreRows.args.data .sidebar }
  - **data:** A dataset containing rows corresponding to movies that belong to multiple genres.. 

:::
:::

::: { #func.splitGenreRows.details .sidebar }
##### Details
\
The function is a wrapper for the [tidyr::separate_rows](https://www.rdocumentation.org/packages/tidyr/versions/1.3.0/topics/separate_rows) `R` function, which is called internally to operate.

::: {.noteblock data-latex=""}
This is an auxiliary function intended for use in the [make_source_datasets](#func.make_source_datasets) function as shown in the [Usage](#func.splitGenreRows.usage) section above of *this Description*.
:::
:::

::: { #func.splitGenreRows.value .sidebar }
##### Value
\

Dataset object with split rows (those belong to multiple genres) described in detail below in the [`edx.sgr` Object] of the [Appendix B: Models Training Datasets].
:::

::: { #func.splitGenreRows.code .sidebar }
##### Source Code
\

The source code of the [splitGenreRows](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L73) function is shown below:
```{r eval=FALSE}
splitGenreRows <- function(data){
  put("Splitting dataset rows related to multiple genres...")
  start <- put_start_date()
  gs_splitted <- data |>
    separate_rows(genres, sep = "\\|")
  put("Dataset rows related to multiple genres have been splitted to have single genre per row.")
  put_end_date(start)
  gs_splitted
}
```

::: {.noteblock data-latex=""}
The source code of the [splitGenreRows](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L73) function is also available in the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L73) script on _GitHub_.
:::
:::

\newpage

### Models Training Functions

#### [union_cv_results](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L425) Function {#func.union_cv_results}
\

Aggregates the input data frames passed in the [data_list](#func.union_cv_results.args.data_list) argument into a single data frame.

::: { #func.union_cv_results.usage .sidebar }
##### Usage
\

```{r UM-effect.func@l39, eval=FALSE}
  user_movie_effects_united <- union_cv_results(user_movie_effects_ls)
```

::: {.noteblock data-latex=""}
In the above [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L39), the `union_cv_results` function is called internally from the [train_user_movie_effect.cv](#func.train_user_movie_effect.cv) function described in section [UME Model: Utility Functions] of *this Appendix*.
:::
:::

::: { #func.union_cv_results.args .sidebar }
##### Arguments
\

::: { #func.union_cv_results.args.data_list .sidebar }
  - **data_list:** List of data frames representing the results of the *K-Fold Cross-Validation* execution (as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV]). 

:::
:::

::: { #func.union_cv_results.details .sidebar }
##### Details
\

This function internally uses the [base::union](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/sets) `R` function to combine the data from the list of data frames passed in the [data_list](#func.union_cv_results.args.data_list) argument into a single data frame for further processing.

The function is used to aggregate the results of the *K-Fold Cross-Validation*, where the $K$ value is determined by the length of the [`edx_CV` Object] (described in [Appendix B: Models Training Datasets]). In *this Project*, we use $K = 5$).

::: {.noteblock data-latex=""}
This is a utility function intended to be called internally from the other user-defined function, such as, for instance, the [train_user_movie_effect.cv](#func.train_user_movie_effect.cv), as shown above in the [Usage](#func.union_cv_results.usage) section of *this Description*.
:::
:::

::: { #func.union_cv_results.value .sidebar }
##### Value
\

A data frame that is a union of the input list of data frames.
:::

\newpage

::: { #func.union_cv_results.code .sidebar }
##### Source Code
\

The source code of the [union_cv_results](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L425) function is shown below:
```{r eval=FALSE}
union_cv_results <- function(data_list) {
  out_dat <- data_list[[1]]
  
  for (i in 2:CVFolds_N){
    out_dat <- union(out_dat, 
                     data_list[[i]])
  }
  
  out_dat
}
```

::: {.noteblock data-latex=""}
The source code of the [union_cv_results](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L425) is also available in the [Model training](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L424) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L425) script on _GitHub_.
:::
:::






\newpage

### Data Visualization Functions

#### [data.plot](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L580) Function {#func.data.plot}
\

Plots a graph based on the dataset passed in the [data](#func.data.plot.args.data) parameter, using both points and a line.

::: { #func.data.plot.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1838)
\

```{r main-script@l1838u}
lss.UMGYDE.preset.degree2.result$tuned.result |>
  data.plot(title = "UMGYDE Model, `loess` function args: range of `span` values for `degree = 2`",
              xname = "parameter.value", 
              yname = "RMSE", 
              xlabel = "spans", 
              ylabel = "RMSE")
```
:::

\newpage

::: { #func.data.plot.args .sidebar }
##### Arguments
\

::: { #func.data.plot.args.data .sidebar }
  - **data:** Dataset to use for the plot; 

:::
::: { #func.data.plot.args.title .sidebar }
  - **title:** Title of the plot; 

:::
::: { #func.data.plot.args.xname .sidebar }
  - **xname:** The name of the dataset column used as the source of the $x$ variable for the plot; 

:::
::: { #func.data.plot.args.yname .sidebar }
  - **yname:** The name of the dataset column used as the source of the $y$ variable for the plot; 

:::
::: { #func.data.plot.args.xlabel .sidebar }
  - **xlabel:** (Optional, *Character string*, `NULL` by default) The $x$ axis label. If `NULL`, the value of the `xname` parameter is used for the label; 

:::
::: { #func.data.plot.args.ylabel .sidebar }
  - **ylabel:** (Optional, *Character string*, `NULL` by default) The $y$ axis label. If `NULL`, the value of the `yname` parameter is used for the label.; 

:::
::: { #func.data.plot.args.line_col .sidebar }
  - **line_col:** (Optional, *Character string*, ***\textcolor{blue}{blue}*** by default) Line color. 

:::
::: { #func.data.plot.args.normalize .sidebar }
- **normalize:** (Optional, *Boolean*, `FALSE` by default) If `TRUE`, deviations from the minimum $y$ value are used to plot, rather than the $y$ values themselves. Otherwise, the $y$ values are used.

:::
:::

::: { #func.data.plot.details .sidebar }
##### Details
\

The function is a wrapper for the [ggplot2::ggplot](https://ggplot2.tidyverse.org/reference/ggplot.html) function and is a simple and convenient tool for visualizing the data of *this Project*.
:::

\newpage

::: { #func.data.plot.code .sidebar }
##### Source Code
\

The soure code of the [data.plot](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L580) function is shown below:
```{r eval=FALSE}
data.plot <- function(data, 
                      title, 
                      xname, 
                      yname, 
                      xlabel = NULL, 
                      ylabel = NULL,
                      line_col = "blue",
                      normalize = FALSE) {
  y <- data[, yname]
  
  if (normalize) {
    y <- y - min(y)
  }
  
  if (is.null(xlabel)) {
    xlabel = xname
  }
  if (is.null(ylabel)) {
    ylabel = yname
  }
  
  aes_mapping <- aes(x = data[, xname], y = y)
  
  data |> 
    ggplot(mapping = aes_mapping) +
    ggtitle(title) +
    xlab(xlabel) +
    ylab(ylabel) +
    geom_point() + 
    geom_line(color=line_col)
}
```

::: {.noteblock data-latex=""}
The source code of the [data.plot](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L580) is also available in the [Data Visualization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L435) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L580) script on _GitHub_.
:::
:::

\newpage

#### [data.plot.left.n](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L481) Function {#func.data.plot.left.n}
\

Plots a graph based on the first $n$ rows (the $n$ is specified by the [left.n](#func.data.plot.left.n.args.left.n) parameter) of the dataset passed in the [data](#func.data.plot.left.n.args.data) parameter, using both points and a line.

::: {.noteblock data-latex=""}
The dataset passed in the [data](#func.data.plot.left.n.args.data) parameter is assumed to be sorted by the column used for the $x$ axis (specified by the column name passed in the [xname](#func.data.plot.left.n.args.xname) parameter).
:::

::: { #func.data.plot.left.n.usage .sidebar }
##### Usage
\

```{r data.helper.func@l470, eval=FALSE}
data.plot.left_detailed <- function(data, 
                                    left.n = 0,
                                    title = NULL,
                                    title.left = NULL,
                                    xname, 
                                    yname, 
                                    xlabel1 = NULL, 
                                    xlabel2 = NULL, 
                                    ylabel1 = NULL,
                                    ylabel2 = NULL,
                                    line_col1 = "blue",
                                    line_col2 = "red",
                                    normalize = FALSE) {
# ...

  p2 <- data |>
    data.plot.left.n(left.n = left.n,
                     title = title.left,
                     xname = xname, 
                     yname = yname, 
                     xlabel = xlabel2, 
                     ylabel = ylabel2,
                     line_col = line_col2,
                     normalize = normalize)
  grid.arrange(p1, p2)
}
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L470) above, the function `data.plot.left.n` is called internally from the [data.plot.left_detailed](#func.data.plot.left_detailed) function described below in this section.
:::
:::

\newpage

::: { #func.data.plot.left.n.args .sidebar }
##### Arguments
\

::: { #func.data.plot.left.n.args.data .sidebar }
  - **data:** Dataset to use for the plot. 

:::
::: { #func.data.plot.left.n.args.left.n .sidebar }
  - **left.n:** (Optional, *Integer*, $0$ by default)If a positive numeric value, specifies the number of the first rows of the dataset to plot. Otherwise, the entire dataset data is set to plot. 

:::
::: { #func.data.plot.left.n.args.title .sidebar }
  - **title:** Title of the plot. 

:::
::: { #func.data.plot.left.n.args.xname .sidebar }
  - **xname:** The name of the dataset column used as the source of the $x$ variable for the plot. 

:::
::: { #func.data.plot.left.n.args.yname .sidebar }
  - **yname:** The name of the dataset column used as the source of the $y$ variable for the plot. 

:::
::: { #func.data.plot.left.n.args.xlabel .sidebar }
  - *xlabel*:** The $x$ axis label. If `NULL`, the value of the `xname` parameter is used for the label. 

:::
::: { #func.data.plot.left.n.args.ylabel .sidebar }
  - **ylabel:** The $y$ axis label. If `NULL`, the value of the `yname` parameter is used for the label. 

:::
::: { #func.data.plot.left.n.args.line_col .sidebar }
  - **line_col:** (Optional, *Character string*, ***\textcolor{red}{red}*** by default) Line color. 

:::
::: { #func.data.plot.left.n.args.normalize .sidebar }
  - **normalize:** (Optional, *Boolean*, `FALSE` by default) If `TRUE`, deviations from the minimum $y$ value are used to plot, rather than the $y$ values themselves. Otherwise, the $y$ values are used.

:::
:::

::: { #func.data.plot.left.n.details .sidebar }
##### Details
\

The function is a wrapper for the [data.plot](#func.data.plot) function described above and is a simple and convenient tool for more detailed visualization of the left part of the graph, initially built based on the entire data set passed in the [data](#func.data.plot.left.n.args.data) parameter.

::: {.noteblock data-latex=""}
This is an auxiliary function that is used internally in the [data.plot.left_detailed](#func.data.plot.left_detailed) function (described below in this section) as shown above in the [Usage](#func.data.plot.left.n.usage) section of *this Description*.
:::
:::

\newpage

::: { #func.data.plot.left.n.code .sidebar }
##### Source Code
\

The source code of the [data.plot.left.n](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L481) function is shown below:
```{r eval=FALSE}
data.plot.left.n <- function(data, 
                             left.n = 0,
                             title, 
                             xname, 
                             yname, 
                             xlabel, 
                             ylabel,
                             line_col = "red",
                             normalize = FALSE) {
  x_col <- data[, xname] 
  y_col <- data[, yname]
  
  
  data.left <- data
  
  if (left.n > 0) {
    data.left <- data |> 
      head(left.n)
  }
  
  data.left |>
    data.plot(title = title,
              xname = xname,
              yname = yname,
              xlabel = xlabel,
              ylabel = ylabel,
              line_col = line_col,
              normalize = normalize)
}
```

::: {.noteblock data-latex=""}
The source code of the [data.plot.left.n](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L481) is also available in the [Data Visualization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L435) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L481) script on _GitHub_.
:::
:::

\newpage

#### [data.plot.left_detailed](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L536) Function {#func.data.plot.left_detailed}
\

Plots two graphs, placing them vertically one above the other: the first one at the top is the *main graph* plotted by the internally called auxiliary function [data.plot](#func.data.plot) (described above in this section) based on the data passed in the [data](#func.data.plot.left_detailed.args.data) argument, and the second one is the left part of the *main graph*, based on the first $n$ rows of the data used for the *main graph*, and plotted on an *enlarged scale* (the $n$ value is passed in the [left.n](#func.data.plot.left.n.args.left.n) argument).

::: {.noteblock data-latex=""}
The dataset passed in the [data](#func.data.plot.left.n.args.data) parameter is assumed to be sorted by the column used for the $x$ axis (specified by the column name passed in the [xname](#func.data.plot.left.n.args.xname) parameter).
:::

::: { #func.data.plot.left_detailed.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1877)
\

```{r main-script@l1877u}
lss.UMGYDE.fine_tune.degree2.result$tuned.result |>
  data.plot.left_detailed(title = "Fine-tuned UMGYDE Model with `loess` parameter: `degree = 2`", 
                             title.left = "Left Part of the Chart Above (Zoomed in)",
                             left.n = 8,
                             xname = "parameter.value", 
                             yname = "RMSE", 
                             xlabel1 = "spans", 
                             ylabel1 = "RMSE")
```
:::

\newpage

::: { #func.data.plot.left_detailed.args .sidebar }
##### Arguments
\

::: { #func.data.plot.left_detailed.args.data .sidebar }
  - **data:** Dataset to use for the plot. 

:::
::: { #func.data.plot.left.n.args.left.n .sidebar }
  - **left.n:** If a positive numeric value, specifies the number of the first rows of the dataset to plot. Otherwise, the entire dataset data is set to plot. 

:::
::: { #func.data.plot.left_detailed.args.title .sidebar }
  - **title:** Title of the plot. 

:::
::: { #func.data.plot.left_detailed.args.xname .sidebar }
  - **xname:** The name of the dataset column used as the source of the $x$ variable for the plot. 

:::
::: { #func.data.plot.left_detailed.args.yname .sidebar }
  - **yname:** The name of the dataset column used as the source of the $y$ variable for the plot. 

:::
::: { #func.data.plot.left_detailed.args.xlabel1 .sidebar }
  - **xlabel1:** (Optional, *Character string*, `NULL` by default) The $x$ axis label for the first plot. If `NULL`, the value of the `xname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.xlabel2 .sidebar }
  - **xlabel2:** (Optional, *Character string*, `NULL` by default) The $x$ axis label for the second plot. If `NULL`, the value of the `xname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.ylabel1 .sidebar }
  - **ylabel1:** (Optional, *Character string*, `NULL` by default) The $y$ axis label for the first plot. If `NULL`, the value of the `yname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.ylabel2 .sidebar }
  - **ylabel2:** (Optional, *Character string*, `NULL` by default) The $y$ axis label for the second plot. If `NULL`, the value of the `yname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.line_col .sidebar }
  - **line_col1** (Optional, *Character string*, ***\textcolor{blue}{blue}*** by default) The line color (main graqh). 

:::
::: { #func.data.plot.left_detailed.args.line_col .sidebar }
  - **line_col2** (Optional, *Character string*, ***\textcolor{red}{red}*** by default) The line color (second graph: the left part of the main graph, which is shown on an enlarged scale). 

:::
::: { #func.data.plot.left_detailed.args.normalize .sidebar }
  - **normalize:** (Optional, *Boolean*, `FALSE` by default) If `TRUE`, deviations from the minimum $y$ value are used to plot, rather than the $y$ values themselves. Otherwise, the $y$ values are used.

:::
:::

::: { #func.data.plot.left_detailed.details .sidebar }
##### Details
\

Internally, this function calls the [data.plot](#func.data.plot) and [data.plot.left.n](#func.data.plot.left.n) functions (the both described above in this section) to build two graphs, which it then combines into a grid using [gridExtra::grid.arrange](https://www.rdocumentation.org/packages/gridExtra/versions/2.3/topics/arrangeGrob) `R` function.
:::

::: { #func.data.plot.left_detailed.code .sidebar }
##### Source Code
\

The soure code of the [data.plot.left_detailed](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L536) function is shown below:
```{r eval=FALSE}
data.plot.left_detailed <- function(data, 
                                    left.n = 0,
                                    title = NULL,
                                    title.left = NULL,
                                    xname, 
                                    yname, 
                                    xlabel1 = NULL, 
                                    xlabel2 = NULL, 
                                    ylabel1 = NULL,
                                    ylabel2 = NULL,
                                    line_col1 = "blue",
                                    line_col2 = "red",
                                    normalize = FALSE) {
  if(is.null(xlabel1)) {
    xlabel1 <- xname
  }
  if(is.null(xlabel2)) {
    xlabel2 <- str_glue(xlabel1, " (left part)")
  }
  if(is.null(ylabel1)) {
    ylabel1 <- yname
  }
  if(is.null(ylabel2)) {
    ylabel2 <- ylabel1
  }
  
  p1 <- data |>
    data.plot(title = title,
              xname = xname, 
              yname = yname, 
              xlabel = xlabel1, 
              ylabel = ylabel1,
              line_col = line_col1)
  
  p2 <- data |>
    data.plot.left.n(left.n = left.n,
                     title = title.left,
                     xname = xname, 
                     yname = yname, 
                     xlabel = xlabel2, 
                     ylabel = ylabel2,
                     line_col = line_col2,
                     normalize = normalize)
  grid.arrange(p1, p2)
}
```

::: {.noteblock data-latex=""}
The source code of the [data.plot.left_detailed](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L536) is also available in the [Data Visualization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L435) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L536) script on _GitHub_.
:::
:::

\newpage

## Models Training: Support Functions
\

### OMR Model: Helper Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the [OMR-model.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R) script on _GitHub_.
:::

#### [naive_model_MSEs](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L2) Function {#func.naive_model_MSEs}
\

Validates the *Overall Mean Rating (OMR) Model* with use of *K-Fold Cross-Validation* method as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: {.noteblock data-latex=""}
The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets] (in *this Project*, we use $K = 5$).
:::

::: { #func.naive_model_MSEs.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L106)
\

```{r main-script@l106u, eval=FALSE}
mu <- mean(edx$rating)
mu.MSEs <- naive_model_MSEs(mu)

```
:::

::: { #func.naive_model_MSEs.args .sidebar }
##### Arguments
\

::: { #func.naive_model_MSEs.args. .sidebar }
  - **mu:** The *Overall Mean Rating (OMR)* value. 

:::
:::

::: { #func.naive_model_MSEs.details .sidebar }
##### Details
\

The function iterates through the [`edx_CV` Object] items internally calling the user-defined helper function [mse](#func.mse) (described above in section [(Root) Mean Squared Error Calculation] of *this Appendix*)  for each iteration.
:::

::: { #func.naive_model_MSEs.value .sidebar }
##### Value
\

Numeric vector of size $K$ containing the Mean Squared Error (MSE) values obtained from applying the $K$*-Fold Cross-Validation* to the *Overall Average Rating (OMR) Model*, where the $K$ value is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::

::: { #func.naive_model_MSEs.code .sidebar }
##### Source Code
\

The source code of the [naive_model_MSEs](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L2) function is shown below:
```{r eval=FALSE}
naive_model_MSEs <- function(mu) {
  sapply(edx_CV, function(cv_item){
    mse(cv_item$validation_set$rating - mu)
  })
}
```

::: {.noteblock data-latex=""}
The source code of the [naive_model_MSEs](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L2) function is defined in the [OMR-model.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L2) script on _GitHub_.
:::
:::

\newpage

#### [naive_model_RMSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L7) Function {#func.naive_model_RMSE}
\
Validates the *Overall Mean Rating (OMR) Model* with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.naive_model_RMSE.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L155)
\

```{r main-script@l155u, eval=FALSE}
  deviation <- seq(0, 6, 0.1) - 3

  deviation.RMSE <- sapply(deviation, function(delta){
    naive_model_RMSE(mu + delta)
  })
```
:::

::: { #func.naive_model_RMSE.args .sidebar }
##### Arguments
\

::: { #func.naive_model_RMSE.args. .sidebar }
  - **mu:** The overall mean rating value. 

:::
:::

::: { #func.naive_model_RMSE.details .sidebar }
##### Details
\

The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets] (in *this Project*, we use $K = 5$).

::: {.noteblock data-latex=""}
This function internally calls the [naive_model_MSEs](#func.naive_model_MSEs) function described above and then calculates the square root of the mean of the obtained results.
:::
:::

::: { #func.naive_model_RMSE.value .sidebar }
##### Value
\

The Root Mean Squared Errors (RMSE) value obtained from applying the *K-Fold Cross-Validation* method to the *Overall Average Rating (OMR) Model*, where the $K$ value is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::

::: { #func.naive_model_RMSE.code .sidebar }
##### Source Code
\

The source code of the [naive_model_RMSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L7) function is shown below:
```{r eval=FALSE}
naive_model_RMSE <- function(mu){
  sqrt(mean(naive_model_MSEs(mu)))
}
```

::: {.noteblock data-latex=""}
The source code of the [naive_model_RMSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L7) function is defined in the [OMR-model.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/OMR-model.functions.R#L7) script on _GitHub_.
:::
:::

\newpage

### UME Model: Utility Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) script on _GitHub_.
:::

#### [train_user_movie_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) Function {#func.train_user_movie_effect}
\

Trains (and optionally *regularizes* if the [lambda](#func.train_user_movie_effect.args.lambda) argument value is non-default) the *User+Movie Effect (UME) Model* using the training dataset passed in the [train_set](#func.train_user_movie_effect.args.train_set) argument.

::: { #func.train_user_movie_effect.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L676)
\

```{r main-script@l676u, eval=FALSE}
  rglr.UM_effect <- train_user_movie_effect(edx, UME.rglr.best_lambda)
```
```{r}
str(rglr.UM_effect)
```
:::

::: { #func.train_user_movie_effect.args .sidebar }
##### Arguments
\

::: { #func.train_user_movie_effect.args.train_set .sidebar }
  - **train_set:** Training dataset; 

:::
::: { #func.train_user_movie_effect.args.lambda .sidebar }
  - **lambda:** (Optional, *Numeric*, $0$ by default) Regularization parameter $\lambda$. 

:::
:::

::: { #func.train_user_movie_effect.details .sidebar }
##### Details
\

The *Regularization technique* described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2] is applied to the model being trained only when the *regularization parameter* $\lambda$ passed in the [lambda](#func.train_user_movie_effect.args.lambda) argument, has a value other than the default (to be more exact, greater than zero).

::: {.noteblock data-latex=""}
*Regularization* is committed through the *penalized regression* by computing the *penalized mean* performed by the internally called [mean_reg](#func.mean_reg) function described above in section [Model Tuning Utils] of *this Appendix*.
:::
:::

::: { #func.train_user_movie_effect.value .sidebar }
##### Value
\

Data frame object representing the trained (and also *regularized* if [lambda](#func.train_user_movie_effect.args.lambda) arg value other than default) *UM Effect Model*.
:::

\newpage

::: { #func.train_user_movie_effect.code .sidebar }
##### Source Code
\

The source code of the [train_user_movie_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) function is shown below:
```{r eval=FALSE}
train_user_movie_effect <- function(train_set, lambda = 0){
  if (is.na(lambda)) {
    stop("Function: train_user_movie_effect
`lambda` is `NA`")
  }

  UM.effect <- train_set |>
    left_join(edx.user_effect, by = "userId") |>
    mutate(resid = rating - (mu + a)) |> 
    group_by(movieId) |>
    summarise(b = mean_reg(resid, lambda), n = n())
  
  stopifnot(!is.na(mean(UM.effect$b)))
  UM.effect
}
```

::: {.noteblock data-latex=""}
The source code of the [train_user_movie_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L4) script on _GitHub_.
:::
:::

\newpage

#### [train_user_movie_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L19) Function {#func.train_user_movie_effect.cv}
\

Trains (and optionally *regularizes* if the [lambda](#func.train_user_movie_effect.args.cv.lambda) argument value is non-default) the *User+Movie Effect (UME) Model* with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.train_user_movie_effect.cv.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L472)
\

```{r main-script@l472u, eval=FALSE}
  cv.UM_effect <- train_user_movie_effect.cv()
```
```{r}
str(cv.UM_effect)
```
:::

::: { #func.train_user_movie_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.train_user_movie_effect.cv.args.lambda .sidebar }
  - **lambda:** (Optional, *Numeric*, $0$ by default) Regularization parameter $\lambda$. 

:::
:::

::: { #func.train_user_movie_effect.cv.details .sidebar }
##### Details
\

The *Regularization technique* described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2] is applied to the model being trained only when the *regularization parameter* $\lambda$ passed in the [lambda](#func.train_user_movie_effect.cv.args.lambda) argument, has a value other than the default (to be more exact, greater than zero).

Internally, this function calls the helper function [train_user_movie_effect](#func.train_user_movie_effect) described above for each iteration of the *K-Fold Cross-Validation* applied to the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets]. It also calls internally the [union_cv_results](#func.union_cv_results) function described above in section [Models Training Functions] of this *Appendix* to aggregate the cross-validation results.


::: {.noteblock data-latex=""}
The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::
:::

::: { #func.train_user_movie_effect.cv.value .sidebar }
##### Value
\

Data frame object representing the *UM Effect Model* trained (and also *regularized* if the [lambda](#func.train_user_movie_effect.cv.args.lambda) argument value is other than the default) with use of *K-Fold Cross-Validation*, where the $K$ is the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::

\newpage

::: { #func.train_user_movie_effect.cv.code .sidebar }
##### Source Code
\

The simplified version of the source code of the [train_user_movie_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L19) function is shown below:
```{r eval=FALSE}
train_user_movie_effect.cv <- function(lambda = 0){
# ...
  start <- put_start_date()
  user_movie_effects_ls <- lapply(edx_CV, function(cv_fold_dat){
    cv_fold_dat$train_set |> train_user_movie_effect(lambda)
  })
  put_end_date(start)
  put_log("Function: train_user_movie_effect.cv:
User+Movie Effect list have been computed")
  
  user_movie_effects_united <- union_cv_results(user_movie_effects_ls)

  user_movie_effect <- user_movie_effects_united |>
    group_by(movieId) |>
    summarise(b = mean(b), n = mean(n))
  # ...
  user_movie_effect
}
```

::: {.noteblock data-latex=""}
The complete source code of the [train_user_movie_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L19) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L19) script on _GitHub_.
:::
:::

\newpage

#### [calc_user_movie_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L53) Function {#func.calc_user_movie_effect_MSE}
\

Validates the *UM Effect (UME) Model* built and trained by the  [train_user_movie_effect](#func.train_user_movie_effect) or [train_user_movie_effect.cv](#func.train_user_movie_effect.cv) function call (both described above in *this Section*).

::: { #func.calc_user_movie_effect_MSE.usage .sidebar }
##### Usage
\

```{r UM-effect.func@l71, eval=FALSE}
  user_movie_effects_MSEs <- sapply(edx_CV, function(cv_fold_dat){
    cv_fold_dat$validation_set |> calc_user_movie_effect_MSE(um_effect)
  })
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L71) above, the function `calc_user_movie_effect_MSE` is called internally from the [calc_user_movie_effect_MSE.cv](#func.calc_user_movie_effect_MSE.cv) function (described below in *this Section*) for each iteration of the *K-Fold Cross-Validation*, to calculate the *MSE* for the corresponding validation dataset of the [`edx_CV` Object] (described in [Appendix B: Models Training Datasets]).
:::
:::

::: { #func.calc_user_movie_effect_MSE.args .sidebar }
##### Arguments
\

::: { #func.calc_user_movie_effect_MSE.args.test_set .sidebar }
  - **test_set:** Validation dataset; 

:::
::: { #func.calc_user_movie_effect_MSE.args.um_effect .sidebar }
  - **um_effect:** Data frame object representing the *UM Effect Model*. 

:::
:::

::: { #func.calc_user_movie_effect_MSE.details .sidebar }
##### Details
\

The function calculates *Mean Squared Error (MSE)* for the *UME Model* passed in the [um_effect](#func.calc_user_movie_effect_MSE.args.um_effect) argument using the validation dataset passed in the [test_set](#func.calc_user_movie_effect_MSE.args.test_set) arg. 

::: {.noteblock data-latex=""}
This is an auxiliary function intended to be called internally from the [calc_user_movie_effect_MSE.cv](#func.calc_user_movie_effect_MSE.cv) (described below in *this Section*) as shown in the [Usage](#func.calc_user_movie_effect_MSE.usage) section above of *this Description*.
:::
:::

::: { #func.calc_user_movie_effect_MSE.value .sidebar }
##### Value
\

*MSE* value calculated for the *UME Model*.
:::

\newpage

::: { #func.calc_user_movie_effect_MSE.code .sidebar }
##### Source Code
\

The source code of the [calc_user_movie_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L53) function is shown below:
```{r eval=FALSE}
calc_user_movie_effect_MSE <- function(test_set, um_effect){
  mse.result <- test_set |>
    left_join(edx.user_effect, by = "userId") |>
    left_join(um_effect, by = "movieId") |>
    mutate(resid = rating - clamp(mu + a + b)) |> 
    pull(resid) |> mse()
  
  stopifnot(!is.na(mse.result))
  mse.result
}
```

::: {.noteblock data-latex=""}
The source code of the [calc_user_movie_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L53) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L53) script on _GitHub_.
:::
:::

\newpage

#### [calc_user_movie_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L67) Function {#func.calc_user_movie_effect_MSE.cv}
\

Validates the *UM Effect (UME) Model* built and trained by the [train_user_movie_effect](#func.train_user_movie_effect) or [train_user_movie_effect.cv](#func.train_user_movie_effect.cv) function call (both described above in *this Section*) with use of *K-Fold Cross-Validation* (as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV]).

::: { #func.calc_user_movie_effect_MSE.cv.usage .sidebar }
##### Usage
\

```{r UM-effect.func@l83, eval=FALSE}
user_movie_effects_MSE <- calc_user_movie_effect_MSE.cv(um_effect)
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L83) above, the function *being described here* is called internally from the [calc_user_movie_effect_RMSE.cv](#func.calc_user_movie_effect_RMSE.cv) function described below in *this Section*.
:::
:::

::: { #func.calc_user_movie_effect_MSE.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_user_movie_effect_MSE.cv.args.um_effect .sidebar }
  - **um_effect:** Data frame object representing the *UM Effect Model*. 

:::
:::

::: { #func.calc_user_movie_effect_MSE.cv.details .sidebar }
##### Details
\

This function calculates *Mean Squared Error (MSE)* for the *UME Model* passed in the [um_effect](#func.calc_user_movie_effect_MSE.cv.args.um_effect) argument using the validation datasets contained in the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets].

It calls internally the [calc_user_movie_effect_MSE](#func.calc_user_movie_effect_MSE) function for each iteration of the *K-Fold Cross-Validation*, calculating the *MSE* for the corresponding validation dataset of the [`edx_CV` Object], and then calculates the mean of the obtained results.

The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).

::: {.noteblock data-latex=""}
This is an auxiliary function intended to be called internally from the [calc_user_movie_effect_RMSE.cv](#func.calc_user_movie_effect_RMSE.cv) as shown in the [Usage](#func.calc_user_movie_effect_MSE.cv.usage) section above of *this Description*.
:::
:::

::: { #func.calc_user_movie_effect_MSE.cv.value .sidebar }
##### Value
\

The *MSE* value calculated for the *UME Model* using *K-Fold Cross-Validation* (see the [Details](#func.calc_user_movie_effect_MSE.cv.details) section of *this Description* above for more details).
:::

\newpage

::: { #func.calc_user_movie_effect_MSE.cv.code .sidebar }
##### Source Code
\

The source code of the [calc_user_movie_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L67) function is shown below:
```{r eval=FALSE}
calc_user_movie_effect_MSE.cv <- function(um_effect){
  put_log("Function: user_movie_effects_MSE.cv:
Computing the RMSE taking into account User+Movie Effects...")
  start <- put_start_date()
  user_movie_effects_MSEs <- sapply(edx_CV, function(cv_fold_dat){
    cv_fold_dat$validation_set |> calc_user_movie_effect_MSE(um_effect)
  })
  put_end_date(start)
  
  put_log1("Function: user_movie_effects_MSE.cv:
MSE values have been plotted for the %1-Fold Cross-Validation samples.", 
           CVFolds_N)
  
  mean(user_movie_effects_MSEs)
}
```

::: {.noteblock data-latex=""}
The source code of the [calc_user_movie_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L67) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L67) script on _GitHub_.
:::
:::

\newpage

#### [calc_user_movie_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L82) Function {#func.calc_user_movie_effect_RMSE.cv}
\

Validates the *UM Effect (UME) Model* (built and trained by the [train_user_movie_effect](#func.train_user_movie_effect) or [train_user_movie_effect.cv](#func.train_user_movie_effect.cv) function call) with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.calc_user_movie_effect_RMSE.cv.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L513)
\

```{r main-script@l513u, eval=FALSE}
cv.UM_effect.RMSE <- calc_user_movie_effect_RMSE.cv(cv.UM_effect)

```
```{r}
cv.UM_effect.RMSE
```
:::

::: { #func.calc_user_movie_effect_RMSE.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_user_movie_effect_RMSE.cv.args.um_effect .sidebar }
  - **um_effect:** Data frame object representing the *UM Effect Model*. 

:::
:::

::: { #func.calc_user_movie_effect_RMSE.cv.details .sidebar }
##### Details
\

The function calculates *Root Squared Error (RMSE)* for the *UME Model* passed in the [um_effect](#func.calc_user_movie_effect_RMSE.cv.args.um_effect) argument using the validation datasets contained in the [`edx_CV` Object] described in [Appendix B: Models Training Datasets].

::: {.noteblock data-latex=""}
This function internally calls the [calc_user_movie_effect_MSE.cv](#func.calc_user_movie_effect_MSE.cv) function described above, to calculate the *MSE* for the *UME Model* with use of *K-Fold Cross-Validation*, and then calculates the square root of the result.

The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::
:::

::: { #func.calc_user_movie_effect_RMSE.cv.value .sidebar }
##### Value
\

The *RMSE* value calculated for the *UME Model* using *K-Fold Cross-Validation* (see the [Details](#func.calc_user_movie_effect_RMSE.cv.details) section of *this Description* above for more details).
:::

\newpage

::: { #func.calc_user_movie_effect_RMSE.cv.code .sidebar }
##### Source Code
\

The source code of the [calc_user_movie_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L82) function is shown below:
```{r eval=FALSE}
calc_user_movie_effect_RMSE.cv <- function(um_effect){
  user_movie_effects_MSE <- calc_user_movie_effect_MSE.cv(um_effect)
  um_effect_RMSE <- sqrt(user_movie_effects_MSE)
  put_log2("Function: user_movie_effects_RMSE.cv:
%1-Fold Cross-Validation ultimate RMSE: %2", length(edx_CV), um_effect_RMSE)
  um_effect_RMSE
}
```

::: {.noteblock data-latex=""}
The source code of the [calc_user_movie_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L82) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L3) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L82) script on _GitHub_.
:::
:::

\newpage

### UME Model: Regularization
\

#### [regularize.test_lambda.UM_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L91) Function {#func.regularize.test_lambda.UM_effect.cv}
\

Validates the *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.test_lambda.UM_effect.cv.args.lambda) argument for the *User+Movie Effect (UME) Model* in the *regularization process* using *penalized approach* with use of *K-Fold Cross-Validation*.

::: { #func.regularize.test_lambda.UM_effect.cv.usage .sidebar }
##### Usage
\

```{r main-script@l571u.rglr.tst_lambda.UME, eval=FALSE}
  lambdas <- seq(0, 1, 0.1)
  cv.UME.preset.result <- 
    tune.model_param(lambdas, regularize.test_lambda.UM_effect.cv)
```
```{r}
str(cv.UME.preset.result)
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L571) above the function *being described here* is passed in the [fn_tune.test.param_value](#func.tune.model_param.args.fn_tune.test.param_value) argument to the [tune.model_param](#func.tune.model_param) function described above in section [Model Tuning Utils] of *this Appendix*.

Such a use of this function is also noted in the [Details](#func.regularize.test_lambda.UM_effect.cv.details) section of *this Description* below.
:::
:::

::: { #func.regularize.test_lambda.UM_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.regularize.test_lambda.UM_effect.cv.args.lambda .sidebar }
  - **lambda:** *Regularization parameter* $\lambda$ used to validate the model in the *regularization process*. 

:::
:::

::: { #func.regularize.test_lambda.UM_effect.cv.details .sidebar }
##### Details
\

The function is used in the *regularization process* of the *UME Model* using the *penalized approach* to regularize predictions for the given *regularization parameter* $\lambda$ (passed in the [lambda](#func.regularize.test_lambda.UM_effect.cv.args.lambda) argument) as explained in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2].

Internally it uses the [train_user_movie_effect.cv](#func.train_user_movie_effect.cv) and [calc_user_movie_effect_RMSE.cv](#func.calc_user_movie_effect_RMSE.cv) functions described above to validate the *UME Model* for the given $\lambda$ with use of the *K-Fold Cross-Validation* method, as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV], where the value of $K$ is determined by the length of the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets] (in *this Project*, we use $K = 5$).

::: {.noteblock data-latex=""}
This function is an auxiliary function specifically designed to be passed in the `fn_tune.test.param_value` argument to the [tune.model_param](#func.tune.model_param) and [model.tune.param_range](#func.model.tune.param_range) functions described above in section [Model Tuning Utils] of *this Appendix*.
:::
:::

::: { #func.regularize.test_lambda.UM_effect.cv.value .sidebar }
##### Value
\

The *Root Mean Squared Errors (RMSE)* value computed for the UME Model applying the *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.test_lambda.UM_effect.cv.args.lambda) argument.

:::

::: { #func.regularize.test_lambda.UM_effect.cv.code .sidebar }
##### Source Code
\

The source code of the [regularize.test_lambda.UM_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L91) function is shown below:
```{r eval=FALSE}
regularize.test_lambda.UM_effect.cv <- function(lambda){
  if (is.na(lambda)) {
    stop("Function: regularize.test_lambda.UM_effect.cv
`lambda` is `NA`")
  }
  um_effect <- train_user_movie_effect.cv(lambda)
  calc_user_movie_effect_RMSE.cv(um_effect)
}
```

::: {.noteblock data-latex=""}
The source code of the [regularize.test_lambda.UM_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L91) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L90) section of the [UM-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R#L91) script on _GitHub_.
:::
:::

\newpage

### UMGE Model: Utility Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the  [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L3) section of the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L3) script on _GitHub_.
:::

#### [train_user_movie_genre_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L42) Function {#func.train_user_movie_genre_effect}
\

Trains (and optionally *regularizes* if the [lambda](#func.train_user_movie_genre_effect.args.lambda) argument value is non-default) the *User+Movie+Genre Effect (UMGE) Model* using the training sample of the `Movielens` dataset (passed in the [train.sgr](#func.train_user_movie_genre_effect.args.train.sgr) argument), specially prepared to train the *UMGE Model*.

::: { #func.train_user_movie_genre_effect.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1086)
\

```{r main-script@l1086u, eval=FALSE}
  rglr.UMG_effect <- edx.sgr |> train_user_movie_genre_effect(UMGE.rglr.best_lambda)
```
```{r}
str(rglr.UMG_effect)
```
:::

::: { #func.train_user_movie_genre_effect.args .sidebar }
##### Arguments
\

::: { #func.train_user_movie_genre_effect.args.train.sgr .sidebar }
  - **train.sgr:** Training sample of the `Movielens` dataset with split rows belonging to multiple genres; 

:::
::: { #func.train_user_movie_genre_effect.args.lambda .sidebar }
  - **lambda:** (Optional, *Numeric*, $0$ by default) Regularization parameter $\lambda$. 

:::
:::

::: { #func.train_user_movie_genre_effect.details .sidebar }
##### Details
\
The dataset passed in the [train.sgr](#func.train_user_movie_genre_effect.args.train.sgr) argument is assumed to be the result returned by the [splitGenreRows](#func.splitGenreRows) helper function described above in section [Data Processing Functions] of *this Appendix*.

For example, the [`edx.sgr` Object] is an appropriate dataset as the value of the [train.sgr](#func.train_user_movie_genre_effect.args.train.sgr).

The *Regularization technique* described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2] is applied to the model being trained only when the *regularization parameter* $\lambda$ passed in the [lambda](#func.train_user_movie_genre_effect.args.lambda) argument, has a value other than the default (to be more exact, greater than zero).

::: {.noteblock data-latex=""}
*Regularization* is committed through the *penalized regression* by computing the *penalized mean* performed by the internally called [mean_reg](#func.mean_reg) function described above in section [Model Tuning Utils] of *this Appendix*.
:::
:::

::: { #func.train_user_movie_genre_effect.value .sidebar }
##### Value
\

Data frame object representing the trained (and also *regularized* if [lambda](#func.train_user_movie_genre_effect.args.lambda) arg value other than default) *UMG Effect Model*.
:::

::: { #func.train_user_movie_genre_effect.code .sidebar }
##### Source Code
\

The source code of the [train_user_movie_genre_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L42) function is shown below:
```{r eval=FALSE}
train_user_movie_genre_effect <- function(train.sgr, lambda = 0){
  if (is.na(lambda)) {
    stop("Function: train_user_movie_genre_effect
`lambda` is `NA`")
  }

  genre_bias <- train.sgr |>
      left_join(edx.user_effect, by = "userId") |>
      left_join(rglr.UM_effect, by = "movieId") |>
      mutate(resid = rating - (mu + a + b)) |>
      group_by(genres) |>
      summarise(g = mean_reg(resid, lambda), n = n())

    train.sgr |>
      left_join(genre_bias, by = "genres") |>
      left_join(rglr.UM_effect, by = "movieId") |>
      group_by(movieId) |>
      summarise(g = mean(g))
}
```

::: {.noteblock data-latex=""}
The source code of the [train_user_movie_genre_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L42) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L3) section of the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L42) script on _GitHub_.
:::
:::

\newpage

#### [train_user_movie_genre_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L61) Function {#func.train_user_movie_genre_effect.cv}
\

Trains (and optionally *regularizes* if the [lambda](#func.train_user_movie_genre_effect.cv.args.lambda) argument value is non-default) the *User+Movie+Genre Effect (UMGE) Model* with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.train_user_movie_genre_effect.cv.usage .sidebar }
##### Usage
\

In the following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L902), the function *being described here* is called with the default value of the [lambda](#func.train_user_movie_genre_effect.cv.args.lambda) argument (therefore, the *Regularization technique* is not used in this call): 
```{r main-script@l902u, eval=FALSE}
# `lambda = 0` by default (the regularization technique is not applied)
cv.UMG_effect <- train_user_movie_genre_effect.cv()
```
```{r}
 str(cv.UMG_effect)
```


In the following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L154), *this function* is called internally from the other custom helper function [regularize.test_lambda.UMG_effect.cv](#func.regularize.test_lambda.UMG_effect.cv) described below in section [UMGE Model: Regularization] of *this Appendix*.\newline
In this case, when the function is passed a non-default value in the [lambda](#func.train_user_movie_genre_effect.cv.args.lambda) argument, the *Regularization technique* is applied:
```{r UMG-effect.func@l154u, eval=FALSE}
umg_effect <- train_user_movie_genre_effect.cv(lambda)
```
:::

::: { #func.train_user_movie_genre_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.train_user_movie_genre_effect.cv.args.lambda .sidebar }
  - **lambda:** (Optional, *Numeric*, $0$ by default) Regularization parameter $\lambda$. 

:::
:::

::: { #func.train_user_movie_genre_effect.cv.details .sidebar }
##### Details
\

The *Regularization technique* described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2] is applied to the model being trained only when the *regularization parameter* $\lambda$ passed in the [lambda](#func.train_user_movie_genre_effect.cv.args.lambda) argument, has a value other than the default (to be more exact, greater than zero).

::: {.noteblock data-latex=""}
To use *regularization*, in *this Project*, the function is called internally from the other *custom helper function* [regularize.test_lambda.UMG_effect.cv](#func.regularize.test_lambda.UMG_effect.cv) (described below in section [UMGE Model: Regularization] of *this Appendix*) as shown above in the [Usage](#func.train_user_movie_genre_effect.cv.usage) section of *this Description*.  
:::

Internally, this function calls the helper function [train_user_movie_genre_effect](#func.train_user_movie_genre_effect) (described above in *this Section*) for each iteration of the *K-Fold Cross-Validation* applied to the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets]. It also calls internally the [union_cv_results](#func.union_cv_results) function described above in section [Models Training Functions] of this *Appendix* to aggregate the cross-validation results.

::: {.noteblock data-latex=""}
The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::
:::

::: { #func.train_user_movie_genre_effect.cv.value .sidebar }
##### Value
\

Data frame object representing the *UMG Effect Model* trained (and also *regularized* if the [lambda](#func.train_user_movie_genre_effect.cv.args.lambda) argument value is other than the default) with use of *K-Fold Cross-Validation*, where the $K$ is the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::

::: { #func.train_user_movie_genre_effect.cv.code .sidebar }
##### Source Code
\

The simplified version of the source code of the [train_user_movie_genre_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L61) function is shown below:
```{r eval=FALSE}
train_user_movie_genre_effect.cv <- function(lambda = 0){
  user_movie_genre_effects_ls <- lapply(kfold_index, function(fold_i){
    cv_fold_dat <- edx_CV[[fold_i]]
    umg_effect <- cv_fold_dat$train.sgr |> train_user_movie_genre_effect(lambda)
    
    put_log2("User+Movie+Genre Effects have been computed for the Fold %1 
of the %2-Fold Cross Validation samples.",
             fold_i,
             CVFolds_N)
    
    umg_effect
  })

  user_movie_genre_effects_united <- union_cv_results(user_movie_genre_effects_ls)

  user_movie_genre_effect <- user_movie_genre_effects_united |>
    group_by(movieId) |>
    summarise(g = mean(g))
  
  if(lambda == 0) put_log("Function `train_user_movie_genre_effect.cv`:
Training completed: User+Movie+Genre Effects model.")
  else put_log1("Function `train_user_movie_genre_effect.cv`:
Training completed: User+Movie+Genre Effects model for lambda: %1...",
                lambda)
  
  user_movie_genre_effect
}
```

::: {.noteblock data-latex=""}
The complete source code of the [train_user_movie_genre_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L61) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L3) section of the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L61) script on _GitHub_.
:::
:::

\newpage

#### [calc_user_movie_genre_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L112) Function {#func.calc_user_movie_genre_effect_MSE}
\

Validates the *UMG Effect (UMGE) Model* built and trained by the  [train_user_movie_genre_effect](#func.train_user_movie_genre_effect) or [train_user_movie_genre_effect.cv](#func.train_user_movie_genre_effect.cv) function call (both described above in *this Section*).

::: { #func.calc_user_movie_genre_effect_MSE.usage .sidebar }
##### Usage
\

```{r UMG-effect.func@l127u, eval=FALSE}
  user_movie_genre_effects_MSEs <- sapply(edx_CV, function(cv_dat){
    cv_dat$validation_set |> calc_user_movie_genre_effect_MSE(umg_effect)
  })
```
:::

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L127) above, the function *being described here* is called internally from the [calc_user_movie_genre_effect_MSE.cv](#func.calc_user_movie_genre_effect_MSE.cv) function (described below in *this Section*) for each iteration of the *K-Fold Cross-Validation*, to calculate the *MSE* for the corresponding validation dataset of the [`edx_CV` Object] (described in [Appendix B: Models Training Datasets]).
:::

::: { #func.calc_user_movie_genre_effect_MSE.args .sidebar }
##### Arguments
\

::: { #func.calc_user_movie_genre_effect_MSE.args.test_set .sidebar }
  - **test_set:** Validation dataset; 

:::
::: { #func.calc_user_movie_genre_effect_MSE.args.umg_effect .sidebar }
  - **umg_effect:** Data frame object representing the *UMG Effect Model*. 

:::
:::

::: { #func.calc_user_movie_genre_effect_MSE.details .sidebar }
##### Details
\

The function calculates *Mean Squared Error (MSE)* for the *UMGE Model* passed in the [umg_effect](#func.calc_user_movie_genre_effect_MSE.args.umg_effect) argument using the validation dataset passed in the [test_set](#func.calc_user_movie_genre_effect_MSE.args.test_set) arg. 

::: {.noteblock data-latex=""}
This is an auxiliary function intended to be called internally from the [calc_user_movie_genre_effect_MSE.cv](#func.calc_user_movie_genre_effect_MSE.cv) (described below in *this Section*) as shown in the [Usage](#func.calc_user_movie_genre_effect_MSE.usage) section above of *this Description*.
:::
:::

::: { #func.calc_user_movie_genre_effect_MSE.value .sidebar }
##### Value
\

*MSE* value calculated for the *UMGE Model*.
:::

\newpage

::: { #func.calc_user_movie_genre_effect_MSE.code .sidebar }
##### Source Code
\

The source code of the [calc_user_movie_genre_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L112) function is shown below:
```{r eval=FALSE}
calc_user_movie_genre_effect_MSE <- function(test_set, umg_effect){
  test_set |>
    left_join(edx.user_effect, by = "userId") |>
    left_join(rglr.UM_effect, by = "movieId") |>
    left_join(umg_effect, by = "movieId") |>
    mutate(resid = rating - clamp(mu + a + b + g)) |> 
    pull(resid) |> mse()
}
```

::: {.noteblock data-latex=""}
The source code of the [calc_user_movie_genre_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L112) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L3) section of the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L112) script on _GitHub_.
:::
:::

\newpage

#### [calc_user_movie_genre_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L124) Function {#func.calc_user_movie_genre_effect_MSE.cv}
\

Validates the *UMG Effect (UMGE) Model* built and trained by the [train_user_movie_genre_effect](#func.train_user_movie_genre_effect) or [train_user_movie_genre_effect.cv](#func.train_user_movie_genre_effect.cv) function call (both described above in *this Section*) with use of *K-Fold Cross-Validation* (as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV]).

::: { #func.calc_user_movie_genre_effect_MSE.cv.usage .sidebar }
##### Usage
\

```{r UMG-effect.func@l139u, eval=FALSE}
  umg_effect_RMSE <- sqrt(calc_user_movie_genre_effect_MSE.cv(umg_effect))
```
:::

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L139) above, the function *being described here* is called internally from the [calc_user_movie_genre_effect_RMSE.cv](#func.calc_user_movie_genre_effect_RMSE.cv) function described below in *this Section*.
:::

::: { #func.calc_user_movie_genre_effect_MSE.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_user_movie_genre_effect_MSE.cv.args.umg_effect .sidebar }
  - **umg_effect:** Data frame object representing the *UMG Effect Model*. 

:::
:::

::: { #func.calc_user_movie_genre_effect_MSE.cv.details .sidebar }
##### Details
\

This function calculates *MSE* for the *UMGE Model* passed in the [umg_effect](#func.calc_user_movie_genre_effect_MSE.cv.args.umg_effect) argument using the validation datasets contained in the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets].

It calls internally the [calc_user_movie_genre_effect_MSE](#func.calc_user_movie_genre_effect_MSE) function for each iteration of the *K-Fold Cross-Validation*, calculating the *MSE* for the corresponding validation dataset of the [`edx_CV` Object], and then calculates the mean of the obtained results.

The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).

::: {.noteblock data-latex=""}
This is an auxiliary function intended to be called internally from the [calc_user_movie_genre_effect_RMSE.cv](#func.calc_user_movie_genre_effect_RMSE.cv) as shown in the [Usage](#func.calc_user_movie_genre_effect_MSE.cv.usage) section above of *this Description*.
:::
:::

::: { #func.calc_user_movie_genre_effect_MSE.cv.value .sidebar }
##### Value
\

The *MSE* value calculated for the *UMGE Model* using *K-Fold Cross-Validation* (see the [Details](#func.calc_user_movie_genre_effect_MSE.cv.details) section of *this Description* above for more details).
:::

::: { #func.calc_user_movie_genre_effect_MSE.cv.code .sidebar }
##### Source Code
\

The simplified version of the source code of the [calc_user_movie_genre_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L124) function is shown below:
```{r eval=FALSE}
calc_user_movie_genre_effect_MSE.cv <- function(umg_effect){
  user_movie_genre_effects_MSEs <- sapply(edx_CV, function(cv_dat){
    cv_dat$validation_set |> calc_user_movie_genre_effect_MSE(umg_effect)
  })

  mean(user_movie_genre_effects_MSEs)
}
```

::: {.noteblock data-latex=""}
The completed source code of the [calc_user_movie_genre_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L124) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L3) section of the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L124) script on _GitHub_.
:::
:::

\newpage

#### [calc_user_movie_genre_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L138) Function {#func.calc_user_movie_genre_effect_RMSE.cv}
\

Validates the *UMG Effect (UMGE) Model* (built and trained by the [train_user_movie_genre_effect](#func.train_user_movie_genre_effect) or [train_user_movie_genre_effect.cv](#func.train_user_movie_genre_effect.cv) function call) with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.calc_user_movie_genre_effect_RMSE.cv.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L931)
\

```{r main-script@l931u, eval=FALSE}
#### Compute UMGE Model RMSE ---------------------------------------------------
cv.UMG_effect.RMSE <- calc_user_movie_genre_effect_RMSE.cv(cv.UMG_effect)
```
```{r}
cv.UMG_effect.RMSE
```
:::

::: { #func.calc_user_movie_genre_effect_RMSE.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_user_movie_genre_effect_RMSE.cv.args.umg_effect .sidebar }
  - **umg_effect:** Data frame object representing the *UMG Effect Model*. 

:::
:::

::: { #func.calc_user_movie_genre_effect_RMSE.cv.details .sidebar }
##### Details
\

The function calculates *Root Squared Error (RMSE)* for the *UMGE Model* passed in the [umg_effect](#func.calc_user_movie_genre_effect_RMSE.cv.args.umg_effect) argument using the validation datasets contained in the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets].\newline
During its execution, it internally calls the [calc_user_movie_genre_effect_MSE.cv](#func.calc_user_movie_genre_effect_MSE.cv) function (described above in *this Section*) to calculate the *MSE* for the *UMGE Model* (with use of *K-Fold Cross-Validation*), and then calculates the square root of the result.

::: {.noteblock data-latex=""}
The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::
:::

::: { #func.calc_user_movie_genre_effect_RMSE.cv.value .sidebar }
##### Value
\

The *RMSE* value calculated for the *UMGE Model* using *K-Fold Cross-Validation* (see the [Details](#func.calc_user_movie_genre_effect_RMSE.cv.details) section of *this Description* above for more details).
:::

\newpage

::: { #func.calc_user_movie_genre_effect_RMSE.cv.code .sidebar }
##### Source Code
\

The simplified version of the source code of the [calc_user_movie_genre_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L138) function is shown below:
```{r eval=FALSE}
calc_user_movie_genre_effect_RMSE.cv <- function(umg_effect){
  sqrt(calc_user_movie_genre_effect_MSE.cv(umg_effect))
}
```

::: {.noteblock data-latex=""}
The complete source code of the [calc_user_movie_genre_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L138) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L3) section of the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L138) script on _GitHub_.
:::
:::

\newpage

### UMGE Model: Regularization
\

#### [regularize.test_lambda.UMG_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L148) Function {#func.regularize.test_lambda.UMG_effect.cv}
\

Validates the *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.test_lambda.UMG_effect.cv.args.lambda) argument for the *User+Movie+Genre Effect (UMGE) Model* in the *regularization process* using *penalized approach* with use of *K-Fold Cross-Validation*.

::: { #func.regularize.test_lambda.UMG_effect.cv.usage .sidebar }
##### Usage
\

```{r main-script@l978u, eval=FALSE}
lambdas <- seq(0, 0.2, 0.01)
cv.UMGE.preset.result <- 
  tune.model_param(lambdas, regularize.test_lambda.UMG_effect.cv)
```
```{r}
str(cv.UMGE.preset.result)
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L978) above the function *being described here* is passed in the [fn_tune.test.param_value](#func.tune.model_param.args.fn_tune.test.param_value) argument to the [tune.model_param](#func.tune.model_param) function described above in section [Model Tuning Utils] of *this Appendix*.

Such a use of this function is also noted in the [Details](#func.regularize.test_lambda.UMG_effect.cv.details) section of *this Description* below.
:::
:::

::: { #func.regularize.test_lambda.UMG_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.regularize.test_lambda.UMG_effect.cv.args.lambda .sidebar }
  - **lambda:** *Regularization parameter* $\lambda$ used to validate the model in the *regularization process*. 

:::
:::

::: { #func.regularize.test_lambda.UMG_effect.cv.details .sidebar }
##### Details
\

The function is used in the *regularization process* of the *UMGE Model* using the *penalized approach* to regularize predictions for the given *regularization parameter* $\lambda$ (passed in the [lambda](#func.regularize.test_lambda.UMG_effect.cv.args.lambda) argument) as explained in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2].

Internally it uses the [train_user_movie_genre_effect.cv](#func.train_user_movie_genre_effect.cv) and [calc_user_movie_genre_effect_RMSE.cv](#func.calc_user_movie_genre_effect_RMSE.cv) functions (described above in [UMGE Model: Utility Functions] section) to validate the *UMGE Model* for the given $\lambda$ with use of the *K-Fold Cross-Validation* method, as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV], where the value of $K$ is determined by the length of the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets] (in *this Project*, we use $K = 5$).

::: {.noteblock data-latex=""}
This function is an auxiliary function specifically designed to be passed in the `fn_tune.test.param_value` argument to the [tune.model_param](#func.tune.model_param) and [model.tune.param_range](#func.model.tune.param_range) functions described above in section [Model Tuning Utils] of *this Appendix*.
:::
:::

::: { #func.regularize.test_lambda.UMG_effect.cv.value .sidebar }
##### Value
\

The *Root Mean Squared Errors (RMSE)* value computed for the UMGE Model applying the *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.test_lambda.UMG_effect.cv.args.lambda) argument.

:::

::: { #func.regularize.test_lambda.UMG_effect.cv.code .sidebar }
##### Source Code
\

The simplified version of the source code of the [regularize.test_lambda.UMG_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L148) function is shown below:
```{r eval=FALSE}
regularize.test_lambda.UMG_effect.cv <- function(lambda){
  umg_effect <- train_user_movie_genre_effect.cv(lambda)
  calc_user_movie_genre_effect_RMSE.cv(umg_effect)
}
```

::: {.noteblock data-latex=""}
The complete source code of the [regularize.test_lambda.UMG_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L148) function is available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L147) section of the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L148) script on _GitHub_.
:::
:::

\newpage

### UMGYE Model: Utility Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the  [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) script on _GitHub_.
:::

#### [calc_date_general_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L4) Function {#func.calc_date_general_effect}
\

This is an auxiliary function that calculates the _Date General Effect_ (optionally *regularizes* if the [lambda](#func.calc_date_general_effect.args.lambda) argument value is non-default) of the user ratings using a *training dataset* passed in the [train_set](#func.calc_date_general_effect.args.train_set) argument, and is intended for use in other helper functions (such as [train_UMGY_effect](#func.train_UMGY_effect) described below in *this Section*), as shown below in section [Usage](#func.calc_date_general_effect.usage) of *this Description*.

::: { #func.calc_date_general_effect.usage .sidebar }
##### Usage
\
```{r UMGY-effect.func@l82u, eval=FALSE}
  train_set |>
    calc_date_general_effect(lambda) |>
    calc_UMGY_effect()
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L82) above, the function *being described here* is called alongside the [calc_UMGY_effect](#func.calc_UMGY_effect) within the [train_UMGY_effect](#func.train_UMGY_effect) (both described below in *this Section*).
:::
:::

::: { #func.calc_date_general_effect.args .sidebar }
##### Arguments
\

::: { #func.calc_date_general_effect.args.train_set .sidebar }
  - **train_set:** Training dataset; 

:::
::: { #func.calc_date_general_effect.args.lambda .sidebar }
  - **lambda:** (Optional, *Numeric*, $0$ by default) Regularization parameter $\lambda$. 

:::
:::

::: { #func.calc_date_general_effect.details .sidebar }
##### Details
\

The *Regularization technique* (described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2]) is applied to the model being trained only when the *regularization parameter* $\lambda$ passed in the [lambda](#func.calc_date_general_effect.args.lambda) argument, has non-default value (to be more exact, greater than zero).

::: {.noteblock data-latex=""}
*Regularization* is committed through the *penalized regression* by computing the *penalized mean* performed by the internally called [mean_reg](#func.mean_reg) function described above in section [Model Tuning Utils] of *this Appendix*.
:::
:::

::: { #func.calc_date_general_effect.value .sidebar }
##### Value
\

Data frame object representing (*regularized* if [lambda](#func.calc_date_general_effect.args.lambda) argument value is non-default) *Date General Effect*.
:::

::: { #func.calc_date_general_effect.code .sidebar }
##### Source Code
\

Below is a slightly simplified version of the source code of the [calc_date_general_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L4) function:
```{r eval=FALSE}
calc_date_general_effect <- function(train_set, lambda = 0){
  dg_effect <- train_set |> 
    left_join(edx.user_effect, by = "userId") |>
    left_join(rglr.UM_effect, by = "movieId") |>
    left_join(rglr.UMG_effect, by = "movieId") |>
    left_join(date_days_map, by = "timestamp") |>
    mutate(resid = rating - (mu + a + b + g)) |>
  group_by(days) |>
    summarise(de = mean_reg(resid, lambda), 
              year = mean(year))
  
  if(lambda == 0) put_log("Function `calc_date_general_effect`:
Date Global Effect has been computed.")
  else put_log1("Function `calc_date_general_effect`:
Date Global Effect has been computed for lambda: %1...",
                lambda)
  dg_effect
}
```

::: {.noteblock data-latex=""}
The complete source code of the [calc_date_general_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L4) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L4) script on _GitHub_.
:::
:::

\newpage

#### [calc_date_general_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L32) Function {#func.calc_date_general_effect.cv}
\

This is an auxiliary function that calculates the *Day General Effect* (optionally *regularizes* if the [lambda](#func.calc_date_general_effect.cv.args.lambda) argument value is non-default) of the user ratings using the K-Fold Cross Validation_ and is intended to be called within another custom helper function, the [train_UMGY_effect.cv](#func.train_UMGY_effect.cv)) (described below in *this Section*) as shown below in the [Usage](#func.calc_date_general_effect.cv.usage) section of *this Description*.

::: { #func.calc_date_general_effect.cv.usage .sidebar }
##### Usage
\
```{r UMGY-effect.func@l92u, eval=FALSE}
calc_date_general_effect.cv(lambda) |> calc_UMGY_effect()  
```

::: {.noteblock data-latex=""}
In the above [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L92), the function *being described here* is called within the [train_UMGY_effect.cv](#func.train_UMGY_effect.cv) function, alongside the [calc_UMGY_effect](#func.calc_UMGY_effect) function (both described below in *this Section*).
:::
:::

::: { #func.calc_date_general_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_date_general_effect.cv.args.lambda .sidebar }
  - **lambda:** (Optional, *Numeric*, $0$ by default) Regularization parameter $\lambda$. 

:::
:::

::: { #func.calc_date_general_effect.cv.details .sidebar }
##### Details
\

The *Regularization technique* described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2] is applied to the model being trained only when the *regularization parameter* $\lambda$ passed in the [lambda](#func.calc_date_general_effect.cv.args.lambda) argument, has a value other than the default (to be more exact, greater than zero).

Internally, this function calls the custom helper function [calc_date_general_effect](#func.calc_date_general_effect) (described above in *this Section*) for each iteration of the *K-Fold Cross-Validation* applied to the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets]. It also calls internally the user-defined auxiliary function [union_cv_results](#func.union_cv_results) described above in section [Models Training Functions] of this *Appendix* to aggregate the cross-validation results.

::: {.noteblock data-latex=""}
The $K$ value for the *K-Fold Cross-Validation* method is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::
:::

::: { #func.calc_date_general_effect.cv.value .sidebar }
##### Value
\

Data frame object representing (*regularized* if [lambda](#func.calc_date_general_effect.cv.args.lambda) argument value is non-default) *Date General Effect*.
:::

\newpage

::: { #func.calc_date_general_effect.cv.code .sidebar }
##### Source Code
\

Below is a simplified version of the source code of the [calc_date_general_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L32) function:
```{r eval=FALSE}
calc_date_general_effect.cv <- function(lambda = 0){

  date_general_effect_ls <- lapply(edx_CV,  function(cv_fold_dat){
    cv_fold_dat$train_set |> calc_date_general_effect(lambda)
  })
  put_log1("Function `calc_date_general_effect.cv`:
Date Global Effect list has been computed for %1-Fold Cross Validation samples.", 
           CVFolds_N)
  
  date_general_effect_united <- union_cv_results(date_general_effect_ls)

  date_general_effect <- date_general_effect_united |>
    group_by(days) |>
    summarise(de = mean(de, na.rm = TRUE), year = mean(year, na.rm = TRUE))
  
  if(lambda == 0) put_log("Function `calc_date_general_effect.cv`:
Training completed: Date Global Effects model.")
  else put_log1("Function `calc_date_general_effect.cv`:
Training completed: Date Global Effects model for lambda: %1...",
                lambda)
  
  date_general_effect
}
```

::: {.noteblock data-latex=""}
The complete source code of the [calc_date_general_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L32) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L32) script on _GitHub_.
:::
:::

\newpage

#### [calc_UMGY_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L71) Function {#func.calc_UMGY_effect}
\

Builds the *User+Movie+Genre+Year Effect (UMGYE) Model* based on the *Date General Effect* data structure returned by the [calc_date_general_effect](#func.calc_date_general_effect) or [calc_date_general_effect.cv](#func.calc_date_general_effect.cv) function (both described above in *this Section*) and passed in the [date_general_effect](#func.calc_UMGY_effect.args.date_general_effect) argument as shown in the example provided below in the [Usage](#func.calc_UMGY_effect.usage) section of *this Description*.

::: { #func.calc_UMGY_effect.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  train_set |>
    calc_date_general_effect(lambda) |>
    calc_UMGY_effect()
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L82) above, the function *being described here* is called internally alongside [calc_date_general_effect](#func.calc_date_general_effect) from the [train_UMGY_effect](#func.train_UMGY_effect) (described above and below, respectively, in *this Section*).
:::
:::

::: { #func.calc_UMGY_effect.args .sidebar }
##### Arguments
\

::: { #func.calc_UMGY_effect.args.date_general_effect .sidebar }
  - **date_general_effect:** *Data frame* object representing the *Date General Effect*; 

:::
:::

::: { #func.calc_UMGY_effect.details .sidebar }
##### Details
\

This is an auxiliary function intended to be called internally from the following functions (both described below in *this Section*):

- [train_UMGY_effect](#func.train_UMGY_effect) (an example of calling the function *being described* from *this function* is shown above in the [Usage](#func.calc_UMGY_effect.usage) section of *this Description*);
- [train_UMGY_effect.cv](#func.train_UMGY_effect.cv).

:::

::: { #func.calc_UMGY_effect.value .sidebar }
##### Value
\

Data frame object representing the *UMGYE Model*.
:::

\newpage

::: { #func.calc_UMGY_effect.code .sidebar }
##### Source Code
\

The source code of the [calc_UMGY_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L71) function is shown below:
```{r eval=FALSE}
calc_UMGY_effect <- function(date_general_effect){
  date_general_effect |>
    group_by(year) |>
    summarise(ye = mean(de, na.rm = TRUE))
}
```

::: {.noteblock data-latex=""}
The source code of the [calc_UMGY_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L71) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L71) script on _GitHub_.
:::
:::

\newpage


#### [train_UMGY_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L76) Function {#func.train_UMGY_effect}
\

Trains (and optionally *regularizes* if the [lambda](#func.train_UMGY_effect.args.lambda) argument value is non-default) the *User+Movie+Genre+Year Effect (UMGYE) Model* using the training sample of the `Movielens` dataset passed in the [train_set](#func.train_UMGY_effect.args.train_set) argument.

::: { #func.train_UMGY_effect.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1340)
\

```{r main-script@l1340u, eval=FALSE}
  rglr.UMGY_effect <- edx |> train_UMGY_effect(UMGYE.rglr.best_lambda)
```
```{r}
str(rglr.UMGY_effect)
```
:::

::: { #func.train_UMGY_effect.args .sidebar }
##### Arguments
\

::: { #func.train_UMGY_effect.args.train_set .sidebar }
- **train_set:** Training sample of the `Movielens` dataset; 

:::
::: { #func.train_UMGY_effect.args.lambda .sidebar }
- **lambda:** (Optional, *Numeric*, $0$ by default) Regularization parameter $\lambda$. 

:::
:::

::: { #func.train_UMGY_effect.details .sidebar }
##### Details
\

This function calls internally the following *user-defined auxiliary functions* (both described above in *this Section*):

* [calc_date_general_effect](#func.calc_date_general_effect); 
* [calc_UMGY_effect](#func.calc_UMGY_effect).

The *Regularization technique* described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2] is applied to the model being trained only when the *regularization parameter* $\lambda$ passed in the [lambda](#func.train_UMGY_effect.args.lambda) argument, has a value other than the default (to be more exact, greater than zero).
:::

::: { #func.train_UMGY_effect.value .sidebar }
##### Value
\

Data frame object representing the trained (and also *regularized* if [lambda](#func.train_UMGY_effect.args.lambda) argument value is non-default) *UMGY Effect Model*.
:::

\newpage

::: { #func.train_UMGY_effect.code .sidebar }
##### Source Code
\

The source code of the [train_UMGY_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L76) function is shown below:
```{r eval=FALSE}
train_UMGY_effect <- function(train_set, lambda = 0){
  if (is.na(lambda)) {
    stop("Function: train_UMGY_effect
`lambda` is `NA`")
  }
  
  train_set |>
    calc_date_general_effect(lambda) |>
    calc_UMGY_effect()
}
```

::: {.noteblock data-latex=""}
The source code of the [train_UMGY_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L76) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L76) script on _GitHub_.
:::
:::

\newpage

#### [train_UMGY_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L86) Function {#func.train_UMGY_effect.cv}
\

Trains (and optionally *regularizes* if the [lambda](#func.train_UMGY_effect.cv.args.lambda) argument value is non-default) the *User+Movie+Genre+Year Effect (UMGYE) Model* with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.train_UMGY_effect.cv.usage .sidebar }
##### Usage
\

```{r UMGY-effect.func@l136u, eval=FALSE}
  train_UMGY_effect.cv(lambda) |>
    calc_UMGY_effect_RMSE.cv()
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L136) above, the function *being described here* is called alongside the [calc_UMGY_effect_RMSE.cv](#func.calc_UMGY_effect_RMSE.cv) (described below in *this Section*) within the custom helper function [regularize.test_lambda.UMGY_effect.cv](#func.regularize.test_lambda.UMGY_effect.cv) (described below in section [UMGYE Model: Regularization] of *this Appendix*).
:::
:::

::: { #func.train_UMGY_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.train_UMGY_effect.cv.args.lambda .sidebar }
  - **lambda:** (Optional, *Numeric*, $0$ by default) Regularization parameter $\lambda$. 

:::
:::

::: { #func.train_UMGY_effect.cv.details .sidebar }
##### Details
\

This function calls internally the following *user-defined auxiliary functions* (both described above in *this Section*):

* [calc_date_general_effect.cv](#func.calc_date_general_effect.cv); 
* [calc_UMGY_effect](#func.calc_UMGY_effect).

The *Regularization technique* described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2] is applied to the model being trained only when the *regularization parameter* $\lambda$ passed in the [lambda](#func.train_UMGY_effect.cv.args.lambda) argument, has a value other than the default (to be more exact, greater than zero).

::: {.noteblock data-latex=""}
To use *regularization*, in *this Project*, this function is called within the [regularize.test_lambda.UMGY_effect.cv](#func.regularize.test_lambda.UMGY_effect.cv) custom helper function (described below in section [UMGYE Model: Regularization] of *this Appendix*) as shown above in the [Usage](#func.train_UMGY_effect.cv.usage) section of *this Description*.
:::
:::
:::

::: { #func.train_UMGY_effect.cv.value .sidebar }
##### Value
\

Data frame object representing the *UMGY Effect Model* trained (and also *regularized* if the [lambda](#func.train_UMGY_effect.cv.args.lambda) argument value is non-default) with use of *K-Fold Cross-Validation*, where the $K$ is the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::

\newpage

::: { #func.train_UMGY_effect.cv.code .sidebar }
##### Source Code
\

The source code of the [train_UMGY_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L86) function is shown below:
```{r eval=FALSE}
train_UMGY_effect.cv <- function(lambda = 0){
  if (is.na(lambda)) {
    stop("Function: train_UMGY_effect.cv
`lambda` is `NA`")
  }
  
  calc_date_general_effect.cv(lambda) |> calc_UMGY_effect()  
}
```

::: {.noteblock data-latex=""}
The source code of the [train_UMGY_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L86) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L86) script on _GitHub_.
:::
:::

\newpage

#### [calc_UMGY_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L94) Function {#func.calc_UMGY_effect_MSE}
\

Validates the *UMGY Effect (UMGYE) Model* built and trained by the [train_UMGY_effect](#func.train_UMGY_effect) or [train_UMGY_effect.cv](#func.train_UMGY_effect.cv) function call (both described above in *this Section*).

::: { #func.calc_UMGY_effect_MSE.usage .sidebar }
##### Usage
\

In the following [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L106), the function *being described here* is called internally from the [calc_UMGY_effect_MSE.cv](#func.calc_UMGY_effect_MSE.cv) function (described below in *this Section*) for each iteration of the *K-Fold Cross-Validation*, to calculate the *MSE* for the corresponding validation dataset of the [`edx_CV` Object] (described in [Appendix B: Models Training Datasets]).
```{r UMGY-effect.func@l106u, eval=FALSE}
  UMGY_effect_MSEs <- sapply(edx_CV, function(cv_fold_dat){
    cv_fold_dat$validation_set |> calc_UMGY_effect_MSE(UMGY_effect)
  })
```

::: {.noteblock data-latex=""}
The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::
:::

::: { #func.calc_UMGY_effect_MSE.args .sidebar }
##### Arguments
\

::: { #func.calc_UMGY_effect_MSE.args.test_set .sidebar }
  - **test_set:** Validation dataset; 

:::
::: { #func.calc_UMGY_effect_MSE.args.UMGY_effect .sidebar }
  - **UMGY_effect:** Data frame object representing the *UMGY Effect Model*. 

:::
:::

::: { #func.calc_UMGY_effect_MSE.details .sidebar }
##### Details
\

The function calculates *Mean Squared Error (MSE)* for the *UMGYE Model* passed in the [UMGY_effect](#func.calc_UMGY_effect_MSE.args.UMGY_effect) argument using the validation dataset passed in the [test_set](#func.calc_UMGY_effect_MSE.args.test_set) arg. 

::: {.noteblock data-latex=""}
This is an auxiliary function intended to be called within the [calc_UMGY_effect_MSE.cv](#func.calc_UMGY_effect_MSE.cv) (described below in *this Section*) as shown in the [Usage](#func.calc_user_movie_genre_effect_MSE.usage) section above of *this Description*.
:::
:::

::: { #func.calc_UMGY_effect_MSE.value .sidebar }
##### Value
\

*MSE* value calculated for the *UMGYE Model*.
:::

\newpage

::: { #func.calc_UMGY_effect_MSE.code .sidebar }
##### Source Code
\

The source code of the [calc_UMGY_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L94) function is shown below:
```{r eval=FALSE}
calc_UMGY_effect_MSE <- function(test_set, UMGY_effect){
  test_set |>
    left_join(edx.user_effect, by = "userId") |>
    left_join(rglr.UM_effect, by = "movieId") |>
    left_join(rglr.UMG_effect, by = "movieId") |>
    left_join(date_days_map, by = "timestamp") |>
    left_join(UMGY_effect, by='year') |>
    mutate(resid = rating - clamp(mu + a + b + g + ye)) |> 
    pull(resid) |> mse()
}
```

::: {.noteblock data-latex=""}
The source code of the [calc_UMGY_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L94) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L94) script on _GitHub_.
:::
:::

\newpage

#### [calc_UMGY_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L104) Function {#func.calc_UMGY_effect_MSE.cv}
\

Validates the *UMGY Effect (UMGYE) Model* built and trained by the [train_UMGY_effect](#func.train_UMGY_effect) or [train_UMGY_effect.cv](#func.train_UMGY_effect.cv) function call (both described above in *this Section*) with use of *K-Fold Cross-Validation* (as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV]).

::: { #func.calc_UMGY_effect_MSE.cv.usage .sidebar }
##### Usage
\

```{r UMGY-effect.func@l121u, eval=FALSE}
  UMGY_effect_RMSE <- sqrt(calc_UMGY_effect_MSE.cv(UMGY_effect))
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L121) above, the function *being described here* is called internally from the [calc_UMGY_effect_RMSE.cv](#func.calc_UMGY_effect_RMSE.cv) function described below in *this Section*.
:::
:::

::: { #func.calc_UMGY_effect_MSE.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_UMGY_effect_MSE.cv.args.UMGY_effect .sidebar }
  - **UMGY_effect:** Data frame object representing the *UMGY Effect Model*. 

:::
:::

::: { #func.calc_UMGY_effect_MSE.cv.details .sidebar }
##### Details
\

The function calculates *MSE* for the *UMGYE Model* passed in the [UMGY_effect](#func.calc_UMGY_effect_MSE.cv.args.UMGY_effect) argument using the validation datasets contained in the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets].

It internally calls the [calc_UMGY_effect_MSE](#func.calc_UMGY_effect_MSE) function for each iteration of the *K-Fold Cross-Validation*, calculating the *MSE* for the corresponding validation dataset of the [`edx_CV` Object], and then calculates the mean of the obtained results.

The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).

::: {.noteblock data-latex=""}
This is an auxiliary function intended to be called within the [calc_UMGY_effect_RMSE.cv](#func.calc_UMGY_effect_RMSE.cv) function (described below in this section) as shown in the [Usage](#func.calc_UMGY_effect_MSE.cv.usage) section above of *This Description*.
:::
:::

::: { #func.calc_UMGY_effect_MSE.cv.value .sidebar }
##### Value
\

The *MSE* value calculated for the *UMGYE Model* using *K-Fold Cross-Validation* (see the [Details](#func.calc_UMGY_effect_MSE.cv.details) section of *this Description* above for more details).
:::

\newpage

::: { #func.calc_UMGY_effect_MSE.cv.code .sidebar }
##### Source Code
\

The simplified version of the source code of the [calc_UMGY_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L104) function is shown below:
```{r eval=FALSE}
calc_UMGY_effect_MSE.cv <- function(UMGY_effect){
  start <- put_start_date()
  UMGY_effect_MSEs <- sapply(edx_CV, function(cv_fold_dat){
    cv_fold_dat$validation_set |> calc_UMGY_effect_MSE(UMGY_effect)
  })
  put_end_date(start)
  put_log1("Function: calc_UMGY_effect_MSE.cv
Date (Year) Effect MSE values have been computed for the %1-Fold Cross Validation samples.", 
           CVFolds_N)
  
  mean(UMGY_effect_MSEs)
}
```

::: {.noteblock data-latex=""}
The completed source code of the [calc_UMGY_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L104) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L104) script on _GitHub_.
:::
:::

\newpage

#### [calc_UMGY_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L120) Function {#func.calc_UMGY_effect_RMSE.cv}
\

Validates the *UMGY Effect (UMGYE) Model* (built and trained by the [train_UMGY_effect](#func.train_UMGY_effect) or [train_UMGY_effect.cv](#func.train_UMGY_effect.cv) function call) with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: { #func.calc_UMGY_effect_RMSE.cv.usage .sidebar }
##### [Usage](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1194)
\

```{r main-script@l1194u, eval=FALSE}
#### Compute User+Movie+Genre+Year Effect Model RMSE ---------------------------
cv.UMGY_effect.RMSE <- calc_UMGY_effect_RMSE.cv(cv.UMGY_effect)
```
```{r}
cv.UMGY_effect.RMSE
```
:::

::: { #func.calc_UMGY_effect_RMSE.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_UMGY_effect_RMSE.cv.args.UMGY_effect .sidebar }
  - **UMGY_effect:** Data frame object representing the *UMGY Effect Model*. 

:::
:::

::: { #func.calc_UMGY_effect_RMSE.cv.details .sidebar }
##### Details
\

The function calculates *Root Squared Error (RMSE)* for the *UMGYE Model* passed in the [UMGY_effect](#func.calc_UMGY_effect_RMSE.cv.args.UMGY_effect) argument using the validation datasets contained in the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets].\newline
During its execution, it internally calls the [calc_UMGY_effect_MSE.cv](#func.calc_UMGY_effect_MSE.cv) function (described above in *this Section*) to calculate the *MSE* for the *UMGE Model* (with use of *K-Fold Cross-Validation*), and then calculates the square root of the result.

::: {.noteblock data-latex=""}
The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::
:::

::: { #func.calc_UMGY_effect_RMSE.cv.value .sidebar }
##### Value
\

The *RMSE* value calculated for the *UMGYE Model* using *K-Fold Cross-Validation* (see the [Details](#func.calc_UMGY_effect_RMSE.cv.details) section of *this Description* above for more details).
:::

\newpage

::: { #func.calc_UMGY_effect_RMSE.cv.code .sidebar }
##### Source Code
\

The source code of the [calc_UMGY_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L120) function is shown below:
```{r eval=FALSE}
calc_UMGY_effect_RMSE.cv <- function(UMGY_effect){
  UMGY_effect_RMSE <- sqrt(calc_UMGY_effect_MSE.cv(UMGY_effect))
  put_log2("%1-Fold Cross Validation ultimate RMSE: %2", 
           CVFolds_N, 
           UMGY_effect_RMSE)
  
  UMGY_effect_RMSE
}
```

::: {.noteblock data-latex=""}
The source code of the [calc_UMGY_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L120) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L3) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L120) script on _GitHub_.
:::
:::

\newpage

### UMGYE Model: Regularization
\

#### [regularize.test_lambda.UMGY_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L130) Function {#func.regularize.test_lambda.UMGY_effect.cv}
\

Validates the *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.test_lambda.UMGY_effect.cv.args.lambda) argument for the *User+Movie+Genre+Year Effect (UMGYE) Model* in the *regularization process* using *penalized approach* with use of *K-Fold Cross-Validation*.

::: { #func.regularize.test_lambda.UMGY_effect.cv.usage .sidebar }
##### Usage
\

```{r main-script@l1241u, eval=FALSE}
  lambdas <- seq(0, 512, 32)
  cv.UMGYE.preset.result <- 
    tune.model_param(lambdas, 
                     regularize.test_lambda.UMGY_effect.cv,
                     steps.beyond_min = 16)
```
```{r}
str(cv.UMGYE.preset.result)
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1241) above the function *being described here* is passed in the [fn_tune.test.param_value](#func.tune.model_param.args.fn_tune.test.param_value) argument to the [tune.model_param](#func.tune.model_param) function described above in section [Model Tuning Utils] of *this Appendix*.

Such a use of this function is also noted in the [Details](#func.regularize.test_lambda.UMGY_effect.cv.details) section of *this Description* below.
:::
:::

::: { #func.regularize.test_lambda.UMGY_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.regularize.test_lambda.UMGY_effect.cv.args.lambda .sidebar }
  - **lambda:** *Regularization parameter* $\lambda$ used to validate the model in the *regularization process*. 

:::
:::

\newpage

::: { #func.regularize.test_lambda.UMGY_effect.cv.details .sidebar }
##### Details
\

The function is used in the *regularization process* of the *UMGYE Model* using the *penalized approach* to regularize predictions for the given *regularization parameter* $\lambda$ (passed in the [lambda](#func.regularize.test_lambda.UMGY_effect.cv.args.lambda) argument) as explained in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2].

Internally it uses the [train_UMGY_effect.cv](#func.train_UMGY_effect.cv) and [calc_UMGY_effect_RMSE.cv](#func.calc_UMGY_effect_RMSE.cv) functions (described above in [UMGYE Model: Utility Functions] section) to validate the *UMGYE Model* for the given $\lambda$ with use of the *K-Fold Cross-Validation* method, as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV], where the value of $K$ is determined by the length of the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets] (in *this Project*, we use $K = 5$).

::: {.noteblock data-latex=""}
This function is an auxiliary function specifically designed to be passed in the `fn_tune.test.param_value` argument to the [tune.model_param](#func.tune.model_param) and [model.tune.param_range](#func.model.tune.param_range) functions described above in section [Model Tuning Utils] of *this Appendix*.
:::
:::

::: { #func.regularize.test_lambda.UMGY_effect.cv.value .sidebar }
##### Value
\

The *Root Mean Squared Errors (RMSE)* value computed for the UMGYE Model applying the *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.test_lambda.UMGY_effect.cv.args.lambda) argument.

:::

::: { #func.regularize.test_lambda.UMGY_effect.cv.code .sidebar }
##### Source Code
\

The source code of the [regularize.test_lambda.UMGY_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L130) function is shown below:
```{r eval=FALSE}
regularize.test_lambda.UMGY_effect.cv <- function(lambda){
  if (is.na(lambda)) {
    stop("Function: regularize.test_lambda.UMGY_effect.cv
`lambda` is `NA`")
  }
  
  train_UMGY_effect.cv(lambda) |>
    calc_UMGY_effect_RMSE.cv()
}
```

::: {.noteblock data-latex=""}
The source code of the [regularize.test_lambda.UMGY_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L130) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L129) section of the [UMGY-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGY-effect.functions.R#L130) script on _GitHub_.
:::
:::

\newpage

### UMGYDE Model: Utility Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the  [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) script on _GitHub_.
:::

#### [calc_day_general_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L4) Function {#func.calc_day_general_effect}
\

Computes the *Day General Effect* (hereafter *DG Effect* or *DGE* for short), optionally *regularized* if the [lambda](#func.calc_day_general_effect.args.lambda) argument value is non-default, of user ratings on a *given day since the earliest record* in the `edx` dataset, using a *training dataset* passed in the [train_set](#func.calc_day_general_effect.args.train_set) argument.

::: { #func.calc_day_general_effect.usage .sidebar }
##### Usage
\
```{r UMGYD-effect.func@l108u, eval=FALSE}
  train_set |> 
    calc_day_general_effect(lambda) |>
    calc_UMGY_SmoothedDay_effect(degree, span)
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L108) above, the function *being described here* is called alongside the [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) within the [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect) function (both described below in this section).
:::
:::

::: { #func.calc_day_general_effect.args .sidebar }
##### Arguments
\

::: { #func.calc_day_general_effect.args.train_set .sidebar }
  - **train_set:** Training dataset containing data to compute the *DG Effect*; 

:::
::: { #func.calc_day_general_effect.args.lambda .sidebar }
  - **lambda:** (Optional, *Numeric*, $0$ by default) Regularization parameter $\lambda$. 

:::
:::

::: { #func.calc_day_general_effect.details .sidebar }
##### Details
\

This is an auxiliary function intended to be called within the following custom helper functions:  the [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect) (as shown above in the [Usage](#func.calc_day_general_effect.usage) section of *this Description*) and the [calc_day_general_effect.cv](#func.calc_day_general_effect.cv) (both described below in *this Section*). 

The *Regularization technique* described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2] is applied to the model being trained only when the *regularization parameter* $\lambda$ passed in the [lambda](#func.calc_day_general_effect.args.lambda) argument, has a value other than the default (to be more exact, greater than zero).

::: {.noteblock data-latex=""}
*Regularization* is committed through the *penalized regression* by computing the *penalized mean* performed by the internally called [mean_reg](#func.mean_reg) function described above in section [Model Tuning Utils] of *this Appendix*.
:::
:::

::: { #func.calc_day_general_effect.value .sidebar }
##### Value
\

Data frame object representing *DG Effect* (optionally, *regularized* if [lambda](#func.calc_day_general_effect.args.lambda) argument value is non-default).
:::

::: { #func.calc_day_general_effect.code .sidebar }
##### Source Code
\

Below is a slightly simplified version of the source code of the [calc_day_general_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L4) function:
```{r eval=FALSE}
calc_day_general_effect <- function(train_set, lambda = 0){
  gday_effect <- train_set |> 
    left_join(edx.user_effect, by = "userId") |>
    left_join(rglr.UM_effect, by = "movieId") |>
    left_join(rglr.UMG_effect, by = "movieId") |>
    left_join(date_days_map, by = "timestamp") |>
    left_join(rglr.UMGY_effect, by='year') |>
    mutate(resid = rating - (mu + a + b + g + ye)) |>
    group_by(days) |>
    summarise(de = mean_reg(resid, lambda), 
              year = mean(year))
  
  if(lambda == 0) put_log("Function `calc_day_general_effect`:
Day General Effect has been computed.")
  else put_log1("Function `calc_day_general_effect`:
Day General Effect has been computed for lambda: %1...",
                lambda)
  gday_effect
}
```

::: {.noteblock data-latex=""}
The complete source code of the [calc_day_general_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L4) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L4) script on _GitHub_.
:::
:::

\newpage

#### [calc_day_general_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L33) Function {#func.calc_day_general_effect.cv}
\

This is an auxiliary function that calculates the *Day General Effect* (optionally *regularizes* if the [lambda](#func.calc_day_general_effect.cv.args.lambda) argument value is non-default) of the user ratings using the K-Fold Cross Validation_ and is intended to be called within another custom helper function, the [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv)) (described below in *this Section*) as shown below in the [Usage](#func.calc_day_general_effect.cv.usage) section of *this Description*.

::: { #func.calc_day_general_effect.cv.usage .sidebar }
##### Usage
\
```{r UMGYD-effect.func@l121u, eval=FALSE}
  calc_day_general_effect.cv(lambda) |>
    calc_UMGY_SmoothedDay_effect(degree, span)
```

::: {.noteblock data-latex=""}
In the above [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L121), the function *being described here* is called within the [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv) function, alongside the [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) function (both described below in *this Section*).
:::
:::

::: { #func.calc_day_general_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_day_general_effect.cv.args.lambda .sidebar }
  - **lambda:** (Optional, *Numeric*, $0$ by default) Regularization parameter $\lambda$. 

:::
:::

::: { #func.calc_day_general_effect.cv.details .sidebar }
##### Details
\

The *Regularization technique* described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2] is applied to the model being trained only when the *regularization parameter* $\lambda$ passed in the [lambda](#func.calc_day_general_effect.cv.args.lambda) argument, has a value other than the default (to be more exact, greater than zero).

Internally, this function calls the custom helper functions [calc_day_general_effect](#func.calc_day_general_effect) function (described above in *this Section*) for each iteration of the *K-Fold Cross-Validation* applied to the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets]. It also calls internally the user-defined auxiliary function [union_cv_results](#func.union_cv_results) described above in section [Models Training Functions] of this *Appendix* to aggregate the cross-validation results.


::: {.noteblock data-latex=""}
The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::
:::

::: { #func.calc_day_general_effect.cv.value .sidebar }
##### Value
\

Data frame object representing (*regularized* if [lambda](#func.calc_day_general_effect.cv.args.lambda) argument value is non-default) *Day General Effect*.
:::

\newpage

::: { #func.calc_day_general_effect.cv.code .sidebar }
##### Source Code
\

Below is a simplified version of the source code of the [calc_day_general_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L33) function:
```{r UMGYD_effect.func@l33u, eval=FALSE}
calc_day_general_effect.cv <- function(lambda = 0){
  
  put_log1("Function `calc_day_general_effect.cv`:
Computing Day General Effect list for %1-Fold Cross Validation samples...", 
           CVFolds_N)

  gday_effect_ls <- lapply(edx_CV,  function(cv_fold_dat){
    cv_fold_dat$train_set |> calc_day_general_effect(lambda)
  })

  gday_effect_united <- union_cv_results(gday_effect_ls)

  gday_effect_united |>
    group_by(days) |>
    summarise(de = mean(de), year = mean(year))
  
}
```

::: {.noteblock data-latex=""}
The complete source code of the [calc_day_general_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L33) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L33) script on _GitHub_.
:::
:::

\newpage

#### [loess_de](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L71) Function {#func.loess_de}
\

Using local fitting, fits a polynomial surface determined by the *Day General Effect* (hereafter *DG Effect* or *DGE* for short) data passed in the [de_bias.dat](#func.loess_de.args.de_bias.dat) argument.

::: {.noteblock data-latex=""}
In *this Project*, the *DGE* data object to be passed in the [de_bias.dat](#func.loess_de.args.de_bias.dat) argument is returned by the [calc_day_general_effect](#func.calc_day_general_effect) and [calc_day_general_effect.cv](#func.calc_day_general_effect.cv) functions (both described above).
:::

::: { #func.loess_de.usage .sidebar }
##### Usage
\

```{r UMGYD_effect.func@l87, eval=FALSE}
  fit <- day_gen_effect |> loess_de(degree, span)
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L87) above, the function described here is called within the [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) custom helper function (described below in *this Section*).
:::
:::

::: { #func.loess_de.args .sidebar }
##### Arguments
\

::: { #func.loess_de.args.de_bias.dat .sidebar }
###### ***de_bias.dat***
\

Data frame object representing the *Day General Effect*. 
:::

::: { #func.loess_de.args.degree .sidebar }
###### ***degree***
\

(Optional, *Integer*, `NA` by default) The degree of the polynomials to pass in the same-named argument to the internally called [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) function.

::: {.noteblock data-latex=""}
When the value is `NA` (the default), the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) is called with `degree = 1`. 
:::
:::

::: { #func.loess_de.args.span .sidebar }
###### ***span***
\

(Optional, *Numeric*, `NA` by default ) The parameter $\alpha$ (which controls the degree of smoothing) to pass in the same-named argument to the internally called [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess).

::: {.noteblock data-latex=""}
When the value is `NA` (the default), the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) is called with `span = 0.75`. 
:::
:::
:::

::: { #func.loess_de.details .sidebar }
##### Details
\

This function is a wrapper for the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) `R` function, which is called internally to make a necessary fit.

::: {.noteblock data-latex=""}
This is an auxiliary function intended for use in other custom helper functions, such as the [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) (described below in *this Section*) as shown above in the [Usage](#func.loess_de.usage) section of *this Description*.
:::
:::

::: { #func.loess_de.value .sidebar }
##### Value
\

Object of class `loess` returned by the internally called [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess).
:::

::: { #func.loess_de.code .sidebar }
##### Source Code
\

The source code of the [loess_de](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L71) function is shown below:
```{r eval=FALSE}
loess_de <- function(de_bias.dat, degree = NA, span = NA){
  if(is.na(degree)) degree = 1
  if(is.na(span)) span = 0.75
  loess(de ~ days, span = span, degree = degree, data = de_bias.dat)
}
```

::: {.noteblock data-latex=""}
The source code of the [loess_de](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L71) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L71) script on _GitHub_.
:::
:::

\newpage

#### [calc_UMGY_SmoothedDay_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L76) Function {#func.calc_UMGY_SmoothedDay_effect}
\

Builds the *User+Movie+Genre+Year+SmoothedDay Effect* (hereafter *UMGYDE* for short) *Model* based on the *Day General Effect* (*DG Effect* for short) data structure returned by the [calc_day_general_effect](#func.calc_day_general_effect) or [calc_day_general_effect.cv](#func.calc_day_general_effect.cv) function (both described above) and passed in the [date_general_effect](#func.calc_UMGY_SmoothedDay_effect.args.date_general_effect) argument.

::: { #func.calc_UMGY_SmoothedDay_effect.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  train_set |> 
    calc_day_general_effect(lambda) |>
    calc_UMGY_SmoothedDay_effect(degree, span)
```

::: {.noteblock data-latex=""}
In the code snippet above, the function `calc_UMGY_SmoothedDay_effect` is called internally from the [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect) function described below.
:::
:::

::: { #func.calc_UMGY_SmoothedDay_effect.args .sidebar }
##### Arguments
\

::: { #func.calc_UMGY_SmoothedDay_effect.args.date_general_effect .sidebar }
  - **date_general_effect:** Data frame object representing the *DG Effect* (to pass in the [de_bias.dat](#func.loess_de.args.de_bias.dat) argument to the internally called [loess_de](#func.loess_de) described above); 

:::
::: { #func.calc_UMGY_SmoothedDay_effect.args.degree .sidebar }
  - **degree:** (Optional, *Integer*, `NA` by default) The degree of the polynomials to pass in the same-named argument to the internally called [loess_de](#func.loess_de) described above; 

:::
::: { #func.calc_UMGY_SmoothedDay_effect.args.span .sidebar }
  - **span:** (Numeric, `NA` by default ) The parameter $\alpha$ (which controls the degree of smoothing) to pass in the same-named argument to the internally called [loess_de](#func.loess_de) described above. 

:::
:::

::: { #func.calc_UMGY_SmoothedDay_effect.details .sidebar }
##### Details
\

This auxiliary function is a wrapper for the [loess_de](#func.loess_de) described above, intended to be used internally in the following helper functions (both described below in this section):

  - [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect);
  
  - [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv).


An example of using it in the [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect) function is shown above in the [Usage](#func.calc_UMGY_SmoothedDay_effect.usage) section of *this Description*:
:::

::: { #func.calc_UMGY_SmoothedDay_effect.value .sidebar }
##### Value
\

Data frame object representing the *UMGYDE Model*.
:::

::: { #func.calc_UMGY_SmoothedDay_effect.code .sidebar }
##### Source Code
\

Below is a slightly simplified version of the source code of the [calc_UMGY_SmoothedDay_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L76) function:
```{r eval=FALSE}
calc_UMGY_SmoothedDay_effect <- function(day_gen_effect, 
                                         degree = NA, 
                                         span = NA){
  fit <- day_gen_effect |> loess_de(degree, span)
  smth_day_effect <- day_gen_effect |> mutate(de_smoothed = fit$fitted)
  
  put_log2("Function `calc_UMGY_SmoothedDay_effect`: 
Model has been trained using `loess` function with the following parameters:
degree: %1;
span: %2.",
           degree,
           span)
  
  smth_day_effect
}
```

::: {.noteblock data-latex=""}
The complete source code of the [calc_UMGY_SmoothedDay_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L76) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L76) script on _GitHub_.
:::
:::

\newpage


#### [train_UMGY_SmoothedDay_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L99) Function {#func.train_UMGY_SmoothedDay_effect}
\

Trains (and optionally *regularizes* if the [lambda](#func.train_UMGY_SmoothedDay_effect.args.lambda) argument value is non-default) the *User+Movie+Genre+Year+SmoothedDay Effect (UMGYDE) Model* using the training sample of the `Movielens` dataset passed in the [train_set](#func.train_UMGY_SmoothedDay_effect.args.train_set) argument.

::: { #func.train_UMGY_SmoothedDay_effect.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  lss.UMGYD_effect <- edx |> 
    train_UMGY_SmoothedDay_effect(lss.best_degree, lss.best_span)
```
:::

::: { #func.train_UMGY_SmoothedDay_effect.args .sidebar }
##### Arguments
\

::: { #func.train_UMGY_SmoothedDay_effect.args.train_set .sidebar }
  - **train_set:** Training sample of the `Movielens` dataset; 

:::

::: { #func.train_UMGY_SmoothedDay_effect.args.degree .sidebar }
  - **degree:** (Optional, *Integer*, `NA` by default) The degree of the polynomials to pass in the same-named argument to the internally called [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) described above; 

:::
::: { #func.train_UMGY_SmoothedDay_effect.args.span .sidebar }
  - **span:** (Numeric, `NA` by default ) The parameter $\alpha$ (which controls the degree of smoothing) to pass in the same-named argument to the internally called [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) described above. 

:::
::: { #func.train_UMGY_SmoothedDay_effect.args.lambda .sidebar }
  - **lambda:** (Optional, *Numeric*, $0$ by default) Regularization parameter $\lambda$. 

:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.details .sidebar }
##### Details
\

Internally, this function calls the helper functions [calc_day_general_effect](#func.calc_day_general_effect) and [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) (both described above in this section), passing the values of the arguments [degree](#func.train_UMGY_SmoothedDay_effect.args.degree) and [span](#func.train_UMGY_SmoothedDay_effect.args.span) to the latter function in the same-named arguments.

::: {.noteblock data-latex=""}
The *Regularization technique* described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2] is applied to the model being trained only when the *regularization parameter* $\lambda$ passed in the [lambda](#func.train_UMGY_SmoothedDay_effect.args.lambda) argument, has a value other than the default (to be more exact, greater than zero).
:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.value .sidebar }
##### Value
\

Data frame object representing the trained (and also *regularized* if [lambda](#func.train_UMGY_SmoothedDay_effect.args.lambda) argument value is non-default) *UMGYDE Model*.
:::

::: { #func.train_UMGY_SmoothedDay_effect.code .sidebar }
##### Source Code
\

The source code of the [train_UMGY_SmoothedDay_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L99) function is shown below:
```{r eval=FALSE}
train_UMGY_SmoothedDay_effect <- function(train_set, 
                                          degree = NA, 
                                          span = NA,
                                          lambda = 0){
  if (is.na(lambda)) {
    stop("Function: train_UMGY_SmoothedDay_effect
`lambda` is `NA`")
  }
  
  train_set |> 
    calc_day_general_effect(lambda) |>
    calc_UMGY_SmoothedDay_effect(degree, span)
}
```

::: {.noteblock data-latex=""}
The source code of the [train_UMGY_SmoothedDay_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L99) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L99) script on _GitHub_.
:::
:::

\newpage

#### [train_UMGY_SmoothedDay_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L113) Function {#func.train_UMGY_SmoothedDay_effect.cv}
\

Trains (and optionally *regularizes* if the [lambda](#func.train_UMGY_SmoothedDay_effect.cv.args.lambda) argument value is non-default) the *User+Movie+Genre+Year+SmoothedDay Effect (UMGYDE) Model* with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: {.noteblock data-latex=""}
The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets] (in *this Project*, we use $K = 5$).
:::

::: { #func.train_UMGY_SmoothedDay_effect.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  train_UMGY_SmoothedDay_effect.cv(best_degree, 
                                   best_span, 
                                   lambda)
```

::: {.noteblock data-latex=""}
In the above code snippet, the `train_UMGY_SmoothedDay_effect.cv` function is called internally from the [regularize.train_UMGYD_effect.cv](#func.regularize.train_UMGYD_effect.cv) function described below in section [UMGYDE Model: Regularization] of *this Appendix*.
:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.train_UMGY_SmoothedDay_effect.cv.args.degree .sidebar }
  - **degree:** (Optional, *Integer*, `NA` by default) The degree of the polynomials to pass in the same-named argument to the internally called [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) described above; 

:::
::: { #func.train_UMGY_SmoothedDay_effect.cv.args.span .sidebar }
  - **span:** (Numeric, `NA` by default ) The parameter $\alpha$ (which controls the degree of smoothing) to pass in the same-named argument to the internally called [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) described above. 

:::
::: { #func.train_UMGY_SmoothedDay_effect.cv.args.lambda .sidebar }
  - **lambda:** (Optional, *Numeric*, $0$ by default) Regularization parameter $\lambda$. 

:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.cv.details .sidebar }
##### Details
\

Internally, this function calls the auxiliary functions [calc_day_general_effect.cv](#func.calc_day_general_effect.cv) and [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) (both described above in this section), passing the values of the arguments [degree](#func.train_UMGY_SmoothedDay_effect.cv.args.degree) and [span](#func.train_UMGY_SmoothedDay_effect.cv.args.span) to the latter function in the same-named arguments.

::: {.noteblock data-latex=""}
This function is also called within other helper functions, such as the [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) and [regularize.train_UMGYD_effect.cv](#func.regularize.train_UMGYD_effect.cv) (described below in sections [UMGYDE Model: Tuning `loess` Params] and [UMGYDE Model: Regularization] of *this Appendix*, respectively). The usage in the latter function is shown in the [Usage](#func.train_UMGY_SmoothedDay_effect.cv.usage) section of *this Description* below.
:::

::: {.noteblock data-latex=""}
The *Regularization technique* described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2] is applied to the model being trained only when the *regularization parameter* $\lambda$ passed in the [lambda](#func.train_UMGY_SmoothedDay_effect.cv.args.lambda) argument, has a value other than the default (to be more exact, greater than zero).
:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.cv.value .sidebar }
##### Value
\

Data frame representing the *UMGYDE Model* trained (and also *regularized* if the [lambda](#func.train_UMGY_SmoothedDay_effect.cv.args.lambda) argument value is non-default) with use of *K-Fold Cross-Validation*, where the $K$ is the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::

::: { #func.train_UMGY_SmoothedDay_effect.cv.code .sidebar }
##### Source Code
\

The source code of the [train_UMGY_SmoothedDay_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L113) function is shown below:
```{r eval=FALSE}
train_UMGY_SmoothedDay_effect.cv <- function(degree = NA, 
                                             span = NA,
                                             lambda = 0){
  if (is.na(lambda)) {
    stop("Function: train_UMGY_SmoothedDay_effect.cv
`lambda` is `NA`")
  }
  
  calc_day_general_effect.cv(lambda) |>
    calc_UMGY_SmoothedDay_effect(degree, span)
}
```

::: {.noteblock data-latex=""}
The source code of the [train_UMGY_SmoothedDay_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L113) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L113) script on _GitHub_.
:::
:::

\newpage

#### [UMGY_SmoothedDay_effect.predict](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L125) Function {#func.UMGY_SmoothedDay_effect.predict}
\

Predicts *user rating* values on the *test dataset* passed in the [test_set](#func.UMGY_SmoothedDay_effect.predict.args.test_set) argument based on the data of the trained *UMGYD Effect (UMGYDE) Model* passed in the [day_smoothed_effect](#func.UMGY_SmoothedDay_effect.predict.args.day_smoothed_effect) argument.

::: { #func.UMGY_SmoothedDay_effect.predict.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
final.UMGYDE.predicted <- final_holdout_test |>
  UMGY_SmoothedDay_effect.predict(rglr.day_smoothed_effect)
```
:::

::: { #func.UMGY_SmoothedDay_effect.predict.args .sidebar }
##### Arguments
\

::: { #func.UMGY_SmoothedDay_effect.predict.args.test_set .sidebar }
  - **test_set:** Validation dataset; 

:::
::: { #func.UMGY_SmoothedDay_effect.predict.args.day_smoothed_effect .sidebar }
  - **day_smoothed_effect:** Data frame object representing the *UMGYDE Model*. 

:::
:::

::: { #func.UMGY_SmoothedDay_effect.predict.details .sidebar }
##### Details
\

This function implements an algorithm for computing the *user rating values* in accordance with the *mathematical description* of the *UMGYDE Model*, as described in section [Mathematical Description of the UMGYDE Model] of *this Report*.

::: {.noteblock data-latex=""}
This function is also called within other helper functions, such as the [calc_UMGY_SmoothedDay_effect.MSE](#func.calc_UMGY_SmoothedDay_effect.MSE) and [UMGYDE_model.predict](#func.UMGYDE_model.predict) described below in this section and [Matrix Factorization Functions] of *this Appendix*, respectively.
:::
:::

::: { #func.UMGY_SmoothedDay_effect.predict.value .sidebar }
##### Value
\

Data frame object containing *predicted user rating* values based on the *UMGYDE Model*
:::

\newpage

::: { #func.UMGY_SmoothedDay_effect.predict.code .sidebar }
##### Source Code
\

The source code of the [UMGY_SmoothedDay_effect.predict](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L125) function is shown below:
```{r eval=FALSE}
UMGY_SmoothedDay_effect.predict <- function(test_set, day_smoothed_effect) {
  test_set |>
    left_join(edx.user_effect, by = "userId") |>
    left_join(rglr.UM_effect, by = "movieId") |>
    left_join(rglr.UMG_effect, by = "movieId") |>
    left_join(date_days_map, by = "timestamp") |>
    left_join(rglr.UMGY_effect, by='year') |>
    left_join(day_smoothed_effect, by='days') |>
    mutate(predicted = clamp(mu + a + b + g + 
                               ifelse(is.na(ye), 0, ye) +
                               ifelse(is.na(de_smoothed), 
                                      0, 
                                      de_smoothed))) |> 
    select(userId, movieId, timestamp, rating, predicted)
}
```

::: {.noteblock data-latex=""}
The source code of the [UMGY_SmoothedDay_effect.predict](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L125) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L125) script on _GitHub_.
:::
:::

\newpage

#### [calc_UMGY_SmoothedDay_effect.MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L141) Function {#func.calc_UMGY_SmoothedDay_effect.MSE}
\

Validates the *UMGYD Effect (UMGYDE) Model* represented by the data passed in the [day_smoothed_effect](#func.calc_UMGY_SmoothedDay_effect.MSE.args.day_smoothed_effect) argument on the *test dataset* passed in the [test_set](#func.calc_UMGY_SmoothedDay_effect.MSE.args.test_set) argument.

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
    cv_fold_dat$validation_set |> 
      calc_UMGY_SmoothedDay_effect.MSE(day_smoothed_effect)
```

::: {.noteblock data-latex=""}
In the code snippet above, the function `calc_UMGY_SmoothedDay_effect.MSE` is called internally from the [calc_UMGY_SmoothedDay_effect.MSE.cv](#func.calc_UMGY_SmoothedDay_effect.MSE.cv) function described below in this section.
:::
:::

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.args .sidebar }
##### Arguments
\

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.args.test_set .sidebar }
  - **test_set:** Validation dataset; 

:::
::: { #func.calc_UMGY_SmoothedDay_effect.MSE.args.day_smoothed_effect .sidebar }
  - **day_smoothed_effect:** Data frame object representing the *UMGYDE Model*. 

:::
:::

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.details .sidebar }
##### Details
\

This function commits the *UMGYDE Model* validation by calculating the *Mean Squared Error (MSE)*.

In *this Project*, the *UMGYDE* data object representing the *UMGYDE Model* (and being passed in the [day_smoothed_effect](#func.loess_de.args.de_bias.dat) argument) is created and returned by the following functions described above in this section:
  
  - [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) 
  
  - [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect) 
  
  - [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv).

Internally, this function calls the auxiliary functions [UMGY_SmoothedDay_effect.predict](#func.UMGY_SmoothedDay_effect.predict) (described above in this section), passing to it the [day_smoothed_effect](#func.calc_UMGY_SmoothedDay_effect.MSE.args.day_smoothed_effect) value in the same-named argument.

::: {.noteblock data-latex=""}
This auxiliary function is used internally in the [calc_UMGY_SmoothedDay_effect.MSE.cv](#func.calc_UMGY_SmoothedDay_effect.MSE.cv) function (described below in this section) as shown in the [Usage](#func.calc_UMGY_SmoothedDay_effect.MSE.usage) section of *This Description* above.
:::
:::

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.value .sidebar }
##### Value
\

*MSE* value calculated for the *UMGYDE Model*.
:::

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.code .sidebar }
##### Source Code
\

The source code of the [calc_UMGY_SmoothedDay_effect.MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L141) function is shown below:
```{r eval=FALSE}
calc_UMGY_SmoothedDay_effect.MSE <- function(test_set, day_smoothed_effect) {
  test_set |>
    UMGY_SmoothedDay_effect.predict(day_smoothed_effect) |>
    mutate(resid = rating - predicted) |> 
    pull(resid) |> mse()
}
```

::: {.noteblock data-latex=""}
The source code of the [calc_UMGY_SmoothedDay_effect.MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L141) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L141) script on _GitHub_.
:::
:::

\newpage

#### [calc_UMGY_SmoothedDay_effect.MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L147) Function {#func.calc_UMGY_SmoothedDay_effect.MSE.cv}
\

Validates the *UMGYD Effect (UMGYDE) Model* represented by the data object passed in the [day_smoothed_effect](#func.calc_UMGY_SmoothedDay_effect.MSE.cv.args.day_smoothed_effect) argument with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV] (we use $K = 5$ in *this Project*).

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  sqrt(calc_UMGY_SmoothedDay_effect.MSE.cv(day_smoothed_effect))
```

::: {.noteblock data-latex=""}
In the code snippet above, the function `calc_UMGY_SmoothedDay_effect.MSE.cv` is called internally from the [calc_UMGY_SmoothedDay_effect.RMSE.cv](#func.calc_UMGY_SmoothedDay_effect.RMSE.cv) function described below in this section.
:::
:::

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.cv.args.day_smoothed_effect .sidebar }
  - **day_smoothed_effect:** Data frame object representing the *UMGYDE Model*. 

:::
:::

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.cv.details .sidebar }
##### Details
\

This function commits the *UMGYDE Model* validation by calculating the *Mean Squared Error (MSE)* on the validation datasets contained in the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets].

::: {.noteblock data-latex=""}
This function internally calls the [calc_UMGY_SmoothedDay_effect.MSE](#func.calc_UMGY_SmoothedDay_effect.MSE) function for each iteration of the *K-Fold Cross-Validation*, passing [day_smoothed_effect](#func.calc_UMGY_SmoothedDay_effect.MSE.cv.args.day_smoothed_effect) value in the same-named argument to the called function and calculating the *MSE* for the corresponding validation dataset of the [`edx_CV` Object]. After that, it calculates the mean of the obtained results.

The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::

In *this Project*, the *UMGYDE* data object representing the *UMGYDE Model* (and being passed in the [day_smoothed_effect](#func.calc_UMGY_SmoothedDay_effect.MSE.cv.args.day_smoothed_effect) argument) is created and returned by the following functions described above in this section:
  
  - [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) 
  
  - [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect) 
  
  - [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv).

::: {.noteblock data-latex=""}
This is an auxiliary function that is called internally from the [calc_UMGY_SmoothedDay_effect.RMSE.cv](#func.calc_UMGY_SmoothedDay_effect.RMSE.cv) function (described below in this section) as shown in the [Usage](#func.calc_UMGY_SmoothedDay_effect.MSE.usage) section of *This Description* above.
:::
:::

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.cv.value .sidebar }
##### Value
\

The *MSE* value calculated for the *UMGYDE Model* with use of *K-Fold Cross-Validation*, where the $K$ is the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.cv.code .sidebar }
##### Source Code
\

The slightly simplified version of the source code of the [calc_UMGY_SmoothedDay_effect.MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L147) function is shown below:
```{r eval=FALSE}
calc_UMGY_SmoothedDay_effect.MSE.cv <- function(day_smoothed_effect){
  smth_day_effect_MSEs <- sapply(edx_CV, function(cv_fold_dat){
    cv_fold_dat$validation_set |> 
      calc_UMGY_SmoothedDay_effect.MSE(day_smoothed_effect)
  })
  put_end_date(start)
  put_log1("Function `calc_UMGY_SmoothedDay_effect.MSE.cv`:
MSE value have been computed for the %1-Fold Cross Validation samples.", 
           CVFolds_N)
  mean(smth_day_effect_MSEs)
}
```

::: {.noteblock data-latex=""}
The completed source code of the [calc_UMGY_SmoothedDay_effect.MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L147) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L147) script on _GitHub_.
:::
:::

\newpage

#### [calc_UMGY_SmoothedDay_effect.RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L169) Function {#func.calc_UMGY_SmoothedDay_effect.RMSE.cv}
\

Validates the *UMGYD Effect (UMGYDE) Model* represented by the data object passed in the [day_smoothed_effect](#func.calc_UMGY_SmoothedDay_effect.RMSE.cv.args.day_smoothed_effect) argument with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: {.noteblock data-latex=""}
The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::

::: { #func.calc_UMGY_SmoothedDay_effect.RMSE.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
lss.UMGYD_effect.RMSE <- calc_UMGY_SmoothedDay_effect.RMSE.cv(lss.UMGYD_effect)
```
:::

::: { #func.calc_UMGY_SmoothedDay_effect.RMSE.cv.args .sidebar }
##### Arguments
\

::: { #func.calc_UMGY_SmoothedDay_effect.RMSE.cv.args.day_smoothed_effect .sidebar }
  - **day_smoothed_effect:** Data frame object representing the *UMGYDE Model*. 

:::
:::

::: { #func.calc_UMGY_SmoothedDay_effect.RMSE.cv.details .sidebar }
##### Details
\

This function commits the *UMGYDE Model* validation by calculating the *Root Mean Squared Error (RMSE)* on the validation datasets contained in the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets].

::: {.noteblock data-latex=""}
This function internally calls the [calc_UMGY_SmoothedDay_effect.MSE.cv](#func.calc_UMGY_SmoothedDay_effect.MSE.cv) auxiliary function described above in this section to compute the *MSE* for the *UMGYDE Model* and then calculates the *square root* of the obtained result.
:::

In *this Project*, the *UMGYDE* data object representing the *UMGYDE Model* (and being passed in the [day_smoothed_effect](#func.calc_UMGY_SmoothedDay_effect.RMSE.cv.args.day_smoothed_effect) argument) is created and returned by the following functions described above in this section:
  
  - [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) 
  
  - [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect) 
  
  - [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv).

::: {.noteblock data-latex=""}
This function is also called internally as an auxiliary function from the [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) and [regularize.test_lambda.UMGYD_effect.cv](#func.regularize.test_lambda.UMGYD_effect.cv) functions described below in sections [UMGYDE Model: Tuning `loess` Params] and [UMGYDE Model: Regularization], respectively, of *this Appendix*.
:::
:::

::: { #func.calc_UMGY_SmoothedDay_effect.RMSE.cv.value .sidebar }
##### Value
\

The *RMSE* value calculated for the *UMGYDE Model* with use of *K-Fold Cross-Validation*, where the $K$ is the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::

::: { #func.calc_UMGY_SmoothedDay_effect.RMSE.cv.code .sidebar }
##### Source Code
\

The source code of the [calc_UMGY_SmoothedDay_effect.RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L169) function is shown below:
```{r eval=FALSE}
calc_UMGY_SmoothedDay_effect.RMSE.cv <- function(day_smoothed_effect){
  sqrt(calc_UMGY_SmoothedDay_effect.MSE.cv(day_smoothed_effect))
}
```

::: {.noteblock data-latex=""}
The source code of the [calc_UMGY_SmoothedDay_effect.RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L169) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L169) script on _GitHub_.
:::
:::

\newpage

### UMGYDE Model: Tuning `loess` Params
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the  [Tuning `loess` Parameters](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L172) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L172) script on _GitHub_.
:::

#### [train_UMGY_SmoothedDay_effect.RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L173) Function {#func.train_UMGY_SmoothedDay_effect.RMSE.cv}
\

Trains and validate (without *regularization*) the *User+Movie+Genre+Year+SmoothedDay Effect (UMGYDE) Model* for the given [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameters passed in the corresponding arguments ([degree](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.args.degree) and [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.args.span)), with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: {.noteblock data-latex=""}
The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets] (in *this Project*, we use $K = 5$).
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  train_UMGY_SmoothedDay_effect.RMSE.cv(degree = 1, span)
```

::: {.noteblock data-latex=""}
In the above code snippet, the `train_UMGY_SmoothedDay_effect.RMSE.cv` function is called internally from the [train_UMGY_SmoothedDay_effect.RMSE.cv.degree1](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1) function described below in this section.
:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.args .sidebar }
##### Arguments
\

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.args.degree .sidebar }
  - **degree:** (Optional, *Integer*, `NA` by default) *The [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameter*: the degree of the polynomials to pass in the same-named argument to the internally called [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv) described above; 

:::
::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.args.span .sidebar }
  - **span:** (Numeric, `NA` by default ) *The [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameter*: the parameter $\alpha$ (which controls the degree of smoothing) to pass in the same-named argument to the internally called [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv) described above. 

:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.details .sidebar }
##### Details
\

This is a wrapper for the function [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv) (described above in section [UMGYDE Model: Utility Functions] of *this Appendix*) it calls internally, passing the values of the arguments [degree](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.args.degree) and [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.args.span) in the same-named arguments.

Unlike the internal function  [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv), this one also validates the *UMGYDE Model* created and trained by that function, for which it calls internally another helper function, [calc_UMGY_SmoothedDay_effect.RMSE.cv](#func.calc_UMGY_SmoothedDay_effect.RMSE.cv) (also described above in section [UMGYDE Model: Utility Functions]), computing *RMSE* for that model.

::: {.noteblock data-latex=""}
This is an auxiliary  function intended to be called internally from the following helper functions (described below in this section), specifically designed for tuning the `degree` and `span` [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameters:  

  - [train_UMGY_SmoothedDay_effect.RMSE.cv.degree0](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0): a helper function designed for tuning the [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) `span` parameter while keeping the `degree` parameter fixed at $0$;
  
  - [train_UMGY_SmoothedDay_effect.RMSE.cv.degree1](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1): a helper function designed for tuning the [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) `span` parameter while keeping the `degree` parameter fixed at $1$;
  
  - [train_UMGY_SmoothedDay_effect.RMSE.cv.degree2](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2): a helper function designed for tuning the [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) `span` parameter while keeping the `degree` parameter fixed at $2$;

:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.value .sidebar }
##### Value
\

The *RMSE* value calculated for the *UMGYDE Model* fitted for the given [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameters passed in the [degree](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.args.degree) and [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.args.span) arguments, and trained with use of *K-Fold Cross-Validation*, where the $K$ is the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.code .sidebar }
##### Source Code
\

The slightly simplified version of the source code of the [train_UMGY_SmoothedDay_effect.RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L173) function is shown below:
```{r eval=FALSE}
train_UMGY_SmoothedDay_effect.RMSE.cv <- function(degree = NA, span = NA) {
  smth_de.RMSE <- train_UMGY_SmoothedDay_effect.cv(degree, span) |>
    calc_UMGY_SmoothedDay_effect.RMSE.cv()
  
  put_log2("Function `train_UMGY_SmoothedDay_effect.RMSE.cv`:
RMSE has been computed for the `loess` function parameters: 
degree = %1, span = %2.", 
           degree,
           span)
  
  smth_de.RMSE
}
```

::: {.noteblock data-latex=""}
The complete source code of the [train_UMGY_SmoothedDay_effect.RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L173) function is available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L173) script on _GitHub_.
:::
:::

\newpage

#### [train_UMGY_SmoothedDay_effect.RMSE.cv.degree0](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L192) Function {#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0}
\

Trains and validates (without *regularization*) the *User+Movie+Genre+Year+SmoothedDay Effect (UMGYDE) Model* for the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) `span` parameter passed in the [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0.args.span) argument and the `degree` parameter equals $0$.

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0.usage .sidebar }
##### Usage
\

```{r main-script@l1578u, eval=FALSE}
  spans <- seq(0.0005, 1, 0.001)
  lss.UMGYDE.preset.degree0.result <- 
    tune.model_param(spans, train_UMGY_SmoothedDay_effect.RMSE.cv.degree0)
```
```{r}
str(lss.UMGYDE.preset.degree0.result)
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1578) above the function *being described here* is passed in the [fn_tune.test.param_value](#func.tune.model_param.args.fn_tune.test.param_value) argument to the [tune.model_param](#func.tune.model_param) function described above in section [Model Tuning Utils] of *this Appendix*.
:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0.args .sidebar }
##### Arguments
\

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0.args.span .sidebar }
  - **span:** (Numeric, `NA` by default ) *The [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameter*: the parameter $\alpha$ (which controls the degree of smoothing) to pass in the same-named argument to the internally called [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) function described above. 

:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0.details .sidebar }
##### Details
\

This function is a wrapper for the function [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) (described above in this section) that it calls internally, passing it the following [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameters :

  - $0$ in the [degree](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.args.degree) argument;
  
  - The [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0.args.span) argument value (of this function) in the same-named argument [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.args.span).

::: {.noteblock data-latex=""}
This is an auxiliary function intended to be passed in the `fn_tune.test.param_value` argument to the [tune.model_param](#func.tune.model_param) and [model.tune.param_range](#func.model.tune.param_range) functions described above in section [Model Tuning Utils] of *this Appendix*.
:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0.value .sidebar }
##### Value
\

The *RMSE* value calculated for the *UMGYDE Model* fitted for the given [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameters (`degree = 0` and the `span` value passed in the [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0.args.span) argument), and trained with use of *K-Fold Cross-Validation*, where the $K$ is the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::

\newpage

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0.code .sidebar }
##### Source Code
\

The source code of the [train_UMGY_SmoothedDay_effect.RMSE.cv.degree0](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L192) function is shown below:
```{r eval=FALSE}
train_UMGY_SmoothedDay_effect.RMSE.cv.degree0 <- function(span) {
  train_UMGY_SmoothedDay_effect.RMSE.cv(degree = 0, span)
}
```

::: {.noteblock data-latex=""}
The source code of the [train_UMGY_SmoothedDay_effect.RMSE.cv.degree0](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L192) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L192) script on _GitHub_.
:::
:::

\newpage

#### [train_UMGY_SmoothedDay_effect.RMSE.cv.degree1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L195) Function {#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1}
\

Trains and validates (without *regularization*) the *User+Movie+Genre+Year+SmoothedDay Effect (UMGYDE) Model* for the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) `span` parameter passed in the [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1.args.span) argument and the `degree` parameter equals $1$.

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1.usage .sidebar }
##### Usage
\

```{r main-script@l1695u, eval=FALSE}
spans <- seq(0.0005, 1, 0.001)
lss.UMGYDE.fine_tune.degree1.result <- 
  model.tune.param_range(lss.fine_tune.loop_starter,
                         UMGYDE.fine_tune.degree1.data.path,
                         cache_file.base_name,
                         train_UMGY_SmoothedDay_effect.RMSE.cv.degree1)
```
```{r}
str(lss.UMGYDE.fine_tune.degree1.result)
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1695) above the function *being described here* is passed in the [fn_tune.test.param_value](#func.model.tune.param_range.args.fn_tune.test.param_value) argument to the [model.tune.param_range](#func.model.tune.param_range) function described above in section [Model Tuning Utils] of *this Appendix*.
:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1.args .sidebar }
##### Arguments
\

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1.args.span .sidebar }
  - **span:** (Numeric, `NA` by default ) *The [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameter*: the parameter $\alpha$ (which controls the degree of smoothing) to pass in the same-named argument to the internally called [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) function described above. 

:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1.details .sidebar }
##### Details
\

This function is a wrapper for the function [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) (described above in this section) that it calls internally, passing it the following [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameters :

  - $1$ in the [degree](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.args.degree) argument;
  
  - The [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1.args.span) argument value (of this function) in the same-named argument [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.args.span).

::: {.noteblock data-latex=""}
This is an auxiliary function intended to be passed in the `fn_tune.test.param_value` argument to the [tune.model_param](#func.tune.model_param) and [model.tune.param_range](#func.model.tune.param_range) functions described above in section [Model Tuning Utils] of *this Appendix*.
:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1.value .sidebar }
##### Value
\

The *RMSE* value calculated for the *UMGYDE Model* fitted for the given [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameters (`degree = 1` and the `span` value passed in the [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1.args.span) argument), and trained with use of *K-Fold Cross-Validation*, where the $K$ is the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1.code .sidebar }
##### Source Code
\

The source code of the [train_UMGY_SmoothedDay_effect.RMSE.cv.degree1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L195) function is shown below:
```{r eval=FALSE}
train_UMGY_SmoothedDay_effect.RMSE.cv.degree1 <- function(span) {
  train_UMGY_SmoothedDay_effect.RMSE.cv(degree = 1, span)
}
```

::: {.noteblock data-latex=""}
The source code of the [train_UMGY_SmoothedDay_effect.RMSE.cv.degree1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L195) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L195) script on _GitHub_.
:::
:::

\newpage

#### [train_UMGY_SmoothedDay_effect.RMSE.cv.degree2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L198) Function {#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2}
\

Trains and validates (without *regularization*) the *User+Movie+Genre+Year+SmoothedDay Effect (UMGYDE) Model* for the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) `span` parameter passed in the [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2.args.span) argument and the `degree` parameter equals $2$.

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2.usage .sidebar }
##### Usage
\

```{r main-script@l1807u, eval=FALSE}
spans <- seq(0.0005, 1, 0.001)
lss.UMGYDE.fine_tune.degree2.result <- 
  model.tune.param_range(lss.fine_tune.loop_starter,
                         UMGYDE.fine_tune.degree2.data.path,
                         cache_file.base_name,
                         train_UMGY_SmoothedDay_effect.RMSE.cv.degree2)
```
```{r}
str(lss.UMGYDE.fine_tune.degree2.result)
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1807) above the function *being described here* is passed in the [fn_tune.test.param_value](#func.model.tune.param_range.args.fn_tune.test.param_value) argument to the [model.tune.param_range](#func.model.tune.param_range) function described above in section [Model Tuning Utils] of *this Appendix*.
:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2.args .sidebar }
##### Arguments
\

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2.args.span .sidebar }
  - **span:** (Numeric, `NA` by default ) *The [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameter*: the parameter $\alpha$ (which controls the degree of smoothing) to pass in the same-named argument to the internally called [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) function described above. 

:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2.details .sidebar }
##### Details
\

This function is a wrapper for the function [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) (described above in this section) that it calls internally, passing it the following [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameters :

  - $2$ in the [degree](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.args.degree) argument;
  
  - The [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2.args.span) argument value (of this function) in the same-named argument [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.args.span).

::: {.noteblock data-latex=""}
This is an auxiliary function intended to be passed in the `fn_tune.test.param_value` argument to the [tune.model_param](#func.tune.model_param) and [model.tune.param_range](#func.model.tune.param_range) functions described above in section [Model Tuning Utils] of *this Appendix*.
:::
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2.value .sidebar }
##### Value
\

The *RMSE* value calculated for the *UMGYDE Model* fitted for the given [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameters (`degree = 2` and the `span` value passed in the [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2.args.span) argument), and trained with use of *K-Fold Cross-Validation*, where the $K$ is the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$).
:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2.code .sidebar }
##### Source Code
\

The source code of the [train_UMGY_SmoothedDay_effect.RMSE.cv.degree2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L198) function is shown below:
```{r eval=FALSE}
train_UMGY_SmoothedDay_effect.RMSE.cv.degree2 <- function(span) {
  train_UMGY_SmoothedDay_effect.RMSE.cv(degree = 2, span)
}
```

::: {.noteblock data-latex=""}
The source code of the [train_UMGY_SmoothedDay_effect.RMSE.cv.degree2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L198) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L198) script on _GitHub_.
:::
:::

\newpage

### UMGYDE Model: Regularization
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the  [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L224) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L224) script on _GitHub_.
:::

#### [regularize.train_UMGYD_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L225) Function {#func.regularize.train_UMGYD_effect}
\

Trains and *regularizes* the *User+Movie+Genre+Year+SmoothedDay Effect (UMGYDE) Model* for a given value of the parameter $\lambda$ passed in the [lambda](#func.regularize.train_UMGYD_effect.args.lambda) argument and preliminary figured out *best values* of the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameters, using the training set of the `Movielens` dataset passed in the [train_set](#func.regularize.train_UMGYD_effect.args.train_set) argument.

::: { #func.regularize.train_UMGYD_effect.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  rglr.UMGYD_effect <- edx |> 
    regularize.train_UMGYD_effect(UMGYDE.rglr.best_lambda)
```
:::

::: { #func.regularize.train_UMGYD_effect.args .sidebar }
##### Arguments
\

::: { #func.regularize.train_UMGYD_effect.args.train_set .sidebar }
  - **train_set:** Training sample of the `Movielens` dataset; 

:::
::: { #func.regularize.train_UMGYD_effect.args.lambda .sidebar }
  - **lambda:** Regularization parameter $\lambda$. 

:::
:::

::: { #func.regularize.train_UMGYD_effect.details .sidebar }
##### Details
\

This function is a wrapper for the function [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect) (described above in section [UMGYDE Model: Utility Functions] of *this Appendix*) that it calls internally, passing it the best values of the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameters `degree` and `span` in the corresponding arguments ([degree](#func.train_UMGY_SmoothedDay_effect.args.degree) and [span](#func.train_UMGY_SmoothedDay_effect.args.span), respectively)

::: {.noteblock data-latex=""}
The *UMGYDE Model* is regularized using the *regularization technique* described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2] is applied to the model being trained only when the *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.train_UMGYD_effect.args.lambda) argument, has a value other than the default (to be more exact, greater than zero).
:::
:::

::: { #func.regularize.train_UMGYD_effect.value .sidebar }
##### Value
\

Data frame object representing the *UMGYDE Model*, regularized by the given *regularization parameter* $\lambda$ (passed in the [lambda](#func.regularize.train_UMGYD_effect.args.lambda) argument) and tuned for the [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) *best parameters* `degree` and `span`.
:::

::: { #func.regularize.train_UMGYD_effect.code .sidebar }
##### Source Code
\

The source code of the [regularize.train_UMGYD_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L225) function is shown below:
```{r eval=FALSE}
regularize.train_UMGYD_effect <- function(train_set, lambda) {
  best_degree <- lss.UMGYDE.best_params["degree"]
  best_span <- lss.UMGYDE.best_params["span"]
  
  train_set |>
    train_UMGY_SmoothedDay_effect(best_degree, 
                                  best_span, 
                                  lambda)
}
```

::: {.noteblock data-latex=""}
The source code of the [regularize.train_UMGYD_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L225) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L3) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L225) script on _GitHub_.
:::
:::

\newpage

#### [regularize.train_UMGYD_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L234) Function {#func.regularize.train_UMGYD_effect.cv}
\

Trains and *regularizes* the *User+Movie+Genre+Year+SmoothedDay Effect (UMGYDE) Model* for a given value of the parameter $\lambda$ passed in the [lambda](#func.regularize.train_UMGYD_effect.args.lambda) argument and preliminary figured out *best values* of the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameters, with use of *K-Fold Cross-Validation* as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV].

::: {.noteblock data-latex=""}
The `K` value for the *K-Fold Cross-Validation* is determined by the length of the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets] (in *this Project*, we use `K = 5`).
:::

::: { #func.regularize.train_UMGYD_effect.cv.usage .sidebar }
##### Usage
\

```{r UMGYD-effect.func@l248u, eval=FALSE}
  regularize.train_UMGYD_effect.cv(lambda) |>
    calc_UMGY_SmoothedDay_effect.RMSE.cv()
```

::: {.noteblock data-latex=""}
In the above [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L248), the `regularize.train_UMGYD_effect.cv` function is called internally from the [regularize.test_lambda.UMGYD_effect.cv](#func.regularize.test_lambda.UMGYD_effect.cv) function described below in *this Section*, along with the [calc_UMGY_SmoothedDay_effect.RMSE.cv](#func.calc_UMGY_SmoothedDay_effect.RMSE.cv) function described above in section [UMGYDE Model: Utility Functions].
:::
:::

::: { #func.regularize.train_UMGYD_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.regularize.train_UMGYD_effect.cv.args.lambda .sidebar }
  - **lambda:** Regularization parameter $\lambda$. 

:::
:::

::: { #func.regularize.train_UMGYD_effect.cv.details .sidebar }
##### Details
\

This is an auxiliary function intended to be called internally from the [regularize.test_lambda.UMGYD_effect.cv](#func.regularize.test_lambda.UMGYD_effect.cv) function (described below in this section) as shown in the [Usage](#func.regularize.train_UMGYD_effect.cv.usage) section of *this Description* above.

The function is a wrapper for the [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv) (described above in section [UMGYDE Model: Utility Functions] of *this Appendix*) that it calls internally, passing it the best values of the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) parameters `degree` and `span` in the corresponding arguments ([degree](#func.train_UMGY_SmoothedDay_effect.cv.args.degree) and [span](#func.train_UMGY_SmoothedDay_effect.cv.args.span), respectively)

::: {.noteblock data-latex=""}
The *UMGYDE Model* is regularized using the *regularization technique* described in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2] is applied to the model being trained only when the *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.train_UMGYD_effect.args.lambda) argument, has a value other than the default (to be more exact, greater than zero).
:::
:::

::: { #func.regularize.train_UMGYD_effect.cv.value .sidebar }
##### Value
\

Data frame object representing the *UMGYDE Model*, tuned for the [loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) *best parameters* `degree` and `span`, trained with use of *K-Fold Cross-Validation*, where the $K$ is the length of the [`edx_CV` Object] (in *this Project*, we use $K = 5$), and regularized by the given *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.train_UMGYD_effect.args.lambda) argument.
:::

::: { #func.regularize.train_UMGYD_effect.cv.code .sidebar }
##### Source Code
\

The source code of the [regularize.train_UMGYD_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L234) function is shown below:
```{r eval=FALSE}
regularize.train_UMGYD_effect.cv <- function(lambda) {
  best_degree <- lss.UMGYDE.best_params["degree"]
  best_span <- lss.UMGYDE.best_params["span"]

  train_UMGY_SmoothedDay_effect.cv(best_degree, 
                                   best_span, 
                                   lambda)
}
```

::: {.noteblock data-latex=""}
The source code of the [regularize.train_UMGYD_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L234) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L224) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L234) script on _GitHub_.
:::
:::

\newpage

#### [regularize.test_lambda.UMGYD_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L242) Function {#func.regularize.test_lambda.UMGYD_effect.cv}
\

Validates the *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.test_lambda.UMGYD_effect.cv.args.lambda) argument for the *User+Movie+Genre+Year+SmoothedDay Effect (UMGYDE) Model* in the *regularization process* using *penalized approach* with use of *K-Fold Cross-Validation*.

::: { #func.regularize.test_lambda.UMGYD_effect.cv.usage .sidebar }
##### Usage
\

```{r main-script@l2070u, eval=FALSE}
lambdas <- seq(0, 256, 16)
cv.UMGYDE.preset.result <- 
  tune.model_param(lambdas, regularize.test_lambda.UMGYD_effect.cv)
```
```{r}
str(cv.UMGYDE.preset.result)
```

::: {.noteblock data-latex=""}
In the [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L2070) above the function *being described here* is passed in the [fn_tune.test.param_value](#func.model.tune.param_range.args.fn_tune.test.param_value) argument to the [model.tune.param_range](#func.model.tune.param_range) function described above in section [Model Tuning Utils] of *this Appendix*.

Such a use of this function is also noted in the [Details](#func.regularize.test_lambda.UMGYD_effect.cv.details) section of *this Description* below.
:::
:::

::: { #func.regularize.test_lambda.UMGYD_effect.cv.args .sidebar }
##### Arguments
\

::: { #func.regularize.test_lambda.UMGYD_effect.cv.args.lambda .sidebar }
  - **lambda:** *Regularization parameter* $\lambda$ used to validate the model in the *regularization process*. 

:::
:::

::: { #func.regularize.test_lambda.UMGYD_effect.cv.details .sidebar }
##### Details
\

The function is used in the *regularization process* of the *UMGYDE Model* using the *penalized approach* to regularize predictions for the given *regularization parameter* $\lambda$ (passed in the [lambda](#func.regularize.test_lambda.UMGYD_effect.cv.args.lambda) argument) as explained in [Section 24.2 *Penalized least squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook (New Edition)_[@IDS2_24-2].

Internally it uses the [regularize.train_UMGYD_effect.cv](#func.regularize.train_UMGYD_effect.cv) (described above in this section) and [calc_UMGY_SmoothedDay_effect.RMSE.cv](#func.calc_UMGY_SmoothedDay_effect.RMSE.cv) functions (described in section [UMGYDE Model: Utility Functions] above) to validate the *UMGYDE Model* for the given $\lambda$ with use of the *K-Fold Cross-Validation* method, as described in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV], where the value of $K$ is determined by the length of the [`edx_CV` Object] described below in [Appendix B: Models Training Datasets] (in *this Project*, we use $K = 5$).

::: {.noteblock data-latex=""}
This function is an auxiliary function specifically designed to be passed in the `fn_tune.test.param_value` argument to the [tune.model_param](#func.tune.model_param) and [model.tune.param_range](#func.model.tune.param_range) functions described above in section [Model Tuning Utils] of *this Appendix*.
:::
:::

::: { #func.regularize.test_lambda.UMGYD_effect.cv.value .sidebar }
##### Value
\

The *Root Mean Squared Errors (RMSE)* value computed for the UMGYDE Model applying the *regularization parameter* $\lambda$ passed in the [lambda](#func.regularize.test_lambda.UMGYD_effect.cv.args.lambda) argument.

:::

::: { #func.regularize.test_lambda.UMGYD_effect.cv.code .sidebar }
##### Source Code
\

The source code of the [regularize.test_lambda.UMGYD_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L242) function is shown below:
```{r eval=FALSE}
regularize.test_lambda.UMGYD_effect.cv <- function(lambda){
  if (is.na(lambda)) {
    stop("Function: regularize.test_lambda.UMGYD_effect.cv
`lambda` is `NA`")
  }
  
  regularize.train_UMGYD_effect.cv(lambda) |>
    calc_UMGY_SmoothedDay_effect.RMSE.cv()
}
```

::: {.noteblock data-latex=""}
The source code of the [regularize.test_lambda.UMGYD_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L242) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L224) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L242) script on _GitHub_.
:::
:::

\newpage

### UMGYDE Model: Matrix Factorization
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the [MF.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R) script on _GitHub_.
:::

#### [mf.residual.dataframe](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L3) Function {#func.mf.residual.dataframe}
\

Computes residuals, defined as the difference between the observed and predicted values of the fully trained _UMGYDE Model_ as described in section [User+Movie+Genre+Year+SmoothedDay Effect (UMGYDE) Model].

::: { #func.mf.residual.dataframe.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
  mf.edx.residual <- mf.residual.dataframe(edx)
```
:::

::: { #func.mf.residual.dataframe.args .sidebar }
##### Arguments
\

::: { #func.mf.residual.dataframe.args.train_set .sidebar }
  - **train_set:** Training dataset; 

:::
:::

::: { #func.mf.residual.dataframe.details .sidebar }
##### Details
\

This function calculates the residuals on the *training dataset* passed as the [train_set](#func.mf.residual.dataframe.args.train_set) argument, taking into account all the effects of the previously trained models, and creates a new data frame that includes the results as a calculated column `rsdsl`, along with the `movieId` and `userId` columns selected from the training dataset.
:::

::: { #func.mf.residual.dataframe.value .sidebar }
##### Value
\

Data frame containing the following three variables:

  - *rsdl*: (Numeric) Calculated column containing results of the function computation;
  
  - *userId*: (Integer) User Identifier;
  
  - *movieId* (Integer) Movie Identifier.

:::

\newpage

::: { #func.mf.residual.dataframe.code .sidebar }
##### Source Code
\

The source code of the [mf.residual.dataframe](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L3) function is shown below:
```{r eval=FALSE}
mf.residual.dataframe <- function(train_set){
  train_set |> 
    left_join(edx.user_effect, by = "userId") |>
    left_join(rglr.UM_effect, by = "movieId") |>
    left_join(rglr.UMG_effect, by = "movieId") |>
    left_join(date_days_map, by = "timestamp") |>
    left_join(rglr.UMGY_effect, by='year') |>
    left_join(rglr.UMGYD_effect, by='days') |>
    mutate(rsdl = rating - (mu + a + b + g + ye + de_smoothed)) |>
    select(userId, movieId, rsdl)
}
```

::: {.noteblock data-latex=""}
The source code of the [mf.residual.dataframe](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L3) function is also available in the [MF.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L3) script on _GitHub_.
:::
:::

\newpage

# Appendix B: Models Training Datasets {#appndx_b}
\

## `edx.mx` Matrix Object {#appndx_b.edx.mx}
\

We use the array representation described in [Section 17.6 *Analysis of variance (ANOVA)*](https://rafalab.dfci.harvard.edu/dsbook-part-2/linear-models/treatment-effect-models.html#sec-anova) of the _Course Textbook (New Edition)_, for the training data[@IDS2_17-6]. For this purpose, we will convert the `edx` dataset into a matrix using the [tidyr::pivot_wider](https://www.rdocumentation.org/packages/tidyr/versions/1.3.0/topics/pivot_wider) function:

```{r data-helper.func@l92, eval=FALSE}

  put_log("Function: `make_source_datasets`: Creating Rating Matrix from `edx` dataset...")
  edx.mx <- edx |> 
    mutate(userId = factor(userId),
           movieId = factor(movieId)) |>
    select(movieId, userId, rating) |>
    pivot_wider(names_from = movieId, values_from = rating) |>
    column_to_rownames("userId") |>
    as.matrix()
  
  put_log("Function: `make_source_datasets`:
Matrix created: `edx.mx` of the following dimentions:")
  put(dim(edx.mx))
```

To create the `edx.mx` object, the above [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L92) is used in the [make_source_datasets](#func.make_source_datasets) function described in section [Initializing Input Datasets] of [Appendix A](#appndx_a).

::: {.noteblock data-latex=""}
The *code snippet* above uses *custom logging function* [put_log](#func.put_log) described in section [Logging Functions] of [Appendix A](#appndx_a).
:::

```{r}
  str(edx.mx)
```

\newpage

## `edx.sgr` Object {#appndx_b.edx.sgr}
\

To account for the Movie Genre Effect more accurately, we need a dataset with split rows for movies belonging to multiple genres:
```{r data-helper.func@l125, eval=FALSE}
  put_log("Function: `make_source_datasets`: 
To account for the Movie Genre Effect, we need a dataset with split rows 
for movies belonging to multiple genres.")
  edx.sgr <- splitGenreRows(edx)
```

To create the `edx.sgr` object, the above [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L125) is used in the [make_source_datasets](#func.make_source_datasets) function described in section [Initializing Input Datasets] of [Appendix A](#appndx_a).

::: {.noteblock data-latex=""}
The *code snippet* above uses the *user-defined helper function*  [splitGenreRows](#func.splitGenreRows) (described in section [Data Processing Functions]) to split the rows of the original dataset (`edx` in this case), as well as the *custom logging function* [put_log](#func.put_log) described in section [Logging Functions] of [Appendix A](#appndx_a).
:::

```{r}
str(edx.sgr)
summary(edx.sgr)
```

\newpage

## `movie_map` Object {#appndx_b.movie_map}
\

To be able to map movie IDs to titles, we create the following lookup table:
```{r data-helper.func@l106, eval=FALSE}
movie_map <- edx |> select(movieId, title, genres) |> 
    distinct(movieId, .keep_all = TRUE)
  
  put_log("Function: `make_source_datasets`: Dataset created: movie_map")
```

To create the `movie_map` object, the above [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L106) is used in the [make_source_datasets](#func.make_source_datasets) function described in section [Initializing Input Datasets] of [Appendix A](#appndx_a).

::: {.noteblock data-latex=""}
The *code snippet* above uses *custom logging function* [put_log](#func.put_log) described in section [Logging Functions] of [Appendix A](#appndx_a).
:::

```{r}
str(movie_map)
summary(movie_map)
```

Note that titles cannot be considered unique, so we cannot use them as IDs[@IDS2_24-1].

\newpage

## `date_days_map` Object {#appndx_b.date_days_map}
\

We have a `timestamp` field in the `edx` dataset.
To be able to map the date, year, and number of days since the earliest record in the `edx` dataset with the corresponding value in this field, we create the following lookup table:
```{r data-helper.func@l112, eval=FALSE}
  put_log("Function: `make_source_datasets`: Creating Date-Days Map dataset...")
  date_days_map <- edx |>
    mutate(date_time = as_datetime(timestamp)) |>
    mutate(date = as_date(date_time)) |>
    mutate(year = year(date_time)) |>
    mutate(days = as.integer(date - min(date))) |>
    select(timestamp, date_time, date, year, days) |>
    distinct(timestamp, .keep_all = TRUE)
  
  put_log("Function: `make_source_datasets`: Dataset created: date_days_map")
```

To create the `date_days_map` object, the above [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L112) is used in the [make_source_datasets](#func.make_source_datasets) function described in section [Initializing Input Datasets] of [Appendix A](#appndx_a).

::: {.noteblock data-latex=""}
The *code snippet* above uses *custom logging function* [put_log](#func.put_log) described in section [Logging Functions] of [Appendix A](#appndx_a).
:::

``` {r}
  str(date_days_map)
  summary(date_days_map)
```

\newpage

## `edx_CV` Object {#appndx_b.edx_CV}
\

`edx_CV` object is a list of sample objects we need to perform the *K-Fold Cross-Validation* 
as explained in [Section 29.6 *Cross validation / K-fold cross validation*](https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html#k-fold-cross-validation) of the _Course Textbook (New Edition)_[@IDS2_29-6_KFCV]:
```{r data-helper.func@l141, eval=FALSE}
  start <- put_start_date()
  edx_CV <- lapply(kfold_index,  function(fold_i){
    
    put_log1("Method `make_source_datasets`: 
Creating K-Fold Cross-Validation Datasets, Fold %1", fold_i)
    
    #> We split the initial datasets into training sets, which we will use to build 
    #> and train our models, and validation sets in which we will compute the accuracy 
    #> of our predictions, the way described in the `Section 23.1.1 Movielens data`
    #> (https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#movielens-data) 
    #> of the Course Textbook.
    
    split_sets <- edx |>
      sample_train_validation_sets(fold_i*1000)
    
    train_set <- split_sets$train_set
    validation_set <- split_sets$validation_set
    
    put_log("Function: `make_source_datasets`: 
Sampling 20% from the split-row version of the `edx` dataset...")
    split_sets.gs <- edx.sgr |>
      sample_train_validation_sets(fold_i*2000)

    train.sgr <- split_sets.gs$train_set
    validation.sgr <- split_sets.gs$validation_set
    
    # put_log("Function: `make_source_datasets`: Dataset created: validation.sgr")
    # put(summary(validation.sgr))
    
    #> We will use the array representation described in `Section 17.5 of the Textbook`
    #> (https://rafalab.dfci.harvard.edu/dsbook-part-2/linear-models/treatment-effect-models.html#sec-anova), 
    #> for the training data. 
    #> To create this matrix, we use `tidyr::pivot_wider` function:
    
    put_log("Function: `make_source_datasets`: Creating Rating Matrix from Train Set...")
    train_mx <- train_set |> 
      mutate(userId = factor(userId),
             movieId = factor(movieId)) |>
      select(movieId, userId, rating) |>
      pivot_wider(names_from = movieId, values_from = rating) |>
      column_to_rownames("userId") |>
      as.matrix()
    
    put_log("Function: `make_source_datasets`:
Matrix created: `train_mx` of the following dimentions:")
    put(dim(train_mx))


    list(train_set = train_set,
         train_mx = train_mx,
         train.sgr = train.sgr,
         validation_set = validation_set)
  })
  put_end_date(start)
  put_log("Function: `make_source_datasets`: 
Set of K-Fold Cross-Validation datasets created: edx_CV")
```

To create the `edx_CV` object, the above [code snippet](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L141) is used in the [make_source_datasets](#func.make_source_datasets) function described in section [Initializing Input Datasets] of [Appendix A](#appndx_a).

The $K$ value for the *K-Fold Cross-Validation* is determined by the length of the list composing the `edx_CV` object. In *this Project*, we choose $K = 5$.

::: {.noteblock data-latex=""}
The *code snippet* above uses the *user-defined helper function*  [sample_train_validation_sets](#func.sample_train_validation_sets) (described in section [Data Processing Functions]) to split the original dataset (`edx` in this case) into *Train* and *Validation* datasets, as well as the following *custom logging function* described in section [Logging Functions] of [Appendix A](#appndx_a):

* [put_start_date](#func.put_start_date);
* [put_end_date](#func.put_end_date);
* [put_log](#func.put_log);
* [put_log1](#func.put_log1).

:::

```{r}
str(edx_CV)
```

\newpage

