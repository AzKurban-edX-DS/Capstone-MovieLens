# Appendix {#appndx_a}
## Data Helper Functions {#appndx_a.data_helper.functions}
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R) script on _GitHub_.
:::

### Data Processing Functions

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section is available in the the [Data processing functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L3) script on _GitHub_.
:::

#### [sample_train_validation_sets](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L17) Function {#func.sample_train_validation_sets}
\

##### Usage

### Model Training Functions

#### [union_cv_results](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L432) Function {#func.union_cv_results}
\

Aggregates the input data frames into a single data frame.

::: { #func.union_cv_results.Usage .sidebar }
##### Usage
\

```{r eval=FALSE}
union_cv_results(data_list = data)

```
:::

::: { #func.union_cv_results.args .sidebar }
##### Arguments
\

::: { #func.union_cv_results.args.data_list .sidebar }
  - **data_list:** List of data frames representing the results of the _N-Fold Cross Validation_ method execution.; 

:::
:::

::: { #func.union_cv_results.details .sidebar }
##### Details
\

The function is used to aggregate the _N-Fold Cross Validation_ method result data into a single data frame for further processing.

:::

::: { #func.union_cv_results.value .sidebar }
##### Value
\

A data frame that is a union of the input data frames.
:::

::: { #func.union_cv_results.code .sidebar }
##### Source Code
\

The source code of the [union_cv_results](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L432) function is shown below:
```{r eval=FALSE}
union_cv_results <- function(data_list) {
  out_dat <- data_list[[1]]
  
  for (i in 2:CVFolds_N){
    out_dat <- union(out_dat, 
                     data_list[[i]])
  }
  
  out_dat
}
```

::: {.noteblock data-latex=""}
The source code of the [union_cv_results](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L432) is also available in the [Model training](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L431) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L432) script on _GitHub_.
:::
:::





#### [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) Function {#func.get_best_param.result}
\

Selects the best parameter value and the corresponding minimum Root Mean Squared Error value from the function's input arguments.

::: { #func.get_best_param.result.Usage .sidebar }
##### Usage
\

```{r eval=FALSE}
get_best_param.result(param_values, rmses)

```
:::

::: { #func.get_best_param.result.args .sidebar }
##### Arguments
\

::: { #func.get_best_param.result.args.param_values .sidebar }
  - **param_values:** List of parameters to choose the best value.; 

:::
::: { #func.get_best_param.result.args.rmses .sidebar }
  - **rmses:** A list of Root Mean Squared Errors corresponding to the parameter values specified in the list passed by the argument [param_values](#func.get_best_param.result.args.param_values). 

:::
:::

::: { #func.get_best_param.result.details .sidebar }
##### Details
\

A parameter value that corresponds to the minimum RMSE is considered the best.

:::

::: { #func.get_best_param.result.value .sidebar }
##### Value
\

A data frame that is a union of the input data frames.
:::

::: { #func.get_best_param.result.code .sidebar }
##### Source Code
\

The soure code of the [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) function is shown below:
```{r eval=FALSE}
get_best_param.result <- function(param_values, rmses){
  best_pvalue_idx <- which.min(rmses)
  c(param.best_value = param_values[best_pvalue_idx], 
    best_RMSE = rmses[best_pvalue_idx])
}
```

::: {.noteblock data-latex=""}
The source code of the [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) is also available in the [Model training](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L431) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) script on _GitHub_.
:::
:::

### Data Visualization Functions

#### [data.plot](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L592) Function {#func.data.plot}
\

Plots a graph based on the dataset passed in the [data](#func.data.plot.args.data) parameter, using both points and a line.

::: { #func.data.plot.Usage .sidebar }
##### Usage
\

```{r eval=FALSE}
data.plot(data, 
          title, 
          xname, 
          yname, 
          xlabel = NULL, 
          ylabel = NULL,
          line_col = "blue",
          normalize = FALSE)
```
:::

::: { #func.data.plot.args .sidebar }
##### Arguments
\

::: { #func.data.plot.args.data .sidebar }
  - **data:** Dataset to use for the plot; 

:::
::: { #func.data.plot.args.title .sidebar }
  - **title:** Title of the plot; 

:::
::: { #func.data.plot.args.xname .sidebar }
  - **xname:** The name of the dataset column used as the source of the $x$ variable for the plot; 

:::
::: { #func.data.plot.args.yname .sidebar }
  - **yname:** The name of the dataset column used as the source of the $y$ variable for the plot; 

:::
::: { #func.data.plot.args.xlabel .sidebar }
  - **xlabel = NULL:** The $x$ axis label. If `NULL`, the value of the `xname` parameter is used for the label; 

:::
::: { #func.data.plot.args.ylabel .sidebar }
  - **ylabel = NULL:** The $y$ axis label. If `NULL`, the value of the `yname` parameter is used for the label.; 

:::
::: { #func.data.plot.args.line_col .sidebar }
  - **line_col = blue:** The line color; 

:::
::: { #func.data.plot.args.normalize .sidebar }
  - **normalize = FALSE:** If `TRUE`, the deviation of $y$ from its mean is used to plot, rather than $y$ values. Otherwise, the value of $y$ is used.

:::
:::

::: { #func.data.plot.details .sidebar }
##### Details
\

The function is a wrapper for the [ggplot2::ggplot](https://ggplot2.tidyverse.org/reference/ggplot.html) function and is a simple and convenient tool for visualizing the data of this project.

:::

::: { #func.data.plot.code .sidebar }
##### Source Code
\

The soure code of the [data.plot](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L592) function is shown below:
```{r eval=FALSE}
data.plot <- function(data, 
                      title, 
                      xname, 
                      yname, 
                      xlabel = NULL, 
                      ylabel = NULL,
                      line_col = "blue",
                      normalize = FALSE) {
  y <- data[, yname]
  
  if (normalize) {
    y <- y - min(y)
  }
  
  if (is.null(xlabel)) {
    xlabel = xname
  }
  if (is.null(ylabel)) {
    ylabel = yname
  }
  
  aes_mapping <- aes(x = data[, xname], y = y)
  
  data |> 
    ggplot(mapping = aes_mapping) +
    ggtitle(title) +
    xlab(xlabel) +
    ylab(ylabel) +
    geom_point() + 
    geom_line(color=line_col)
}
```

::: {.noteblock data-latex=""}
The source code of the [data.plot](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L592) is also available in the [Data Visualization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L447) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L592) script on _GitHub_.
:::
:::

#### [data.plot.left.n](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L493) Function {#func.data.plot.left.n}
\

Plots a graph based on the first $n$ rows (the $n$ is specified by the [left.n](#func.data.plot.left.n.args.left.n) parameter) of the dataset passed in the [data](#func.data.plot.left.n.args.data) parameter, using both points and a line.

::: {.noteblock data-latex=""}
The dataset passed in the [data](#func.data.plot.left.n.args.data) parameter is assumed to be sorted by the column used for the $x$ axis (specified by the column name passed in the [xname](#func.data.plot.left.n.args.xname) parameter).
:::

::: { #func.data.plot.left.n.Usage .sidebar }
##### Usage
\

```{r eval=FALSE}
data.plot.left.n <- function(data, 
                             left.n = 0,
                             title, 
                             xname, 
                             yname, 
                             xlabel, 
                             ylabel,
                             line_col = "red",
                             normalize = FALSE)
```
:::

::: { #func.data.plot.left.n.args .sidebar }
##### Arguments
\

::: { #func.data.plot.left.n.args.data .sidebar }
  - **data:** Dataset to use for the plot. 

:::
::: { #func.data.plot.left.n.args.left.n .sidebar }
  - **left.n:** If a positive numeric value, specifies the number of the first rows of the dataset to plot. Otherwise, the entire dataset data is set to plot. 

:::
::: { #func.data.plot.left.n.args.title .sidebar }
  - **title:** Title of the plot. 

:::
::: { #func.data.plot.left.n.args.xname .sidebar }
  - **xname:** The name of the dataset column used as the source of the $x$ variable for the plot. 

:::
::: { #func.data.plot.left.n.args.yname .sidebar }
  - **yname:** The name of the dataset column used as the source of the $y$ variable for the plot. 

:::
::: { #func.data.plot.left.n.args.xlabel .sidebar }
  - *xlabel = NULL*:** The $x$ axis label. If `NULL`, the value of the `xname` parameter is used for the label. 

:::
::: { #func.data.plot.left.n.args.ylabel .sidebar }
  - **ylabel = NULL:** The $y$ axis label. If `NULL`, the value of the `yname` parameter is used for the label. 

:::
::: { #func.data.plot.left.n.args.line_col .sidebar }
  - **line_col = blue:** The line color. 

:::
::: { #func.data.plot.left.n.args.normalize .sidebar }
  - **normalize = FALSE:** If `TRUE`, the deviation of $y$ from its mean is used to plot, rather than $y$ values. Otherwise, the value of $y$ is used.

:::
:::

::: { #func.data.plot.left.n.details .sidebar }
##### Details
\

The function is a wrapper for the [data.plot](#func.data.plot) function described above and is a simple and convenient tool for more detailed visualization of the left part of the graph, initially built based on the entire data set passed in the [data](#func.data.plot.left.n.args.data) parameter.
:::

::: { #func.data.plot.left.n.code .sidebar }
##### Source Code
\

The source code of the [data.plot.left.n](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L493) function is shown below:
```{r eval=FALSE}
data.plot.left.n <- function(data, 
                             left.n = 0,
                             title, 
                             xname, 
                             yname, 
                             xlabel, 
                             ylabel,
                             line_col = "red",
                             normalize = FALSE) {
  x_col <- data[, xname] 
  y_col <- data[, yname]
  
  
  data.left <- data
  
  if (left.n > 0) {
    data.left <- data |> 
      head(left.n)
  }
  
  data.left |>
    data.plot(title = title,
              xname = xname,
              yname = yname,
              xlabel = xlabel,
              ylabel = ylabel,
              line_col = line_col,
              normalize = normalize)
}
```

::: {.noteblock data-latex=""}
The source code of the [data.plot.left.n](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L493) is also available in the [Data Visualization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L447) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L493) script on _GitHub_.
:::
:::

#### [data.plot.left_detailed](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L448) Function {#func.data.plot.left_detailed}
\

Combines two graphs plotted by the internally called helper functions in a grid: the first is a standard graph plotted by the [data.plot](#func.data.plot) function described above, the second is a graph based on the first $n$ rows (the $n$ is specified by the [left.n](#func.data.plot.left.n.args.left.n) parameter) of the dataset plotted by the [data.plot.left.n](#func.data.plot.left.n) function also described above (The data for both graphs is passed in the [data]).(#func.data.plot.left.n.args.data) parameter).

::: {.noteblock data-latex=""}
The dataset passed in the [data](#func.data.plot.left.n.args.data) parameter is assumed to be sorted by the column used for the $x$ axis (specified by the column name passed in the [xname](#func.data.plot.left.n.args.xname) parameter).
:::

::: { #func.data.plot.left_detailed.Usage .sidebar }
##### Usage
\

```{r eval=FALSE}
data.plot.left_detailed <- function(data, 
                                    left.n = 0,
                                    title = NULL,
                                    title.left = NULL,
                                    xname, 
                                    yname, 
                                    xlabel1 = NULL, 
                                    xlabel2 = NULL, 
                                    ylabel1 = NULL,
                                    ylabel2 = NULL,
                                    line_col1 = "blue",
                                    line_col2 = "red",
                                    normalize = FALSE)
```
:::

::: { #func.data.plot.left_detailed.args .sidebar }
##### Arguments
\

::: { #func.data.plot.left_detailed.args.data .sidebar }
  - **data:** Dataset to use for the plot. 

:::
::: { #func.data.plot.left.n.args.left.n .sidebar }
  - **left.n:** If a positive numeric value, specifies the number of the first rows of the dataset to plot. Otherwise, the entire dataset data is set to plot. 

:::
::: { #func.data.plot.left_detailed.args.title .sidebar }
  - **title:** Title of the plot. 

:::
::: { #func.data.plot.left_detailed.args.xname .sidebar }
  - **xname:** The name of the dataset column used as the source of the $x$ variable for the plot. 

:::
::: { #func.data.plot.left_detailed.args.yname .sidebar }
  - **yname:** The name of the dataset column used as the source of the $y$ variable for the plot. 

:::
::: { #func.data.plot.left_detailed.args.xlabel1 .sidebar }
  - *xlabel1 = NULL*:** The $x$ axis label for the first plot. If `NULL`, the value of the `xname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.xlabel2 .sidebar }
  - *xlabel2 = NULL*:** The $x$ axis label for the second plot. If `NULL`, the value of the `xname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.ylabel1 .sidebar }
  - **ylabel1 = NULL:** The $y$ axis label for the first plot. If `NULL`, the value of the `yname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.ylabel2 .sidebar }
  - **ylabel2 = NULL:** The $y$ axis label for the second plot. If `NULL`, the value of the `yname` parameter is used for the label. 

:::
::: { #func.data.plot.left_detailed.args.line_col .sidebar }
  - **line_col = blue:** The line color. 

:::
::: { #func.data.plot.left_detailed.args.normalize .sidebar }
  - **normalize = FALSE:** If `TRUE`, the deviation of $y$ from its mean is used to plot, rather than $y$ values. Otherwise, the value of $y$ is used.

:::
:::

::: { #func.data.plot.left_detailed.details .sidebar }
##### Details
\

Under the hood, the function calls internally the [data.plot](#func.data.plot) and [data.plot.left.n](#func.data.plot.left.n) functions (described above) to build two graphs and combines them into a grid.
:::

::: { #func.data.plot.left_detailed.code .sidebar }
##### Source Code
\

The soure code of the [data.plot.left_detailed](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L448) function is shown below:
```{r eval=FALSE}
data.plot.left_detailed <- function(data, 
                                    left.n = 0,
                                    title = NULL,
                                    title.left = NULL,
                                    xname, 
                                    yname, 
                                    xlabel1 = NULL, 
                                    xlabel2 = NULL, 
                                    ylabel1 = NULL,
                                    ylabel2 = NULL,
                                    line_col1 = "blue",
                                    line_col2 = "red",
                                    normalize = FALSE) {
  if(is.null(xlabel1)) {
    xlabel1 <- xname
  }
  if(is.null(xlabel2)) {
    xlabel2 <- str_glue(xlabel1, " (left part)")
  }
  if(is.null(ylabel1)) {
    ylabel1 <- yname
  }
  if(is.null(ylabel2)) {
    ylabel2 <- ylabel1
  }
  
  p1 <- data |>
    data.plot(title = title,
              xname = xname, 
              yname = yname, 
              xlabel = xlabel1, 
              ylabel = ylabel1,
              line_col = line_col1)
  
  p2 <- data |>
    data.plot.left.n(left.n = left.n,
                     title = title.left,
                     xname = xname, 
                     yname = yname, 
                     xlabel = xlabel2, 
                     ylabel = ylabel2,
                     line_col = line_col2,
                     normalize = normalize)
  grid.arrange(p1, p2)
}
```

::: {.noteblock data-latex=""}
The source code of the [data.plot.left_detailed](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L448) is also available in the [Data Visualization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L447) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L448) script on _GitHub_.
:::
:::

\newpage



## Common Helper Functions
### Utility Functions {#appndx_a.CHF.utility_funcs}

#### [clamp](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/common-helper.functions.R#L6) Function {#func.clamp}
\

Clamps the input value passed in [r](#func.clamp.args.r) argument between the values passed in [min](#func.clamp.args.min) and [max](#func.clamp.args.max) arguments. 

::: { #func.clamp.Usage .sidebar }
##### Usage
\

```{r eval=FALSE}
r_clamped <- clamp(r, min = 0.5, max = 5)
```
:::

::: { #func.clamp.args .sidebar }
##### Arguments
\

::: { #func.clamp.args.r .sidebar }
  - **r:** Value to clamp; 

:::
::: { #func.clamp.args.min .sidebar }
  - **min:** Minimum allowed value; 

:::
:::
::: { #func.clamp.args.max .sidebar }
  - **max:** Maximum allowed value; 

:::
:::

::: { #func.clamp.details .sidebar }
##### Details
\

As explained in [Section  23.4 *User effects*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#user-effects) of the _Course Textbook_ we know ratings cannot be below 0.5 or above 5. For this reason, we need a function described in that section[@IDS2_23-4]:

Therefore, in our project this function is used to clamp the computed movie rating values between 0.5 and 5.

:::

::: { #func.clamp.value .sidebar }
##### Value
\

The value clamped between [min](#func.clamp.args.min) and [max](#func.clamp.args.max) argument values.

:::

::: { #func.clamp.code .sidebar }
##### Source Code
\

The source code of the [clamp](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/common-helper.functions.R#L6) function is shown below:
```{r eval=FALSE}
clamp <- function(x, min = 0.5, max = 5) pmax(pmin(x, max), min)
```

::: {.noteblock data-latex=""}
The source code of the [clamp](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L6) function is also available in the [Utility Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L3) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L6) script on _GitHub_.
:::
:::




### Result RMSEs Table Functions
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [Model Tuning](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L74) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R) script on _GitHub_.
:::

#### [RMSEs.](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L) Function {#func.RMSEs.}
\

::: {.noteblock data-latex=""}
The complete source code of this function is available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L) script on _GitHub_.
:::


::: { #func.RMSEs.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
```
:::

::: { #func.RMSEs..args .sidebar }
##### Arguments
\

::: { #func.RMSEs..args.RMSEs .sidebar }
  - ***RMSEs:*** _Resut (RMSEs) Table_ to modify;

:::

::: { #func.RMSEs..args. .sidebar }
  - ***:*** ;

:::

::: { #func.RMSEs..args. .sidebar }
  - ***:*** ;

:::

::: { #func.RMSEs..args. .sidebar }
  - ***:*** ;

:::

::: { #func.RMSEs..args. .sidebar }
  - ***:*** ;

:::

::: { #func.RMSEs..args. .sidebar }
  - ***:*** ;

:::

::: { #func.RMSEs..args. .sidebar }
  - ***:*** ;

:::

::: { #func.RMSEs..args. .sidebar }
  - ***:*** ;

:::

::: { #func.RMSEs..args. .sidebar }
  - ***:*** ;

:::

::: { #func.RMSEs.details .sidebar }
##### Details
\


::: { #func.RMSEs.code .sidebar }
##### Source Code
\

The soure code of the function is provided below:
```{r eval=FALSE}
```
:::

##### Return

The modified _Resut (RMSEs) Table_.


#### [RMSEs.AddRow](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L38) Function {#func.RMSEs.AddRow}
\

::: {.noteblock data-latex=""}
The complete source code of this function is available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L38) script on _GitHub_.
:::

::: { #func.RMSEs.AddRow.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
RMSEs.AddRow(RMSEs, 
             method, 
             value, 
             comment = "", 
             before = NULL)
```
:::

::: { #func.RMSEs.AddRow.args .sidebar }
##### Arguments
\

::: { #func.RMSEs.AddRow.args.RMSEs .sidebar }
  - ***RMSEs:*** _Resut (RMSEs) Table_ to modify;

:::

::: { #func.RMSEs.AddRow.args.method .sidebar }
  - ***method:*** The _Method or Model_ being evaluated;

:::

::: { #func.RMSEs.AddRow.args.value .sidebar }
  - ***value:*** The _Root Mean Squared Error (RMSE)_ value;

:::

::: { #func.RMSEs.AddRow.args.comment .sidebar }
  - ***comment:*** Detailed information about the record or any other comment (if needed);

:::

::: { #func.RMSEs.AddRow.args.before .sidebar }
  - ***before:*** One-based row index where to add the new rows, if NULL (default): after last row;

:::

::: { #func.RMSEs.AddRow.code .sidebar }
##### Source Code
\

The soure code of the function is provided below:
```{r eval=FALSE}
RMSEs.AddRow <- function(RMSEs, 
                         method, 
                         value, 
                         comment = "", 
                         before = NULL){
  RMSEs |>
    add_row(Method = method,
            RMSE = value,
            Comment = comment,
            .before = before)
}
```
:::

##### Return

The modified _Resut (RMSEs) Table_.


#### [RMSEs.AddDiffColumn](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L49) Function {#func.RMSEs.AddDiffColumn}
\

::: {.noteblock data-latex=""}
The complete source code of this function is available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L49) script on _GitHub_.
:::

Adds a calculated column named _Diff_ to the _Result(RMSEs)_ table (passed in the [RMSEs](#func.RMSEs.AddDiffColumn.args.RMSEs) parameter) that contains, for each row, the difference between the value of the _RMSE_ column for the previous row and the value of the same column for the current row. This is true for each row except the first, for which the value is always zero.

::: { #func.RMSEs.AddDiffColumn.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
RMSEs.ModifiedTable <- RMSEs.AddDiffColumn(RMSEs)
```
:::

::: { #func.RMSEs.AddDiffColumn.args .sidebar }
##### Arguments
\

::: { #func.RMSEs.AddDiffColumn.args.RMSEs .sidebar }
  - ***RMSEs:*** _Resut (RMSEs) Table_ to modify;

:::

::: { #func.RMSEs.AddDiffColumn.code .sidebar }
##### Source Code
\

The soure code of the function is provided below:
```{r eval=FALSE}
RMSEs.AddDiffColumn <- function(RMSEs){
  RMSEs.Diff <- RMSEs |>
    RMSEs.AddRow(NULL, project_objective, before = 1) #|>
    #RMSEs.AddRow(NULL, 0, before = 1)
    
  
  RMSEs.Diff <- RMSEs.Diff[-nrow(RMSEs.Diff),]
    
  RMSEs |>
  add_column(Diff = RMSEs.Diff$RMSE - RMSEs$RMSE, 
             .before = "Comment")
  
}
```

::: {.noteblock data-latex=""}
Under the hood, the function calls internally the [RMSEs.AddRow](#func.RMSEs.AddRow) function described above.
:::
:::

##### Return

The modified _Resut (RMSEs) Table_.

#### [RMSE_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L74) Function {#func.RMSE_kable}
\

::: {.noteblock data-latex=""}
The complete source code of this function is available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L74) script on _GitHub_.
:::

Prints the _Resut (RMSEs) Table_.

::: {.noteblock data-latex=""}
It is assumed that the table has the following three columns:
  
  1. *Method*;
  2. *RMSE*;
  3. *Comment*;
  
:::

::: { #func.RMSE_kableusage .sidebar }
##### Usage
\

```{r eval=FALSE}
RMSE_kable <- function(RMSEs,
                       col1width = 15,
                       col2width = 5,
                       col3width = 30)
```
:::

::: { #func.RMSE_kable.args .sidebar }
##### Arguments
\

::: { #func.RMSE_kable.args.RMSEs .sidebar }
  - ***RMSEs:*** _Resut (RMSEs) Table_ to print;

:::

::: { #func.RMSE_kable.args.col1width .sidebar }
  - ***col1width:*** Width of the first column;

:::

::: { #func.RMSE_kable.args.col2width .sidebar }
  - ***col2width:*** Width of the second column;

:::

::: { #func.RMSE_kable.args.col3width .sidebar }
  - ***col3width:*** Width of the third column;

:::

::: { #func.RMSE_kablecode .sidebar }
##### Source Code
\

The soure code of the function is provided below:
```{r eval=FALSE}
RMSE_kable <- function(RMSEs,
                       col1width = 15,
                       col2width = 5,
                       col3width = 30){
  RMSEs |>
    kable(align='lcl', booktabs = T, padding = 5) |> 
    row_spec(0, bold = T) |>
    column_spec(column = 1, width = RSME.tibble.col_width(col1width)) |>
    column_spec(column = 2, width = RSME.tibble.col_width(col2width)) |>
    column_spec(column = 3, width = RSME.tibble.col_width(col3width)) 
}
```
:::

#### [RMSE.Total_kable](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L85) Function {#func.RMSE.Total_kable}
\

::: {.noteblock data-latex=""}
The complete source code of this function is available in the [RMSEs Result Tibble](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L32) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L85) script on _GitHub_.
:::

Prints the _Resut (RMSEs) Table_.

::: {.noteblock data-latex=""}
It is assumed that the table has the following four columns:
  
  1. *Method*;
  2. *RMSE*;
  3. *Diff*;
  4. *Comment*;
  
:::

::: { #func.RMSE.Total_kableusage .sidebar }
##### Usage
\

```{r eval=FALSE}
RMSE.Total_kable <- function(RMSEs,
                       col1width = 15,
                       col2width = 7,
                       col3width = 5,
                       col4width = 25)
```
:::

::: { #func.RMSE.Total_kable.args .sidebar }
##### Arguments
\

::: { #func.RMSE.Total_kable.args.RMSEs .sidebar }
  - ***RMSEs:*** _Resut (RMSEs) Table_ to print;

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col1width:*** Width of the first column;

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col2width:*** Width of the second column;

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col3width:*** Width of the third column;

:::

::: { #func.RMSE.Total_kable.args. .sidebar }
  - ***col4width:*** Width of the fourth column;

:::

::: { #func.RMSE.Total_kablecode .sidebar }
##### Source Code
\

The soure code of the function is provided below:
```{r eval=FALSE}
RMSE.Total_kable <- function(RMSEs,
                       col1width = 15,
                       col2width = 7,
                       col3width = 5, 
                       col4width = 25){
  RMSEs |> 
    RMSE_kable(col1width,
               col2width,
               col3width) |>
    column_spec(column = 4, 
                width = RSME.tibble.col_width(col4width)) 
}

```

::: {.noteblock data-latex=""}
Under the hood, the function calls internally the [RMSE_kable](#func.RMSE_kable) function described above.
:::
:::

### Regularization Functions {#appndx_a.CHF.regularization}
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [Model Tuning](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L74) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R) script on _GitHub_.
:::

#### [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L63) Function {#func.mean_reg}
\

A general function for computing the arithmetic mean given a _regularization parameter_ $\lambda$. We will call it the _penaized mean_.

::: { #func.mean_reg.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
mean_reg(vals, lambda = 0, na.rm = TRUE)

```
:::

::: { #func.mean_reg.args .sidebar }
##### Arguments
\

::: { #func.mean_reg.args.vals .sidebar }
  - **vals:** values (usually a numeric vector) to calculate the _penalized mean_;

:::
::: { #func.mean_reg.args.lambda .sidebar }
  - **lambda:** a _regularization parameter_ $\lambda$ used in the _Regularization techniques_. 

:::
  - **na.rm:** a logical evaluating to TRUE or FALSE indicating whether NA values should be stripped before the computation proceeds.

:::


::: { #func.mean_reg.details .sidebar }
##### Details
\
We call this function internally from the functions that compute the _penalized estimates_  as described in section [23.6 Penalized Least Squares](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the _Course Textbook_[@IDS2_23-6].

::: {.noteblock data-latex=""}
If the [lambda](#func.mean_reg.args.lambda) parameter is `0` (the default), the function is equivalent to the standard R function [base::mean](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/mean), calling with the parameter `trim = 0` (the default for the `base::mean` function).
:::
:::

::: { #func.mean_reg.code .sidebar }
##### Source Code
\

The soure code of the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L63) function is shown below:
```{r eval=FALSE}
mean_reg <- function(vals, lambda = 0, na.rm = TRUE){
  if (is.na(lambda)) {
    stop("Function: mean_reg
`lambda` is `NA`")
  }
  
  names(lambda) <- NULL
  sums <- sum(vals, na.rm = na.rm)
  N <- ifelse(na.rm, sum(!is.na(vals)), length(vals))
  sums/(N + lambda)
}
```

::: {.noteblock data-latex=""}
The source code of the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L63) is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L62) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L63) script on _GitHub_.
:::
:::

::: { #func.mean_reg.value .sidebar }
##### Value
\

The function calculates the _penalized mean_ of the [vals](#func.mean_reg.args.vals) parameter as follows:
$$
\mu(\lambda) = \frac{1}{\lambda + N} \sum_{i=1}^{N} x_i
$$

When the [lambda](#func.mean_reg.args.lambda) parameter is `0` (meaning the $\lambda = 0$), the function calculates the simple arithmetic mean as follows:
$$
\mu = \frac{1}{N} \sum_{i=1}^{N} x_i
$$

:::

#### [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L116) Function {#func.tune.model_param}
\

The function searches for the parameter value corresponding to the minimum value of the `RMSE` from the list of values specified by the `param_values` parameter.

##### Signature
\
```{r eval=FALSE}
tune.model_param <- function(param_values, 
                             fn_tune.test.param_value, 
                             break.if_min = TRUE,
                             steps.beyond_min = 2){

# ...
  list(tuned.result = data.frame(RMSE = RMSEs_tmp,
                                parameter.value = param_vals_tmp),
       best_result = param_values.best_result)
}  
```

##### Arguments
\

  - **param_values:** A list of values to search for the value corresponding to the minimum value of the `RMSE` ; 

::: { #func.tune.model_param.args.fn_tune.test.param_value .sidebar }
  - **fn_tune.test.param_value:** A helper function that calculates the value of the `RMSE` for a given parameter value.; 

:::  
  - **break.if_min = TRUE:** A Boolean parameter that determines whether the function should terminate after completing the number of steps specified by the parameter `steps.beyond_min`, after the minimum value of the `RMSE` has been found;
  
  - **steps.beyond_min = 2:** (takes effect only if `break.if_min` parameter is `TRUE`) Specifies the number of steps after finding the minimum value of the `RMSE`, upon completion of which the function should terminate.

##### Details
\
During execution, the function uses a helper function specified by the `fn_tune.test.param_value` parameter, which calculates the `RMSE` value for the given parameter from the list determined by the `param_values` parameter.

::: {.noteblock data-latex=""}
Note that the algorithm assumes that the dependence of the `RMSE` on the input parameter is a monotonically decreasing function until a minimum is reached and monotonically increasing thereafter. That is, it is assumed that the function has a single minimum on the given interval.
:::

::: { #func.tune.model_param.value .sidebar }
##### Value
\
The function returns a data structure containing the found value of the input parameter `param_values` for which the `RMSE` value is minimal, as well as the minimum `RMSE` value itself, along with a sequence of all calculated `RMSE` values:
```{r eval=FALSE}
  list(tuned.result = data.frame(RMSE = RMSEs_tmp,
                                parameter.value = param_vals_tmp),
       best_result = param_values.best_result)
```
:::

##### Source Code
\
Below is the most significant part of the source code of the [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L116) function:
```{r eval=FALSE}
tune.model_param <- function(param_values, 
                             fn_tune.test.param_value, 
                             break.if_min = TRUE,
                             steps.beyond_min = 2){
  n <- length(param_values)
  param_vals_tmp <- numeric()
  RMSEs_tmp <- numeric()
  RMSE_min <- Inf
  i_max.beyond_RMSE_min <- Inf
  prm_val.best <- NA

  # ...
  
  for (i in 1:n) {
    put_log1("Function: `tune.model_param`:
Iteration %1", i)
    prm_val <- param_values[i]
    param_vals_tmp[i] <- prm_val
    
    RMSE_tmp <- fn_tune.test.param_value(prm_val)
    RMSEs_tmp[i] <- RMSE_tmp

    plot(param_vals_tmp[RMSEs_tmp], RMSEs_tmp[RMSEs_tmp])

    if(RMSE_tmp > RMSE_min){
      warning("Function: `tune.model_param`:
`RSME` reached its minimum: ", RMSE_min, "
for parameter value: ", prm_val)
      put_log2("Function: `tune.model_param`:
Current `RMSE` value is %1 related to parameter value: %2",
               RMSE_tmp,
               prm_val)
      
      if (i > i_max.beyond_RMSE_min) {
        warning("Function: `tune.model_param`:
Operation is breaked (after `RSME` reached its minimum) on the following step: ", i)
        break
      }
      next
    }

    RMSE_min <- RMSE_tmp
    prm_val.best <- prm_val
    
    if (break.if_min) {
      i_max.beyond_RMSE_min <- i + steps.beyond_min
    }
  }
  
  param_values.best_result <- c(param.best_value = prm_val.best, 
                                best_RMSE = RMSE_min)
  
  
  list(tuned.result = data.frame(RMSE = RMSEs_tmp,
                                parameter.value = param_vals_tmp),
       best_result = param_values.best_result)
}
```

\newpage

#### [model.tune.param_range](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L198) Function {#func.model.tune.param_range}
\

The function fine-tunes the model by searching for the best possible value of the input parameter over a given interval for which the corresponding `RMSE` value is minimal.

##### Signature
\
```{r eval=FALSE}
model.tune.param_range <- function(loop_starter,
                             tune_dir_path,
                             cache_file_base_name,
                             fn_tune.test.param_value,
                             max.identical.min_RMSE.count = 4,
                             endpoint.min_diff = 0,
                             break.if_min = TRUE,
                             steps.beyond_min = 2){
  # ...
  list(best_result = param_values.best_result,
       param_values.endpoints = c(prm_val.leftmost, prm_val.rightmost, seq_increment),
       tuned.result = data.frame(parameter.value = parameter.value,
                                 RMSE = result.RMSE))
}
```

##### **Parameters**
\

::: { #func.model.tune.param_range.args.loop_starter .sidebar }
###### ***loop_starter***
\
A numeric vector of the form `c(start, end, dvs)`, where `start` and `end` are the endpoints of the interval on which the parameter value that minimizes `RMSE` is sought.
`dvs` is a divisor for splitting the interval to transform it into a sequence of values among which the value that minimizes `RMSE` is sought.
For this purpose, the sequence step is calculated as follows:
$$
step = \frac{end - start}{dvs}
$$  

The sequence obtained as a result of the transformation is equivalent to the one generated by the function `seq` as follows:
```{r eval=FALSE}
seq(start, end, step)
```  
In fact, the `seq` function is called internally to generate the sequence during the execution of the `model.tune.param_range` function.
:::

::: { #func.model.tune.param_range.args.tune_dir_path .sidebar }
###### ***tune_dir_path***
\
To improve performance, the algorithm caches intermediate results in the file system. This parameter specifies the path to the directory where the files are cached.
:::

::: { #func.model.tune.param_range.args.cache_file_base_name .sidebar }
###### ***cache_file_base_name***
\
The algorithm generates unique names for cache files based on this and the `loop_starter` parameter, as well as some other intermediate values calculated during the execution.
:::

::: { #func.model.tune.param_range.args.fn_tune.test.param_value .sidebar }
###### ***fn_tune.test.param_value***
\
This is a helper function name that is passed to the same-named parameter of the [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L116) function that is called internally during the execution (see the description of the `tune.model_param` function [above](#func.tune.model_param)). 
:::

::: { #func.model.tune.param_range.args.max.identical.min_RMSE.count .sidebar }
###### ***max.identical.min_RMSE.count = 4***
\
If more than one identical minimum `RMSE` value is calculated during execution, the number of identical minimums is limited by the value of this parameter. When it is reached, the algorithm considers the task execution to be complete.
:::

::: { #func.model.tune.param_range.args.endpoint.min_diff .sidebar }
###### ***endpoint.min_diff = 0***
\
Defines the sensitivity threshold for determining the neighborhood boundaries of the minimum `RMSE` value (for details, see the `Details` section [below](#func.model.tune.param_range.details)).
:::

::: { #func.model.tune.param_range.args.break.if_min .sidebar }
###### ***break.if_min = TRUE***
\
This is a parameter that is required for the [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L116) function that is called internally during execution (see the description of the `tune.model_param` function [above](#func.tune.model_param)). 
:::

::: { #func.model.tune.param_range.args.steps.beyond_min .sidebar }
###### ***steps.beyond_min = 2***
\
This is a parameter that is required for the [tune.model_param](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L116) function that is called internally during execution (see the description of the `tune.model_param` function [above](#func.tune.model_param)). 

::: { #func.model.tune.param_range.details .sidebar }
##### **Details** 
\
First, the function generates a sequence of the `input parameter values` based on the `loop_starter` parameter values, as described above (see the [loop_starter](#func.model.tune.param_range.args.loop_starter) parameter description for the details), which is used as one of the input parameters for the helper function [tune.model_param](#func.tune.model_param), which is repeatedly called during the execution, performing fine-tuning of the model.

The `tune.model_param` function returns a range of input parameter values associated with the set of corresponding _Root Mean Squared Errors_ that is also guaranteed to include their minimum value, as described in the [Value](#func.tune.model_param.value) subsection of the [tune.model_param](#func.tune.model_param) function description.

Next, the function figures out the boundary indices of a range of values from the neighborhood of the minimum `RMSE` by calling internally another helper function [get_fine_tune.param.endpoints.idx](#func.get_fine_tune.param.endpoints.idx) (see the description below) and, using one more helper function [get_best_param.result](#func.get_best_param.result)  (see the description below), a pair of values,  corresponding to the best result: minimal  `RMSE` and corresponding input parameter value (which is considered the best).

The found values of the boundary indices are then used as the endpoints of a new interval to regenerate the sequence based on it in the next iteration, just as it was done based on the values of the `loop_starter` parameter at the very beginning of the execution. The value of `step divisor`, used to calculate the step of the generated sequence, remains unchanged during the entire execution (see the description of the [loop_strarter](#func.model.tune.param_range.args.loop_starter) parameter above for details).

Thus, with each subsequent iteration, the minimum `RMSE` value is calculated more accurately, over an ever-decreasing interval, with the boundary values tending to the minimum `RMSE` value, and the sequence generated with an ever-decreasing step.

The calculation is completed when subsequent calculated values of the minimum `RMSE` stop improving and reach the most accurate possible value.
:::

##### **Value**
\

A data structure containing the minimum `RMSE` value reached during the fine-tuning process, the corresponding input parameter value, and information about the final sequence, on which the best output values were found:
```{r eval=FALSE}
  list(best_result = param_values.best_result,
       param_values.endpoints = c(prm_val.leftmost, prm_val.rightmost, seq_increment),
       tuned.result = data.frame(parameter.value = parameter.value,
                                 RMSE = result.RMSE))
```

::: {#func.model.tune.param_range.code .sidebar }
##### Source Code
\
Below is the simplified version of the source code of the [model.tune.param_range](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L198) function:
```{r eval=FALSE}
model.tune.param_range <- function(loop_starter,
                             tune_dir_path,
                             cache_file_base_name,
                             fn_tune.test.param_value,
                             max.identical.min_RMSE.count = 4,
                             is.cv = TRUE,
                             endpoint.min_diff = 0, #1e-07,
                             break.if_min = TRUE,
                             steps.beyond_min = 2){

  seq_start <- loop_starter[1]
  seq_end <- loop_starter[2]
  interval_divisor <- loop_starter[3]
  
  if (interval_divisor < 4) {
    interval_divisor <- 4
  }
  
  prm_val.leftmost <- seq_start
  prm_val.rightmost <- seq_end
  
  RMSE.leftmost <- NA
  RMSE.rightmost <- NA

  best_RMSE <- NA
  param.best_value <- 0
  
  
  param_values.best_result <- c(param.best_value = param.best_value, 
                                best_RMSE = best_RMSE)
  # Start repeat loop
  repeat{
    seq_increment <- (seq_end - seq_start)/interval_divisor 
    
    if (seq_increment < 0.0000000000001) {
      warning("Function `model.tune.param_range`:
parameter value increment is too small.")
      break
    }
    
    test_param_vals <- seq(seq_start, seq_end, seq_increment)
    
    tuned_result <- tune.model_param(test_param_vals, 
                                  fn_tune.test.param_value,
                                  break.if_min,
                                  steps.beyond_min)
    
    tuned.result <- tuned_result$tuned.result
    plot(tuned.result$parameter.value, tuned.result$RMSE)
    
    bound.idx <- get_fine_tune.param.endpoints.idx(tuned.result)
    start.idx <- bound.idx["start"]
    end.idx <- bound.idx["end"]
    best_RMSE.idx <- bound.idx["best"]
    
    prm_val.leftmost.tmp <- tuned.result$parameter.value[start.idx]
    RMSE.leftmost.tmp <- tuned.result$RMSE[start.idx]

    prm_val.rightmost.tmp <- tuned.result$parameter.value[end.idx]
    RMSE.rightmost.tmp <- tuned.result$RMSE[end.idx]
    
    min_RMSE <- tuned.result$RMSE[best_RMSE.idx]
    min_RMSE.prm_val <- tuned.result$parameter.value[best_RMSE.idx]

    seq_start <- prm_val.leftmost.tmp
    seq_end <- prm_val.rightmost.tmp
    
    if (is.na(best_RMSE)) {
      prm_val.leftmost <- prm_val.leftmost.tmp
      RMSE.leftmost <- RMSE.leftmost.tmp
      
      prm_val.rightmost <- prm_val.rightmost.tmp
      RMSE.rightmost <- RMSE.rightmost.tmp
      
      param.best_value <- min_RMSE.prm_val
      best_RMSE <- min_RMSE
    }
    
    if (RMSE.leftmost.tmp - min_RMSE >= endpoint.min_diff) {
      prm_val.leftmost <- prm_val.leftmost.tmp
      RMSE.leftmost <- RMSE.leftmost.tmp
    } 
    
    if (RMSE.rightmost.tmp - min_RMSE >= endpoint.min_diff) {
      prm_val.rightmost <- prm_val.rightmost.tmp
      RMSE.rightmost <- RMSE.rightmost.tmp
    } 
    
    if (end.idx - start.idx <= 0) {
      warning("`tuned.result$parameter.value` sequential start index are the same or greater than end one.")
      break
    }
    
    if (best_RMSE == min_RMSE) {
      warning("Currently computed minimal RMSE equals the previously reached best one: ",
              best_RMSE, "
Currently computed minial value is: ", min_RMSE)

      if (sum(tuned.result$RMSE[tuned.result$RMSE == min_RMSE]) >= max.identical.min_RMSE.count) {
        warning("Minimal `RMSE`identical values count reached it maximum allowed value: ",
                max.identical.min_RMSE.count)

        param_values.best_result <-
          get_best_param.result(tuned.result$parameter.value,
                                tuned.result$RMSE)
        break
      }

    } else if (best_RMSE < min_RMSE) {
      stop("Current minimal RMSE is greater than previously computed best value: ",
           best_RMSE, "
Currently computed minial value is: ", min_RMSE)
    }

    best_RMSE <- min_RMSE
    param.best_value <- min_RMSE.prm_val

    param_values.best_result <- 
      get_best_param.result(tuned.result$parameter.value, 
                          tuned.result$RMSE)
  }
  # End repeat loop
  
  n <- length(tuned.result$parameter.value)
  parameter.value <- tuned.result$parameter.value
  result.RMSE <- tuned.result$RMSE
  
  if (result.RMSE[1] == best_RMSE) {
    parameter.value[1] <- prm_val.leftmost
    result.RMSE[1] <- RMSE.leftmost
  }
  if (result.RMSE[n] == best_RMSE) {
    parameter.value[n+1] <- prm_val.rightmost
    result.RMSE[n+1] <- RMSE.rightmost
  }
  
  list(best_result = param_values.best_result,
       param_values.endpoints = c(prm_val.leftmost, prm_val.rightmost, seq_increment),
       tuned.result = data.frame(parameter.value = parameter.value,
                                 RMSE = result.RMSE))
}
```

::: {.noteblock data-latex=""}
The complete version of the source code of the [model.tune.param_range](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L198) is available in the [Model Tuning](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L74) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L198) script on _GitHub_.
:::
:::

\newpage

#### [get_fine_tune.param.endpoints](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L80) Function {#func.get_fine_tune.param.endpoints}
\

The algorithm finds the values of the nearest neighboring elements of the element corresponding to the minimum RMSE value in the given sequence.

##### Signature
\
```{r eval=FALSE}
get_fine_tune.param.endpoints <- function(preset.result) {
  # ...
  
  c(start = preset.result$parameter.value[i], 
    end = preset.result$parameter.value[j],
    best = preset.result$parameter.value[best.idx])
}
```

##### Arguments
\

::: {#func.get_fine_tune.param.endpoints.args.preset.result .sidebar }
###### ***preset.result***
\
A data structure compatible with the `tuned.result` item of the data structure returned by the [tune.model_param](#func.tune.model_param) function (see the [Value](#func.tune.model_param.value) subsection of the `tune.model_param` function description section for more details). Here is a sample of using this parameter in the `model.tune.param_range` function [code](#func.model.tune.param_range.code):
```{r eval=FALSE}
    tuned_result <- tune.model_param(test_param_vals, 
                                  fn_tune.test.param_value,
                                  break.if_min,
                                  steps.beyond_min)
    
    tuned.result <- tuned_result$tuned.result
    # tuned.result = data.frame(RMSE, parameter.value)
    # ...
    bound.idx <- get_fine_tune.param.endpoints(tuned.result)
    # bounnd.idx =  c(start.index, end.index, min_RMSE.index)
```
::: 

##### Details
\

Under the hood, the function internally calls another helper function [get_fine_tune.param.endpoints.idx](#func.get_fine_tune.param.endpoints.idx) described below to figure out the boundary indices of the range of values from the nearest neighborhood of the value corresponding to the best `RMSE` in the data passed in the [preset.result](#func.get_fine_tune.param.endpoints.args.preset.result) parameter.

##### Value
\
A vector containing the element value corresponding to the minimum `RMSE` in a given sequence, along with the values of its nearest neighboring elements:
```{r eval=FALSE}
  c(start = preset.result$parameter.value[i], 
    end = preset.result$parameter.value[j],
    best = preset.result$parameter.value[best.idx])
```

##### Source Code
\
The source code of the [get_fine_tune.param.endpoints](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L80) function is provided below:
```{r eval=FALSE}
get_fine_tune.param.endpoints <- function(preset.result) {

  preset.result.idx <- get_fine_tune.param.endpoints.idx(preset.result)
  
  i <- preset.result.idx["start"]
  j <- preset.result.idx["end"]
  best.idx <- preset.result.idx["best"]
  
  c(start = preset.result$parameter.value[i], 
    end = preset.result$parameter.value[j],
    best = preset.result$parameter.value[best.idx])
}
```

\newpage

#### [get_fine_tune.param.endpoints.idx](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L87) Function {#func.get_fine_tune.param.endpoints.idx}
\

##### Signature
\
```{r eval=FALSE}
get_fine_tune.param.endpoints.idx <- function(preset.result) {
  # ...
    
  c(start = i, 
    end = j,
    best = best_RMSE.idx)
}
```

##### Arguments
\

::: {#func.get_fine_tune.param.endpoints.idx.args.preset.result .sidebar }
###### ***preset.result***
\
A data structure compatible with the `tuned.result` item of the data structure returned by the [tune.model_param](#func.tune.model_param) function (see the [Value](#func.tune.model_param.value) subsection of the `tune.model_param` function description section for more details). Here is a sample of using this parameter in the `model.tune.param_range` function [code](#func.model.tune.param_range.code):
```{r eval=FALSE}
    tuned_result <- tune.model_param(test_param_vals, 
                                  fn_tune.test.param_value,
                                  break.if_min,
                                  steps.beyond_min)
    
    tuned.result <- tuned_result$tuned.result
    # tuned.result = data.frame(RMSE, parameter.value)
    # ...
    bound.idx <- get_fine_tune.param.endpoints.idx(tuned.result)
    # bounnd.idx =  c(start.index, end.index, min_RMSE.index)
```
::: 

##### Details
\
The algorithm finds the indices of the nearest neighboring elements of the element corresponding to the minimum RMSE value in the given sequence.

##### Value
\
A vector containing the index of the element corresponding to the minimum `RMSE` value in a given sequence, along with the indices of its nearest neighboring elements:
```{r eval=FALSE}
  c(start, # interval start index
    end,   # interval end index
    best)  # index of the best `RMSE`
```

##### Source Code
\
The source code of the [get_fine_tune.param.endpoints.idx](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L87) function is shown below:
```{r eval=FALSE}
get_fine_tune.param.endpoints.idx <- function(preset.result) {
  best_RMSE <- min(preset.result$RMSE)
  best_RMSE.idx <- which.min(preset.result$RMSE)
  # best_lambda <- preset.result$parameter.value[best_RMSE.idx]
  
  preset.result.N <- length(preset.result$RMSE)
  i <- best_RMSE.idx
  j <- i
  
  while (i > 1) {
    i <- i - 1
    
    if (preset.result$RMSE[i] > best_RMSE) {
      break
    }
  }
  
  while (j < preset.result.N) {
    j <- j + 1
    
    if (preset.result$RMSE[j] > best_RMSE) {
      break
    }
  }
  
  c(start = i, 
    end = j,
    best = best_RMSE.idx)
}

```

\newpage

#### [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) Function {#func.get_best_param.result}
\

##### Signature
\
```{r eval=FALSE}
get_best_param.result <- function(param_values, rmses){
  # ...
  
  c(param.best_value = param_values[best_pvalue_idx], 
    best_RMSE = rmses[best_pvalue_idx])

```

##### Arguments
\
A pair of matched vectors, the first of which contains the values of the input parameters for tuning, and the second, the corresponding values of the `RMSE`.
  
  - **param_values:** A vector containing the values of the input parameters for tuning;; 
  - **rmses:** A vector containing values of the corresponding `Root Mean Squared Errors`..

##### Details
\
Extracts the best values from the input data and returns them as a vector containing a pair of the best _input parameter_ value and the corresponding _minimum `RMSE`_.

##### Value
\
A vector containing a pair of the best _input parameter_ value and the corresponding _minimum `RMSE`_:
```{r eval=FALSE}
c(param.best_value, best_RMSE)
```

##### Source Code
\
The source code of the [get_best_param.result](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L442) function is shown below:
```{r eval=FALSE}
get_best_param.result <- function(param_values, rmses){
  best_pvalue_idx <- which.min(rmses)
  c(param.best_value = param_values[best_pvalue_idx], 
    best_RMSE = rmses[best_pvalue_idx])
```

