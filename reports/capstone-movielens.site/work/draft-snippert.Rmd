---
title: "func-descr.template"
output: html_document
---

::: {.noteblock data-latex=""}
In the code snippet above, we use the custom function [@fn](#func.@fn) described in the [sec_name] section of [Appendix A: Support Functions].
:::
### MF: Helper Functions

#### [mf.residual.dataframe](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L1) Function {#func.mf.residual.dataframe}
\

::: { #func.mf.residual.dataframe.args.description .sidebar }
##### Description
\

Computes residuals, defined as the difference between the observed and predicted values of the fully trained _UMGYDE Model_ as described in the [User+Movie+Genre+Year+Day Effect (UMGYDE) Model] section.

##### Arguments
\

###### ***train_set***
\

::: { #func.mf.residual.dataframe.args.train_set .sidebar }
The dataset to be trained.
:::

##### Source Code
\

The folowing is the source code of the function:
```{r eval=FALSE}
mf.residual.dataframe <- function(train_set){
  train_set |> 
    left_join(edx.user_effect, by = "userId") |>
    left_join(rglr.UM_effect, by = "movieId") |>
    left_join(rglr.UMG_effect, by = "movieId") |>
    left_join(date_days_map, by = "timestamp") |>
    left_join(rglr.UMGY_effect, by='year') |>
    left_join(rglr.UMGYD_effect, by='days') |>
    mutate(rsdl = rating - (mu + a + b + g + ye + de_smoothed)) |>
    select(userId, movieId, rsdl)
}
```

::: {.noteblock data-latex=""}
The source code of the [mf.residual.dataframe](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L1) function is also available in the [MF.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L1) script on _GitHub_.
:::

##### Return
\

A data frame object containing the residuals (see the [Description](#func.mf.residual.dataframe.args.description) above for the details). 

\newpage

#### [UMGYDE_model.predict](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functionsR#L12) Function {#func.UMGYDE_model.predict}
\

This is a wrapper for the [UMGY_SmoothedDay_effect.predict](#func.UMGY_SmoothedDay_effect.predict) function described in the [UMGYDE Model: Helper Functions] section above with the fixed [day_smoothed_effect](#func.UMGY_SmoothedDay_effect.predict.args.day_smoothed_effect) parameter value obtained after the _UMGYDE Model_ (described in the [User+Movie+Genre+Year+Day Effect (UMGYDE) Model] section)  has been fully trained.

##### Arguments
\

::: { #func.UMGYDE_model.predict.args.test_set .sidebar }
###### ***test_set***
\

The dataset for testing the _UMGYDE Model_ after it has been fully trained.
:::

##### Source Code
\

The following is the source code of the function:
```{r eval=FALSE}
UMGYDE_model.predict <- function(test_set) {
  test_set |>
    UMGY_SmoothedDay_effect.predict(rglr.UMGYD_effect)
}
```

::: {.noteblock data-latex=""}
The source code of the [UMGYDE_model.predict](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functionsR#L12) function is also available in the [MF.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functionsR#L12) script on _GitHub_.
:::

##### Return
\

A data frame object containing predicted values. 

\newpage


### UMGE Model: Support Functions
\

::: {.noteblock data-latex=""}
Some of the functions described in this section accepts the `lambda` parameter, which we will need later for the _Model Regularization_ method. We use the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L63) function call as well, which we will also need for the *Regularization* techniques to apply to our models (for details, see the  [mean_reg](#func.mean_reg) function description in the Section [Common Helper Functions: Regularization](#appndx_a.CHF.model_tuning_utils) section of [Appendix A: Support Functions]).
We have already explained that in the [UME Model Regularization] section. 
For now, we omit the `lambda` parameter, accepting its default value `lambda = 0`. Let's recall that in this case, the [mean_reg](#func.mean_reg) function is equivalent to the standard R function [base::mean](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/mean).
:::

#### [train_user_movie_genre_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L40) Function {#func.train_user_movie_genre_effect}
\

We use this function to build and train our model using a _Train Set_ (passing it to the `train.sgr` parameter), which can be any sample of the `edx.sgr` dataset (or the entire dataset itself) described above in the [`edx.sgr` Object] section. Here, I only remind that it is the dataset created from the `edx` one by splitting its rows to ensure each belongs to a single _genre_. Here is the source code of the function:
```{r eval=FALSE}
train_user_movie_genre_effect <- function(train.sgr, lambda = 0){
  if (is.na(lambda)) {
    stop("Function: train_user_movie_genre_effect
`lambda` is `NA`")
  }

  genre_bias <- train.sgr |>
      left_join(edx.user_effect, by = "userId") |>
      left_join(rglr.UM_effect, by = "movieId") |>
      mutate(resid = rating - (mu + a + b)) |>
      group_by(genres) |>
      summarise(g = mean_reg(resid, lambda), n = n())

    train.sgr |>
      left_join(genre_bias, by = "genres") |>
      left_join(rglr.UM_effect, by = "movieId") |>
      group_by(movieId) |>
      summarise(g = mean(g))
}
```


#### [train_user_movie_genre_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L59) Function {#func.train_user_movie_genre_effect.cv}
\

We use this function, defined in the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L59) script, to train the current model using the _5-Fold Cross Validation_ method. Below, we provide a slightly simplified version of the source code of that function:
```{r eval=FALSE}
train_user_movie_genre_effect.cv <- function(lambda = 0){
  # ...

put_log1("Function `train_user_movie_genre_effect.cv`:
Computing User+Movie+Genre Effects list for %1-Fold Cross Validation samples...", 
           CVFolds_N)
  
  start <- put_start_date()
  user_movie_genre_effects_ls <- lapply(kfold_index, function(fold_i){
    cv_fold_dat <- edx_CV[[fold_i]]
    
    put_log2("Processing User+Movie+Genre Effects for %1-Fold Cross Validation samples (Fold %2)...",
             CVFolds_N,
             fold_i)
    umg_effect <- cv_fold_dat$train.sgr |> train_user_movie_genre_effect(lambda)
    
    
    put_log2("User+Movie+Genre Effects have been computed for the Fold %1 
of the %2-Fold Cross Validation samples.",
             fold_i,
             CVFolds_N)
    umg_effect
  })
  put_end_date(start)
  put_log1("Function `train_user_movie_genre_effect.cv`:
User+Movie+Genre Effects list has been computed for %1-Fold Cross Validation samples.", 
           CVFolds_N)

  user_movie_genre_effects_united <- union_cv_results(user_movie_genre_effects_ls)

  user_movie_genre_effect <- user_movie_genre_effects_united |>
    group_by(movieId) |>
    summarise(g = mean(g))
  
  if(lambda == 0) put_log("Function `train_user_movie_genre_effect.cv`:
Training completed: User+Movie+Genre Effects model.")
  else put_log1("Function `train_user_movie_genre_effect.cv`:
Training completed: User+Movie+Genre Effects model for lambda: %1...",
                lambda)
  
  user_movie_genre_effect
}
```

::: {.noteblock data-latex=""}
Here we use the function call [union_cv_results](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L432) to aggregate the _5-Fold Cross Validation_ method results (for details, see the [union_cv_results](#func.union_cv_results) function description in the [Data Helper Functions](#appndx_a.data_helper.functions) section of [Appendix A: Support Functions]).
:::

#### `calc_user_movie_genre_effect_MSE` Function
\

The source code of the function [calc_user_movie_genre_effect_MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L110) defined in the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R) script to calculate the _Mean Squared Error (MSE)_ of the _UMGE Model_ for the given _Test Set_ is provided below:
```{r eval=FALSE}
calc_user_movie_genre_effect_MSE <- function(test_set, umg_effect){
  test_set |>
    left_join(edx.user_effect, by = "userId") |>
    left_join(rglr.UM_effect, by = "movieId") |>
    left_join(umg_effect, by = "movieId") |>
    mutate(resid = rating - clamp(mu + a + b + g)) |> 
    pull(resid) |> mse()
}
```

\newpage

#### `calc_user_movie_genre_effect_MSE.cv` Function
\

The source code of the function [calc_user_movie_genre_effect_MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L122) defined in the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R) script to calculate the _5-Fold Cross Validation MSE_ result of the _UMGE Model_ is provided below:
```{r eval=FALSE}
calc_user_movie_genre_effect_MSE.cv <- function(umg_effect){
  put_log("Computing RMSEs.ResultTibble on Validation Sets...")
  start <- put_start_date()
  user_movie_genre_effects_MSEs <- sapply(edx_CV, function(cv_dat){
    cv_dat$validation_set |> calc_user_movie_genre_effect_MSE(umg_effect)
  })
  put_end_date(start)
  
  plot(user_movie_genre_effects_MSEs)
  put_log1("MSE values have been plotted for the %1-Fold Cross Validation samples.", 
           CVFolds_N)
 
  mean(user_movie_genre_effects_MSEs)
}
```


#### `calc_user_movie_genre_effect_RMSE` Function
\

The source code of the function [calc_user_movie_genre_effect_RMSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L118) defined in the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R) script to calculate the _Root Mean Squared Error (RMSE)_ of the _UMGE Model_ for the given _Test Set_ is provided below:

```{r eval=FALSE}
calc_user_movie_genre_effect_RMSE <- function(test_set, umg_effect){
  umg_mse <- test_set |> calc_user_movie_genre_effect_MSE(umg_effect)
  sqrt(umg_mse)
}
```

#### `calc_user_movie_genre_effect_RMSE.cv` Function { #func.calc_user_movie_genre_effect_RMSE.cv }
\

The source code of the function [calc_user_movie_genre_effect_RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R#L136) defined in the [UMG-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R) script to calculate the _5-Fold Cross Validation **RMSE**_ result of the _UMGE Model_ is provided below:

```{r eval=FALSE}
calc_user_movie_genre_effect_RMSE.cv <- function(umg_effect){
  umg_effect_RMSE <- sqrt(calc_user_movie_genre_effect_MSE.cv(umg_effect))
  put_log2("%1-Fold Cross Validation ultimate RMSE: %2", 
           CVFolds_N, 
           umg_effect_RMSE)
  
  umg_effect_RMSE
}
```

\newpage




### Regularization Functions {#appndx_a.CHF.model_tuning_utils}
\

::: {.noteblock data-latex=""}
The complete source code of the functions described in this section are available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) script on _GitHub_.
:::

#### [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) Function {#func.mean_reg}
\

Calculates the arithmetic mean taking into account the _regularization parameter_ $\lambda$ passed in the [lambda](#func.mean_reg.args.lambda) argument. We will call it the _penalized mean_.

::: { #func.mean_reg.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
mean_reg(vals, lambda = 0, na.rm = TRUE)

```
:::

::: { #func.mean_reg.args .sidebar }
##### Arguments
\

::: { #func.mean_reg.args.vals .sidebar }
  - **vals:** Values (usually a numeric vector) to calculate the _penalized mean_;

:::
::: { #func.mean_reg.args.lambda .sidebar }
  - **lambda:** (0 by default) _Regularization parameter_ $\lambda$ used in the _Regularization techniques_. 

:::
  - **na.rm:** a logical evaluating to TRUE or FALSE indicating whether NA values should be stripped before the computation proceeds.

:::


::: { #func.mean_reg.details .sidebar }
##### Details
\

The function calculates the _penalized mean_ of the values passed in the [vals](#func.mean_reg.args.vals) argument as follows:
$$
\mu(\lambda) = \frac{1}{\lambda + N} \sum_{i=1}^{N} x_i
$$

When the [lambda](#func.mean_reg.args.lambda) parameter is `0` (meaning the $\lambda = 0$), the function calculates the simple arithmetic mean:
$$
\mu = \frac{1}{N} \sum_{i=1}^{N} x_i
$$

We call this function internally from the functions that compute the _penalized estimates_  as described in [Section 24.1 *Case study: recommendation systems / Penalized Least Squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the *Course Textbook (New Edition)*[@IDS2_24-1].

::: {.noteblock data-latex=""}
If the [lambda](#func.mean_reg.args.lambda) parameter is `0` (the default), the function is equivalent to the standard R function [base::mean](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/mean), calling with the parameter `trim = 0` (the default for the `base::mean` function).
:::
:::

::: { #func.mean_reg.value .sidebar }
##### Value
\

The [penalized mean](#func.mean_reg.details) of the values passed in the [vals](#func.mean_reg.args.vals) argument.
:::

::: { #func.mean_reg.code .sidebar }
##### Source Code
\

The soure code of the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) function is shown below:
```{r eval=FALSE}
mean_reg <- function(vals, lambda = 0, na.rm = TRUE){
  if (is.na(lambda)) {
    stop("Function: mean_reg
`lambda` is `NA`")
  }
  
  names(lambda) <- NULL
  sums <- sum(vals, na.rm = na.rm)
  N <- ifelse(na.rm, sum(!is.na(vals)), length(vals))
  sums/(N + lambda)
}
```

::: {.noteblock data-latex=""}
The source code of the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) script on _GitHub_.
:::
:::

#### [get_fine_tune.param.endpoints.idx](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L87) Function {#func.get_fine_tune.param.endpoints.idx}
\

Implements an algorithm that finds the pair of indices of the nearest neighboring elements with values greater than the minimum to the left and right of the element (or group of elements) with the minimum value in the *RMSE* column of the data frame passed in the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument.

::: {.noteblock data-latex=""}
The algorithm assumes that the set of values in the *RMSE* column is a monotonically non-increasing function of the index until the minimum is reached and monotonically non-decreasing thereafter. That is, it is assumed that the function can have only one minimum on the given set.
:::


::: { #func.get_fine_tune.param.endpoints.idx.usage .sidebar }
##### Usage
\

::: {.noteblock data-latex=""}
The element named `tuned.result` of the *list* returned by the [tune.model_param](#func.tune.model_param) function described below is a *data frame* suitable for use as the value of the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument.
:::

The following code snippet shows how to use the data returned by the [tune.model_param](#func.tune.model_param) function as the value of the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument:
```{r eval=FALSE}
cv.UME.preset.result <- 
  tune.model_param(lambdas, regularize.test_lambda.UM_effect.cv)

```
```{r}
cv.UME.preset.result$tuned.result |>
  data.plot(title = "UME Model Regularization",#TeX(r'[UME Model Regularization: $\lambda$ Range Pre-configuration]'),
              xname = "parameter.value",
              yname = "RMSE",
              xlabel = "lambda", #TeX(r'[$\lambda$]'),
              ylabel = "RMSE")

preset.result <- cv.UME.preset.result$tuned.result
preset.result.idx <- get_fine_tune.param.endpoints.idx(preset.result)
print(preset.result.idx)
```

:::

::: { #func.get_fine_tune.param.endpoints.idx.args .sidebar }
##### Arguments
\

::: {#func.get_fine_tune.param.endpoints.idx.args.preset.result .sidebar }
  - **preset.result:** Any data frame that has an *RMSE* column containing the `RMSE` values corresponding to the *regularization parameter* $\lambda$ values for the model being regularized, as described in the [Details](#func.tune.model_param.details) section of the [tune.model_param](#func.tune.model_param) function description below.

:::
:::

::: { #func.get_fine_tune.param.endpoints.idx.value .sidebar }
##### Value
\
A vector containing the index of the element corresponding to the minimum `RMSE` value in a given sequence, along with the indices of its nearest neighboring elements:
```{r eval=FALSE}
  c(start, # interval start index
    end,   # interval end index
    best)  # index of the best `RMSE`
```

In the example shown above in the [Usage](#func.get_fine_tune.param.endpoints.idx.usage) section we can see the value return by *this function*:
```{r}
print(preset.result.idx)
```

:::

::: { #func.get_fine_tune.param.endpoints.idx.code .sidebar }
##### Source Code
\

The source code of the [get_fine_tune.param.endpoints.idx](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L87) function is shown below:
```{r eval=FALSE}
get_fine_tune.param.endpoints.idx <- function(preset.result) {
  best_RMSE <- min(preset.result$RMSE)
  best_RMSE.idx <- which.min(preset.result$RMSE)
  # best_lambda <- preset.result$parameter.value[best_RMSE.idx]
  
  preset.result.N <- length(preset.result$RMSE)
  i <- best_RMSE.idx
  j <- i
  
  while (i > 1) {
    i <- i - 1
    
    if (preset.result$RMSE[i] > best_RMSE) {
      break
    }
  }
  
  while (j < preset.result.N) {
    j <- j + 1
    
    if (preset.result$RMSE[j] > best_RMSE) {
      break
    }
  }
  
  c(start = i, 
    end = j,
    best = best_RMSE.idx)
}

```
:::



#### [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) Function {#func.mean_reg}
\

Calculates the arithmetic mean taking into account the _regularization parameter_ $\lambda$ passed in the [lambda](#func.mean_reg.args.lambda) argument. We will call it the _penalized mean_.

::: { #func.mean_reg.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
mean_reg(vals, lambda = 0, na.rm = TRUE)

```
:::

::: { #func.mean_reg.args .sidebar }
##### Arguments
\

::: { #func.mean_reg.args.vals .sidebar }
  - **vals:** Values (usually a numeric vector) to calculate the _penalized mean_;

:::
::: { #func.mean_reg.args.lambda .sidebar }
  - **lambda:** (0 by default) _Regularization parameter_ $\lambda$ used in the _Regularization techniques_. 

:::
  - **na.rm:** a logical evaluating to TRUE or FALSE indicating whether NA values should be stripped before the computation proceeds.

:::


::: { #func.mean_reg.details .sidebar }
##### Details
\

The function calculates the _penalized mean_ of the values passed in the [vals](#func.mean_reg.args.vals) argument as follows:
$$
\mu(\lambda) = \frac{1}{\lambda + N} \sum_{i=1}^{N} x_i
$$

When the [lambda](#func.mean_reg.args.lambda) parameter is `0` (meaning the $\lambda = 0$), the function calculates the simple arithmetic mean:
$$
\mu = \frac{1}{N} \sum_{i=1}^{N} x_i
$$

We call this function internally from the functions that compute the _penalized estimates_  as described in [Section 24.1 *Case study: recommendation systems / Penalized Least Squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the *Course Textbook (New Edition)*[@IDS2_24-1].

::: {.noteblock data-latex=""}
If the [lambda](#func.mean_reg.args.lambda) parameter is `0` (the default), the function is equivalent to the standard R function [base::mean](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/mean), calling with the parameter `trim = 0` (the default for the `base::mean` function).
:::
:::

::: { #func.mean_reg.value .sidebar }
##### Value
\

The [penalized mean](#func.mean_reg.details) of the values passed in the [vals](#func.mean_reg.args.vals) argument.
:::

::: { #func.mean_reg.code .sidebar }
##### Source Code
\

The soure code of the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) function is shown below:
```{r eval=FALSE}
mean_reg <- function(vals, lambda = 0, na.rm = TRUE){
  if (is.na(lambda)) {
    stop("Function: mean_reg
`lambda` is `NA`")
  }
  
  names(lambda) <- NULL
  sums <- sum(vals, na.rm = na.rm)
  N <- ifelse(na.rm, sum(!is.na(vals)), length(vals))
  sums/(N + lambda)
}
```

::: {.noteblock data-latex=""}
The source code of the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) script on _GitHub_.
:::
:::

#### [get_fine_tune.param.endpoints.idx](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L87) Function {#func.get_fine_tune.param.endpoints.idx}
\

Implements an algorithm that finds the pair of indices of the nearest neighboring elements with values greater than the minimum to the left and right of the element (or group of elements) with the minimum value in the *RMSE* column of the data frame passed in the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument.

::: {.noteblock data-latex=""}
The algorithm assumes that the set of values in the *RMSE* column is a monotonically non-increasing function of the index until the minimum is reached and monotonically non-decreasing thereafter. That is, it is assumed that the function can have only one minimum on the given set.
:::


::: { #func.get_fine_tune.param.endpoints.idx.usage .sidebar }
##### Usage
\

::: {.noteblock data-latex=""}
The element named `tuned.result` of the *list* returned by the [tune.model_param](#func.tune.model_param) function described below is a *data frame* suitable for use as the value of the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument.
:::

The following code snippet shows how to use the data returned by the [tune.model_param](#func.tune.model_param) function as the value of the [preset.result](#func.get_fine_tune.param.endpoints.idx.args.preset.result) argument:
```{r eval=FALSE}
cv.UME.preset.result <- 
  tune.model_param(lambdas, regularize.test_lambda.UM_effect.cv)

```
```{r}
cv.UME.preset.result$tuned.result |>
  data.plot(title = TeX(r'[UME Model Regularization: $\lambda$ Range Pre-configuration]'),
              xname = "parameter.value", 
              yname = "RMSE", 
              xlabel = TeX(r'[$\lambda$]'), 
              ylabel = "RMSE")

preset.result <- cv.UME.preset.result$tuned.result
preset.result.idx <- get_fine_tune.param.endpoints.idx(preset.result)
print(preset.result.idx)
```

:::

::: { #func.get_fine_tune.param.endpoints.idx.args .sidebar }
##### Arguments
\

::: {#func.get_fine_tune.param.endpoints.idx.args.preset.result .sidebar }
  - **preset.result:** Any data frame that has an *RMSE* column containing the `RMSE` values corresponding to the *regularization parameter* $\lambda$ values for the model being regularized, as described in the [Details](#func.tune.model_param.details) section of the [tune.model_param](#func.tune.model_param) function description below.

:::
:::

::: { #func.get_fine_tune.param.endpoints.idx.value .sidebar }
##### Value
\
A vector containing the index of the element corresponding to the minimum `RMSE` value in a given sequence, along with the indices of its nearest neighboring elements:
```{r eval=FALSE}
  c(start, # interval start index
    end,   # interval end index
    best)  # index of the best `RMSE`
```

In the example shown above in the [Usage](#func.get_fine_tune.param.endpoints.idx.usage) section we can see the value return by *this function*:
```{r}
print(preset.result.idx)
```

:::

::: { #func.get_fine_tune.param.endpoints.idx.code .sidebar }
##### Source Code
\

The source code of the [get_fine_tune.param.endpoints.idx](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L87) function is shown below:
```{r eval=FALSE}
get_fine_tune.param.endpoints.idx <- function(preset.result) {
  best_RMSE <- min(preset.result$RMSE)
  best_RMSE.idx <- which.min(preset.result$RMSE)
  # best_lambda <- preset.result$parameter.value[best_RMSE.idx]
  
  preset.result.N <- length(preset.result$RMSE)
  i <- best_RMSE.idx
  j <- i
  
  while (i > 1) {
    i <- i - 1
    
    if (preset.result$RMSE[i] > best_RMSE) {
      break
    }
  }
  
  while (j < preset.result.N) {
    j <- j + 1
    
    if (preset.result$RMSE[j] > best_RMSE) {
      break
    }
  }
  
  c(start = i, 
    end = j,
    best = best_RMSE.idx)
}

```
:::

\newpage

#### [cmmn_hlp.rglr.fn.tmpl](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#LX) Function {#func.cmmn_hlp.rglr.fn.tmpl}
\

::: { #func.cmmn_hlp.rglr.fn.tmpl.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
cmmn_hlp.rglr.fn.tmpl()

```
:::

::: { #func.cmmn_hlp.rglr.fn.tmpl.args .sidebar }
##### Arguments
\

::: { #func.cmmn_hlp.rglr.fn.tmpl.args. .sidebar }
  - **:** ; 

:::
::: { #func.cmmn_hlp.rglr.fn.tmpl.args. .sidebar }
  - **:** ; 

:::
:::

::: { #func.cmmn_hlp.rglr.fn.tmpl.details .sidebar }
##### Details
\



:::

::: { #func.cmmn_hlp.rglr.fn.tmpl.value .sidebar }
##### Value
\

:::

::: { #func.cmmn_hlp.rglr.fn.tmpl.code .sidebar }
##### Source Code
\

The source code of the [cmmn_hlp.rglr.fn.tmpl](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#LX) function is shown below:
```{r eval=FALSE}
```

::: {.noteblock data-latex=""}
The source code of the [cmmn_hlp.rglr.fn.tmpl](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#LX) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#LX) script on _GitHub_.
:::
:::





#### [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) Function {#func.mean_reg}
\

Calculates the arithmetic mean taking into account the _regularization parameter_ $\lambda$ passed in the [lambda](#func.mean_reg.args.lambda) argument. We will call it the _penalized mean_.

::: { #func.mean_reg.usage .sidebar }
##### Usage
\

```{r eval=FALSE}
mean_reg(vals, lambda = 0, na.rm = TRUE)

```
:::

::: { #func.mean_reg.args .sidebar }
##### Arguments
\

::: { #func.mean_reg.args.vals .sidebar }
  - **vals:** Values (usually a numeric vector) to calculate the _penalized mean_;

:::
::: { #func.mean_reg.args.lambda .sidebar }
  - **lambda:** (0 by default) _Regularization parameter_ $\lambda$ used in the _Regularization techniques_. 

:::
  - **na.rm:** a logical evaluating to TRUE or FALSE indicating whether NA values should be stripped before the computation proceeds.

:::


::: { #func.mean_reg.details .sidebar }
##### Details
\

The function calculates the _penalized mean_ of the values passed in the [vals](#func.mean_reg.args.vals) argument as follows:
$$
\mu(\lambda) = \frac{1}{\lambda + N} \sum_{i=1}^{N} x_i
$$

When the [lambda](#func.mean_reg.args.lambda) parameter is `0` (meaning the $\lambda = 0$), the function calculates the simple arithmetic mean:
$$
\mu = \frac{1}{N} \sum_{i=1}^{N} x_i
$$

We call this function internally from the functions that compute the _penalized estimates_  as described in [Section 24.1 *Case study: recommendation systems / Penalized Least Squares*](https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html#penalized-least-squares) of the *Course Textbook (New Edition)*[@IDS2_24-1].

::: {.noteblock data-latex=""}
If the [lambda](#func.mean_reg.args.lambda) parameter is `0` (the default), the function is equivalent to the standard R function [base::mean](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/mean), calling with the parameter `trim = 0` (the default for the `base::mean` function).
:::
:::

::: { #func.mean_reg.value .sidebar }
##### Value
\

The [penalized mean](#func.mean_reg.details) of the values passed in the [vals](#func.mean_reg.args.vals) argument.
:::

::: { #func.mean_reg.code .sidebar }
##### Source Code
\

The soure code of the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) function is shown below:
```{r eval=FALSE}
mean_reg <- function(vals, lambda = 0, na.rm = TRUE){
  if (is.na(lambda)) {
    stop("Function: mean_reg
`lambda` is `NA`")
  }
  
  names(lambda) <- NULL
  sums <- sum(vals, na.rm = na.rm)
  N <- ifelse(na.rm, sum(!is.na(vals)), length(vals))
  sums/(N + lambda)
}
```

::: {.noteblock data-latex=""}
The source code of the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L69) section of the [common-helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L70) script on _GitHub_.
:::
:::

### Regularization Functions2 {#appndx_a.CHF.model_tuning_utils2}
\


### MF: Helper Functions

#### [mf.residual.dataframe](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L1) Function {#func.mf.residual.dataframe}
\

::: { #func.mf.residual.dataframe.args.description .sidebar }
##### Description
\

Computes residuals, defined as the difference between the observed and predicted values of the fully trained _UMGYDE Model_ as described in the [User+Movie+Genre+Year+Day Effect (UMGYDE) Model] section.

##### Arguments
\

###### ***train_set***
\

::: { #func.mf.residual.dataframe.args.train_set .sidebar }
The dataset to be trained.
:::

##### Source Code
\

The folowing is the source code of the function:
```{r eval=FALSE}
mf.residual.dataframe <- function(train_set){
  train_set |> 
    left_join(edx.user_effect, by = "userId") |>
    left_join(rglr.UM_effect, by = "movieId") |>
    left_join(rglr.UMG_effect, by = "movieId") |>
    left_join(date_days_map, by = "timestamp") |>
    left_join(rglr.UMGY_effect, by='year') |>
    left_join(rglr.UMGYD_effect, by='days') |>
    mutate(rsdl = rating - (mu + a + b + g + ye + de_smoothed)) |>
    select(userId, movieId, rsdl)
}
```

::: {.noteblock data-latex=""}
The source code of the [mf.residual.dataframe](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L1) function is also available in the [MF.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functions.R#L1) script on _GitHub_.
:::

##### Return
\

A data frame object containing the residuals (see the [Description](#func.mf.residual.dataframe.args.description) above for the details). 

\newpage

#### [UMGYDE_model.predict](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functionsR#L12) Function {#func.UMGYDE_model.predict}
\

This is a wrapper for the [UMGY_SmoothedDay_effect.predict](#func.UMGY_SmoothedDay_effect.predict) function described in the [UMGYDE Model: Helper Functions] section above with the fixed [day_smoothed_effect](#func.UMGY_SmoothedDay_effect.predict.args.day_smoothed_effect) parameter value obtained after the _UMGYDE Model_ (described in the [User+Movie+Genre+Year+Day Effect (UMGYDE) Model] section)  has been fully trained.

##### Arguments
\

::: { #func.UMGYDE_model.predict.args.test_set .sidebar }
###### ***test_set***
\

The dataset for testing the _UMGYDE Model_ after it has been fully trained.
:::

##### Source Code
\

The following is the source code of the function:
```{r eval=FALSE}
UMGYDE_model.predict <- function(test_set) {
  test_set |>
    UMGY_SmoothedDay_effect.predict(rglr.UMGYD_effect)
}
```

::: {.noteblock data-latex=""}
The source code of the [UMGYDE_model.predict](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functionsR#L12) function is also available in the [MF.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/MF.functionsR#L12) script on _GitHub_.
:::

##### Return
\

A data frame object containing predicted values. 

\newpage

