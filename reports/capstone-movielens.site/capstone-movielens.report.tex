% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\newsavebox\pandoc@box
\newcommand*\pandocbounded[1]{% scales image to fit in text height/width
  \sbox\pandoc@box{#1}%
  \Gscale@div\@tempa{\textheight}{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
  \Gscale@div\@tempb{\linewidth}{\wd\pandoc@box}%
  \ifdim\@tempb\p@<\@tempa\p@\let\@tempa\@tempb\fi% select the smaller of both
  \ifdim\@tempa\p@<\p@\scalebox{\@tempa}{\usebox\pandoc@box}%
  \else\usebox{\pandoc@box}%
  \fi%
}
% Set default figure placement to htbp
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{awesomebox}
\usepackage{hyperref}
\usepackage[natbib=true, style=numeric, backref=true, sorting=none]{biblatex}
\hypersetup{backref, pdfpagemode=Normal, colorlinks=true, implicit=false}
\usepackage[]{biblatex}
\addbibresource{references.bib}
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Capstone Movielens Report},
  pdfauthor={Azamat Kurbanaev},
  colorlinks=true,
  linkcolor={red},
  filecolor={Maroon},
  citecolor={blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{Capstone Movielens Report}
\author{Azamat Kurbanaev}
\date{2025-05-19}

\begin{document}
\maketitle

{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{2}
\tableofcontents
}
\newenvironment{infobox}[1]
  {
  \begin{itemize}
  \renewcommand{\labelitemi}{
    \raisebox{-.7\height}[0pt][0pt]{
      {\setkeys{Gin}{width=3em,keepaspectratio}
        \includegraphics{images/#1}}
    }
  }
  \setlength{\fboxsep}{1em}
  \begin{blackbox}
  \item
  }
  {
  \end{blackbox}
  \end{itemize}
  }

\section{Introduction / Overview / Executive Summary}\label{introduction-overview-executive-summary}

The goal of the project is to build a Recommendation System using a \href{http://grouplens.org/datasets/movielens/10m/}{10M version of the MovieLens dataset}.
Following the \href{https://archive.nytimes.com/bits.blogs.nytimes.com/2009/09/21/netflix-awards-1-million-prize-and-starts-a-new-contest/index.html}{Netflix Grand Prize Contest} requirements, we will evaluate the \emph{Root Mean Square Error} (\emph{RMSE}) score, which, as shown in \href{https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html\#sec-netflix-loss-function}{Section 23.2 Loss function} of the \emph{Course Textbook}, is defined as:
\[
\mbox{RMSE} = \sqrt{\frac{1}{N} \sum_{i,j}^{N} (y_{i,j} - \hat{y}_{i,j})^2}
\]

with \(N\) being the number of user/movie combinations for which we make predictions and the sum occurring over all these combinations\autocite{IDS2_23-2}.

Our goal is to achieve a value of less than 0.86490 (compare with the \emph{Netflix Grand Prize} requirement: of at least 0.8563\autocite{BigChaosSln}).
\newpage

\subsection{Datasets Overview}\label{datasets-overview}

To start with we have to generate two datasets derived from the \emph{MovieLens} one mentioned above:

\begin{itemize}
\tightlist
\item
  \textbf{edx:} we use it to develop and train our algorithms;
\item
  \textbf{final\_holdout\_test:} according to the course requirements, we use it exclusively to evaluate the \emph{\textbf{RMSE}} of our final algorithm.
\end{itemize}

For this purpose the following package has been developed by the author of this report: \texttt{edx.capstone.movielens.data}. The source code of the package is available \href{https://github.com/AzKurban-edX-DS/edx.capstone.movielens.data}{on GitHub}\autocite{edx_capstone_movielens_data}.

Let's install the development version of this package from the GitHub repository and attach the correspondent library to the global environment:

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{require}\NormalTok{(edx.capstone.movielens.data)) pak}\SpecialCharTok{::}\FunctionTok{pak}\NormalTok{(}\StringTok{"AzKurban{-}edX{-}DS/edx.capstone.movielens.data"}\NormalTok{)}

\FunctionTok{library}\NormalTok{(edx.capstone.movielens.data)}
\NormalTok{edx }\OtherTok{\textless{}{-}}\NormalTok{ edx.capstone.movielens.data}\SpecialCharTok{::}\NormalTok{edx}
\NormalTok{final\_holdout\_test }\OtherTok{\textless{}{-}}\NormalTok{ edx.capstone.movielens.data}\SpecialCharTok{::}\NormalTok{final\_holdout\_test}
\end{Highlighting}
\end{Shaded}

Now, we have the datasets listed above:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(edx)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      userId         movieId          rating        timestamp            title              genres         
##  Min.   :    1   Min.   :    1   Min.   :0.500   Min.   :7.897e+08   Length:9000055     Length:9000055    
##  1st Qu.:18124   1st Qu.:  648   1st Qu.:3.000   1st Qu.:9.468e+08   Class :character   Class :character  
##  Median :35738   Median : 1834   Median :4.000   Median :1.035e+09   Mode  :character   Mode  :character  
##  Mean   :35870   Mean   : 4122   Mean   :3.512   Mean   :1.033e+09                                        
##  3rd Qu.:53607   3rd Qu.: 3626   3rd Qu.:4.000   3rd Qu.:1.127e+09                                        
##  Max.   :71567   Max.   :65133   Max.   :5.000   Max.   :1.231e+09
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(final\_holdout\_test)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      userId         movieId          rating        timestamp            title              genres         
##  Min.   :    1   Min.   :    1   Min.   :0.500   Min.   :7.897e+08   Length:999999      Length:999999     
##  1st Qu.:18096   1st Qu.:  648   1st Qu.:3.000   1st Qu.:9.467e+08   Class :character   Class :character  
##  Median :35768   Median : 1827   Median :4.000   Median :1.035e+09   Mode  :character   Mode  :character  
##  Mean   :35870   Mean   : 4108   Mean   :3.512   Mean   :1.033e+09                                        
##  3rd Qu.:53621   3rd Qu.: 3624   3rd Qu.:4.000   3rd Qu.:1.127e+09                                        
##  Max.   :71567   Max.   :65133   Max.   :5.000   Max.   :1.231e+09
\end{verbatim}

\newpage

\subsubsection{\texorpdfstring{\texttt{edx} Dataset}{edx Dataset}}\label{edx-dataset}

\hfill\break
Let's look into the details of the \texttt{edx} dataset:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(edx)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    9000055 obs. of  6 variables:
##  $ userId   : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ movieId  : int  122 185 292 316 329 355 356 362 364 370 ...
##  $ rating   : num  5 5 5 5 5 5 5 5 5 5 ...
##  $ timestamp: int  838985046 838983525 838983421 838983392 838983392 838984474 838983653 838984885 838983707 838984596 ...
##  $ title    : chr  "Boomerang (1992)" "Net, The (1995)" "Outbreak (1995)" "Stargate (1994)" ...
##  $ genres   : chr  "Comedy|Romance" "Action|Crime|Thriller" "Action|Drama|Sci-Fi|Thriller" "Action|Adventure|Sci-Fi" ...
\end{verbatim}

Note that we have 9000055 rows and six columns in there:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dim\_edx }\OtherTok{\textless{}{-}} \FunctionTok{dim}\NormalTok{(edx)}
\FunctionTok{print}\NormalTok{(dim\_edx)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 9000055       6
\end{verbatim}

First, let's note that we have 10677 different movies:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n\_movies }\OtherTok{\textless{}{-}} \FunctionTok{n\_distinct}\NormalTok{(edx}\SpecialCharTok{$}\NormalTok{movieId)}
\FunctionTok{print}\NormalTok{(n\_movies)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10677
\end{verbatim}

and 69878 different users in the dataset:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n\_users }\OtherTok{\textless{}{-}} \FunctionTok{n\_distinct}\NormalTok{(edx}\SpecialCharTok{$}\NormalTok{userId)}
\FunctionTok{print}\NormalTok{(n\_users)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 69878
\end{verbatim}

Now, note the expressions below which confirm the fact explained in \href{https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html\#movielens-data}{Section \emph{23.1.1 Movielens data}} of the \emph{Course Textbook}\autocite{IDS2} that not every user rated every movie:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{max\_possible\_ratings }\OtherTok{\textless{}{-}}\NormalTok{ n\_movies}\SpecialCharTok{*}\NormalTok{n\_users}
\FunctionTok{sprintf}\NormalTok{(}\StringTok{"Maximum possible ratings: \%s"}\NormalTok{, max\_possible\_ratings)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Maximum possible ratings: 746087406"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sprintf}\NormalTok{(}\StringTok{"Rows in \textasciigrave{}edx\textasciigrave{} dataset: \%s"}\NormalTok{, dim\_edx[}\DecValTok{1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Rows in `edx` dataset: 9000055"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sprintf}\NormalTok{(}\StringTok{"Not every movie was rated: \%s"}\NormalTok{, max\_possible\_ratings }\SpecialCharTok{\textgreater{}}\NormalTok{ dim\_edx[}\DecValTok{1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Not every movie was rated: TRUE"
\end{verbatim}

As also explained in that section, we can think of these data as a very large matrix, with users on the rows and movies on the columns, with many empty cells. Therefore, we can think of a recommendation system as filling in the \texttt{NA}s in the dataset for the movies that some or all the users do not rate. A sample from the \texttt{edx} data below illustrates this idea\autocite{IDS2_23-1-1}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{keep }\OtherTok{\textless{}{-}}\NormalTok{ edx }\SpecialCharTok{|\textgreater{}} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{count}\NormalTok{(movieId) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{top\_n}\NormalTok{(}\DecValTok{4}\NormalTok{, n) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{pull}\NormalTok{(movieId)}

\NormalTok{tab }\OtherTok{\textless{}{-}}\NormalTok{ edx }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(movieId }\SpecialCharTok{\%in\%}\NormalTok{ keep) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(userId }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{13}\SpecialCharTok{:}\DecValTok{20}\NormalTok{)) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{select}\NormalTok{(userId, title, rating) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{title =} \FunctionTok{str\_remove}\NormalTok{(title, }\StringTok{", The"}\NormalTok{),}
         \AttributeTok{title =} \FunctionTok{str\_remove}\NormalTok{(title, }\StringTok{":.*"}\NormalTok{)) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{names\_from =} \StringTok{"title"}\NormalTok{, }\AttributeTok{values\_from =} \StringTok{"rating"}\NormalTok{)}

\FunctionTok{print}\NormalTok{(tab)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 5
##   userId `Pulp Fiction (1994)` `Jurassic Park (1993)` `Silence of the Lambs (1991)` `Forrest Gump (1994)`
##    <int>                 <dbl>                  <dbl>                         <dbl>                 <dbl>
## 1     13                     4                     NA                            NA                    NA
## 2     16                    NA                      3                            NA                    NA
## 3     17                    NA                     NA                             5                    NA
## 4     18                     5                      3                             5                    NA
## 5     19                    NA                      1                            NA                     4
\end{verbatim}

The following plot of the matrix for a random sample of 100 movies and 100 users with yellow indicating a user/movie combination for which we have a rating shows how \emph{sparse} the matrix is:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{users }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\FunctionTok{unique}\NormalTok{(edx}\SpecialCharTok{$}\NormalTok{userId), }\DecValTok{100}\NormalTok{)}

\NormalTok{rafalib}\SpecialCharTok{::}\FunctionTok{mypar}\NormalTok{()}
\NormalTok{edx}\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(userId }\SpecialCharTok{\%in\%}\NormalTok{ users) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{select}\NormalTok{(userId, movieId, rating) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{rating =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{names\_from =}\NormalTok{ movieId, }\AttributeTok{values\_from =}\NormalTok{ rating) }\SpecialCharTok{|\textgreater{}} 
\NormalTok{  (\textbackslash{}(mat) mat[, }\FunctionTok{sample}\NormalTok{(}\FunctionTok{ncol}\NormalTok{(mat), }\DecValTok{100}\NormalTok{)])() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{as.matrix}\NormalTok{() }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{t}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{image}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{100}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{100}\NormalTok{, }\AttributeTok{z =}\NormalTok{ \_ , }\AttributeTok{xlab =} \StringTok{"Movies"}\NormalTok{, }\AttributeTok{ylab =} \StringTok{"Users"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.4\linewidth]{capstone-movielens.report_files/figure-latex/sparsity-of-movie-recs-1}

Further observations highlighted there that, as we can see from the distributions the author presented, some movies get rated more than others, and some users are more active than others in rating movies:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 }\OtherTok{\textless{}{-}}\NormalTok{ edx }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{count}\NormalTok{(movieId) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(n)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{bins =} \DecValTok{30}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{scale\_x\_log10}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Movies"}\NormalTok{)}

\NormalTok{p2 }\OtherTok{\textless{}{-}}\NormalTok{ edx }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{count}\NormalTok{(userId) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(n)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{bins =} \DecValTok{30}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{scale\_x\_log10}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Users"}\NormalTok{)}

\NormalTok{gridExtra}\SpecialCharTok{::}\FunctionTok{grid.arrange}\NormalTok{(p2, p1, }\AttributeTok{ncol =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/movie-id-and-user-hists-1.pdf}}

Finally, we can see that no movies have a rating of 0. Movies are rated from 0.5 to 5.0 in 0.5 increments:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#library(dplyr)}
\NormalTok{s }\OtherTok{\textless{}{-}}\NormalTok{ edx }\SpecialCharTok{|\textgreater{}} \FunctionTok{group\_by}\NormalTok{(rating) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{n =} \FunctionTok{n}\NormalTok{())}
\FunctionTok{print}\NormalTok{(s)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 2
##    rating       n
##     <dbl>   <int>
##  1    0.5   85374
##  2    1    345679
##  3    1.5  106426
##  4    2    711422
##  5    2.5  333010
##  6    3   2121240
##  7    3.5  791624
##  8    4   2588430
##  9    4.5  526736
## 10    5   1390114
\end{verbatim}

Further analysis of the \texttt{edx} dataset have been also inspired by the article mentioned above\autocite{MRS-R-BEST}, from which the code and explanatory notes below were cited.
\newpage

\paragraph{\texorpdfstring{Rating distribution plot\autocite{MRS-R-BEST}}{Rating distribution plot{[}@MRS-R-BEST{]}}}\label{rating-distribution-plotmrs-r-best}

\hfill\break
The code below demonstrates another way of visualizing the rating distribution:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{edx }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{group\_by}\NormalTok{(rating) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ rating, }\AttributeTok{y =}\NormalTok{ count)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"\#8888ff"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Rating Distribution"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Rating"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Occurrences Count"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ comma) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}\AttributeTok{n.breaks =} \DecValTok{10}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_economist}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
        \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \DecValTok{10}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
        \AttributeTok{plot.margin =} \FunctionTok{margin}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{1.2}\NormalTok{, }\StringTok{"cm"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-30-1.pdf}}

This graph is another confirmation of what we found out above: rounded ratings occur more often than half-stared ones. The upward trend previously discussed is now perfectly clear, although it seems to top right between the 3 and 4-star ratings lowering the occurrences count afterward. That might be due to users being more hesitant to rate with the highest mark for whichever reasons they might hold\autocite{MRS-R-BEST}.
\newpage

\paragraph{Ratings per movie}\label{ratings-per-movie}

\hfill\break

\subparagraph{\texorpdfstring{Movie popularity count\autocite{MRS-R-BEST}}{Movie popularity count{[}@MRS-R-BEST{]}}}\label{movie-popularity-countmrs-r-best}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(edx }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{group\_by}\NormalTok{(movieId) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{slice\_head}\NormalTok{(}\AttributeTok{n =} \DecValTok{10}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 2
##    movieId count
##      <int> <int>
##  1       1 23790
##  2       2 10779
##  3       3  7028
##  4       4  1577
##  5       5  6400
##  6       6 12346
##  7       7  7259
##  8       8   821
##  9       9  2278
## 10      10 15187
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(edx }\SpecialCharTok{|\textgreater{}} \FunctionTok{group\_by}\NormalTok{(movieId) }\SpecialCharTok{|\textgreater{}} \FunctionTok{summarize}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{|\textgreater{}} \FunctionTok{select}\NormalTok{(count))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      count        
##  Min.   :    1.0  
##  1st Qu.:   30.0  
##  Median :  122.0  
##  Mean   :  842.9  
##  3rd Qu.:  565.0  
##  Max.   :31362.0
\end{verbatim}

\newpage

\subparagraph{\texorpdfstring{Ratings per movie plot\autocite{MRS-R-BEST}}{Ratings per movie plot{[}@MRS-R-BEST{]}}}\label{ratings-per-movie-plotmrs-r-best}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{edx }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{group\_by}\NormalTok{(movieId) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ movieId, }\AttributeTok{y =}\NormalTok{ count)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{color =} \StringTok{"\#4020dd"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{color =} \StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Ratings per movie"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Movies"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Number of ratings"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ comma) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}\AttributeTok{n.breaks =} \DecValTok{10}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_economist}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
        \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \DecValTok{10}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
        \AttributeTok{plot.margin =} \FunctionTok{margin}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{1.2}\NormalTok{, }\StringTok{"cm"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'
\end{verbatim}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-33-1.pdf}}
\newpage

\subparagraph{\texorpdfstring{Movies' rating histogram\autocite{MRS-R-BEST}}{Movies' rating histogram{[}@MRS-R-BEST{]}}}\label{movies-rating-histogrammrs-r-best}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{edx }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{group\_by}\NormalTok{(movieId) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ count)) }\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{fill =} \StringTok{"\#8888ff"}\NormalTok{, }\AttributeTok{color =} \StringTok{"\#4020dd"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Movies\textquotesingle{} rating histogram"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Rating count"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Number of movies"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ comma) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_log10}\NormalTok{(}\AttributeTok{n.breaks =} \DecValTok{10}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_economist}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
        \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \DecValTok{10}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
        \AttributeTok{plot.margin =} \FunctionTok{margin}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{1.2}\NormalTok{, }\StringTok{"cm"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
\end{verbatim}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-34-1.pdf}}
\newpage

\paragraph{\texorpdfstring{Ratings per user\autocite{MRS-R-BEST}}{Ratings per user{[}@MRS-R-BEST{]}}}\label{ratings-per-usermrs-r-best}

\hfill\break

\subparagraph{User rating count (activity measure)}\label{user-rating-count-activity-measure}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(edx }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{group\_by}\NormalTok{(userId) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{slice\_head}\NormalTok{(}\AttributeTok{n =} \DecValTok{10}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 2
##    userId count
##     <int> <int>
##  1      1    19
##  2      2    17
##  3      3    31
##  4      4    35
##  5      5    74
##  6      6    39
##  7      7    96
##  8      8   727
##  9      9    21
## 10     10   112
\end{verbatim}

\subparagraph{User rating summary}\label{user-rating-summary}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(edx }\SpecialCharTok{|\textgreater{}} \FunctionTok{group\_by}\NormalTok{(userId) }\SpecialCharTok{|\textgreater{}} \FunctionTok{summarize}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{|\textgreater{}} \FunctionTok{select}\NormalTok{(count))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      count       
##  Min.   :  10.0  
##  1st Qu.:  32.0  
##  Median :  62.0  
##  Mean   : 128.8  
##  3rd Qu.: 141.0  
##  Max.   :6616.0
\end{verbatim}

\newpage

\subparagraph{Ratings per user plot}\label{ratings-per-user-plot}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{edx }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{group\_by}\NormalTok{(userId) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ userId, }\AttributeTok{y =}\NormalTok{ count)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{color =} \StringTok{"\#4020dd"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{color =} \StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Ratings per user"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Users"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Number of ratings"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ comma) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}\AttributeTok{n.breaks =} \DecValTok{10}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_economist}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
        \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \DecValTok{10}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
        \AttributeTok{plot.margin =} \FunctionTok{margin}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{1.2}\NormalTok{, }\StringTok{"cm"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'
\end{verbatim}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-37-1.pdf}}
\newpage

\subparagraph{Users' rating histogram}\label{users-rating-histogram}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{edx }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{group\_by}\NormalTok{(userId) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ count)) }\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{fill =} \StringTok{"\#8888ff"}\NormalTok{, }\AttributeTok{color =} \StringTok{"\#4020dd"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Users\textquotesingle{} rating histogram"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Rating count"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Number of users"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ comma) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_log10}\NormalTok{(}\AttributeTok{n.breaks =} \DecValTok{10}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_economist}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
        \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \DecValTok{10}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
        \AttributeTok{plot.margin =} \FunctionTok{margin}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{1.2}\NormalTok{, }\StringTok{"cm"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
\end{verbatim}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-38-1.pdf}}
\newpage

\section{Methods / Analysis}\label{methods-analysis}

\begin{noteblock}
All the source code of the R-scripts is available on the project's \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/tree/main/r/src}{GitHub repository}\autocite{edx_capstone_movielens}.

\end{noteblock}

\subsection{Defining Logging and Time Measuring Helper Functions}\label{defining-logging-and-time-measuring-helper-functions}

\hfill\break

First, let's define some helper functions for logging and time-measuring features that we will use in our R scripts. Some of them are listed below:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Logging Helper functions {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{open\_logfile }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(file\_name)\{}
\NormalTok{  log\_file\_name }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.time}\NormalTok{()) }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{str\_replace\_all}\NormalTok{(}\StringTok{\textquotesingle{}:\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}\_\textquotesingle{}}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{str\_replace}\NormalTok{(}\StringTok{\textquotesingle{} \textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}T\textquotesingle{}}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{str\_c}\NormalTok{(file\_name)}
  
  \FunctionTok{log\_open}\NormalTok{(}\AttributeTok{file\_name =}\NormalTok{ log\_file\_name)}
\NormalTok{\}}
\NormalTok{print\_start\_date }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{()\{}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{date}\NormalTok{())}
  \FunctionTok{Sys.time}\NormalTok{()}
\NormalTok{\}}
\NormalTok{put\_start\_date }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{()\{}
  \FunctionTok{put}\NormalTok{(}\FunctionTok{date}\NormalTok{())}
  \FunctionTok{Sys.time}\NormalTok{()}
\NormalTok{\}}
\NormalTok{print\_end\_date }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(start)\{}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{date}\NormalTok{())}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{Sys.time}\NormalTok{() }\SpecialCharTok{{-}}\NormalTok{ start)}
\NormalTok{\}}
\NormalTok{put\_end\_date }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(start)\{}
  \FunctionTok{put}\NormalTok{(}\FunctionTok{date}\NormalTok{())}
  \FunctionTok{put}\NormalTok{(}\FunctionTok{Sys.time}\NormalTok{() }\SpecialCharTok{{-}}\NormalTok{ start)}
\NormalTok{\}}

\NormalTok{msg.set\_arg }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(msg\_template, arg, }\AttributeTok{arg.name =} \StringTok{"\%1"}\NormalTok{) \{}
\NormalTok{  msg\_template }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{str\_replace\_all}\NormalTok{(arg.name, }\FunctionTok{as.character}\NormalTok{(arg))}
\NormalTok{\}}
\NormalTok{msg.glue }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(msg\_template, arg, }\AttributeTok{arg.name =} \StringTok{"\%1"}\NormalTok{)\{}
\NormalTok{  msg\_template }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{msg.set\_arg}\NormalTok{(arg, arg.name) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{str\_glue}\NormalTok{()}
\NormalTok{\}}

\NormalTok{print\_log }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(msg)\{}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{str\_glue}\NormalTok{(msg))}
\NormalTok{\}}
\NormalTok{put\_log }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(msg)\{}
  \FunctionTok{put}\NormalTok{(}\FunctionTok{str\_glue}\NormalTok{(msg))}
\NormalTok{\}}

\NormalTok{get\_log1 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(msg\_template, arg1) \{}
  \FunctionTok{str\_glue}\NormalTok{(}\FunctionTok{str\_replace\_all}\NormalTok{(msg\_template, }\StringTok{"\%1"}\NormalTok{, }\FunctionTok{as.character}\NormalTok{(arg1)))}
\NormalTok{\}}
\NormalTok{print\_log1 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(msg\_template, arg1)\{}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{get\_log1}\NormalTok{(msg\_template, arg1))}
\NormalTok{\}}
\NormalTok{put\_log1 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(msg\_template, arg1)\{}
  \FunctionTok{put}\NormalTok{(}\FunctionTok{get\_log1}\NormalTok{(msg\_template, arg1))}
\NormalTok{\}}

\NormalTok{get\_log2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(msg\_template, arg1, arg2) \{}
\NormalTok{  msg\_template }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{str\_replace\_all}\NormalTok{(}\StringTok{"\%1"}\NormalTok{, }\FunctionTok{as.character}\NormalTok{(arg1)) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{str\_replace\_all}\NormalTok{(}\StringTok{"\%2"}\NormalTok{, }\FunctionTok{as.character}\NormalTok{(arg2)) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{str\_glue}\NormalTok{()}
\NormalTok{\}}
\NormalTok{print\_log2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(msg\_template, arg1, arg2)\{}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{get\_log1}\NormalTok{(msg\_template, arg1, arg2))}
\NormalTok{\}}
\NormalTok{put\_log2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(msg\_template, arg1, arg2)\{}
  \FunctionTok{put}\NormalTok{(}\FunctionTok{get\_log1}\NormalTok{(msg\_template, arg1, arg2))}
\NormalTok{\}}

\CommentTok{\# ...}
\end{Highlighting}
\end{Shaded}

\begin{noteblock}
The full source code of these functions is available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R\#L20}{Logging Helper functions} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R\#L20}{capstone-movielens.main.R} script on \emph{GitHub}.

\end{noteblock}

\newpage

\subsection{Preparing train and set datasets}\label{preparing-train-and-set-datasets}

\hfill\break

We will split the \texttt{edx} dataset into a training set, which we will use to build and train our models, and a test set in which we will compute the accuracy of our predictions, the way described in \href{https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html\#movielens-data}{Section 23.1.1 Movielens data} of the \emph{Course Textbook} mentioned above\autocite{IDS2_23-1-1}.We will also use the \emph{5-Fold Cross Validation} method as described in \href{https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html\#cross-validation}{Section 29.6 Cross validation} of the \emph{Course Textbook}.
To prepare datasets for processing, we will use the following functions, specifically designed for these operations:

\phantomsection\label{func.make_source_datasets}
\begin{itemize}
\tightlist
\item
  \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L87}{make\_source\_datasets}
\end{itemize}

\phantomsection\label{func.init_source_datasets}
\begin{itemize}
\tightlist
\item
  \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L209}{init\_source\_datasets}
\end{itemize}

\begin{noteblock}
The full source code of the function listed above is available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L86}{Initialize input datasets} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R}{data.helper.functions.R} script on \emph{GitHub}.

\end{noteblock}

\subsubsection{\texorpdfstring{The \hyperref[func.make_source_datasets]{make\_source\_datasets} function}{The make\_source\_datasets function}}\label{the-make_source_datasets-function}

\hfill\break

Let's take a closer look at the objects we will receive as a result of executing this function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{make\_source\_datasets }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{()\{}
  \CommentTok{\# ...}
  \FunctionTok{list}\NormalTok{(}\AttributeTok{edx\_CV =}\NormalTok{ edx\_CV,}
       \AttributeTok{edx.mx =}\NormalTok{ edx.mx,}
       \AttributeTok{edx.sgr =}\NormalTok{ edx.sgr,}
       \AttributeTok{tuning\_sets =}\NormalTok{ tuning\_sets,}
       \AttributeTok{movie\_map =}\NormalTok{ movie\_map,}
       \AttributeTok{date\_days\_map =}\NormalTok{ date\_days\_map)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\paragraph{\texorpdfstring{\texttt{edx.mx} Matrix Object}{edx.mx Matrix Object}}\label{edx.mx-matrix-object}

\hfill\break

We will use the array representation described in \href{https://rafalab.dfci.harvard.edu/dsbook-part-2/linear-models/treatment-effect-models.html\#sec-anova}{Section 17.5 of the Textbook}, for the training data: we denote ranking for movie \(j\) by user \(i\) as \(y_{i,j}\). To create this matrix, we use \texttt{tidyr::pivot\_wider} function:

\begin{Shaded}
\begin{Highlighting}[]
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}make\_source\_datasets\textasciigrave{}: Creating Rating Matrix from \textasciigrave{}edx\textasciigrave{} dataset..."}\NormalTok{)}
\NormalTok{  edx.mx }\OtherTok{\textless{}{-}}\NormalTok{ edx }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{userId =} \FunctionTok{factor}\NormalTok{(userId),}
           \AttributeTok{movieId =} \FunctionTok{factor}\NormalTok{(movieId)) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{select}\NormalTok{(movieId, userId, rating) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{names\_from =}\NormalTok{ movieId, }\AttributeTok{values\_from =}\NormalTok{ rating) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{column\_to\_rownames}\NormalTok{(}\StringTok{"userId"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{as.matrix}\NormalTok{()}
  
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}make\_source\_datasets\textasciigrave{}:}
\StringTok{Matrix created: \textasciigrave{}edx.mx\textasciigrave{} of the following dimentions:"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
  \FunctionTok{str}\NormalTok{(edx.mx)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  num [1:69878, 1:10677] 5 NA NA NA NA NA NA NA NA NA ...
##  - attr(*, "dimnames")=List of 2
##   ..$ : chr [1:69878] "1" "2" "3" "4" ...
##   ..$ : chr [1:10677] "122" "185" "292" "316" ...
\end{verbatim}

\paragraph{\texorpdfstring{\texttt{edx.sgr} Object}{edx.sgr Object}}\label{edx.sgr-object}

\hfill\break

To account for the Movie Genre Effect more accurately, we need a dataset with split rows for movies belonging to multiple genres:

\begin{Shaded}
\begin{Highlighting}[]
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}make\_source\_datasets\textasciigrave{}: }
\StringTok{To account for the Movie Genre Effect, we need a dataset with split rows }
\StringTok{for movies belonging to multiple genres."}\NormalTok{)}
\NormalTok{  edx.sgr }\OtherTok{\textless{}{-}} \FunctionTok{splitGenreRows}\NormalTok{(edx)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(edx.sgr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## tibble [23,371,423 x 6] (S3: tbl_df/tbl/data.frame)
##  $ userId   : int [1:23371423] 1 1 1 1 1 1 1 1 1 1 ...
##  $ movieId  : int [1:23371423] 122 122 185 185 185 292 292 292 292 316 ...
##  $ rating   : num [1:23371423] 5 5 5 5 5 5 5 5 5 5 ...
##  $ timestamp: int [1:23371423] 838985046 838985046 838983525 838983525 838983525 838983421 838983421 838983421 838983421 838983392 ...
##  $ title    : chr [1:23371423] "Boomerang (1992)" "Boomerang (1992)" "Net, The (1995)" "Net, The (1995)" ...
##  $ genres   : chr [1:23371423] "Comedy" "Romance" "Action" "Crime" ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(edx.sgr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      userId         movieId          rating        timestamp            title              genres         
##  Min.   :    1   Min.   :    1   Min.   :0.500   Min.   :7.897e+08   Length:23371423    Length:23371423   
##  1st Qu.:18140   1st Qu.:  616   1st Qu.:3.000   1st Qu.:9.472e+08   Class :character   Class :character  
##  Median :35784   Median : 1748   Median :4.000   Median :1.042e+09   Mode  :character   Mode  :character  
##  Mean   :35886   Mean   : 4277   Mean   :3.527   Mean   :1.035e+09                                        
##  3rd Qu.:53638   3rd Qu.: 3635   3rd Qu.:4.000   3rd Qu.:1.131e+09                                        
##  Max.   :71567   Max.   :65133   Max.   :5.000   Max.   :1.231e+09
\end{verbatim}

Note that we use the \texttt{splitGenreRows} function to split rows of the original dataset:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{splitGenreRows }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data)\{}
  \FunctionTok{put}\NormalTok{(}\StringTok{"Splitting dataset rows related to multiple genres..."}\NormalTok{)}
\NormalTok{  start }\OtherTok{\textless{}{-}} \FunctionTok{put\_start\_date}\NormalTok{()}
\NormalTok{  gs\_splitted }\OtherTok{\textless{}{-}}\NormalTok{ data }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{separate\_rows}\NormalTok{(genres, }\AttributeTok{sep =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{|"}\NormalTok{)}
  \FunctionTok{put}\NormalTok{(}\StringTok{"Dataset rows related to multiple genres have been splitted to have single genre per row."}\NormalTok{)}
  \FunctionTok{put\_end\_date}\NormalTok{(start)}
\NormalTok{  gs\_splitted}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{noteblock}
The source code of the function mentioned above is also available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L86}{Initialize input datasets} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R}{data.helper.functions.R} script on \emph{GitHub}.

\end{noteblock}

\paragraph{\texorpdfstring{\texttt{movie\_map} Object}{movie\_map Object}}\label{movie_map-object}

\hfill\break

To be able to map movie IDs to titles we create the following lookup table:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{movie\_map }\OtherTok{\textless{}{-}}\NormalTok{ edx }\SpecialCharTok{|\textgreater{}} \FunctionTok{select}\NormalTok{(movieId, title, genres) }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{distinct}\NormalTok{(movieId, }\AttributeTok{.keep\_all =} \ConstantTok{TRUE}\NormalTok{)}
  
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}make\_source\_datasets\textasciigrave{}: Dataset created: movie\_map"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(movie\_map)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    10677 obs. of  3 variables:
##  $ movieId: int  122 185 292 316 329 355 356 362 364 370 ...
##  $ title  : chr  "Boomerang (1992)" "Net, The (1995)" "Outbreak (1995)" "Stargate (1994)" ...
##  $ genres : chr  "Comedy|Romance" "Action|Crime|Thriller" "Action|Drama|Sci-Fi|Thriller" "Action|Adventure|Sci-Fi" ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(movie\_map)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     movieId         title              genres         
##  Min.   :    1   Length:10677       Length:10677      
##  1st Qu.: 2754   Class :character   Class :character  
##  Median : 5434   Mode  :character   Mode  :character  
##  Mean   :13105                                        
##  3rd Qu.: 8710                                        
##  Max.   :65133
\end{verbatim}

Note that titles cannot be considered unique, so we can't use them as IDs\autocite{IDS2_23-1-1}.

\paragraph{\texorpdfstring{\texttt{date\_days\_map} Object}{date\_days\_map Object}}\label{date_days_map-object}

\hfill\break

We have a \texttt{timestamp} field in the \texttt{edx} dataset.
To be able to map the date, year, and number of days since the earliest record in the \texttt{edx} dataset with the corresponding value in this field, we create the following lookup table:

\begin{Shaded}
\begin{Highlighting}[]
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}make\_source\_datasets\textasciigrave{}: Creating Date{-}Days Map dataset..."}\NormalTok{)}
\NormalTok{  date\_days\_map }\OtherTok{\textless{}{-}}\NormalTok{ edx }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{date\_time =} \FunctionTok{as\_datetime}\NormalTok{(timestamp)) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{date =} \FunctionTok{as\_date}\NormalTok{(date\_time)) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year =} \FunctionTok{year}\NormalTok{(date\_time)) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{days =} \FunctionTok{as.integer}\NormalTok{(date }\SpecialCharTok{{-}} \FunctionTok{min}\NormalTok{(date))) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{select}\NormalTok{(timestamp, date\_time, date, year, days) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{distinct}\NormalTok{(timestamp, }\AttributeTok{.keep\_all =} \ConstantTok{TRUE}\NormalTok{)}
  
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}make\_source\_datasets\textasciigrave{}: Dataset created: date\_days\_map"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
  \FunctionTok{str}\NormalTok{(date\_days\_map)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    6519590 obs. of  5 variables:
##  $ timestamp: int  838985046 838983525 838983421 838983392 838984474 838983653 838984885 838983707 838984596 838983834 ...
##  $ date_time: POSIXct, format: "1996-08-02 11:24:06" "1996-08-02 10:58:45" "1996-08-02 10:57:01" "1996-08-02 10:56:32" ...
##  $ date     : Date, format: "1996-08-02" "1996-08-02" "1996-08-02" "1996-08-02" ...
##  $ year     : num  1996 1996 1996 1996 1996 ...
##  $ days     : int  571 571 571 571 571 571 571 571 571 571 ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
  \FunctionTok{summary}\NormalTok{(date\_days\_map)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    timestamp           date_time                           date                 year           days     
##  Min.   :7.897e+08   Min.   :1995-01-09 11:46:49.00   Min.   :1995-01-09   Min.   :1995   Min.   :   0  
##  1st Qu.:9.783e+08   1st Qu.:2001-01-01 05:05:01.75   1st Qu.:2001-01-01   1st Qu.:2001   1st Qu.:2184  
##  Median :1.091e+09   Median :2004-08-03 01:08:18.50   Median :2004-08-03   Median :2004   Median :3494  
##  Mean   :1.066e+09   Mean   :2003-10-10 23:15:02.07   Mean   :2003-10-10   Mean   :2003   Mean   :3196  
##  3rd Qu.:1.152e+09   3rd Qu.:2006-07-04 20:41:57.50   3rd Qu.:2006-07-04   3rd Qu.:2006   3rd Qu.:4194  
##  Max.   :1.231e+09   Max.   :2009-01-05 05:02:16.00   Max.   :2009-01-05   Max.   :2009   Max.   :5110
\end{verbatim}

\paragraph{\texorpdfstring{\texttt{edx\_CV} Object}{edx\_CV Object}}\label{edx_cv-object}

\hfill\break

Here we have a list of sample objects we need to perform the \emph{5-Fold Cross Validation}
as explained in \href{https://rafalab.dfci.harvard.edu/dsbook-part-2/ml/resampling-methods.html\#k-fold-cross-validation}{Section 29.6.1 K-fold cross validation} of the \emph{Course Textbook}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  start }\OtherTok{\textless{}{-}} \FunctionTok{put\_start\_date}\NormalTok{()}
\NormalTok{  edx\_CV }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(kfold\_index,  }\ControlFlowTok{function}\NormalTok{(fold\_i)\{}
    
    \FunctionTok{put\_log1}\NormalTok{(}\StringTok{"Method \textasciigrave{}make\_source\_datasets\textasciigrave{}: }
\StringTok{Creating K{-}Fold Cross Validation Datasets, Fold \%1"}\NormalTok{, fold\_i)}
    
    \CommentTok{\#\textgreater{} We split the initial datasets into training sets, which we will use to build }
    \CommentTok{\#\textgreater{} and train our models, and validation sets in which we will compute the accuracy }
    \CommentTok{\#\textgreater{} of our predictions, the way described in the \textasciigrave{}Section 23.1.1 Movielens data\textasciigrave{}}
    \CommentTok{\#\textgreater{} (https://rafalab.dfci.harvard.edu/dsbook{-}part{-}2/highdim/regularization.html\#movielens{-}data) }
    \CommentTok{\#\textgreater{} of the Course Textbook.}
    
\NormalTok{    split\_sets }\OtherTok{\textless{}{-}}\NormalTok{ edx }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{sample\_train\_validation\_sets}\NormalTok{(fold\_i}\SpecialCharTok{*}\DecValTok{1000}\NormalTok{)}
    
\NormalTok{    train\_set }\OtherTok{\textless{}{-}}\NormalTok{ split\_sets}\SpecialCharTok{$}\NormalTok{train\_set}
\NormalTok{    validation\_set }\OtherTok{\textless{}{-}}\NormalTok{ split\_sets}\SpecialCharTok{$}\NormalTok{validation\_set}
    
    \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}make\_source\_datasets\textasciigrave{}: }
\StringTok{Sampling 20\% from the split{-}row version of the \textasciigrave{}edx\textasciigrave{} dataset..."}\NormalTok{)}
\NormalTok{    split\_sets.gs }\OtherTok{\textless{}{-}}\NormalTok{ edx.sgr }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{sample\_train\_validation\_sets}\NormalTok{(fold\_i}\SpecialCharTok{*}\DecValTok{2000}\NormalTok{)}

\NormalTok{    train.sgr }\OtherTok{\textless{}{-}}\NormalTok{ split\_sets.gs}\SpecialCharTok{$}\NormalTok{train\_set}
\NormalTok{    validation.sgr }\OtherTok{\textless{}{-}}\NormalTok{ split\_sets.gs}\SpecialCharTok{$}\NormalTok{validation\_set}
    
    \CommentTok{\# put\_log("Function: \textasciigrave{}make\_source\_datasets\textasciigrave{}: Dataset created: validation.sgr")}
    \CommentTok{\# put(summary(validation.sgr))}
    
    \CommentTok{\#\textgreater{} We will use the array representation described in \textasciigrave{}Section 17.5 of the Textbook\textasciigrave{}}
    \CommentTok{\#\textgreater{} (https://rafalab.dfci.harvard.edu/dsbook{-}part{-}2/linear{-}models/treatment{-}effect{-}models.html\#sec{-}anova), }
    \CommentTok{\#\textgreater{} for the training data. }
    \CommentTok{\#\textgreater{} To create this matrix, we use \textasciigrave{}tidyr::pivot\_wider\textasciigrave{} function:}
    
    \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}make\_source\_datasets\textasciigrave{}: Creating Rating Matrix from Train Set..."}\NormalTok{)}
\NormalTok{    train\_mx }\OtherTok{\textless{}{-}}\NormalTok{ train\_set }\SpecialCharTok{|\textgreater{}} 
      \FunctionTok{mutate}\NormalTok{(}\AttributeTok{userId =} \FunctionTok{factor}\NormalTok{(userId),}
             \AttributeTok{movieId =} \FunctionTok{factor}\NormalTok{(movieId)) }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{select}\NormalTok{(movieId, userId, rating) }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{names\_from =}\NormalTok{ movieId, }\AttributeTok{values\_from =}\NormalTok{ rating) }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{column\_to\_rownames}\NormalTok{(}\StringTok{"userId"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{as.matrix}\NormalTok{()}
    
    \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}make\_source\_datasets\textasciigrave{}:}
\StringTok{Matrix created: \textasciigrave{}train\_mx\textasciigrave{} of the following dimentions:"}\NormalTok{)}
    \FunctionTok{put}\NormalTok{(}\FunctionTok{dim}\NormalTok{(train\_mx))}

    \FunctionTok{list}\NormalTok{(}\AttributeTok{train\_set =}\NormalTok{ train\_set,}
         \AttributeTok{train\_mx =}\NormalTok{ train\_mx,}
         \AttributeTok{train.sgr =}\NormalTok{ train.sgr,}
         \AttributeTok{validation\_set =}\NormalTok{ validation\_set)}
\NormalTok{  \})}
  \FunctionTok{put\_end\_date}\NormalTok{(start)}
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}make\_source\_datasets\textasciigrave{}: }
\StringTok{Set of K{-}Fold Cross Validation datasets created: edx\_CV"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(edx\_CV)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## List of 5
##  $ :List of 4
##   ..$ train_set     :'data.frame':   7172311 obs. of  6 variables:
##   .. ..$ userId   : int [1:7172311] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ movieId  : int [1:7172311] 122 185 292 329 356 362 364 370 420 466 ...
##   .. ..$ rating   : num [1:7172311] 5 5 5 5 5 5 5 5 5 5 ...
##   .. ..$ timestamp: int [1:7172311] 838985046 838983525 838983421 838983392 838983653 838984885 838983707 838984596 838983834 838984679 ...
##   .. ..$ title    : chr [1:7172311] "Boomerang (1992)" "Net, The (1995)" "Outbreak (1995)" "Star Trek: Generations (1994)" ...
##   .. ..$ genres   : chr [1:7172311] "Comedy|Romance" "Action|Crime|Thriller" "Action|Drama|Sci-Fi|Thriller" "Action|Adventure|Drama|Sci-Fi" ...
##   ..$ train_mx      : num [1:69878, 1:10677] 5 NA NA NA NA NA NA NA NA NA ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:69878] "1" "2" "3" "4" ...
##   .. .. ..$ : chr [1:10677] "122" "185" "292" "329" ...
##   ..$ train.sgr     : tibble [18,669,190 x 6] (S3: tbl_df/tbl/data.frame)
##   .. ..$ userId   : int [1:18669190] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ movieId  : int [1:18669190] 122 122 185 185 292 292 292 292 316 316 ...
##   .. ..$ rating   : num [1:18669190] 5 5 5 5 5 5 5 5 5 5 ...
##   .. ..$ timestamp: int [1:18669190] 838985046 838985046 838983525 838983525 838983421 838983421 838983421 838983421 838983392 838983392 ...
##   .. ..$ title    : chr [1:18669190] "Boomerang (1992)" "Boomerang (1992)" "Net, The (1995)" "Net, The (1995)" ...
##   .. ..$ genres   : chr [1:18669190] "Comedy" "Romance" "Action" "Crime" ...
##   ..$ validation_set:'data.frame':   1827744 obs. of  6 variables:
##   .. ..$ userId   : int [1:1827744] 1 1 1 1 2 2 2 2 3 3 ...
##   .. ..$ movieId  : int [1:1827744] 316 355 377 588 260 376 648 1049 110 1252 ...
##   .. ..$ rating   : num [1:1827744] 5 5 5 5 5 3 2 3 4.5 4 ...
##   .. ..$ timestamp: int [1:1827744] 838983392 838984474 838983834 838983339 868244562 868245920 868244699 868245920 1136075500 1133571071 ...
##   .. ..$ title    : chr [1:1827744] "Stargate (1994)" "Flintstones, The (1994)" "Speed (1994)" "Aladdin (1992)" ...
##   .. ..$ genres   : chr [1:1827744] "Action|Adventure|Sci-Fi" "Children|Comedy|Fantasy" "Action|Romance|Thriller" "Adventure|Animation|Children|Comedy|Musical" ...
##  $ :List of 4
##   ..$ train_set     :'data.frame':   7172306 obs. of  6 variables:
##   .. ..$ userId   : int [1:7172306] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ movieId  : int [1:7172306] 122 185 292 316 329 355 356 364 370 377 ...
##   .. ..$ rating   : num [1:7172306] 5 5 5 5 5 5 5 5 5 5 ...
##   .. ..$ timestamp: int [1:7172306] 838985046 838983525 838983421 838983392 838983392 838984474 838983653 838983707 838984596 838983834 ...
##   .. ..$ title    : chr [1:7172306] "Boomerang (1992)" "Net, The (1995)" "Outbreak (1995)" "Stargate (1994)" ...
##   .. ..$ genres   : chr [1:7172306] "Comedy|Romance" "Action|Crime|Thriller" "Action|Drama|Sci-Fi|Thriller" "Action|Adventure|Sci-Fi" ...
##   ..$ train_mx      : num [1:69878, 1:10677] 5 NA NA NA NA NA NA NA NA NA ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:69878] "1" "2" "3" "4" ...
##   .. .. ..$ : chr [1:10677] "122" "185" "292" "316" ...
##   ..$ train.sgr     : tibble [18,669,201 x 6] (S3: tbl_df/tbl/data.frame)
##   .. ..$ userId   : int [1:18669201] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ movieId  : int [1:18669201] 122 122 185 185 185 292 292 316 316 329 ...
##   .. ..$ rating   : num [1:18669201] 5 5 5 5 5 5 5 5 5 5 ...
##   .. ..$ timestamp: int [1:18669201] 838985046 838985046 838983525 838983525 838983525 838983421 838983421 838983392 838983392 838983392 ...
##   .. ..$ title    : chr [1:18669201] "Boomerang (1992)" "Boomerang (1992)" "Net, The (1995)" "Net, The (1995)" ...
##   .. ..$ genres   : chr [1:18669201] "Comedy" "Romance" "Action" "Crime" ...
##   ..$ validation_set:'data.frame':   1827749 obs. of  6 variables:
##   .. ..$ userId   : int [1:1827749] 1 1 1 1 2 2 2 2 3 3 ...
##   .. ..$ movieId  : int [1:1827749] 362 520 539 594 539 590 733 1210 1252 1408 ...
##   .. ..$ rating   : num [1:1827749] 5 5 5 5 3 5 3 4 4 3.5 ...
##   .. ..$ timestamp: int [1:1827749] 838984885 838984679 838984068 838984679 868246262 868245608 868244562 868245644 1133571071 1133571145 ...
##   .. ..$ title    : chr [1:1827749] "Jungle Book, The (1994)" "Robin Hood: Men in Tights (1993)" "Sleepless in Seattle (1993)" "Snow White and the Seven Dwarfs (1937)" ...
##   .. ..$ genres   : chr [1:1827749] "Adventure|Children|Romance" "Comedy" "Comedy|Drama|Romance" "Animation|Children|Drama|Fantasy|Musical" ...
##  $ :List of 4
##   ..$ train_set     :'data.frame':   7172307 obs. of  6 variables:
##   .. ..$ userId   : int [1:7172307] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ movieId  : int [1:7172307] 122 185 292 316 329 355 362 370 377 420 ...
##   .. ..$ rating   : num [1:7172307] 5 5 5 5 5 5 5 5 5 5 ...
##   .. ..$ timestamp: int [1:7172307] 838985046 838983525 838983421 838983392 838983392 838984474 838984885 838984596 838983834 838983834 ...
##   .. ..$ title    : chr [1:7172307] "Boomerang (1992)" "Net, The (1995)" "Outbreak (1995)" "Stargate (1994)" ...
##   .. ..$ genres   : chr [1:7172307] "Comedy|Romance" "Action|Crime|Thriller" "Action|Drama|Sci-Fi|Thriller" "Action|Adventure|Sci-Fi" ...
##   ..$ train_mx      : num [1:69878, 1:10677] 5 NA NA NA NA NA NA NA NA NA ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:69878] "1" "2" "3" "4" ...
##   .. .. ..$ : chr [1:10677] "122" "185" "292" "316" ...
##   ..$ train.sgr     : tibble [18,669,195 x 6] (S3: tbl_df/tbl/data.frame)
##   .. ..$ userId   : int [1:18669195] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ movieId  : int [1:18669195] 122 122 185 185 185 292 292 292 316 329 ...
##   .. ..$ rating   : num [1:18669195] 5 5 5 5 5 5 5 5 5 5 ...
##   .. ..$ timestamp: int [1:18669195] 838985046 838985046 838983525 838983525 838983525 838983421 838983421 838983421 838983392 838983392 ...
##   .. ..$ title    : chr [1:18669195] "Boomerang (1992)" "Boomerang (1992)" "Net, The (1995)" "Net, The (1995)" ...
##   .. ..$ genres   : chr [1:18669195] "Comedy" "Romance" "Action" "Crime" ...
##   ..$ validation_set:'data.frame':   1827748 obs. of  6 variables:
##   .. ..$ userId   : int [1:1827748] 1 1 1 1 2 2 2 2 3 3 ...
##   .. ..$ movieId  : int [1:1827748] 356 364 539 616 590 719 780 786 151 213 ...
##   .. ..$ rating   : num [1:1827748] 5 5 5 5 5 3 3 3 4.5 5 ...
##   .. ..$ timestamp: int [1:1827748] 838983653 838983707 838984068 838984941 868245608 868246191 868244698 868244562 1133571026 1136075789 ...
##   .. ..$ title    : chr [1:1827748] "Forrest Gump (1994)" "Lion King, The (1994)" "Sleepless in Seattle (1993)" "Aristocats, The (1970)" ...
##   .. ..$ genres   : chr [1:1827748] "Comedy|Drama|Romance|War" "Adventure|Animation|Children|Drama|Musical" "Comedy|Drama|Romance" "Animation|Children" ...
##  $ :List of 4
##   ..$ train_set     :'data.frame':   7172311 obs. of  6 variables:
##   .. ..$ userId   : int [1:7172311] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ movieId  : int [1:7172311] 122 185 292 316 329 355 356 362 364 370 ...
##   .. ..$ rating   : num [1:7172311] 5 5 5 5 5 5 5 5 5 5 ...
##   .. ..$ timestamp: int [1:7172311] 838985046 838983525 838983421 838983392 838983392 838984474 838983653 838984885 838983707 838984596 ...
##   .. ..$ title    : chr [1:7172311] "Boomerang (1992)" "Net, The (1995)" "Outbreak (1995)" "Stargate (1994)" ...
##   .. ..$ genres   : chr [1:7172311] "Comedy|Romance" "Action|Crime|Thriller" "Action|Drama|Sci-Fi|Thriller" "Action|Adventure|Sci-Fi" ...
##   ..$ train_mx      : num [1:69878, 1:10677] 5 NA NA NA NA NA NA NA NA NA ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:69878] "1" "2" "3" "4" ...
##   .. .. ..$ : chr [1:10677] "122" "185" "292" "316" ...
##   ..$ train.sgr     : tibble [18,669,192 x 6] (S3: tbl_df/tbl/data.frame)
##   .. ..$ userId   : int [1:18669192] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ movieId  : int [1:18669192] 122 122 185 185 292 292 316 316 329 329 ...
##   .. ..$ rating   : num [1:18669192] 5 5 5 5 5 5 5 5 5 5 ...
##   .. ..$ timestamp: int [1:18669192] 838985046 838985046 838983525 838983525 838983421 838983421 838983392 838983392 838983392 838983392 ...
##   .. ..$ title    : chr [1:18669192] "Boomerang (1992)" "Boomerang (1992)" "Net, The (1995)" "Net, The (1995)" ...
##   .. ..$ genres   : chr [1:18669192] "Comedy" "Romance" "Action" "Thriller" ...
##   ..$ validation_set:'data.frame':   1827744 obs. of  6 variables:
##   .. ..$ userId   : int [1:1827744] 1 1 1 1 2 2 2 2 3 3 ...
##   .. ..$ movieId  : int [1:1827744] 377 520 588 616 110 648 1049 1356 1148 1276 ...
##   .. ..$ rating   : num [1:1827744] 5 5 5 5 5 2 3 3 4 3.5 ...
##   .. ..$ timestamp: int [1:1827744] 838983834 838984679 838983339 838984941 868245777 868244699 868245920 868244603 1133571121 1133571205 ...
##   .. ..$ title    : chr [1:1827744] "Speed (1994)" "Robin Hood: Men in Tights (1993)" "Aladdin (1992)" "Aristocats, The (1970)" ...
##   .. ..$ genres   : chr [1:1827744] "Action|Romance|Thriller" "Comedy" "Adventure|Animation|Children|Comedy|Musical" "Animation|Children" ...
##  $ :List of 4
##   ..$ train_set     :'data.frame':   7172301 obs. of  6 variables:
##   .. ..$ userId   : int [1:7172301] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ movieId  : int [1:7172301] 122 185 292 316 355 356 364 370 420 466 ...
##   .. ..$ rating   : num [1:7172301] 5 5 5 5 5 5 5 5 5 5 ...
##   .. ..$ timestamp: int [1:7172301] 838985046 838983525 838983421 838983392 838984474 838983653 838983707 838984596 838983834 838984679 ...
##   .. ..$ title    : chr [1:7172301] "Boomerang (1992)" "Net, The (1995)" "Outbreak (1995)" "Stargate (1994)" ...
##   .. ..$ genres   : chr [1:7172301] "Comedy|Romance" "Action|Crime|Thriller" "Action|Drama|Sci-Fi|Thriller" "Action|Adventure|Sci-Fi" ...
##   ..$ train_mx      : num [1:69878, 1:10677] 5 NA NA NA NA NA NA NA NA NA ...
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:69878] "1" "2" "3" "4" ...
##   .. .. ..$ : chr [1:10677] "122" "185" "292" "316" ...
##   ..$ train.sgr     : tibble [18,669,194 x 6] (S3: tbl_df/tbl/data.frame)
##   .. ..$ userId   : int [1:18669194] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ movieId  : int [1:18669194] 122 122 185 185 292 292 316 329 329 355 ...
##   .. ..$ rating   : num [1:18669194] 5 5 5 5 5 5 5 5 5 5 ...
##   .. ..$ timestamp: int [1:18669194] 838985046 838985046 838983525 838983525 838983421 838983421 838983392 838983392 838983392 838984474 ...
##   .. ..$ title    : chr [1:18669194] "Boomerang (1992)" "Boomerang (1992)" "Net, The (1995)" "Net, The (1995)" ...
##   .. ..$ genres   : chr [1:18669194] "Comedy" "Romance" "Crime" "Thriller" ...
##   ..$ validation_set:'data.frame':   1827754 obs. of  6 variables:
##   .. ..$ userId   : int [1:1827754] 1 1 1 1 2 2 2 2 3 3 ...
##   .. ..$ movieId  : int [1:1827754] 329 362 377 594 110 376 539 736 1252 1408 ...
##   .. ..$ rating   : num [1:1827754] 5 5 5 5 5 3 3 3 4 3.5 ...
##   .. ..$ timestamp: int [1:1827754] 838983392 838984885 838983834 838984679 868245777 868245920 868246262 868244698 1133571071 1133571145 ...
##   .. ..$ title    : chr [1:1827754] "Star Trek: Generations (1994)" "Jungle Book, The (1994)" "Speed (1994)" "Snow White and the Seven Dwarfs (1937)" ...
##   .. ..$ genres   : chr [1:1827754] "Action|Adventure|Drama|Sci-Fi" "Adventure|Children|Romance" "Action|Romance|Thriller" "Animation|Children|Drama|Fantasy|Musical" ...
\end{verbatim}

\begin{noteblock}
This code snippet is a \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L140}{part} of the \hyperref[func.make_source_datasets]{make\_source\_datasets} \emph{function} code described above.

\end{noteblock}

Note that we used the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L15}{sample\_train\_validation\_sets} function call to split the original dataset (\texttt{edx} in this case):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    split\_sets }\OtherTok{\textless{}{-}}\NormalTok{ edx }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{sample\_train\_validation\_sets}\NormalTok{(fold\_i}\SpecialCharTok{*}\DecValTok{1000}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

which returns a pair of train/validation sets:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sample\_train\_validation\_sets }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data, seed)\{}
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}sample\_train\_validation\_sets\textasciigrave{}: Sampling 20\% of the \textasciigrave{}data\textasciigrave{} data..."}\NormalTok{)}
  \FunctionTok{set.seed}\NormalTok{(seed)}
\NormalTok{  validation\_ind }\OtherTok{\textless{}{-}} 
    \FunctionTok{sapply}\NormalTok{(}\FunctionTok{splitByUser}\NormalTok{(data),}
           \ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{sample}\NormalTok{(i, }\FunctionTok{ceiling}\NormalTok{(}\FunctionTok{length}\NormalTok{(i)}\SpecialCharTok{*}\NormalTok{.}\DecValTok{2}\NormalTok{))) }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{unlist}\NormalTok{() }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{sort}\NormalTok{()}
  
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}sample\_train\_validation\_sets\textasciigrave{}: }
\StringTok{Extracting 80\% of the original \textasciigrave{}data\textasciigrave{} not used for the Validation Set, }
\StringTok{excluding data for users who provided no more than a specified number of ratings: \{min\_nratings\}."}\NormalTok{)}
  
\NormalTok{  train\_set }\OtherTok{\textless{}{-}}\NormalTok{ data[}\SpecialCharTok{{-}}\NormalTok{validation\_ind,]}
  
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}sample\_train\_validation\_sets\textasciigrave{}: Dataset created: train\_set"}\NormalTok{)}
  \FunctionTok{put}\NormalTok{(}\FunctionTok{summary}\NormalTok{(train\_set))}
  
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}sample\_train\_validation\_sets\textasciigrave{}: }
\StringTok{To make sure we dont include movies in the Training Set that should not be there, }
\StringTok{we exclude entries using the semi\_join function from the Validation Set."}\NormalTok{)}
\NormalTok{  tmp.data }\OtherTok{\textless{}{-}}\NormalTok{ data[validation\_ind,]}
  
\NormalTok{  validation\_set }\OtherTok{\textless{}{-}}\NormalTok{ tmp.data }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{semi\_join}\NormalTok{(train\_set, }\AttributeTok{by =} \StringTok{"movieId"}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{semi\_join}\NormalTok{(train\_set, }\AttributeTok{by =} \StringTok{"userId"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{as.data.frame}\NormalTok{()}
  
  \CommentTok{\# Add rows excluded from \textasciigrave{}validation\_set\textasciigrave{} into \textasciigrave{}train\_set\textasciigrave{}}
\NormalTok{  tmp.excluded }\OtherTok{\textless{}{-}} \FunctionTok{anti\_join}\NormalTok{(tmp.data, validation\_set)}
\NormalTok{  train\_set }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(train\_set, tmp.excluded)}
  
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}sample\_train\_validation\_sets\textasciigrave{}: Dataset created: validation\_set"}\NormalTok{)}
  \FunctionTok{put}\NormalTok{(}\FunctionTok{summary}\NormalTok{(validation\_set))}

  \CommentTok{\# CV train \& test sets Consistency Test}
\NormalTok{  validation.left\_join.Nas }\OtherTok{\textless{}{-}}\NormalTok{ train\_set }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{tst.col =}\NormalTok{ rating) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{select}\NormalTok{(userId, movieId, tst.col) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{data.consistency.test}\NormalTok{(validation\_set)}
  
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: \textasciigrave{}sample\_train\_validation\_sets\textasciigrave{}:}
\StringTok{Below are the data consistency verification results"}\NormalTok{)}
  \FunctionTok{put}\NormalTok{(validation.left\_join.Nas)}
  
  \CommentTok{\# Return result datassets {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}    }
  \FunctionTok{list}\NormalTok{(}\AttributeTok{train\_set =}\NormalTok{ train\_set, }
       \AttributeTok{validation\_set =}\NormalTok{ validation\_set)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{noteblock}
The \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L15}{sample\_train\_validation\_sets} function is defined in the same script as the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L87}{make\_source\_datasets}` one, from where it is called.

\end{noteblock}

\newpage

\subsubsection{Common Helper Functions}\label{common-helper-functions}

\hfill\break

For our further analysis, we are going to use the following \emph{common helper functions}:

\paragraph{\texorpdfstring{\texttt{clamp} function}{clamp function}}\label{clamp-function}

\hfill\break

As explained in \href{https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html\#user-effects}{Section 24.4 User effects} of the \emph{Course Textbook} we know ratings can't be below 0.5 or above 5. For this reason, we will use the \texttt{clamp} function described in that section:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{clamp }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, }\AttributeTok{min =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{max =} \DecValTok{5}\NormalTok{) }\FunctionTok{pmax}\NormalTok{(}\FunctionTok{pmin}\NormalTok{(x, max), min)}
\end{Highlighting}
\end{Shaded}

\paragraph{\texorpdfstring{Functions to calculate \emph{(Root) Mean Squared Error}}{Functions to calculate (Root) Mean Squared Error}}\label{functions-to-calculate-root-mean-squared-error}

\hfill\break

We will need the following functions to calculate \emph{(R)MSEs}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mse }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(r) }\FunctionTok{mean}\NormalTok{(r}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}

\NormalTok{mse\_cv }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(r\_list) \{}
\NormalTok{  mses }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(r\_list, }\FunctionTok{mse}\NormalTok{(r))}
  \FunctionTok{mean}\NormalTok{(mses)}
\NormalTok{\}}

\NormalTok{rmse }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(r) }\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mse}\NormalTok{(r))}
\CommentTok{\# rmse\_cv \textless{}{-} function(r\_list) sqrt(mse\_cv(r\_list))}

\NormalTok{rmse2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(true\_ratings, predicted\_ratings) \{}
  \FunctionTok{rmse}\NormalTok{(true\_ratings }\SpecialCharTok{{-}}\NormalTok{ predicted\_ratings)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{noteblock}
All the \emph{common helper functions}, including those described above, are defined in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R}{common-helper.functions.R} script on \emph{GitHub}.

\end{noteblock}

\newpage

\subsection{Overall Mean Rating (Naive) Model}\label{overall-mean-rating-naive-model}

\hfill\break

Let's begin our analysis by evaluating the simplest model described in \href{https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html\#a-first-model}{Section \emph{23.3 The First Model} of the \emph{Course Textbook}}, and then gradually refine it through further research.
It is about a model that assumes the same rating for all movies and users with all the differences explained by random variation would look as follows:

\[
Y_{i,j} = \mu + \varepsilon_{i,j}
\]

with \(\varepsilon_{i,j}\) independent errors sampled from the same distribution centered at 0 and \(\mu\) the \emph{true} rating for all movies.

We know that the estimate that minimizes the RMSE is the least squares estimate of \(\mu\) and, in this case, is the average of all ratings:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mu }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(edx}\SpecialCharTok{$}\NormalTok{rating)}
\FunctionTok{print}\NormalTok{(mu)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3.512465
\end{verbatim}

If we predict all unknown ratings with \(\hat{\mu}\), we obtain the following RMSE:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mu.MSEs }\OtherTok{\textless{}{-}} \FunctionTok{naive\_model\_MSEs}\NormalTok{(mu)}
\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{fold\_No =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\AttributeTok{MSE =}\NormalTok{ mu.MSEs) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{data.plot}\NormalTok{(}\AttributeTok{title =} \StringTok{"MSE resuls of the 5{-}fold CV method applied to the Overall Mean Rating Model"}\NormalTok{,}
              \AttributeTok{xname =} \StringTok{"fold\_No"}\NormalTok{, }
              \AttributeTok{yname =} \StringTok{"MSE"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-95-1.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mu.RMSE }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mean}\NormalTok{(mu.MSEs))}
\NormalTok{mu.RMSE}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.060346
\end{verbatim}

\begin{noteblock}
For the \emph{Mean Squared Error} data visualization we used \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L592}{data.plot} function{]} defined in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L447}{Data Visualization} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R}{data.helper.function.R} script.

\end{noteblock}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data.plot }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data, }
\NormalTok{                      title, }
\NormalTok{                      xname, }
\NormalTok{                      yname, }
                      \AttributeTok{xlabel =} \ConstantTok{NULL}\NormalTok{, }
                      \AttributeTok{ylabel =} \ConstantTok{NULL}\NormalTok{,}
                      \AttributeTok{line\_col =} \StringTok{"blue"}\NormalTok{,}
                      \CommentTok{\# scale = 1,}
                      \AttributeTok{normalize =} \ConstantTok{FALSE}\NormalTok{) \{}
\NormalTok{  y }\OtherTok{\textless{}{-}}\NormalTok{ data[, yname]}
  
  \ControlFlowTok{if}\NormalTok{ (normalize) \{}
\NormalTok{    y }\OtherTok{\textless{}{-}}\NormalTok{ y }\SpecialCharTok{{-}} \FunctionTok{min}\NormalTok{(y)}
\NormalTok{  \}}
  
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(xlabel)) \{}
\NormalTok{    xlabel }\OtherTok{=}\NormalTok{ xname}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(ylabel)) \{}
\NormalTok{    ylabel }\OtherTok{=}\NormalTok{ yname}
\NormalTok{  \}}
  
\NormalTok{  aes\_mapping }\OtherTok{\textless{}{-}} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ data[, xname], }\AttributeTok{y =}\NormalTok{ y)}
  
\NormalTok{  data }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{mapping =}\NormalTok{ aes\_mapping) }\SpecialCharTok{+}
    \FunctionTok{ggtitle}\NormalTok{(title) }\SpecialCharTok{+}
    \FunctionTok{xlab}\NormalTok{(xlabel) }\SpecialCharTok{+}
    \FunctionTok{ylab}\NormalTok{(ylabel) }\SpecialCharTok{+}
    \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
    \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{color=}\NormalTok{line\_col)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Here we also used \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L54}{naive\_model\_MSEs} function defined in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R}{common-helper.functions.R} script (already mentioned above) to compute \emph{Mean Squared Errors} using \emph{5-Fold Cross Validation} method:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{naive\_model\_MSEs }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(val) \{}
  \FunctionTok{sapply}\NormalTok{(edx\_CV, }\ControlFlowTok{function}\NormalTok{(cv\_item)\{}
    \FunctionTok{mse}\NormalTok{(cv\_item}\SpecialCharTok{$}\NormalTok{validation\_set}\SpecialCharTok{$}\NormalTok{rating }\SpecialCharTok{{-}}\NormalTok{ val)}
\NormalTok{  \})}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

One more function, defined in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R}{same script}, that we will need for further analysis of the current model, is the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L59}{naive\_model\_RMSE} one:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{naive\_model\_RMSE }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(val)\{}
  \FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mean}\NormalTok{(}\FunctionTok{naive\_model\_MSEs}\NormalTok{(val)))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\newpage

\subsubsection{\texorpdfstring{Ensure that \texttt{mu.RMSE} value is the best for the current model}{Ensure that mu.RMSE value is the best for the current model}}\label{ensure-that-mu.rmse-value-is-the-best-for-the-current-model}

\hfill\break

If we plug in any other number, we will get a higher RMSE. Let's prove that by the following small investigation:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  deviation }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{6}\NormalTok{, }\FloatTok{0.1}\NormalTok{) }\SpecialCharTok{{-}} \DecValTok{3}

\NormalTok{  deviation.RMSE }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(deviation, }\ControlFlowTok{function}\NormalTok{(delta)\{}
    \FunctionTok{naive\_model\_RMSE}\NormalTok{(mu }\SpecialCharTok{+}\NormalTok{ delta)}
\NormalTok{  \})}
\end{Highlighting}
\end{Shaded}

Let's make a quick investigation of the \texttt{deviation.RMSE} result we have just got:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{delta =}\NormalTok{ deviation, }
           \AttributeTok{delta.RMSE =}\NormalTok{ deviation.RMSE) }\SpecialCharTok{|\textgreater{}} 
\FunctionTok{data.plot}\NormalTok{(}\AttributeTok{title =} \FunctionTok{TeX}\NormalTok{(r}\StringTok{\textquotesingle{}[RMSE as a function of deviation ($\textbackslash{}delta$) from the Overall Mean Rating ($\textbackslash{}hat\{mu\}$)]\textquotesingle{}}\NormalTok{),}
              \AttributeTok{xname =} \StringTok{"delta"}\NormalTok{, }
              \AttributeTok{yname =} \StringTok{"delta.RMSE"}\NormalTok{, }
              \AttributeTok{xlabel =} \FunctionTok{TeX}\NormalTok{(r}\StringTok{\textquotesingle{}[$\textbackslash{}delta$]\textquotesingle{}}\NormalTok{), }
              \AttributeTok{ylabel =} \StringTok{"RMSE"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-100-1.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{which\_min\_deviation }\OtherTok{\textless{}{-}}\NormalTok{ deviation[}\FunctionTok{which.min}\NormalTok{(deviation.RMSE)]}
\NormalTok{min\_rmse }\OtherTok{=} \FunctionTok{min}\NormalTok{(deviation.RMSE)}

\FunctionTok{print\_log1}\NormalTok{(}\StringTok{"Minimum RMSE is achieved when the deviation from the mean is: \%1"}\NormalTok{,}
\NormalTok{         which\_min\_deviation)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Minimum RMSE is achieved when the deviation from the mean is: 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print\_log1}\NormalTok{(}\StringTok{"Is the previously computed RMSE the best for the current model: \%1"}\NormalTok{,}
\NormalTok{         mu.RMSE }\SpecialCharTok{==}\NormalTok{ min\_rmse)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Is the previously computed RMSE the best for the current model: TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{RMSEs.ResultTibble.OMR }\OtherTok{\textless{}{-}}\NormalTok{ RMSEs.ResultTibble }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{RMSEs.AddRow}\NormalTok{(}\StringTok{"Overall Mean Rating Model"}\NormalTok{, mu.RMSE)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{RMSE\_kable}\NormalTok{(RMSEs.ResultTibble.OMR)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{>{\raggedright\arraybackslash}p{20em}>{\centering\arraybackslash}p{5em}>{\raggedright\arraybackslash}p{20em}}
\toprule
\textbf{Method} & \textbf{RMSE} & \textbf{Comment}\\
\midrule
Project Objective & 0.864900 & \\
Overall Mean Rating Model & 1.060346 & \\
\bottomrule
\end{tabular}

To win the grand prize of \$1,000,000, a participating team had to get an RMSE of at least 0.8563\autocite{BigChaosSln}. So we can definitely do better!\autocite{IDS2_23-3}

\newpage

\subsection{User Effect Model}\label{user-effect-model}

\hfill\break

To improve our model let's now take into consideration user effects as explained in \href{https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html\#user-effects}{Section \emph{23.4 User effects}} of the \emph{Course Textbook}.
If we visualize the average rating for each user the way the \href{https://x.com/rafalab}{the author} shows, we can see that there is substantial variability in the average ratings across users:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{hist}\NormalTok{(edx.user\_mean\_ratings}\SpecialCharTok{$}\NormalTok{mean\_rating, }\AttributeTok{nclass =} \DecValTok{30}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-112-1.pdf}}

Following the author's further explanation, to account for this variability, we will use a linear model with a \emph{treatment effect} \(\alpha_i\) for each user. The sum \(\mu+\alpha_i\) can be interpreted as the typical rating user \(i\) gives to movies. So we write the model as follows:

\[
Y_{i,j} = \mu + \alpha_i + \varepsilon_{i,j}
\]

Statistics textbooks refer to the \(\alpha\)s as treatment effects. In the Netflix challenge papers, they refer to them as \emph{bias}\autocite{IDS2_23-4,MFT_RS}.

As it is stated here\autocite{IDS2_23-4}, it can be shown that the least squares estimate \(\hat{\alpha}_i\) is just the average of \(y_{i,j} - \hat{\mu}\) for each user \(i\). So we can compute them this way:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{rowMeans}\NormalTok{(y }\SpecialCharTok{{-}}\NormalTok{ mu, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

These considerations alows us to compute a \emph{User Mean Ratings} the following way:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{put\_log}\NormalTok{(}\StringTok{"Computing Average Ratings per User (User Mean Ratings)..."}\NormalTok{)}
\NormalTok{user.mean\_ratings }\OtherTok{\textless{}{-}} \FunctionTok{rowMeans}\NormalTok{(edx.mx, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{user\_ratings.n }\OtherTok{\textless{}{-}} \FunctionTok{rowSums}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(edx.mx))}
  
\NormalTok{edx.user\_mean\_ratings }\OtherTok{\textless{}{-}} 
  \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{userId =} \FunctionTok{names}\NormalTok{(user.mean\_ratings), }
             \AttributeTok{mean\_rating =}\NormalTok{ user.mean\_ratings,}
             \AttributeTok{n =}\NormalTok{ user\_ratings.n)}
  
\FunctionTok{put\_log}\NormalTok{(}\StringTok{"User Mean Ratings have been computed."}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(edx.user\_mean\_ratings)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    69878 obs. of  3 variables:
##  $ userId     : chr  "1" "2" "3" "4" ...
##  $ mean_rating: num  5 3.29 3.94 4.06 3.92 ...
##  $ n          : num  19 17 31 35 74 39 96 727 21 112 ...
\end{verbatim}

And then we compute a \emph{User Effect} this way:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{put\_log}\NormalTok{(}\StringTok{"Computing User Effect per users ..."}\NormalTok{)}
\NormalTok{edx.user\_effect }\OtherTok{\textless{}{-}}\NormalTok{ edx.user\_mean\_ratings }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{userId =} \FunctionTok{as.integer}\NormalTok{(userId),}
         \AttributeTok{a =}\NormalTok{ mean\_rating }\SpecialCharTok{{-}}\NormalTok{ mu)}

\FunctionTok{put\_log}\NormalTok{(}\StringTok{"A User Effect Model has been builded"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{par}\NormalTok{(}\AttributeTok{cex =} \FloatTok{0.7}\NormalTok{)}
\FunctionTok{hist}\NormalTok{(edx.user\_effect}\SpecialCharTok{$}\NormalTok{a, }\DecValTok{30}\NormalTok{, }\AttributeTok{xlab =} \FunctionTok{TeX}\NormalTok{(r}\StringTok{\textquotesingle{}[$\textbackslash{}hat\{alpha\}\_\{i\}$]\textquotesingle{}}\NormalTok{),}
     \AttributeTok{main =} \FunctionTok{TeX}\NormalTok{(r}\StringTok{\textquotesingle{}[Histogram of $\textbackslash{}hat\{alpha\}\_\{i\}$]\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-117-1.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(edx.user\_effect)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    69878 obs. of  4 variables:
##  $ userId     : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ mean_rating: num  5 3.29 3.94 4.06 3.92 ...
##  $ n          : num  19 17 31 35 74 39 96 727 21 112 ...
##  $ a          : num  1.488 -0.218 0.423 0.545 0.406 ...
\end{verbatim}

\begin{noteblock}
The full source code of the \emph{User Effect} computation is available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R\#L531}{Model building: User Effect} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R}{capstone-movielens.main.R} script on \emph{GitHub}.

\end{noteblock}

Finally, we are ready to compute the \texttt{RMSE} (additionally using the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L4}{clamp} helper function we defined above to keep predictions in the proper range):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{put\_log}\NormalTok{(}\StringTok{"Computing the RMSE taking into account user effects..."}\NormalTok{)}
\NormalTok{start }\OtherTok{\textless{}{-}} \FunctionTok{put\_start\_date}\NormalTok{()}
\NormalTok{edx.user\_effect.MSEs }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(edx\_CV, }\ControlFlowTok{function}\NormalTok{(cv\_fold\_dat)\{}
\NormalTok{  cv\_fold\_dat}\SpecialCharTok{$}\NormalTok{validation\_set }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{left\_join}\NormalTok{(edx.user\_effect, }\AttributeTok{by =} \StringTok{"userId"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{resid =}\NormalTok{ rating }\SpecialCharTok{{-}} \FunctionTok{clamp}\NormalTok{(mu }\SpecialCharTok{+}\NormalTok{ a)) }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{pull}\NormalTok{(resid) }\SpecialCharTok{|\textgreater{}} \FunctionTok{mse}\NormalTok{()}
\NormalTok{\})}
\FunctionTok{put\_end\_date}\NormalTok{(start)}

\NormalTok{edx.user\_effect.RMSE }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mean}\NormalTok{(edx.user\_effect.MSEs))}

\NormalTok{RMSEs.ResultTibble.UE }\OtherTok{\textless{}{-}}\NormalTok{ RMSEs.ResultTibble.OMR }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{RMSEs.AddRow}\NormalTok{(}\StringTok{"User Effect Model"}\NormalTok{, edx.user\_effect.RMSE)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{fold\_No =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\AttributeTok{MSE =}\NormalTok{ edx.user\_effect.MSEs) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{data.plot}\NormalTok{(}\AttributeTok{title =} \StringTok{"MSE resuls of the 5{-}fold CV method applied to the User Effect Model"}\NormalTok{,}
            \AttributeTok{xname =} \StringTok{"fold\_No"}\NormalTok{, }
            \AttributeTok{yname =} \StringTok{"MSE"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-119-1.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{RMSE\_kable}\NormalTok{(RMSEs.ResultTibble.UE)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{>{\raggedright\arraybackslash}p{20em}>{\centering\arraybackslash}p{5em}>{\raggedright\arraybackslash}p{20em}}
\toprule
\textbf{Method} & \textbf{RMSE} & \textbf{Comment}\\
\midrule
Project Objective & 0.8649000 & \\
Overall Mean Rating Model & 1.0603462 & \\
User Effect Model & 0.9697962 & \\
\bottomrule
\end{tabular}

\begin{noteblock}
The full source code of the \emph{User Effect Model RMSE} computation is available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R\#L655}{Compute RMSE for User Effect Model} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R}{capstone-movielens.main.R} script on \emph{GitHub}.

\end{noteblock}

\newpage

\subsection{User+Movie Effect (UME) Model}\label{usermovie-effect-ume-model}

\hfill\break

In \href{https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html\#movie-effects}{23.5 Movie effects} section of the \emph{Course Textbook} the author draws our attention to the fact that some movies are generally rated higher than others. He also explains that a linear model with a \emph{treatment effect} \(\beta_j\) for each movie can be used in this case, which can be interpreted as movie effect or the difference between the average ranking for movie \(j\) and the overall average \(\mu\):

\[
Y_{i,j} = \mu + \alpha_i + \beta_j +\varepsilon_{i,j}
\]
The author then shows how to use an approximation by first computing the least square estimate \(\hat{\mu}\) and \(\hat{\alpha}_i\), and then estimating \(\hat{\beta}_j\) as the average of the residuals \(y_{i,j} - \hat{\mu} - \hat{\alpha}_i\):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b }\OtherTok{\textless{}{-}} \FunctionTok{colMeans}\NormalTok{(y }\SpecialCharTok{{-}}\NormalTok{ mu }\SpecialCharTok{{-}}\NormalTok{ a, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Inspired by this idea, a few support functions were developed by the author of this report, which we will use for our further analysis.

\subsubsection{UME Model: Support Functions}\label{ume-model-support-functions}

\hfill\break

\begin{noteblock}
The complete source code of the functions described in this section is available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L1}{UME Model Support Functions} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R}{UM-effect.functions.R} script on \emph{GitHub}.

\end{noteblock}

\paragraph{\texorpdfstring{\href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L2}{train\_user\_movie\_effect} Function}{train\_user\_movie\_effect Function}}\label{func.train_user_movie_effect}

\hfill\break

We use this function to build and train our model using the \texttt{train\_set} dataset:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{train\_user\_movie\_effect }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(train\_set, }\AttributeTok{lambda =} \DecValTok{0}\NormalTok{)\{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.na}\NormalTok{(lambda)) \{}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"Function: train\_user\_movie\_effect}
\StringTok{\textasciigrave{}lambda\textasciigrave{} is \textasciigrave{}NA\textasciigrave{}"}\NormalTok{)}
\NormalTok{  \}}

\NormalTok{  UM.effect }\OtherTok{\textless{}{-}}\NormalTok{ train\_set }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{left\_join}\NormalTok{(edx.user\_effect, }\AttributeTok{by =} \StringTok{"userId"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{resid =}\NormalTok{ rating }\SpecialCharTok{{-}}\NormalTok{ (mu }\SpecialCharTok{+}\NormalTok{ a)) }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{group\_by}\NormalTok{(movieId) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{summarise}\NormalTok{(}\AttributeTok{b =} \FunctionTok{mean\_reg}\NormalTok{(resid, lambda), }\AttributeTok{n =} \FunctionTok{n}\NormalTok{())}
  
  \FunctionTok{stopifnot}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(}\FunctionTok{mean}\NormalTok{(UM.effect}\SpecialCharTok{$}\NormalTok{b)))}
\NormalTok{  UM.effect}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{noteblock}
The function described above accepts the \texttt{lambda} parameter, which we will need later for the \emph{Model Regularization} method. We also use the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L63}{mean\_reg} function call, which we will also need later for the \emph{Regularization} techniques (for details, see the \hyperref[func.mean_reg]{mean\_reg} function description in the Section \hyperref[appndx_a.rglr.common_helper.functions]{Regularization: Common Helper Functions} section of the \hyperref[appndx_a]{Appendix} to this report).
We will explain that later in the \hyperref[usermovie-effect-model-regularization]{User+Movie Effect Model Regularization} section.
For now, we omit the \texttt{lambda} parameter, accepting its default value \texttt{lambda\ =\ 0}. In this case, the \hyperref[func.mean_reg]{mean\_reg} function is equivalent to the standard R function \href{https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/mean}{base::mean}.

\end{noteblock}

\paragraph{\texorpdfstring{\texttt{train\_user\_movie\_effect.cv} Function}{train\_user\_movie\_effect.cv Function}}\label{func.train_user_movie_effect.cv}

\hfill\break

We use the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L17}{train\_user\_movie\_effect.cv} function to build and train our model using the \texttt{5-Fold\ Cross\ Validation} method. Below, we provide the most important part of the code of that function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{train\_user\_movie\_effect.cv }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{lambda =} \DecValTok{0}\NormalTok{)\{}
\CommentTok{\# ...}
\NormalTok{  start }\OtherTok{\textless{}{-}} \FunctionTok{put\_start\_date}\NormalTok{()}
\NormalTok{  user\_movie\_effects\_ls }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(edx\_CV, }\ControlFlowTok{function}\NormalTok{(cv\_fold\_dat)\{}
\NormalTok{    cv\_fold\_dat}\SpecialCharTok{$}\NormalTok{train\_set }\SpecialCharTok{|\textgreater{}} \FunctionTok{train\_user\_movie\_effect}\NormalTok{(lambda)}
\NormalTok{  \})}
  \FunctionTok{put\_end\_date}\NormalTok{(start)}
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: train\_user\_movie\_effect.cv:}
\StringTok{User+Movie Effect list have been computed"}\NormalTok{)}
  
\NormalTok{  user\_movie\_effects\_united }\OtherTok{\textless{}{-}} \FunctionTok{union\_cv\_results}\NormalTok{(user\_movie\_effects\_ls)}

\NormalTok{  user\_movie\_effect }\OtherTok{\textless{}{-}}\NormalTok{ user\_movie\_effects\_united }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{group\_by}\NormalTok{(movieId) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{summarise}\NormalTok{(}\AttributeTok{b =} \FunctionTok{mean}\NormalTok{(b), }\AttributeTok{n =} \FunctionTok{mean}\NormalTok{(n))}
  \CommentTok{\# ...}
\NormalTok{  user\_movie\_effect}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{noteblock}
Here we use the function call \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L432}{union\_cv\_results}, which is defined in the script \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R}{common-helper.functions.R}, to aggregate the \emph{5-Fold Cross Validation} method results (for details, see the \hyperref[func.union_cv_results]{union\_cv\_results} function description in the \hyperref[appndx_a.data_helper.functions]{Data Helper Functions} section of the \hyperref[appndx_a]{Appendix} to this report).

\end{noteblock}

\paragraph{\texorpdfstring{\texttt{calc\_user\_movie\_effect\_MSE} Function}{calc\_user\_movie\_effect\_MSE Function}}\label{calc_user_movie_effect_mse-function}

\hfill\break

The source code of the function \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L55}{calc\_user\_movie\_effect\_MSE} defined in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R}{UM-effect.functions.R} script to calculate the \emph{Mean Squared Error (MSE)} of the \emph{UME Model} for the given \texttt{Test\ Set} is provided below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calc\_user\_movie\_effect\_MSE }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(test\_set, um\_effect)\{}
\NormalTok{  mse.result }\OtherTok{\textless{}{-}}\NormalTok{ test\_set }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{left\_join}\NormalTok{(edx.user\_effect, }\AttributeTok{by =} \StringTok{"userId"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{left\_join}\NormalTok{(um\_effect, }\AttributeTok{by =} \StringTok{"movieId"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{resid =}\NormalTok{ rating }\SpecialCharTok{{-}} \FunctionTok{clamp}\NormalTok{(mu }\SpecialCharTok{+}\NormalTok{ a }\SpecialCharTok{+}\NormalTok{ b)) }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{pull}\NormalTok{(resid) }\SpecialCharTok{|\textgreater{}} \FunctionTok{mse}\NormalTok{()}
  
  \FunctionTok{stopifnot}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(mse.result))}
\NormalTok{  mse.result}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\paragraph{\texorpdfstring{\texttt{calc\_user\_movie\_effect\_MSE.cv} Function}{calc\_user\_movie\_effect\_MSE.cv Function}}\label{calc_user_movie_effect_mse.cv-function}

\hfill\break

The source code of the function \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L72}{calc\_user\_movie\_effect\_MSE.cv} defined in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R}{UM-effect.functions.R} script to calculate the \emph{5-Fold Cross Validation} \textbf{MSE}\_ result of the \emph{UME Model} is provided below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calc\_user\_movie\_effect\_MSE.cv }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(um\_effect)\{}
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function: user\_movie\_effects\_MSE.cv:}
\StringTok{Computing the RMSE taking into account User+Movie Effects..."}\NormalTok{)}
\NormalTok{  start }\OtherTok{\textless{}{-}} \FunctionTok{put\_start\_date}\NormalTok{()}
\NormalTok{  user\_movie\_effects\_MSEs }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(edx\_CV, }\ControlFlowTok{function}\NormalTok{(cv\_fold\_dat)\{}
\NormalTok{    cv\_fold\_dat}\SpecialCharTok{$}\NormalTok{validation\_set }\SpecialCharTok{|\textgreater{}} \FunctionTok{calc\_user\_movie\_effect\_MSE}\NormalTok{(um\_effect)}
\NormalTok{  \})}
  \FunctionTok{put\_end\_date}\NormalTok{(start)}
  
  \FunctionTok{put\_log1}\NormalTok{(}\StringTok{"Function: user\_movie\_effects\_MSE.cv:}
\StringTok{MSE values have been plotted for the \%1{-}Fold Cross Validation samples."}\NormalTok{, }
\NormalTok{           CVFolds\_N)}
  
  \FunctionTok{mean}\NormalTok{(user\_movie\_effects\_MSEs)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\paragraph{\texorpdfstring{\texttt{calc\_user\_movie\_effect\_RMSE} Function}{calc\_user\_movie\_effect\_RMSE Function}}\label{calc_user_movie_effect_rmse-function}

\hfill\break

The source code of the function \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L51}{calc\_user\_movie\_effect\_RMSE} defined in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R}{UM-effect.functions.R} script to calculate the \texttt{Root\ Mean\ Squared\ Error\ (RMSE)} of the \texttt{UME\ Model} for the given \texttt{Test\ Set} is provided below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calc\_user\_movie\_effect\_RMSE }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(test\_set, um\_effect)\{}
\NormalTok{  mse }\OtherTok{\textless{}{-}}\NormalTok{ test\_set }\SpecialCharTok{|\textgreater{}} \FunctionTok{calc\_user\_movie\_effect\_MSE}\NormalTok{(um\_effect)}
  \FunctionTok{sqrt}\NormalTok{(mse)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\paragraph{\texorpdfstring{\texttt{calc\_user\_movie\_effect\_RMSE.cv} Function}{calc\_user\_movie\_effect\_RMSE.cv Function}}\label{func.calc_user_movie_effect_RMSE.cv}

\hfill\break

The source code of the function \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L65}{calc\_user\_movie\_effect\_RMSE.cv} defined in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R}{UM-effect.functions.R} script to calculate the \texttt{5-Fold\ Cross\ Validation} RMSE result of the \texttt{UME\ Model} is provided below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calc\_user\_movie\_effect\_RMSE.cv }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(um\_effect)\{}
\NormalTok{  user\_movie\_effects\_MSE }\OtherTok{\textless{}{-}} \FunctionTok{calc\_user\_movie\_effect\_MSE.cv}\NormalTok{(um\_effect)}
\NormalTok{  um\_effect\_RMSE }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{(user\_movie\_effects\_MSE)}
  \FunctionTok{put\_log2}\NormalTok{(}\StringTok{"Function: user\_movie\_effects\_RMSE.cv:}
\StringTok{\%1{-}Fold Cross Validation ultimate RMSE: \%2"}\NormalTok{, CVFolds\_N, um\_effect\_RMSE)}
\NormalTok{  um\_effect\_RMSE}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\newpage

\subsubsection{UME Model Building}\label{ume-model-building}

\hfill\break

\begin{noteblock}
The complete source code of builing and training the current model is available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R\#L721}{Model building: User+Movie Effect} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R}{capstone-movielens.main.R} script on \emph{GitHub}.

\end{noteblock}

Below, we provide the most significant part of the code for training our model using the \texttt{5-Fold\ Cross\ Validation} method:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  cv.UM\_effect }\OtherTok{\textless{}{-}} \FunctionTok{train\_user\_movie\_effect.cv}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(cv.UM\_effect)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## tibble [10,677 x 3] (S3: tbl_df/tbl/data.frame)
##  $ movieId: int [1:10677] 1 2 3 4 5 6 7 8 9 10 ...
##  $ b      : num [1:10677] 0.335 -0.306 -0.365 -0.598 -0.444 ...
##  $ n      : num [1:10677] 18907 8593 5574 1253 5065 ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{par}\NormalTok{(}\AttributeTok{cex =} \FloatTok{0.7}\NormalTok{)}
\FunctionTok{hist}\NormalTok{(cv.UM\_effect}\SpecialCharTok{$}\NormalTok{b, }\DecValTok{30}\NormalTok{, }\AttributeTok{xlab =} \FunctionTok{TeX}\NormalTok{(r}\StringTok{\textquotesingle{}[$\textbackslash{}hat\{beta\}\_\{j\}$)]\textquotesingle{}}\NormalTok{),}
     \AttributeTok{main =} \FunctionTok{TeX}\NormalTok{(r}\StringTok{\textquotesingle{}[Histogram of $\textbackslash{}hat\{beta\}\_\{j\}$]\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-135-1.pdf}}

We can now construct predictors and see how much the \texttt{RMSE} improves\autocite{IDS2_23-5}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cv.UM\_effect.RMSE }\OtherTok{\textless{}{-}} \FunctionTok{calc\_user\_movie\_effect\_RMSE.cv}\NormalTok{(cv.UM\_effect)}

\NormalTok{RMSEs.ResultTibble.UME }\OtherTok{\textless{}{-}}\NormalTok{ RMSEs.ResultTibble.UE }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{RMSEs.AddRow}\NormalTok{(}\StringTok{"User+Movie Effect Model"}\NormalTok{, cv.UM\_effect.RMSE)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{RMSE\_kable}\NormalTok{(RMSEs.ResultTibble.UME)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{>{\raggedright\arraybackslash}p{20em}>{\centering\arraybackslash}p{5em}>{\raggedright\arraybackslash}p{20em}}
\toprule
\textbf{Method} & \textbf{RMSE} & \textbf{Comment}\\
\midrule
Project Objective & 0.8649000 & \\
Overall Mean Rating Model & 1.0603462 & \\
User Effect Model & 0.9697962 & \\
User+Movie Effect Model & 0.8732081 & \\
\bottomrule
\end{tabular}

\subsubsection{User+Movie Effect Model Regularization}\label{usermovie-effect-model-regularization}

\hfill\break

\paragraph{Utilizing Penalized least squares}\label{utilizing-penalized-least-squares}

\hfill\break

\href{https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html\#penalized-least-squares}{Section \emph{23.6 Penalized least squares} of the \emph{Course Textbook}} explains why and how we should use \emph{Penalized least squares} to improve our predictions. The author also explains that the general idea of penalized regression is to control the total variability of the movie effects:
\[
\sum_{j=1}^{n} \beta_j^2
\]
Specifically, instead of minimizing the least squares equation, we minimize an equation that adds a penalty:
\[ 
\sum_{i,j} \left(y_{u,i} - \mu - \alpha_i - \beta_j \right)^2 + \lambda \sum_{j} \beta_j^2
\]
The first term is just the sum of squares and the second is a penalty that gets larger when many \(\beta_i\)s are large. Using calculus, we can actually show that the values of \(\beta_i\) that minimize this equation are:
\[
\hat{\beta}_j(\lambda) = \frac{1}{\lambda + n_j} \sum_{i=1}^{n_i} \left(Y_{i,j} - \mu - \alpha_i\right)
\]
where \(n_j\) is the number of ratings made for movie \(j\).

This approach will have our desired effect: when our sample size \(n_j\) is very large, we obtain a stable estimate and the penalty \(\lambda\) is effectively ignored since \(n_j+\lambda \approx n_j\). Yet when the \(n_j\) is small, then the estimate \(\hat{\beta}_i(\lambda)\) is shrunken towards 0. The larger the \(\lambda\), the more we shrink\autocite{IDS2_23-6}.

We will implement the \emph{Regularization} method on our models (starting from the current model) in two steps:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \textbf{Pre-configuration:} Preliminary determination of the optimal range of \(\lambda\) values for the \texttt{5-Fold\ Cross\ Validation} samples;
\item
  \textbf{Fine-tuning:} figuring out the value of \(\lambda\) that minimizes the model's RMSE.
\item
  \textbf{Retraining:} retraining the model with the best value of the parameter \(\lambda\) obtained in the previous step.
\end{enumerate}

\newpage

\paragraph{UME Model Regularization: Support Functions}\label{ume-model-regularization-support-functions}

\hfill\break

\begin{noteblock}
The \href{}{regularize.test\_lambda.UM\_effect.cv} function described below are defined in the \href{}{Regularization} section of the \href{}{UM-effect.functions.R} script.

\end{noteblock}

\subparagraph{\texorpdfstring{\href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L96}{regularize.test\_lambda.UM\_effect.cv} Function}{regularize.test\_lambda.UM\_effect.cv Function}}\label{func.regularize.test_lambda.UM_effect.cv}

\hfill\break

This function calculates \emph{RMSE} of the \emph{UME Model} using \emph{5-Fold Cross Validation} method for the given \(\lambda\) parameter value:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{regularize.test\_lambda.UM\_effect.cv }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(lambda)\{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.na}\NormalTok{(lambda)) \{}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"Function: regularize.test\_lambda.UM\_effect.cv}
\StringTok{\textasciigrave{}lambda\textasciigrave{} is \textasciigrave{}NA\textasciigrave{}"}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{  um\_effect }\OtherTok{\textless{}{-}} \FunctionTok{train\_user\_movie\_effect.cv}\NormalTok{(lambda)}
  \FunctionTok{calc\_user\_movie\_effect\_RMSE.cv}\NormalTok{(um\_effect)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{noteblock}
Note that we reuse the function \hyperref[func.train_user_movie_effect.cv]{train\_user\_movie\_effect.cv} calling it from the \hyperref[func.regularize.test_lambda.UM_effect.cv]{regularize.test\_lambda.UM\_effect.cv}, but now with the \(\lambda\) parameter different from the default (`lambda = 0') value.

\end{noteblock}

\newpage

\paragraph{UME Model Regularization: Pre-configuratioin}\label{ume-model-regularization-pre-configuratioin}

\hfill\break

Let's perform the preconfiguration to determine the appropriate range of \(\lambda\) for subsequent fine-tuning of our current model:

We are going to use the \hyperref[func.tune.model_param]{tune.model\_param} function described in the \hyperref[appndx_a.rglr.common_helper.functions]{Regularization: Common Helper Functions} section of the \hyperref[appndx_a]{Appendix} to this report, passing the \hyperref[func.regularize.test_lambda.UM_effect.cv]{regularize.test\_lambda.UM\_effect.cv} function as the value of the \hyperref[func.tune.model_param.params.fn_tune.test.param_value]{fn\_tune.test.param\_value} parameter:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lambdas }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.1}\NormalTok{)}

\NormalTok{cv.UME.preset.result }\OtherTok{\textless{}{-}} 
  \FunctionTok{tune.model\_param}\NormalTok{(lambdas, regularize.test\_lambda.UM\_effect.cv)}

\FunctionTok{put\_log1}\NormalTok{(}\StringTok{"Preliminary regularization set{-}up of \textasciigrave{}lambda\textasciigrave{}s range for the UME Model has been completed}
\StringTok{for the \%1{-}Fold Cross Validation samples."}\NormalTok{,}
\NormalTok{CVFolds\_N)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(cv.UME.preset.result)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## List of 2
##  $ tuned.result:'data.frame':    8 obs. of  2 variables:
##   ..$ RMSE           : num [1:8] 0.873 0.873 0.873 0.873 0.873 ...
##   ..$ parameter.value: num [1:8] 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7
##  $ best_result : Named num [1:2] 0.4 0.873
##   ..- attr(*, "names")= chr [1:2] "param.best_value" "best_RMSE"
\end{verbatim}

\begin{noteblock}
The complete version of the source code provided in this section can be found in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R\#L814}{Process Preliminary setting-up of lambda range for UM Effect regularization} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R}{capstone-movielens.main.R} script.

\end{noteblock}

Now, let's visualize the results of the \(\lambda\) range preconfiguration:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cv.UME.preset.result}\SpecialCharTok{$}\NormalTok{tuned.result }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{data.plot}\NormalTok{(}\AttributeTok{title =} \FunctionTok{TeX}\NormalTok{(r}\StringTok{\textquotesingle{}[Preliminary set{-}up of $\textbackslash{}lambda$ for Regularazation of the User+Movie Effect Model.]\textquotesingle{}}\NormalTok{),}
              \AttributeTok{xname =} \StringTok{"parameter.value"}\NormalTok{, }
              \AttributeTok{yname =} \StringTok{"RMSE"}\NormalTok{, }
              \AttributeTok{xlabel =} \FunctionTok{TeX}\NormalTok{(r}\StringTok{\textquotesingle{}[$\textbackslash{}lambda$]\textquotesingle{}}\NormalTok{), }
              \AttributeTok{ylabel =} \StringTok{"RMSE"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-141-1.pdf}}

\begin{noteblock}
We use the custom data visualization function \hyperref[func.data.plot]{data.plot} described in the \hyperref[appndx_a.data_helper.functions]{Data Helper Functions} section of the \hyperref[appndx_a]{Appendix} to this report, which is defined in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L447}{Data Visualization} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L592}{data.helper.functions.R} script on \emph{GitHub}.

\end{noteblock}

\newpage

\paragraph{UME Model Regularization: Fine-tuning}\label{ume-model-regularization-fine-tuning}

\hfill\break

We are now ready to perform the fine-tuning step of our model \emph{regularization} process to determine the best value for the \(\lambda\) parameter.

Here we are going to use the \hyperref[func.model.tune.param_range]{model.tune.param\_range} function described in the \hyperref[appndx_a.rglr.common_helper.functions]{Regularization: Common Helper Functions} section of the \hyperref[appndx_a]{Appendix} to this report, passing the \hyperref[func.regularize.test_lambda.UM_effect.cv]{regularize.test\_lambda.UM\_effect.cv} function as the value of the \hyperref[func.model.tune.param_range.params.fn_tune.test.param_value]{fn\_tune.test.param\_value} parameter:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{endpoints }\OtherTok{\textless{}{-}} 
  \FunctionTok{get\_fine\_tune.param.endpoints}\NormalTok{(cv.UME.preset.result}\SpecialCharTok{$}\NormalTok{tuned.result)}

\NormalTok{UM\_effect.loop\_starter }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(endpoints[}\StringTok{"start"}\NormalTok{], }
\NormalTok{                            endpoints[}\StringTok{"end"}\NormalTok{], }
                            \DecValTok{8}\NormalTok{)}
\NormalTok{UM\_effect.loop\_starter}
\CommentTok{\#\textgreater{} [1] 0.3 0.5 8.0}

\NormalTok{UME.rglr.fine\_tune.cache.base\_name }\OtherTok{\textless{}{-}} \StringTok{"UME.rglr.fine{-}tune"}

\NormalTok{UME.rglr.fine\_tune.results }\OtherTok{\textless{}{-}} 
  \FunctionTok{model.tune.param\_range}\NormalTok{(UM\_effect.loop\_starter,}
\NormalTok{                         UME.rglr.fine\_tune.cache.path,}
\NormalTok{                         UME.rglr.fine\_tune.cache.base\_name,}
\NormalTok{                         regularize.test\_lambda.UM\_effect.cv)}
                         \CommentTok{\#endpoint.min\_diff = 1e{-}07/4)}

\NormalTok{UME.rglr.fine\_tune.RMSE.best }\OtherTok{\textless{}{-}}\NormalTok{ UME.rglr.fine\_tune.results}\SpecialCharTok{$}\NormalTok{best\_result[}\StringTok{"best\_RMSE"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## *** Fine-tuning results object data structure ***
\end{verbatim}

\begin{verbatim}
## List of 3
##  $ best_result           : Named num [1:2] 0.387 0.873
##   ..- attr(*, "names")= chr [1:2] "param.best_value" "best_RMSE"
##  $ param_values.endpoints: Named num [1:3] 3.87e-01 3.87e-01 9.54e-07
##   ..- attr(*, "names")= chr [1:3] "" "" ""
##  $ tuned.result          :'data.frame':  9 obs. of  2 variables:
##   ..$ parameter.value: num [1:9] 0.387 0.387 0.387 0.387 0.387 ...
##   ..$ RMSE           : num [1:9] 0.873 0.873 0.873 0.873 0.873 ...
\end{verbatim}

\begin{verbatim}
## *** Fine-tuning: best results ***
\end{verbatim}

\begin{verbatim}
## param.best_value        best_RMSE 
##        0.3874500        0.8732057
\end{verbatim}

\begin{noteblock}
The complete version of the source code provided in this section can be also found in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R\#L867}{Fine-tuning Step of the Regularization Method for the User+Movie Model} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R}{capstone-movielens.main.R} script on \emph{GitHub}.

\end{noteblock}

Let's visualize the fine-tuning results:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{UME.rglr.fine\_tune.results}\SpecialCharTok{$}\NormalTok{tuned.result }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{data.plot}\NormalTok{(}\AttributeTok{title =} \StringTok{"Fine{-}tune Stage results of the Regularization Process for the User+Movie Model"}\NormalTok{,}
              \AttributeTok{xname =} \StringTok{"parameter.value"}\NormalTok{,}
              \AttributeTok{yname =} \StringTok{"RMSE"}\NormalTok{,}
              \AttributeTok{xlabel =} \FunctionTok{TeX}\NormalTok{(r}\StringTok{\textquotesingle{}[$\textbackslash{}lambda$]\textquotesingle{}}\NormalTok{),}
              \AttributeTok{ylabel =} \FunctionTok{str\_glue}\NormalTok{(}\StringTok{"Deviation from the best RMSE value ("}\NormalTok{,}
                                \FunctionTok{as.character}\NormalTok{(}\FunctionTok{round}\NormalTok{(UME.rglr.fine\_tune.RMSE.best, }\AttributeTok{digits =} \DecValTok{7}\NormalTok{)), }
                                \StringTok{")"}\NormalTok{),}
              \AttributeTok{normalize =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-144-1.pdf}}
\newpage

\paragraph{\texorpdfstring{UME Model Regularization: Retraining Model with the best \(\lambda\)}{UME Model Regularization: Retraining Model with the best \textbackslash lambda}}\label{ume-model-regularization-retraining-model-with-the-best-lambda}

\hfill\break

Now, we can calculate the \emph{Regularized User+Movie Effect} by retraining our model on the entire \texttt{edx} dataset with the best value of the \(\lambda\) parameter we just calculated, for the definitive \emph{Root Mean Squared Error} calculation and use in subsequent models.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  UME.rglr.best\_lambda }\OtherTok{\textless{}{-}}\NormalTok{ best\_result[}\StringTok{"param.best\_value"}\NormalTok{]}
\NormalTok{  UME.rglr.best\_lambda}

\NormalTok{  rglr.UM\_effect }\OtherTok{\textless{}{-}} \FunctionTok{train\_user\_movie\_effect}\NormalTok{(edx, UME.rglr.best\_lambda)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## *** The Best Fine-tuning Results ***
\end{verbatim}

\begin{verbatim}
## param.best_value        best_RMSE 
##        0.3874500        0.8732057
\end{verbatim}

\begin{verbatim}
## *** Regularized User+Movie Effect Structure ***
\end{verbatim}

\begin{verbatim}
## tibble [10,677 x 3] (S3: tbl_df/tbl/data.frame)
##  $ movieId: int [1:10677] 1 2 3 4 5 6 7 8 9 10 ...
##  $ b      : Named num [1:10677] 0.331 -0.305 -0.364 -0.599 -0.443 ...
##   ..- attr(*, "names")= chr [1:10677] "param.best_value" "param.best_value" "param.best_value" "param.best_value" ...
##  $ n      : int [1:10677] 23790 10779 7028 1577 6400 12346 7259 821 2278 15187 ...
\end{verbatim}

\begin{verbatim}
## Regularized User+Movie Effect Model has been re-trained for the best `lambda`: 0.38745002746582.
\end{verbatim}

\begin{noteblock}
The complete version of the source code provided in this section are available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R\#L910}{Re-training Regularized User+Movie Effect Model for the best \(\lambda\)} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R\#L910}{capstone-movielens.main.R} script on \emph{GitHub}.

\end{noteblock}

We calculate the \emph{Root Mean Squared Error} for the ultimately computed \emph{User+Movie Effect} using \hyperref[func.calc_user_movie_effect_RMSE.cv]{calc\_user\_movie\_effect\_RMSE.cv} function described above as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{UME.rglr.retrain.RMSE }\OtherTok{\textless{}{-}} \FunctionTok{calc\_user\_movie\_effect\_RMSE.cv}\NormalTok{(rglr.UM\_effect)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print\_log1}\NormalTok{(}\StringTok{"The best RMSE after being regularized: \%1"}\NormalTok{,}
\NormalTok{         UME.rglr.retrain.RMSE)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## The best RMSE after being regularized: 0.872972999076497
\end{verbatim}

Finally, we add the definitive result for the current model to our \emph{Result Table}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{RMSEs.ResultTibble.rglr.UME }\OtherTok{\textless{}{-}}\NormalTok{ RMSEs.ResultTibble.UME }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{RMSEs.AddRow}\NormalTok{(}\StringTok{"Regularized User+Movie Effect Model"}\NormalTok{, }
\NormalTok{               UME.rglr.retrain.RMSE,}
               \AttributeTok{comment =} \StringTok{"Computed for \textasciigrave{}lambda\textasciigrave{} = \%1"} \SpecialCharTok{|\textgreater{}}
                 \FunctionTok{msg.glue}\NormalTok{(UME.rglr.best\_lambda))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{RMSE\_kable}\NormalTok{(RMSEs.ResultTibble.rglr.UME)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{>{\raggedright\arraybackslash}p{20em}>{\centering\arraybackslash}p{5em}>{\raggedright\arraybackslash}p{20em}}
\toprule
\textbf{Method} & \textbf{RMSE} & \textbf{Comment}\\
\midrule
Project Objective & 0.8649000 & \\
Overall Mean Rating Model & 1.0603462 & \\
User Effect Model & 0.9697962 & \\
User+Movie Effect Model & 0.8732081 & \\
Regularized User+Movie Effect Model & 0.8729730 & Computed for `lambda` = 0.38745002746582\\
\bottomrule
\end{tabular}

\newpage

\subsection{User+Movie+Genre Effect (UMGE) Model}\label{usermoviegenre-effect-umge-model}

\hfill\break

As mentioned in \href{https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html\#exercises}{Section 23.7: Exercises} of the \emph{Chapter ``23 Regularization'' of the Course Textbook} the \texttt{Movielens} dataset also has a genres column. This column includes every genre that applies to the movie (some movies fall under several genres)\autocite{IDS2_23-7}.

To account for \emph{genre effects} we will use the model suggested in the \href{https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html\#exercises}{Section 23.7: Exercises} of the \emph{Chapter ``23 Regularization'' of the Course Textbook}\autocite{IDS2_23-7}:

\subsubsection{Genre Data Analysis}\label{genre-data-analysis}

\hfill\break

\paragraph{Movie Genres Data}\label{movie-genres-data}

\hfill\break

The following code computes movie rating summaries by popular genres like Drama, Comedy, Thriller, and Romance:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#library(stringr)}
\NormalTok{genres }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"Drama"}\NormalTok{, }\StringTok{"Comedy"}\NormalTok{, }\StringTok{"Thriller"}\NormalTok{, }\StringTok{"Romance"}\NormalTok{)}
\FunctionTok{sapply}\NormalTok{(genres, }\ControlFlowTok{function}\NormalTok{(g) \{}
  \FunctionTok{sum}\NormalTok{(}\FunctionTok{str\_detect}\NormalTok{(edx}\SpecialCharTok{$}\NormalTok{genres, g))}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Drama   Comedy Thriller  Romance 
##  3910127  3540930  2325899  1712100
\end{verbatim}

Further, we can find out the movies that have the greatest number of ratings using the following code:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ordered\_movie\_ratings }\OtherTok{\textless{}{-}}\NormalTok{ edx }\SpecialCharTok{|\textgreater{}} \FunctionTok{group\_by}\NormalTok{(movieId, title) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{number\_of\_ratings =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(number\_of\_ratings))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'movieId'. You can override using the `.groups` argument.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{head}\NormalTok{(ordered\_movie\_ratings))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 3
## # Groups:   movieId [6]
##   movieId title                            number_of_ratings
##     <int> <chr>                                        <int>
## 1     296 Pulp Fiction (1994)                          31362
## 2     356 Forrest Gump (1994)                          31079
## 3     593 Silence of the Lambs, The (1991)             30382
## 4     480 Jurassic Park (1993)                         29360
## 5     318 Shawshank Redemption, The (1994)             28015
## 6     110 Braveheart (1995)                            26212
\end{verbatim}

and figure out the most given ratings in order from most to least:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ratings }\OtherTok{\textless{}{-}}\NormalTok{ edx }\SpecialCharTok{|\textgreater{}}  \FunctionTok{group\_by}\NormalTok{(rating) }\SpecialCharTok{|\textgreater{}}
     \FunctionTok{summarise}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{|\textgreater{}}
     \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(count))}
\FunctionTok{print}\NormalTok{(ratings)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 2
##    rating   count
##     <dbl>   <int>
##  1    4   2588430
##  2    3   2121240
##  3    5   1390114
##  4    3.5  791624
##  5    2    711422
##  6    4.5  526736
##  7    1    345679
##  8    2.5  333010
##  9    1.5  106426
## 10    0.5   85374
\end{verbatim}

The following code allows us to summarize that in general, half-star ratings are less common than whole-star ratings (e.g., there are fewer ratings of 3.5 than there are ratings of 3 or 4, etc.):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{edx }\SpecialCharTok{|\textgreater{}} \FunctionTok{group\_by}\NormalTok{(rating) }\SpecialCharTok{|\textgreater{}} \FunctionTok{summarize}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

We can visually see that from the following plot:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{edx }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{group\_by}\NormalTok{(rating) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ rating, }\AttributeTok{y =}\NormalTok{ count)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-174-1.pdf}}

\paragraph{Movie Genres Effect}\label{movie-genres-effect}

\hfill\break

The plot below shows strong evidence of a genre effect (for illustrative purposes, the plot shows only categories with more than 20, 000 ratings).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Preparing data for plotting:}
\NormalTok{genre\_ratins\_grp }\OtherTok{\textless{}{-}}\NormalTok{ edx }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{genre\_categories =} \FunctionTok{as.factor}\NormalTok{(genres)) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{group\_by}\NormalTok{(genre\_categories) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{n =} \FunctionTok{n}\NormalTok{(), }\AttributeTok{rating\_avg =} \FunctionTok{mean}\NormalTok{(rating), }\AttributeTok{se =} \FunctionTok{sd}\NormalTok{(rating)}\SpecialCharTok{/}\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{n}\NormalTok{())) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{filter}\NormalTok{(n }\SpecialCharTok{\textgreater{}} \DecValTok{40000}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{genres =} \FunctionTok{reorder}\NormalTok{(genre\_categories, rating\_avg)) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{select}\NormalTok{(genres, rating\_avg, se, n)}

\FunctionTok{dim}\NormalTok{(genre\_ratins\_grp)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 42  4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{genre\_ratins\_grp\_sorted }\OtherTok{\textless{}{-}}\NormalTok{ genre\_ratins\_grp }\SpecialCharTok{|\textgreater{}} \FunctionTok{sort\_by.data.frame}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{ rating\_avg)}
\FunctionTok{print}\NormalTok{(genre\_ratins\_grp\_sorted)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 42 x 4
##    genres                  rating_avg      se      n
##    <fct>                        <dbl>   <dbl>  <int>
##  1 Horror                        2.88 0.00472  68738
##  2 Children|Comedy               2.92 0.00460  63483
##  3 Action|Comedy                 3.00 0.00480  51289
##  4 Comedy|Sci-Fi                 3.08 0.00526  44599
##  5 Horror|Thriller               3.12 0.00447  75000
##  6 Action|Adventure|Comedy       3.20 0.00498  45118
##  7 Comedy                        3.24 0.00133 700889
##  8 Action|Sci-Fi                 3.25 0.00561  49733
##  9 Action|Drama|Thriller         3.27 0.00492  45246
## 10 Action|Thriller               3.27 0.00319  96535
## # i 32 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Creating plot:}
\NormalTok{genre\_ratins\_grp }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ genres, }\AttributeTok{y =}\NormalTok{ rating\_avg, }\AttributeTok{ymin =}\NormalTok{ rating\_avg }\SpecialCharTok{{-}} \DecValTok{2}\SpecialCharTok{*}\NormalTok{se, }\AttributeTok{ymax =}\NormalTok{ rating\_avg }\SpecialCharTok{+} \DecValTok{2}\SpecialCharTok{*}\NormalTok{se)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_errorbar}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Average rating per Genre"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Average rating"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{90}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-175-1.pdf}}
Below are worst and best ratings categories:

\begin{verbatim}
## [1] "The worst ratings are for the genre category: Horror"
\end{verbatim}

\begin{verbatim}
## [1] "The best ratings are for the genre category: Comedy|Drama|Romance|War"
\end{verbatim}

Another way of visualizing a genre effect is shown in the section \href{https://www.kaggle.com/code/amirmotefaker/movie-recommendation-system-using-r-best/notebook\#Average-rating-for-each-genre}{Average rating for each genre} of the article ``Movie Recommendation System using R - BEST'' written by \href{https://www.kaggle.com/amirmotefaker}{Amir Moterfaker}\autocite{MRS-R-BEST}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# For better visibility, we reduce the data for plotting }
\CommentTok{\# while keeping the worst and best rating rows:}
\NormalTok{plot\_ind }\OtherTok{\textless{}{-}} \FunctionTok{odd}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(genre\_ratins\_grp))}
\NormalTok{plot\_dat }\OtherTok{\textless{}{-}}\NormalTok{ genre\_ratins\_grp\_sorted[plot\_ind,] }

\NormalTok{plot\_dat }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ rating\_avg, }\AttributeTok{y =}\NormalTok{ genres)) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Genre Average Rating"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{, }\AttributeTok{width =} \FloatTok{0.6}\NormalTok{, }\AttributeTok{fill =} \StringTok{"\#8888ff"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Average ratings"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Genres"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ comma, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.0}\NormalTok{, }\FloatTok{5.0}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_economist}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \FloatTok{3.5}\NormalTok{),}
        \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{),}
        \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \DecValTok{10}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{),}
        \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{angle =} \DecValTok{0}\NormalTok{),}
        \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \FloatTok{0.25}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{size =} \DecValTok{8}\NormalTok{),}
        \AttributeTok{plot.margin =} \FunctionTok{margin}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{1.2}\NormalTok{, }\StringTok{"cm"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-177-1.pdf}}

\subsubsection{Mathematical Description of the UMGE Model}\label{mathematical-description-of-the-umge-model}

\hfill\break

If we define \(g_{i,j}\) as the genre for user's \(i\) rating of movie \(j\), we can use the following models to account for the \texttt{genre} effect:
\[
Y_{i,j} = \mu + \alpha_i + \beta_j + g_{i,j} + \varepsilon_{i,j}
\]

where \(g_{i,j}\) is an \emph{aggregation function} which is explained in detail in \emph{Section 22.3: ``Review of Aggregation Functions'' of ``Recommender Systems Handbook''} (\emph{Chapter 22: ``Aggregation of Preferences in Recommender Systems''}, p.~712) book\autocite{RRSK_RS_HB}.

In the formula above \(g_{i,j}\) denotes a \emph{genre effect} for user's \(i\) rating of movie \(j\), so that:

\[
g_{i,j} = \sum_{k=1}^K x_{i,j}^k \gamma_k
\]

with \(x^k_{i,j} = 1\) if \(g_{i,j}\) includes genre \(k\), and \(x^k_{i,j} = 0\) otherwise.

Therefore, for our current model, we can compute the expected value
\[
\hat{g}_{i,j} = g_{i,j} + \varepsilon_{i,j}
\]
as a residual:
\[
\hat{g}_{i,j} = Y_{i,j} - (\mu + \alpha_i + \beta_j)
\]

\subsubsection{UMGE Model: Support Functions}\label{umge-model-support-functions}

\hfill\break

\begin{noteblock}
The complete source code of the functions described in this section is available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R\#L1}{UMGE Model Support Functions} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R}{UMG-effect.functions.R} script on \emph{GitHub}.

\end{noteblock}

\paragraph{\texorpdfstring{\href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R\#L40}{train\_user\_movie\_genre\_effect} Function}{train\_user\_movie\_genre\_effect Function}}\label{func.train_user_movie_genre_effect}

\hfill\break

We use this function to build and train our model using a \emph{Train Set} (passing it to the \texttt{train.sgr} parameter), which can be any sample of the \texttt{edx.sgr} dataset (or the entire dataset itself) described above in the \hyperref[edx.sgr-object]{\texttt{edx.sgr} Object} section. Here I only remind that it is the dataset created from the \texttt{edx} one by splitting its rows to ensure that each one belongs to a single \emph{genre}. Here is the source code of the function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{train\_user\_movie\_genre\_effect }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(train.sgr, }\AttributeTok{lambda =} \DecValTok{0}\NormalTok{)\{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.na}\NormalTok{(lambda)) \{}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"Function: train\_user\_movie\_genre\_effect}
\StringTok{\textasciigrave{}lambda\textasciigrave{} is \textasciigrave{}NA\textasciigrave{}"}\NormalTok{)}
\NormalTok{  \}}

\NormalTok{  genre\_bias }\OtherTok{\textless{}{-}}\NormalTok{ train.sgr }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{left\_join}\NormalTok{(edx.user\_effect, }\AttributeTok{by =} \StringTok{"userId"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{left\_join}\NormalTok{(rglr.UM\_effect, }\AttributeTok{by =} \StringTok{"movieId"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{mutate}\NormalTok{(}\AttributeTok{resid =}\NormalTok{ rating }\SpecialCharTok{{-}}\NormalTok{ (mu }\SpecialCharTok{+}\NormalTok{ a }\SpecialCharTok{+}\NormalTok{ b)) }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{group\_by}\NormalTok{(genres) }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{summarise}\NormalTok{(}\AttributeTok{g =} \FunctionTok{mean\_reg}\NormalTok{(resid, lambda), }\AttributeTok{n =} \FunctionTok{n}\NormalTok{())}

\NormalTok{    train.sgr }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{left\_join}\NormalTok{(genre\_bias, }\AttributeTok{by =} \StringTok{"genres"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{left\_join}\NormalTok{(rglr.UM\_effect, }\AttributeTok{by =} \StringTok{"movieId"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{group\_by}\NormalTok{(movieId) }\SpecialCharTok{|\textgreater{}}
      \FunctionTok{summarise}\NormalTok{(}\AttributeTok{g =} \FunctionTok{mean}\NormalTok{(g))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{noteblock}
The function described above accepts the \texttt{lambda} parameter, which we will need later for the \emph{Model Regularization} method. We also use the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L63}{mean\_reg} function call, which we will also need later for the \emph{Regularization} techniques (for details, see the \hyperref[func.mean_reg]{mean\_reg} function description in the Section \hyperref[appndx_a.rglr.common_helper.functions]{Regularization: Common Helper Functions} section of the \hyperref[appndx_a]{Appendix} to this report).
We have already explained that in the \hyperref[usermovie-effect-model-regularization]{User+Movie Effect Model Regularization} section.
For now, we omit the \texttt{lambda} parameter, accepting its default value \texttt{lambda\ =\ 0}. Let's recall that in this case, the \hyperref[func.mean_reg]{mean\_reg} function is equivalent to the standard R function \href{https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/mean}{base::mean}.

\end{noteblock}

\paragraph{\texorpdfstring{\texttt{train\_user\_movie\_genre\_effect.cv} Function}{train\_user\_movie\_genre\_effect.cv Function}}\label{func.train_user_movie_genre_effect.cv}

\hfill\break

We use the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R\#L59}{train\_user\_movie\_genre\_effect.cv} function to build and train our model using the \texttt{5-Fold\ Cross\ Validation} method. Below, we provide a slightly simplified version of the source code of that function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{train\_user\_movie\_genre\_effect.cv }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{lambda =} \DecValTok{0}\NormalTok{)\{}
  \CommentTok{\# ...}

\FunctionTok{put\_log1}\NormalTok{(}\StringTok{"Function \textasciigrave{}train\_user\_movie\_genre\_effect.cv\textasciigrave{}:}
\StringTok{Computing User+Movie+Genre Effects list for \%1{-}Fold Cross Validation samples..."}\NormalTok{, }
\NormalTok{           CVFolds\_N)}
  
\NormalTok{  start }\OtherTok{\textless{}{-}} \FunctionTok{put\_start\_date}\NormalTok{()}
\NormalTok{  user\_movie\_genre\_effects\_ls }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(kfold\_index, }\ControlFlowTok{function}\NormalTok{(fold\_i)\{}
\NormalTok{    cv\_fold\_dat }\OtherTok{\textless{}{-}}\NormalTok{ edx\_CV[[fold\_i]]}
    
    \FunctionTok{put\_log2}\NormalTok{(}\StringTok{"Processing User+Movie+Genre Effects for \%1{-}Fold Cross Validation samples (Fold \%2)..."}\NormalTok{,}
\NormalTok{             CVFolds\_N,}
\NormalTok{             fold\_i)}
\NormalTok{    umg\_effect }\OtherTok{\textless{}{-}}\NormalTok{ cv\_fold\_dat}\SpecialCharTok{$}\NormalTok{train.sgr }\SpecialCharTok{|\textgreater{}} \FunctionTok{train\_user\_movie\_genre\_effect}\NormalTok{(lambda)}
    
    
    \FunctionTok{put\_log2}\NormalTok{(}\StringTok{"User+Movie+Genre Effects have been computed for the Fold \%1 }
\StringTok{of the \%2{-}Fold Cross Validation samples."}\NormalTok{,}
\NormalTok{             fold\_i,}
\NormalTok{             CVFolds\_N)}
\NormalTok{    umg\_effect}
\NormalTok{  \})}
  \FunctionTok{put\_end\_date}\NormalTok{(start)}
  \FunctionTok{put\_log1}\NormalTok{(}\StringTok{"Function \textasciigrave{}train\_user\_movie\_genre\_effect.cv\textasciigrave{}:}
\StringTok{User+Movie+Genre Effects list has been computed for \%1{-}Fold Cross Validation samples."}\NormalTok{, }
\NormalTok{           CVFolds\_N)}

\NormalTok{  user\_movie\_genre\_effects\_united }\OtherTok{\textless{}{-}} \FunctionTok{union\_cv\_results}\NormalTok{(user\_movie\_genre\_effects\_ls)}

\NormalTok{  user\_movie\_genre\_effect }\OtherTok{\textless{}{-}}\NormalTok{ user\_movie\_genre\_effects\_united }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{group\_by}\NormalTok{(movieId) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{summarise}\NormalTok{(}\AttributeTok{g =} \FunctionTok{mean}\NormalTok{(g))}
  
  \ControlFlowTok{if}\NormalTok{(lambda }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }\FunctionTok{put\_log}\NormalTok{(}\StringTok{"Function \textasciigrave{}train\_user\_movie\_genre\_effect.cv\textasciigrave{}:}
\StringTok{Training completed: User+Movie+Genre Effects model."}\NormalTok{)}
  \ControlFlowTok{else} \FunctionTok{put\_log1}\NormalTok{(}\StringTok{"Function \textasciigrave{}train\_user\_movie\_genre\_effect.cv\textasciigrave{}:}
\StringTok{Training completed: User+Movie+Genre Effects model for lambda: \%1..."}\NormalTok{,}
\NormalTok{                lambda)}
  
\NormalTok{  user\_movie\_genre\_effect}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{noteblock}
Here we use the function call \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L432}{union\_cv\_results} to aggregate the \emph{5-Fold Cross Validation} method results (for details, see the \hyperref[func.union_cv_results]{union\_cv\_results} function description in the \hyperref[appndx_a.data_helper.functions]{Data Helper Functions} section of the \hyperref[appndx_a]{Appendix} to this report).

\end{noteblock}

\paragraph{\texorpdfstring{\texttt{calc\_user\_movie\_genre\_effect\_MSE} Function}{calc\_user\_movie\_genre\_effect\_MSE Function}}\label{calc_user_movie_genre_effect_mse-function}

\hfill\break

The source code of the function \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R\#L110}{calc\_user\_movie\_genre\_effect\_MSE} defined in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R}{UMG-effect.functions.R} script to calculate the \emph{Mean Squared Error (MSE)} of the \emph{UMGE Model} for the given \emph{Test Set} is provided below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calc\_user\_movie\_genre\_effect\_MSE }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(test\_set, umg\_effect)\{}
\NormalTok{  test\_set }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{left\_join}\NormalTok{(edx.user\_effect, }\AttributeTok{by =} \StringTok{"userId"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{left\_join}\NormalTok{(rglr.UM\_effect, }\AttributeTok{by =} \StringTok{"movieId"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{left\_join}\NormalTok{(umg\_effect, }\AttributeTok{by =} \StringTok{"movieId"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{resid =}\NormalTok{ rating }\SpecialCharTok{{-}} \FunctionTok{clamp}\NormalTok{(mu }\SpecialCharTok{+}\NormalTok{ a }\SpecialCharTok{+}\NormalTok{ b }\SpecialCharTok{+}\NormalTok{ g)) }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{pull}\NormalTok{(resid) }\SpecialCharTok{|\textgreater{}} \FunctionTok{mse}\NormalTok{()}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\newpage

\paragraph{\texorpdfstring{\texttt{calc\_user\_movie\_genre\_effect\_MSE.cv} Function}{calc\_user\_movie\_genre\_effect\_MSE.cv Function}}\label{calc_user_movie_genre_effect_mse.cv-function}

\hfill\break

The source code of the function \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R\#L122}{calc\_user\_movie\_genre\_effect\_MSE.cv} defined in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R}{UMG-effect.functions.R} script to calculate the \emph{5-Fold Cross Validation MSE} result of the \emph{UMGE Model} is provided below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calc\_user\_movie\_genre\_effect\_MSE.cv }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(umg\_effect)\{}
  \FunctionTok{put\_log}\NormalTok{(}\StringTok{"Computing RMSEs.ResultTibble on Validation Sets..."}\NormalTok{)}
\NormalTok{  start }\OtherTok{\textless{}{-}} \FunctionTok{put\_start\_date}\NormalTok{()}
\NormalTok{  user\_movie\_genre\_effects\_MSEs }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(edx\_CV, }\ControlFlowTok{function}\NormalTok{(cv\_dat)\{}
\NormalTok{    cv\_dat}\SpecialCharTok{$}\NormalTok{validation\_set }\SpecialCharTok{|\textgreater{}} \FunctionTok{calc\_user\_movie\_genre\_effect\_MSE}\NormalTok{(umg\_effect)}
\NormalTok{  \})}
  \FunctionTok{put\_end\_date}\NormalTok{(start)}
  
  \FunctionTok{plot}\NormalTok{(user\_movie\_genre\_effects\_MSEs)}
  \FunctionTok{put\_log1}\NormalTok{(}\StringTok{"MSE values have been plotted for the \%1{-}Fold Cross Validation samples."}\NormalTok{, }
\NormalTok{           CVFolds\_N)}
 
  \FunctionTok{mean}\NormalTok{(user\_movie\_genre\_effects\_MSEs)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\paragraph{\texorpdfstring{\texttt{calc\_user\_movie\_genre\_effect\_RMSE} Function}{calc\_user\_movie\_genre\_effect\_RMSE Function}}\label{calc_user_movie_genre_effect_rmse-function}

\hfill\break

The source code of the function \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R\#L118}{calc\_user\_movie\_genre\_effect\_RMSE} defined in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R}{UMG-effect.functions.R} script to calculate the \emph{Root Mean Squared Error (RMSE)} of the \emph{UMGE Model} for the given \emph{Test Set} is provided below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calc\_user\_movie\_genre\_effect\_RMSE }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(test\_set, umg\_effect)\{}
\NormalTok{  umg\_mse }\OtherTok{\textless{}{-}}\NormalTok{ test\_set }\SpecialCharTok{|\textgreater{}} \FunctionTok{calc\_user\_movie\_genre\_effect\_MSE}\NormalTok{(umg\_effect)}
  \FunctionTok{sqrt}\NormalTok{(umg\_mse)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\paragraph{\texorpdfstring{\texttt{calc\_user\_movie\_genre\_effect\_RMSE.cv} Function}{calc\_user\_movie\_genre\_effect\_RMSE.cv Function}}\label{func.calc_user_movie_genre_effect_RMSE.cv}

\hfill\break

The source code of the function \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R\#L136}{calc\_user\_movie\_genre\_effect\_RMSE.cv} defined in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMG-effect.functions.R}{UMG-effect.functions.R} script to calculate the \emph{5-Fold Cross Validation \textbf{RMSE}} result of the \emph{UMGE Model} is provided below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calc\_user\_movie\_genre\_effect\_RMSE.cv }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(umg\_effect)\{}
\NormalTok{  umg\_effect\_RMSE }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{(}\FunctionTok{calc\_user\_movie\_genre\_effect\_MSE.cv}\NormalTok{(umg\_effect))}
  \FunctionTok{put\_log2}\NormalTok{(}\StringTok{"\%1{-}Fold Cross Validation ultimate RMSE: \%2"}\NormalTok{, }
\NormalTok{           CVFolds\_N, }
\NormalTok{           umg\_effect\_RMSE)}
  
\NormalTok{  umg\_effect\_RMSE}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\newpage

\subsubsection{UMGE Model Building}\label{umge-model-building}

\hfill\break

\begin{noteblock}
The complete source code of builing and training the current model is available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R\#L1149}{Model building: User+Movie+Genre Effect} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R}{capstone-movielens.main.R} script on \emph{GitHub}.

\end{noteblock}

Below, we provide the most significant part of the code for training our model using the \texttt{5-Fold\ Cross\ Validation} method:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  cv.UMG\_effect }\OtherTok{\textless{}{-}} \FunctionTok{train\_user\_movie\_genre\_effect.cv}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(cv.UMG\_effect)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## tibble [10,677 x 2] (S3: tbl_df/tbl/data.frame)
##  $ movieId: int [1:10677] 1 2 3 4 5 6 7 8 9 10 ...
##  $ g      : num [1:10677] -9.28e-06 -7.23e-05 -1.07e-04 -6.46e-05 4.56e-05 ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{par}\NormalTok{(}\AttributeTok{cex =} \FloatTok{0.7}\NormalTok{)}
\FunctionTok{hist}\NormalTok{(cv.UMG\_effect}\SpecialCharTok{$}\NormalTok{g, }\DecValTok{30}\NormalTok{, }\AttributeTok{xlab =} \FunctionTok{TeX}\NormalTok{(r}\StringTok{\textquotesingle{}[$\textbackslash{}hat\{g\}\_\{i,j\}$]\textquotesingle{}}\NormalTok{),}
     \AttributeTok{main =} \FunctionTok{TeX}\NormalTok{(r}\StringTok{\textquotesingle{}[Histogram of $\textbackslash{}hat\{g\}\_\{i,j\}$]\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-185-1.pdf}}

We can now construct predictors and calculate the \emph{RMSE} of the current model using the \hyperref[func.calc_user_movie_genre_effect_RMSE.cv]{calc\_user\_movie\_genre\_effect\_RMSE.cv} function described above:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cv.UMG\_effect.RMSE }\OtherTok{\textless{}{-}} \FunctionTok{calc\_user\_movie\_genre\_effect\_RMSE.cv}\NormalTok{(cv.UMG\_effect)}

\NormalTok{RMSEs.ResultTibble.UMGE }\OtherTok{\textless{}{-}}\NormalTok{ RMSEs.ResultTibble.rglr.UME }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{RMSEs.AddRow}\NormalTok{(}\StringTok{"User+Movie+Genre Effect Model"}\NormalTok{, cv.UMG\_effect.RMSE)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{RMSE\_kable}\NormalTok{(RMSEs.ResultTibble.UMGE)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{>{\raggedright\arraybackslash}p{20em}>{\centering\arraybackslash}p{5em}>{\raggedright\arraybackslash}p{20em}}
\toprule
\textbf{Method} & \textbf{RMSE} & \textbf{Comment}\\
\midrule
Project Objective & 0.8649000 & \\
Overall Mean Rating Model & 1.0603462 & \\
User Effect Model & 0.9697962 & \\
User+Movie Effect Model & 0.8732081 & \\
Regularized User+Movie Effect Model & 0.8729730 & Computed for `lambda` = 0.38745002746582\\
\addlinespace
User+Movie+Genre Effect Model & 0.8729730 & \\
\bottomrule
\end{tabular}

\begin{noteblock}
Unfortunately, we do not see any improvement here yet.

\end{noteblock}

\newpage

\[
Y_{i,j} = \mu + \alpha_i + \beta_j + g_{i,j} + f(d_{i,j})
\]

\[
 \sum_{i=1}^{n_i} \left(Y_{i,j} - \mu - \alpha_i\right)
\]

\subsection{User+Movie+Genre+Year Effect (UMGYE) Model}\label{usermoviegenreyear-effect-umgye-model}

\hfill\break

\paragraph{\texorpdfstring{Yearly rating count\autocite{MRS-R-BEST}}{Yearly rating count{[}@MRS-R-BEST{]}}}\label{yearly-rating-countmrs-r-best}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(edx }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year =} \FunctionTok{year}\NormalTok{(}\FunctionTok{as\_datetime}\NormalTok{(timestamp, }\AttributeTok{origin =} \StringTok{"1970{-}01{-}01"}\NormalTok{))) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{group\_by}\NormalTok{(year) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{())}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 15 x 2
##     year   count
##    <dbl>   <int>
##  1  1995       2
##  2  1996  942772
##  3  1997  414101
##  4  1998  181634
##  5  1999  709893
##  6  2000 1144349
##  7  2001  683355
##  8  2002  524959
##  9  2003  619938
## 10  2004  691429
## 11  2005 1059277
## 12  2006  689315
## 13  2007  629168
## 14  2008  696740
## 15  2009   13123
\end{verbatim}

\paragraph{\texorpdfstring{Average rating per year plot\autocite{MRS-R-BEST}}{Average rating per year plot{[}@MRS-R-BEST{]}}}\label{average-rating-per-year-plotmrs-r-best}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{edx }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year =} \FunctionTok{year}\NormalTok{(}\FunctionTok{as\_datetime}\NormalTok{(timestamp, }\AttributeTok{origin =} \StringTok{"1970{-}01{-}01"}\NormalTok{))) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{group\_by}\NormalTok{(year) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{rating\_avg =} \FunctionTok{mean}\NormalTok{(rating)) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ year, }\AttributeTok{y =}\NormalTok{ rating\_avg)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"\#8888ff"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Average rating per year"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Year"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Average rating"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ comma) }\SpecialCharTok{+} 
  \FunctionTok{theme\_economist}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
        \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{vjust =} \DecValTok{10}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
        \AttributeTok{plot.margin =} \FunctionTok{margin}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{1.2}\NormalTok{, }\StringTok{"cm"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{capstone-movielens.report_files/figure-latex/unnamed-chunk-207-1.pdf}}

We use the following models to account for the \texttt{date} effect:

\[
Y_{i,j} = \mu + \alpha_i + \beta_j + f(d_{i,j}) + \varepsilon_{i,j}
\]

\newpage

\subsection{User+Movie+Genre+Year+Day Effect (UMGYDE) Model}\label{usermoviegenreyearday-effect-umgyde-model}

\hfill\break

\newpage

\subsubsection{UMGYDE Model: Matrix Factorization}\label{umgyde-model-matrix-factorization}

\hfill\break

\newpage

\section{Conclusion}\label{conclusion}

\hfill\break

Hello Conclusion!

This is a great conclusion, isn't it?!!

\newpage

\section{Appendix}\label{appndx_a}

\subsection{Data Helper Functions}\label{appndx_a.data_helper.functions}

\hfill\break

\subsubsection{\texorpdfstring{\href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L432}{union\_cv\_results} Function}{union\_cv\_results Function}}\label{func.union_cv_results}

\hfill\break

Aggregates the input data frames into a single data frame.

\phantomsection\label{func.union_cv_results.Usage}
\paragraph{Usage}\label{usage}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{union\_cv\_results}\NormalTok{(}\AttributeTok{data\_list =}\NormalTok{ data)}
\end{Highlighting}
\end{Shaded}

\phantomsection\label{func.union_cv_results.params}
\paragraph{Parameters}\label{parameters}

\hfill\break

\phantomsection\label{func.union_cv_results.params.data_list}
\begin{itemize}
\tightlist
\item
  \textbf{data\_list:} List of data frames representing the results of the \emph{N-Fold Cross Validation} method execution.;
\end{itemize}

\phantomsection\label{func.union_cv_results.details}
\paragraph{Details}\label{details}

\hfill\break

The function is used to aggregate the \emph{N-Fold Cross Validation} method result data into a single data frame for further processing.

\phantomsection\label{func.union_cv_results.value}
\paragraph{Value}\label{value}

\hfill\break

A data frame that is a union of the input data frames.

\phantomsection\label{func.union_cv_results.code}
\paragraph{Source Code}\label{source-code}

\hfill\break

The soure code of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L432}{union\_cv\_results} function is shown below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{union\_cv\_results }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data\_list) \{}
\NormalTok{  out\_dat }\OtherTok{\textless{}{-}}\NormalTok{ data\_list[[}\DecValTok{1}\NormalTok{]]}
  
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2}\SpecialCharTok{:}\NormalTok{CVFolds\_N)\{}
\NormalTok{    out\_dat }\OtherTok{\textless{}{-}} \FunctionTok{union}\NormalTok{(out\_dat, }
\NormalTok{                     data\_list[[i]])}
\NormalTok{  \}}
  
\NormalTok{  out\_dat}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{noteblock}
The source code of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L432}{union\_cv\_results} is also available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L431}{Model training} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L432}{data.helper.functions.R} script.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L592}{data.plot} Function}{data.plot Function}}\label{func.data.plot}

\hfill\break

Plots a graph based on the dataset passed in the \hyperref[func.data.plot.params.data]{data} parameter, using both points and a line.

\phantomsection\label{func.data.plot.Usage}
\paragraph{Usage}\label{usage-1}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data.plot}\NormalTok{(data, }
\NormalTok{          title, }
\NormalTok{          xname, }
\NormalTok{          yname, }
          \AttributeTok{xlabel =} \ConstantTok{NULL}\NormalTok{, }
          \AttributeTok{ylabel =} \ConstantTok{NULL}\NormalTok{,}
          \AttributeTok{line\_col =} \StringTok{"blue"}\NormalTok{,}
          \AttributeTok{normalize =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\phantomsection\label{func.data.plot.params}
\paragraph{Parameters}\label{parameters-1}

\hfill\break

\phantomsection\label{func.data.plot.params.data}
\begin{itemize}
\tightlist
\item
  \textbf{data:} Dataset to use for the plot;
\end{itemize}

\phantomsection\label{func.data.plot.params.title}
\begin{itemize}
\tightlist
\item
  \textbf{title:} Title of the plot;
\end{itemize}

\phantomsection\label{func.data.plot.params.xname}
\begin{itemize}
\tightlist
\item
  \textbf{xname:} The name of the dataset column used as the source of the \(x\) variable for the plot;
\end{itemize}

\phantomsection\label{func.data.plot.params.yname}
\begin{itemize}
\tightlist
\item
  \textbf{yname:} The name of the dataset column used as the source of the \(y\) variable for the plot;
\end{itemize}

\phantomsection\label{func.data.plot.params.xlabel}
\begin{itemize}
\tightlist
\item
  \emph{xlabel = NULL}:** The \(x\) axis label. If \texttt{NULL}, the value of the \texttt{xname} parameter is used for the label;
\end{itemize}

\phantomsection\label{func.data.plot.params.ylabel}
\begin{itemize}
\tightlist
\item
  \textbf{ylabel = NULL:} The \(y\) axis label. If \texttt{NULL}, the value of the \texttt{yname} parameter is used for the label.;
\end{itemize}

\phantomsection\label{func.data.plot.params.line_col}
\begin{itemize}
\tightlist
\item
  \textbf{line\_col = blue:} The line color;
\end{itemize}

\phantomsection\label{func.data.plot.params.normalize}
\begin{itemize}
\tightlist
\item
  \textbf{normalize = FALSE:} If \texttt{TRUE}, the deviation of \(y\) from its mean is used to plot, rather than \(y\) values. Otherwise, the value of \(y\) is used.
\end{itemize}

\phantomsection\label{func.data.plot.details}
\paragraph{Details}\label{details-1}

\hfill\break

The function is a wrapper for the \href{https://ggplot2.tidyverse.org/reference/ggplot.html}{ggplot2::ggplot} function and is a simple and convenient tool for visualizing the data of this project.

\phantomsection\label{func.data.plot.code}
\paragraph{Source Code}\label{source-code-1}

\hfill\break

The soure code of the \href{}{data.plot} function is shown below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data.plot }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data, }
\NormalTok{                      title, }
\NormalTok{                      xname, }
\NormalTok{                      yname, }
                      \AttributeTok{xlabel =} \ConstantTok{NULL}\NormalTok{, }
                      \AttributeTok{ylabel =} \ConstantTok{NULL}\NormalTok{,}
                      \AttributeTok{line\_col =} \StringTok{"blue"}\NormalTok{,}
                      \AttributeTok{normalize =} \ConstantTok{FALSE}\NormalTok{) \{}
\NormalTok{  y }\OtherTok{\textless{}{-}}\NormalTok{ data[, yname]}
  
  \ControlFlowTok{if}\NormalTok{ (normalize) \{}
\NormalTok{    y }\OtherTok{\textless{}{-}}\NormalTok{ y }\SpecialCharTok{{-}} \FunctionTok{min}\NormalTok{(y)}
\NormalTok{  \}}
  
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(xlabel)) \{}
\NormalTok{    xlabel }\OtherTok{=}\NormalTok{ xname}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(ylabel)) \{}
\NormalTok{    ylabel }\OtherTok{=}\NormalTok{ yname}
\NormalTok{  \}}
  
\NormalTok{  aes\_mapping }\OtherTok{\textless{}{-}} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ data[, xname], }\AttributeTok{y =}\NormalTok{ y)}
  
\NormalTok{  data }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{mapping =}\NormalTok{ aes\_mapping) }\SpecialCharTok{+}
    \FunctionTok{ggtitle}\NormalTok{(title) }\SpecialCharTok{+}
    \FunctionTok{xlab}\NormalTok{(xlabel) }\SpecialCharTok{+}
    \FunctionTok{ylab}\NormalTok{(ylabel) }\SpecialCharTok{+}
    \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
    \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{color=}\NormalTok{line\_col)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{noteblock}
The source code of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L592}{data.plot} is also available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L447}{Data Visualization} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L592}{data.helper.functions.R} script.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{}{data.helper.func0} Function}{data.helper.func0 Function}}\label{func.data.helper.func0}

\hfill\break

\phantomsection\label{func.data.helper.func0.Usage}
\paragraph{Usage}\label{usage-2}

\hfill\break

\phantomsection\label{func.data.helper.func0.params}
\paragraph{Parameters}\label{parameters-2}

\hfill\break

\phantomsection\label{func.data.helper.func0.params.p1}
\begin{itemize}
\tightlist
\item
  \textbf{p1:} description;
\end{itemize}

\phantomsection\label{func.data.helper.func0.params.2}
\begin{itemize}
\tightlist
\item
  \textbf{p2:} description.
\end{itemize}

\phantomsection\label{func.data.helper.func0.details}
\paragraph{Details}\label{details-2}

\hfill\break

\begin{noteblock}
Note

\end{noteblock}

\phantomsection\label{func.data.helper.func0.value}
\paragraph{Value}\label{value-1}

\hfill\break

\phantomsection\label{func.data.helper.func0.code}
\paragraph{Source Code}\label{source-code-2}

\hfill\break

The soure code of the \href{}{data.helper.func0} function is shown below:

\begin{noteblock}
The source code of the \href{}{data.helper.func0} is also available in the \href{}{Some.Section} section of the \href{}{Somefunctions.R} script.

\end{noteblock}

\subsection{Regularization: Common Helper Functions}\label{appndx_a.rglr.common_helper.functions}

\hfill\break

\begin{noteblock}
The full source code of the functions described below are available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L74}{Model Tuning} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R}{common-helper.functions.R} script on \emph{GitHub}.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L63}{mean\_reg} Function}{mean\_reg Function}}\label{func.mean_reg}

\hfill\break

A general function for computing the arithmetic mean given a \emph{regularization parameter} \(\lambda\). We will call it the \emph{penaized mean}.

\phantomsection\label{func.mean_reg.usage}
\paragraph{Usage}\label{usage-3}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean\_reg}\NormalTok{(vals, }\AttributeTok{lambda =} \DecValTok{0}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\phantomsection\label{func.mean_reg.params}
\paragraph{Parameters}\label{parameters-3}

\hfill\break

\phantomsection\label{func.mean_reg.params.vals}
\begin{itemize}
\tightlist
\item
  \textbf{vals:} values (usually a numeric vector) to calculate the \emph{penalized mean};
\end{itemize}

\phantomsection\label{func.mean_reg.params.lambda}
\begin{itemize}
\tightlist
\item
  \textbf{lambda:} a \emph{regularization parameter} \(\lambda\) used in the \emph{Regularization techniques}.
\end{itemize}

\begin{itemize}
\tightlist
\item
  \textbf{na.rm:} a logical evaluating to TRUE or FALSE indicating whether NA values should be stripped before the computation proceeds.
\end{itemize}

\phantomsection\label{func.mean_reg.details}
\paragraph{Details}\label{details-3}

\hfill\break
We call this function internally from the functions that compute the \emph{penalized estimates} as described in section \href{https://rafalab.dfci.harvard.edu/dsbook-part-2/highdim/regularization.html\#penalized-least-squares}{23.6 Penalized Least Squares} of the \emph{Course Textbook}\autocite{IDS2_23-6}.

\begin{noteblock}
If the \hyperref[func.mean_reg.params.lambda]{lambda} parameter is \texttt{0} (the default), the function is equivalent to the standard R function \href{https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/mean}{base::mean}, calling with the parameter \texttt{trim\ =\ 0} (the default for the \texttt{base::mean} function).

\end{noteblock}

\phantomsection\label{func.mean_reg.value}
\paragraph{Value}\label{value-2}

\hfill\break

The function calculates the \emph{penalized mean} of the \hyperref[func.mean_reg.params.vals]{vals} parameter as follows:
\[
\mu(\lambda) = \frac{1}{\lambda + N} \sum_{i=1}^{N} x_i
\]

When the \hyperref[func.mean_reg.params.lambda]{lambda} parameter is \texttt{0} (meaning the \(\lambda = 0\)), the function calculates the simple arithmetic mean as follows:
\[
\mu = \frac{1}{N} \sum_{i=1}^{N} x_i
\]

\phantomsection\label{func.mean_reg.code}
\paragraph{Source Code}\label{source-code-3}

\hfill\break

The soure code of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L63}{mean\_reg} function is shown below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mean\_reg }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(vals, }\AttributeTok{lambda =} \DecValTok{0}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)\{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.na}\NormalTok{(lambda)) \{}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"Function: mean\_reg}
\StringTok{\textasciigrave{}lambda\textasciigrave{} is \textasciigrave{}NA\textasciigrave{}"}\NormalTok{)}
\NormalTok{  \}}
  
  \FunctionTok{names}\NormalTok{(lambda) }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{  sums }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(vals, }\AttributeTok{na.rm =}\NormalTok{ na.rm)}
\NormalTok{  N }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(na.rm, }\FunctionTok{sum}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(vals)), }\FunctionTok{length}\NormalTok{(vals))}
\NormalTok{  sums}\SpecialCharTok{/}\NormalTok{(N }\SpecialCharTok{+}\NormalTok{ lambda)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{noteblock}
The source code of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L63}{mean\_reg} is also available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L62}{Regularization} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L63}{common-helper.functions.R} script.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L116}{tune.model\_param} Function}{tune.model\_param Function}}\label{func.tune.model_param}

\hfill\break

The function searches for the parameter value corresponding to the minimum value of the \texttt{RMSE} from the list of values specified by the \texttt{param\_values} parameter.

\paragraph{Signature}\label{signature}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tune.model\_param }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(param\_values, }
\NormalTok{                             fn\_tune.test.param\_value, }
                             \AttributeTok{break.if\_min =} \ConstantTok{TRUE}\NormalTok{,}
                             \AttributeTok{steps.beyond\_min =} \DecValTok{2}\NormalTok{)\{}

\CommentTok{\# ...}
  \FunctionTok{list}\NormalTok{(}\AttributeTok{tuned.result =} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{RMSE =}\NormalTok{ RMSEs\_tmp,}
                                \AttributeTok{parameter.value =}\NormalTok{ param\_vals\_tmp),}
       \AttributeTok{best\_result =}\NormalTok{ param\_values.best\_result)}
\NormalTok{\}  }
\end{Highlighting}
\end{Shaded}

\paragraph{Parameters}\label{parameters-4}

\hfill\break

\begin{itemize}
\tightlist
\item
  \textbf{param\_values:} A list of values to search for the value corresponding to the minimum value of the \texttt{RMSE} ;
\end{itemize}

\phantomsection\label{func.tune.model_param.params.fn_tune.test.param_value}
\begin{itemize}
\tightlist
\item
  \textbf{fn\_tune.test.param\_value:} A helper function that calculates the value of the \texttt{RMSE} for a given parameter value.;
\end{itemize}

\begin{itemize}
\item
  \textbf{break.if\_min = TRUE:} A Boolean parameter that determines whether the function should terminate after completing the number of steps specified by the parameter \texttt{steps.beyond\_min}, after the minimum value of the \texttt{RMSE} has been found;
\item
  \textbf{steps.beyond\_min = 2:} (takes effect only if \texttt{break.if\_min} parameter is \texttt{TRUE}) Specifies the number of steps after finding the minimum value of the \texttt{RMSE}, upon completion of which the function should terminate.
\end{itemize}

\paragraph{Details}\label{details-4}

\hfill\break
During execution, the function uses a helper function specified by the \texttt{fn\_tune.test.param\_value} parameter, which calculates the \texttt{RMSE} value for the given parameter from the list determined by the \texttt{param\_values} parameter.

\begin{noteblock}
Note that the algorithm assumes that the dependence of the \texttt{RMSE} on the input parameter is a monotonically decreasing function until a minimum is reached and monotonically increasing thereafter. That is, it is assumed that the function has a single minimum on the given interval.

\end{noteblock}

\phantomsection\label{func.tune.model_param.value}
\paragraph{Value}\label{value-3}

\hfill\break
The function returns a data structure containing the found value of the input parameter \texttt{param\_values} for which the \texttt{RMSE} value is minimal, as well as the minimum \texttt{RMSE} value itself, along with a sequence of all calculated \texttt{RMSE} values:

\begin{Shaded}
\begin{Highlighting}[]
  \FunctionTok{list}\NormalTok{(}\AttributeTok{tuned.result =} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{RMSE =}\NormalTok{ RMSEs\_tmp,}
                                \AttributeTok{parameter.value =}\NormalTok{ param\_vals\_tmp),}
       \AttributeTok{best\_result =}\NormalTok{ param\_values.best\_result)}
\end{Highlighting}
\end{Shaded}

\paragraph{Source Code}\label{source-code-4}

\hfill\break
Below is the most significant part of the source code of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L116}{tune.model\_param} function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tune.model\_param }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(param\_values, }
\NormalTok{                             fn\_tune.test.param\_value, }
                             \AttributeTok{break.if\_min =} \ConstantTok{TRUE}\NormalTok{,}
                             \AttributeTok{steps.beyond\_min =} \DecValTok{2}\NormalTok{)\{}
\NormalTok{  n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(param\_values)}
\NormalTok{  param\_vals\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{numeric}\NormalTok{()}
\NormalTok{  RMSEs\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{numeric}\NormalTok{()}
\NormalTok{  RMSE\_min }\OtherTok{\textless{}{-}} \ConstantTok{Inf}
\NormalTok{  i\_max.beyond\_RMSE\_min }\OtherTok{\textless{}{-}} \ConstantTok{Inf}
\NormalTok{  prm\_val.best }\OtherTok{\textless{}{-}} \ConstantTok{NA}

  \CommentTok{\# ...}
  
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\NormalTok{n) \{}
    \FunctionTok{put\_log1}\NormalTok{(}\StringTok{"Function: \textasciigrave{}tune.model\_param\textasciigrave{}:}
\StringTok{Iteration \%1"}\NormalTok{, i)}
\NormalTok{    prm\_val }\OtherTok{\textless{}{-}}\NormalTok{ param\_values[i]}
\NormalTok{    param\_vals\_tmp[i] }\OtherTok{\textless{}{-}}\NormalTok{ prm\_val}
    
\NormalTok{    RMSE\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{fn\_tune.test.param\_value}\NormalTok{(prm\_val)}
\NormalTok{    RMSEs\_tmp[i] }\OtherTok{\textless{}{-}}\NormalTok{ RMSE\_tmp}

    \FunctionTok{plot}\NormalTok{(param\_vals\_tmp[RMSEs\_tmp], RMSEs\_tmp[RMSEs\_tmp])}

    \ControlFlowTok{if}\NormalTok{(RMSE\_tmp }\SpecialCharTok{\textgreater{}}\NormalTok{ RMSE\_min)\{}
      \FunctionTok{warning}\NormalTok{(}\StringTok{"Function: \textasciigrave{}tune.model\_param\textasciigrave{}:}
\StringTok{\textasciigrave{}RSME\textasciigrave{} reached its minimum: "}\NormalTok{, RMSE\_min, }\StringTok{"}
\StringTok{for parameter value: "}\NormalTok{, prm\_val)}
      \FunctionTok{put\_log2}\NormalTok{(}\StringTok{"Function: \textasciigrave{}tune.model\_param\textasciigrave{}:}
\StringTok{Current \textasciigrave{}RMSE\textasciigrave{} value is \%1 related to parameter value: \%2"}\NormalTok{,}
\NormalTok{               RMSE\_tmp,}
\NormalTok{               prm\_val)}
      
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{\textgreater{}}\NormalTok{ i\_max.beyond\_RMSE\_min) \{}
        \FunctionTok{warning}\NormalTok{(}\StringTok{"Function: \textasciigrave{}tune.model\_param\textasciigrave{}:}
\StringTok{Operation is breaked (after \textasciigrave{}RSME\textasciigrave{} reached its minimum) on the following step: "}\NormalTok{, i)}
        \ControlFlowTok{break}
\NormalTok{      \}}
      \ControlFlowTok{next}
\NormalTok{    \}}

\NormalTok{    RMSE\_min }\OtherTok{\textless{}{-}}\NormalTok{ RMSE\_tmp}
\NormalTok{    prm\_val.best }\OtherTok{\textless{}{-}}\NormalTok{ prm\_val}
    
    \ControlFlowTok{if}\NormalTok{ (break.if\_min) \{}
\NormalTok{      i\_max.beyond\_RMSE\_min }\OtherTok{\textless{}{-}}\NormalTok{ i }\SpecialCharTok{+}\NormalTok{ steps.beyond\_min}
\NormalTok{    \}}
\NormalTok{  \}}
  
\NormalTok{  param\_values.best\_result }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{param.best\_value =}\NormalTok{ prm\_val.best, }
                                \AttributeTok{best\_RMSE =}\NormalTok{ RMSE\_min)}
  
  
  \FunctionTok{list}\NormalTok{(}\AttributeTok{tuned.result =} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{RMSE =}\NormalTok{ RMSEs\_tmp,}
                                \AttributeTok{parameter.value =}\NormalTok{ param\_vals\_tmp),}
       \AttributeTok{best\_result =}\NormalTok{ param\_values.best\_result)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\newpage

\subsubsection{\texorpdfstring{\href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L198}{model.tune.param\_range} Function}{model.tune.param\_range Function}}\label{func.model.tune.param_range}

\hfill\break

The function fine-tunes the model by searching for the best possible value of the input parameter over a given interval for which the corresponding \texttt{RMSE} value is minimal.

\paragraph{Signature}\label{signature-1}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model.tune.param\_range }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(loop\_starter,}
\NormalTok{                             tune\_dir\_path,}
\NormalTok{                             cache\_file\_base\_name,}
\NormalTok{                             fn\_tune.test.param\_value,}
                             \AttributeTok{max.identical.min\_RMSE.count =} \DecValTok{4}\NormalTok{,}
                             \AttributeTok{endpoint.min\_diff =} \DecValTok{0}\NormalTok{,}
                             \AttributeTok{break.if\_min =} \ConstantTok{TRUE}\NormalTok{,}
                             \AttributeTok{steps.beyond\_min =} \DecValTok{2}\NormalTok{)\{}
  \CommentTok{\# ...}
  \FunctionTok{list}\NormalTok{(}\AttributeTok{best\_result =}\NormalTok{ param\_values.best\_result,}
       \AttributeTok{param\_values.endpoints =} \FunctionTok{c}\NormalTok{(prm\_val.leftmost, prm\_val.rightmost, seq\_increment),}
       \AttributeTok{tuned.result =} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{parameter.value =}\NormalTok{ parameter.value,}
                                 \AttributeTok{RMSE =}\NormalTok{ result.RMSE))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\paragraph{\texorpdfstring{\textbf{Parameters}}{Parameters}}\label{parameters-5}

\hfill\break

\phantomsection\label{func.model.tune.param_range.params.loop_starter}
\subparagraph{\texorpdfstring{\textbf{\emph{loop\_starter}}}{loop\_starter}}\label{loop_starter}

\hfill\break
A numeric vector of the form \texttt{c(start,\ end,\ dvs)}, where \texttt{start} and \texttt{end} are the endpoints of the interval on which the parameter value that minimizes \texttt{RMSE} is sought.
\texttt{dvs} is a divisor for splitting the interval to transform it into a sequence of values among which the value that minimizes \texttt{RMSE} is sought.
For this purpose, the sequence step is calculated as follows:
\[
step = \frac{end - start}{dvs}
\]

The sequence obtained as a result of the transformation is equivalent to the one generated by the function \texttt{seq} as follows:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(start, end, step)}
\end{Highlighting}
\end{Shaded}

In fact, the \texttt{seq} function is called internally to generate the sequence during the execution of the \texttt{model.tune.param\_range} function.

\phantomsection\label{func.model.tune.param_range.params.tune_dir_path}
\subparagraph{\texorpdfstring{\textbf{\emph{tune\_dir\_path}}}{tune\_dir\_path}}\label{tune_dir_path}

\hfill\break
To improve performance, the algorithm caches intermediate results in the file system. This parameter specifies the path to the directory where the files are cached.

\phantomsection\label{func.model.tune.param_range.params.cache_file_base_name}
\subparagraph{\texorpdfstring{\textbf{\emph{cache\_file\_base\_name}}}{cache\_file\_base\_name}}\label{cache_file_base_name}

\hfill\break
The algorithm generates unique names for cache files based on this and the \texttt{loop\_starter} parameter, as well as some other intermediate values calculated during the execution.

\phantomsection\label{func.model.tune.param_range.params.fn_tune.test.param_value}
\subparagraph{\texorpdfstring{\textbf{\emph{fn\_tune.test.param\_value}}}{fn\_tune.test.param\_value}}\label{fn_tune.test.param_value}

\hfill\break
This is a helper function name that is passed to the same-named parameter of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L116}{tune.model\_param} function that is called internally during the execution (see the description of the \texttt{tune.model\_param} function \hyperref[func.tune.model_param]{above}).

\phantomsection\label{func.model.tune.param_range.params.max.identical.min_RMSE.count}
\subparagraph{\texorpdfstring{\textbf{\emph{max.identical.min\_RMSE.count = 4}}}{max.identical.min\_RMSE.count = 4}}\label{max.identical.min_rmse.count-4}

\hfill\break
If more than one identical minimum \texttt{RMSE} value is calculated during execution, the number of identical minimums is limited by the value of this parameter. When it is reached, the algorithm considers the task execution to be complete.

\phantomsection\label{func.model.tune.param_range.params.endpoint.min_diff}
\subparagraph{\texorpdfstring{\textbf{\emph{endpoint.min\_diff = 0}}}{endpoint.min\_diff = 0}}\label{endpoint.min_diff-0}

\hfill\break
Defines the sensitivity threshold for determining the neighborhood boundaries of the minimum \texttt{RMSE} value (for details, see the \texttt{Details} section \hyperref[func.model.tune.param_range.details]{below}).

\phantomsection\label{func.model.tune.param_range.params.break.if_min}
\subparagraph{\texorpdfstring{\textbf{\emph{break.if\_min = TRUE}}}{break.if\_min = TRUE}}\label{break.if_min-true}

\hfill\break
This is a parameter that is required for the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L116}{tune.model\_param} function that is called internally during execution (see the description of the \texttt{tune.model\_param} function \hyperref[func.tune.model_param]{above}).

\phantomsection\label{func.model.tune.param_range.params.steps.beyond_min}
\subparagraph{\texorpdfstring{\textbf{\emph{steps.beyond\_min = 2}}}{steps.beyond\_min = 2}}\label{steps.beyond_min-2}

\hfill\break
This is a parameter that is required for the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L116}{tune.model\_param} function that is called internally during execution (see the description of the \texttt{tune.model\_param} function \hyperref[func.tune.model_param]{above}).

\phantomsection\label{func.model.tune.param_range.details}
\paragraph{\texorpdfstring{\textbf{Details}}{Details}}\label{details-5}

\hfill\break
First, the function generates a sequence of the \texttt{input\ parameter\ values} based on the \texttt{loop\_starter} parameter values, as described above (see the \hyperref[func.model.tune.param_range.params.loop_starter]{loop\_starter} parameter description for the details), which is used as one of the input parameters for the helper function \hyperref[func.tune.model_param]{tune.model\_param}, which is repeatedly called during the execution, performing fine-tuning of the model.

The \texttt{tune.model\_param} function returns a range of input parameter values associated with the set of corresponding \emph{Root Mean Squared Errors} that is also guaranteed to include their minimum value, as described in the \hyperref[func.tune.model_param.value]{Value} subsection of the \hyperref[func.tune.model_param]{tune.model\_param} function description.

Next, the function figures out the boundary indices of a range of values from the neighborhood of the minimum \texttt{RMSE} by calling internally another helper function \texttt{get\_fine\_tune.param.endpoints.idx} (see the description of the function \hyperref[func.get_fine_tune.param.endpoints.idx]{get\_fine\_tune.param.endpoints.idx} below) and, using one more helper function \texttt{get\_best\_param.result} (see the description of the function \hyperref[func.get_best_param.result]{get\_best\_param.result} below), a pair of values, corresponding to the best result: minimal \texttt{RMSE} and corresponding input parameter value (which is considered the best).

The found values of the boundary indices are then used as the endpoints of a new interval to regenerate the sequence based on it in the next iteration, just as it was done based on the values of the \texttt{loop\_starter} parameter at the very beginning of the execution. The value of \texttt{step\ divisor}, used to calculate the step of the generated sequence, remains unchanged during the entire execution (see the description of the \hyperref[func.model.tune.param_range.params.loop_starter]{loop\_strarter} parameter above for details).

Thus, with each subsequent iteration, the minimum \texttt{RMSE} value is calculated more accurately, over an ever-decreasing interval, with the boundary values tending to the minimum \texttt{RMSE} value, and the sequence generated with an ever-decreasing step.

The calculation is completed when subsequent calculated values of the minimum \texttt{RMSE} stop improving and reach the most accurate possible value.

\paragraph{\texorpdfstring{\textbf{Value}}{Value}}\label{value-4}

\hfill\break

A data structure containing the minimum \texttt{RMSE} value reached during the fine-tuning process, the corresponding input parameter value, and information about the final sequence, on which the best output values were found:

\begin{Shaded}
\begin{Highlighting}[]
  \FunctionTok{list}\NormalTok{(}\AttributeTok{best\_result =}\NormalTok{ param\_values.best\_result,}
       \AttributeTok{param\_values.endpoints =} \FunctionTok{c}\NormalTok{(prm\_val.leftmost, prm\_val.rightmost, seq\_increment),}
       \AttributeTok{tuned.result =} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{parameter.value =}\NormalTok{ parameter.value,}
                                 \AttributeTok{RMSE =}\NormalTok{ result.RMSE))}
\end{Highlighting}
\end{Shaded}

\phantomsection\label{func.model.tune.param_range.code}
\paragraph{Source Code}\label{source-code-5}

\hfill\break
Below is the simplified version of the source code of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L198}{model.tune.param\_range} function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model.tune.param\_range }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(loop\_starter,}
\NormalTok{                             tune\_dir\_path,}
\NormalTok{                             cache\_file\_base\_name,}
\NormalTok{                             fn\_tune.test.param\_value,}
                             \AttributeTok{max.identical.min\_RMSE.count =} \DecValTok{4}\NormalTok{,}
                             \AttributeTok{is.cv =} \ConstantTok{TRUE}\NormalTok{,}
                             \AttributeTok{endpoint.min\_diff =} \DecValTok{0}\NormalTok{, }\CommentTok{\#1e{-}07,}
                             \AttributeTok{break.if\_min =} \ConstantTok{TRUE}\NormalTok{,}
                             \AttributeTok{steps.beyond\_min =} \DecValTok{2}\NormalTok{)\{}

\NormalTok{  seq\_start }\OtherTok{\textless{}{-}}\NormalTok{ loop\_starter[}\DecValTok{1}\NormalTok{]}
\NormalTok{  seq\_end }\OtherTok{\textless{}{-}}\NormalTok{ loop\_starter[}\DecValTok{2}\NormalTok{]}
\NormalTok{  interval\_divisor }\OtherTok{\textless{}{-}}\NormalTok{ loop\_starter[}\DecValTok{3}\NormalTok{]}
  
  \ControlFlowTok{if}\NormalTok{ (interval\_divisor }\SpecialCharTok{\textless{}} \DecValTok{4}\NormalTok{) \{}
\NormalTok{    interval\_divisor }\OtherTok{\textless{}{-}} \DecValTok{4}
\NormalTok{  \}}
  
\NormalTok{  prm\_val.leftmost }\OtherTok{\textless{}{-}}\NormalTok{ seq\_start}
\NormalTok{  prm\_val.rightmost }\OtherTok{\textless{}{-}}\NormalTok{ seq\_end}
  
\NormalTok{  RMSE.leftmost }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\NormalTok{  RMSE.rightmost }\OtherTok{\textless{}{-}} \ConstantTok{NA}

\NormalTok{  best\_RMSE }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\NormalTok{  param.best\_value }\OtherTok{\textless{}{-}} \DecValTok{0}
  
  
\NormalTok{  param\_values.best\_result }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{param.best\_value =}\NormalTok{ param.best\_value, }
                                \AttributeTok{best\_RMSE =}\NormalTok{ best\_RMSE)}
  \CommentTok{\# Start repeat loop}
  \ControlFlowTok{repeat}\NormalTok{\{}
\NormalTok{    seq\_increment }\OtherTok{\textless{}{-}}\NormalTok{ (seq\_end }\SpecialCharTok{{-}}\NormalTok{ seq\_start)}\SpecialCharTok{/}\NormalTok{interval\_divisor }
    
    \ControlFlowTok{if}\NormalTok{ (seq\_increment }\SpecialCharTok{\textless{}} \FloatTok{0.0000000000001}\NormalTok{) \{}
      \FunctionTok{warning}\NormalTok{(}\StringTok{"Function \textasciigrave{}model.tune.param\_range\textasciigrave{}:}
\StringTok{parameter value increment is too small."}\NormalTok{)}
      \ControlFlowTok{break}
\NormalTok{    \}}
    
\NormalTok{    test\_param\_vals }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(seq\_start, seq\_end, seq\_increment)}
    
\NormalTok{    tuned\_result }\OtherTok{\textless{}{-}} \FunctionTok{tune.model\_param}\NormalTok{(test\_param\_vals, }
\NormalTok{                                  fn\_tune.test.param\_value,}
\NormalTok{                                  break.if\_min,}
\NormalTok{                                  steps.beyond\_min)}
    
\NormalTok{    tuned.result }\OtherTok{\textless{}{-}}\NormalTok{ tuned\_result}\SpecialCharTok{$}\NormalTok{tuned.result}
    \FunctionTok{plot}\NormalTok{(tuned.result}\SpecialCharTok{$}\NormalTok{parameter.value, tuned.result}\SpecialCharTok{$}\NormalTok{RMSE)}
    
\NormalTok{    bound.idx }\OtherTok{\textless{}{-}} \FunctionTok{get\_fine\_tune.param.endpoints.idx}\NormalTok{(tuned.result)}
\NormalTok{    start.idx }\OtherTok{\textless{}{-}}\NormalTok{ bound.idx[}\StringTok{"start"}\NormalTok{]}
\NormalTok{    end.idx }\OtherTok{\textless{}{-}}\NormalTok{ bound.idx[}\StringTok{"end"}\NormalTok{]}
\NormalTok{    best\_RMSE.idx }\OtherTok{\textless{}{-}}\NormalTok{ bound.idx[}\StringTok{"best"}\NormalTok{]}
    
\NormalTok{    prm\_val.leftmost.tmp }\OtherTok{\textless{}{-}}\NormalTok{ tuned.result}\SpecialCharTok{$}\NormalTok{parameter.value[start.idx]}
\NormalTok{    RMSE.leftmost.tmp }\OtherTok{\textless{}{-}}\NormalTok{ tuned.result}\SpecialCharTok{$}\NormalTok{RMSE[start.idx]}

\NormalTok{    prm\_val.rightmost.tmp }\OtherTok{\textless{}{-}}\NormalTok{ tuned.result}\SpecialCharTok{$}\NormalTok{parameter.value[end.idx]}
\NormalTok{    RMSE.rightmost.tmp }\OtherTok{\textless{}{-}}\NormalTok{ tuned.result}\SpecialCharTok{$}\NormalTok{RMSE[end.idx]}
    
\NormalTok{    min\_RMSE }\OtherTok{\textless{}{-}}\NormalTok{ tuned.result}\SpecialCharTok{$}\NormalTok{RMSE[best\_RMSE.idx]}
\NormalTok{    min\_RMSE.prm\_val }\OtherTok{\textless{}{-}}\NormalTok{ tuned.result}\SpecialCharTok{$}\NormalTok{parameter.value[best\_RMSE.idx]}

\NormalTok{    seq\_start }\OtherTok{\textless{}{-}}\NormalTok{ prm\_val.leftmost.tmp}
\NormalTok{    seq\_end }\OtherTok{\textless{}{-}}\NormalTok{ prm\_val.rightmost.tmp}
    
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.na}\NormalTok{(best\_RMSE)) \{}
\NormalTok{      prm\_val.leftmost }\OtherTok{\textless{}{-}}\NormalTok{ prm\_val.leftmost.tmp}
\NormalTok{      RMSE.leftmost }\OtherTok{\textless{}{-}}\NormalTok{ RMSE.leftmost.tmp}
      
\NormalTok{      prm\_val.rightmost }\OtherTok{\textless{}{-}}\NormalTok{ prm\_val.rightmost.tmp}
\NormalTok{      RMSE.rightmost }\OtherTok{\textless{}{-}}\NormalTok{ RMSE.rightmost.tmp}
      
\NormalTok{      param.best\_value }\OtherTok{\textless{}{-}}\NormalTok{ min\_RMSE.prm\_val}
\NormalTok{      best\_RMSE }\OtherTok{\textless{}{-}}\NormalTok{ min\_RMSE}
\NormalTok{    \}}
    
    \ControlFlowTok{if}\NormalTok{ (RMSE.leftmost.tmp }\SpecialCharTok{{-}}\NormalTok{ min\_RMSE }\SpecialCharTok{\textgreater{}=}\NormalTok{ endpoint.min\_diff) \{}
\NormalTok{      prm\_val.leftmost }\OtherTok{\textless{}{-}}\NormalTok{ prm\_val.leftmost.tmp}
\NormalTok{      RMSE.leftmost }\OtherTok{\textless{}{-}}\NormalTok{ RMSE.leftmost.tmp}
\NormalTok{    \} }
    
    \ControlFlowTok{if}\NormalTok{ (RMSE.rightmost.tmp }\SpecialCharTok{{-}}\NormalTok{ min\_RMSE }\SpecialCharTok{\textgreater{}=}\NormalTok{ endpoint.min\_diff) \{}
\NormalTok{      prm\_val.rightmost }\OtherTok{\textless{}{-}}\NormalTok{ prm\_val.rightmost.tmp}
\NormalTok{      RMSE.rightmost }\OtherTok{\textless{}{-}}\NormalTok{ RMSE.rightmost.tmp}
\NormalTok{    \} }
    
    \ControlFlowTok{if}\NormalTok{ (end.idx }\SpecialCharTok{{-}}\NormalTok{ start.idx }\SpecialCharTok{\textless{}=} \DecValTok{0}\NormalTok{) \{}
      \FunctionTok{warning}\NormalTok{(}\StringTok{"\textasciigrave{}tuned.result$parameter.value\textasciigrave{} sequential start index are the same or greater than end one."}\NormalTok{)}
      \ControlFlowTok{break}
\NormalTok{    \}}
    
    \ControlFlowTok{if}\NormalTok{ (best\_RMSE }\SpecialCharTok{==}\NormalTok{ min\_RMSE) \{}
      \FunctionTok{warning}\NormalTok{(}\StringTok{"Currently computed minimal RMSE equals the previously reached best one: "}\NormalTok{,}
\NormalTok{              best\_RMSE, }\StringTok{"}
\StringTok{Currently computed minial value is: "}\NormalTok{, min\_RMSE)}

      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{sum}\NormalTok{(tuned.result}\SpecialCharTok{$}\NormalTok{RMSE[tuned.result}\SpecialCharTok{$}\NormalTok{RMSE }\SpecialCharTok{==}\NormalTok{ min\_RMSE]) }\SpecialCharTok{\textgreater{}=}\NormalTok{ max.identical.min\_RMSE.count) \{}
        \FunctionTok{warning}\NormalTok{(}\StringTok{"Minimal \textasciigrave{}RMSE\textasciigrave{}identical values count reached it maximum allowed value: "}\NormalTok{,}
\NormalTok{                max.identical.min\_RMSE.count)}

\NormalTok{        param\_values.best\_result }\OtherTok{\textless{}{-}}
          \FunctionTok{get\_best\_param.result}\NormalTok{(tuned.result}\SpecialCharTok{$}\NormalTok{parameter.value,}
\NormalTok{                                tuned.result}\SpecialCharTok{$}\NormalTok{RMSE)}
        \ControlFlowTok{break}
\NormalTok{      \}}

\NormalTok{    \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (best\_RMSE }\SpecialCharTok{\textless{}}\NormalTok{ min\_RMSE) \{}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"Current minimal RMSE is greater than previously computed best value: "}\NormalTok{,}
\NormalTok{           best\_RMSE, }\StringTok{"}
\StringTok{Currently computed minial value is: "}\NormalTok{, min\_RMSE)}
\NormalTok{    \}}

\NormalTok{    best\_RMSE }\OtherTok{\textless{}{-}}\NormalTok{ min\_RMSE}
\NormalTok{    param.best\_value }\OtherTok{\textless{}{-}}\NormalTok{ min\_RMSE.prm\_val}

\NormalTok{    param\_values.best\_result }\OtherTok{\textless{}{-}} 
      \FunctionTok{get\_best\_param.result}\NormalTok{(tuned.result}\SpecialCharTok{$}\NormalTok{parameter.value, }
\NormalTok{                          tuned.result}\SpecialCharTok{$}\NormalTok{RMSE)}
\NormalTok{  \}}
  \CommentTok{\# End repeat loop}
  
\NormalTok{  n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(tuned.result}\SpecialCharTok{$}\NormalTok{parameter.value)}
\NormalTok{  parameter.value }\OtherTok{\textless{}{-}}\NormalTok{ tuned.result}\SpecialCharTok{$}\NormalTok{parameter.value}
\NormalTok{  result.RMSE }\OtherTok{\textless{}{-}}\NormalTok{ tuned.result}\SpecialCharTok{$}\NormalTok{RMSE}
  
  \ControlFlowTok{if}\NormalTok{ (result.RMSE[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{==}\NormalTok{ best\_RMSE) \{}
\NormalTok{    parameter.value[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ prm\_val.leftmost}
\NormalTok{    result.RMSE[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ RMSE.leftmost}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (result.RMSE[n] }\SpecialCharTok{==}\NormalTok{ best\_RMSE) \{}
\NormalTok{    parameter.value[n}\SpecialCharTok{+}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ prm\_val.rightmost}
\NormalTok{    result.RMSE[n}\SpecialCharTok{+}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ RMSE.rightmost}
\NormalTok{  \}}
  
  \FunctionTok{list}\NormalTok{(}\AttributeTok{best\_result =}\NormalTok{ param\_values.best\_result,}
       \AttributeTok{param\_values.endpoints =} \FunctionTok{c}\NormalTok{(prm\_val.leftmost, prm\_val.rightmost, seq\_increment),}
       \AttributeTok{tuned.result =} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{parameter.value =}\NormalTok{ parameter.value,}
                                 \AttributeTok{RMSE =}\NormalTok{ result.RMSE))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{noteblock}
The full version of the source code of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L198}{model.tune.param\_range} is available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L74}{Model Tuning} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L198}{common-helper.functions.R} script.

\end{noteblock}

\newpage

\subsubsection{\texorpdfstring{\href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L87}{get\_fine\_tune.param.endpoints.idx} Function}{get\_fine\_tune.param.endpoints.idx Function}}\label{func.get_fine_tune.param.endpoints.idx}

\hfill\break

\paragraph{Signature}\label{signature-2}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{get\_fine\_tune.param.endpoints.idx }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(preset.result) \{}
  \CommentTok{\# ...}
    
  \FunctionTok{c}\NormalTok{(}\AttributeTok{start =}\NormalTok{ i, }
    \AttributeTok{end =}\NormalTok{ j,}
    \AttributeTok{best =}\NormalTok{ best\_RMSE.idx)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\paragraph{Parameters}\label{parameters-6}

\hfill\break

\phantomsection\label{func.get_fine_tune.param.endpoints.idx.params.preset.result}
\subparagraph{\texorpdfstring{\textbf{\emph{preset.result}}}{preset.result}}\label{preset.result}

\hfill\break
A data structure compatible with the \texttt{tuned.result} item of the data structure returned by the \hyperref[func.tune.model_param]{tune.model\_param} function (see the \hyperref[func.tune.model_param.value]{Value} subsection of the \texttt{tune.model\_param} function description section for more details). Here is a sample of using this parameter in the \texttt{model.tune.param\_range} function \hyperref[func.model.tune.param_range.code]{code}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    tuned\_result }\OtherTok{\textless{}{-}} \FunctionTok{tune.model\_param}\NormalTok{(test\_param\_vals, }
\NormalTok{                                  fn\_tune.test.param\_value,}
\NormalTok{                                  break.if\_min,}
\NormalTok{                                  steps.beyond\_min)}
    
\NormalTok{    tuned.result }\OtherTok{\textless{}{-}}\NormalTok{ tuned\_result}\SpecialCharTok{$}\NormalTok{tuned.result}
    \CommentTok{\# tuned.result = data.frame(RMSE, parameter.value)}
    \CommentTok{\# ...}
\NormalTok{    bound.idx }\OtherTok{\textless{}{-}} \FunctionTok{get\_fine\_tune.param.endpoints.idx}\NormalTok{(tuned.result)}
    \CommentTok{\# bounnd.idx =  c(start.index, end.index, min\_RMSE.index)}
\end{Highlighting}
\end{Shaded}

\paragraph{Details}\label{details-6}

\hfill\break
The algorithm finds the indices of the nearest neighboring elements of the element corresponding to the minimum RMSE value in the given sequence.

\paragraph{Value}\label{value-5}

\hfill\break
A vector containing the index of the element corresponding to the minimum \texttt{RMSE} value in a given sequence, along with the indices of its nearest neighboring elements:

\begin{Shaded}
\begin{Highlighting}[]
  \FunctionTok{c}\NormalTok{(start, }\CommentTok{\# interval start index}
\NormalTok{    end,   }\CommentTok{\# interval end index}
\NormalTok{    best)  }\CommentTok{\# index of the best \textasciigrave{}RMSE\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

\paragraph{Source Code}\label{source-code-6}

\hfill\break
The source code of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R\#L87}{get\_fine\_tune.param.endpoints.idx} function is shown below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{get\_fine\_tune.param.endpoints.idx }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(preset.result) \{}
\NormalTok{  best\_RMSE }\OtherTok{\textless{}{-}} \FunctionTok{min}\NormalTok{(preset.result}\SpecialCharTok{$}\NormalTok{RMSE)}
\NormalTok{  best\_RMSE.idx }\OtherTok{\textless{}{-}} \FunctionTok{which.min}\NormalTok{(preset.result}\SpecialCharTok{$}\NormalTok{RMSE)}
  \CommentTok{\# best\_lambda \textless{}{-} preset.result$parameter.value[best\_RMSE.idx]}
  
\NormalTok{  preset.result.N }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(preset.result}\SpecialCharTok{$}\NormalTok{RMSE)}
\NormalTok{  i }\OtherTok{\textless{}{-}}\NormalTok{ best\_RMSE.idx}
\NormalTok{  j }\OtherTok{\textless{}{-}}\NormalTok{ i}
  
  \ControlFlowTok{while}\NormalTok{ (i }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{) \{}
\NormalTok{    i }\OtherTok{\textless{}{-}}\NormalTok{ i }\SpecialCharTok{{-}} \DecValTok{1}
    
    \ControlFlowTok{if}\NormalTok{ (preset.result}\SpecialCharTok{$}\NormalTok{RMSE[i] }\SpecialCharTok{\textgreater{}}\NormalTok{ best\_RMSE) \{}
      \ControlFlowTok{break}
\NormalTok{    \}}
\NormalTok{  \}}
  
  \ControlFlowTok{while}\NormalTok{ (j }\SpecialCharTok{\textless{}}\NormalTok{ preset.result.N) \{}
\NormalTok{    j }\OtherTok{\textless{}{-}}\NormalTok{ j }\SpecialCharTok{+} \DecValTok{1}
    
    \ControlFlowTok{if}\NormalTok{ (preset.result}\SpecialCharTok{$}\NormalTok{RMSE[j] }\SpecialCharTok{\textgreater{}}\NormalTok{ best\_RMSE) \{}
      \ControlFlowTok{break}
\NormalTok{    \}}
\NormalTok{  \}}
  
  \FunctionTok{c}\NormalTok{(}\AttributeTok{start =}\NormalTok{ i, }
    \AttributeTok{end =}\NormalTok{ j,}
    \AttributeTok{best =}\NormalTok{ best\_RMSE.idx)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\newpage

\subsubsection{\texorpdfstring{\href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L442}{get\_best\_param.result} Function}{get\_best\_param.result Function}}\label{func.get_best_param.result}

\hfill\break

\paragraph{Signature}\label{signature-3}

\hfill\break

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{get\_best\_param.result }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(param\_values, rmses)\{}
  \CommentTok{\# ...}
  
  \FunctionTok{c}\NormalTok{(}\AttributeTok{param.best\_value =}\NormalTok{ param\_values[best\_pvalue\_idx], }
    \AttributeTok{best\_RMSE =}\NormalTok{ rmses[best\_pvalue\_idx])}
\end{Highlighting}
\end{Shaded}

\paragraph{Parameters}\label{parameters-7}

\hfill\break
A pair of matched vectors, the first of which contains the values of the input parameters for tuning, and the second, the corresponding values of the \texttt{RMSE}.

\begin{itemize}
\tightlist
\item
  \textbf{param\_values:} A vector containing the values of the input parameters for tuning;;
\item
  \textbf{rmses:} A vector containing values of the corresponding \texttt{Root\ Mean\ Squared\ Errors}..
\end{itemize}

\paragraph{Details}\label{details-7}

\hfill\break
Extracts the best values from the input data and returns them as a vector containing a pair of the best \emph{input parameter} value and the corresponding \emph{minimum \texttt{RMSE}}.

\paragraph{Value}\label{value-6}

\hfill\break
A vector containing a pair of the best \emph{input parameter} value and the corresponding \emph{minimum \texttt{RMSE}}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{c}\NormalTok{(param.best\_value, best\_RMSE)}
\end{Highlighting}
\end{Shaded}

\paragraph{Source Code}\label{source-code-7}

\hfill\break
The source code of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R\#L442}{get\_best\_param.result} function is shown below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{get\_best\_param.result }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(param\_values, rmses)\{}
\NormalTok{  best\_pvalue\_idx }\OtherTok{\textless{}{-}} \FunctionTok{which.min}\NormalTok{(rmses)}
  \FunctionTok{c}\NormalTok{(}\AttributeTok{param.best\_value =}\NormalTok{ param\_values[best\_pvalue\_idx], }
    \AttributeTok{best\_RMSE =}\NormalTok{ rmses[best\_pvalue\_idx])}
\end{Highlighting}
\end{Shaded}

\newpage

\subsection{Support Functions}\label{support-functions}

\hfill\break

\subsubsection{\texorpdfstring{\href{}{fname00} Function}{fname00 Function}}\label{func.fname00}

\hfill\break

\phantomsection\label{func.fname00.Usage}
\paragraph{Usage}\label{usage-4}

\hfill\break

\phantomsection\label{func.fname00.params}
\paragraph{Parameters}\label{parameters-8}

\hfill\break

\phantomsection\label{func.fname00.params.p1}
\begin{itemize}
\tightlist
\item
  \textbf{p1:} description;
\end{itemize}

\phantomsection\label{func.fname00.params.2}
\begin{itemize}
\tightlist
\item
  \textbf{p2:} description.
\end{itemize}

\phantomsection\label{func.fname00.details}
\paragraph{Details}\label{details-8}

\hfill\break

\begin{noteblock}
Note

\end{noteblock}

\phantomsection\label{func.fname00.value}
\paragraph{Value}\label{value-7}

\hfill\break

\phantomsection\label{func.fname00.code}
\paragraph{Source Code}\label{source-code-8}

\hfill\break

The soure code of the \href{}{fname00} function is shown below:

\begin{noteblock}
The source code of the \href{}{fname00} is also available in the \href{}{Some.Section} section of the \href{}{Somefunctions.R} script.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{}{fname01} Function}{fname01 Function}}\label{func.fname01}

\hfill\break

\phantomsection\label{func.fname01.signature}
\paragraph{Signature}\label{signature-4}

\hfill\break

\phantomsection\label{func.fname01.params}
\paragraph{Parameters}\label{parameters-9}

\hfill\break
- \textbf{param1:} description;
- \textbf{param2:} description.

\phantomsection\label{func.fname01.details}
\paragraph{Details}\label{details-9}

\hfill\break

\begin{noteblock}
Note

\end{noteblock}

\phantomsection\label{func.fname01.value}
\paragraph{Value}\label{value-8}

\hfill\break

\phantomsection\label{func.fname01.code}
\paragraph{Source Code}\label{source-code-9}

\hfill\break
The soure code of the \href{}{function} function is shown below:

\begin{noteblock}
The source code of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L96}{} is also available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L95}{Regularization} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L96}{UM-effect.functions.R} script.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{}{fname02} Function}{fname02 Function}}\label{func.fname02}

\hfill\break

\phantomsection\label{func.fname02.signature}
\paragraph{Signature}\label{signature-5}

\hfill\break

\phantomsection\label{func.fname02.params}
\paragraph{Parameters}\label{parameters-10}

\hfill\break
- \textbf{param1:} description;
- \textbf{param2:} description.

\phantomsection\label{func.fname02.details}
\paragraph{Details}\label{details-10}

\hfill\break

\begin{noteblock}
Note

\end{noteblock}

\phantomsection\label{func.fname02.value}
\paragraph{Value}\label{value-9}

\hfill\break

\phantomsection\label{func.fname02.code}
\paragraph{Source Code}\label{source-code-10}

\hfill\break
The soure code of the \href{}{function} function is shown below:

\begin{noteblock}
The source code of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L96}{} is also available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L95}{Regularization} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L96}{UM-effect.functions.R} script.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{}{fname0} Function}{fname0 Function}}\label{func.fname0}

\hfill\break

\phantomsection\label{func.fname0.signature}
\paragraph{Signature}\label{signature-6}

\hfill\break

\phantomsection\label{func.fname0.params}
\paragraph{Parameters}\label{parameters-11}

\hfill\break
- \textbf{param1:} description;
- \textbf{param2:} description.

\phantomsection\label{func.fname0.details}
\paragraph{Details}\label{details-11}

\hfill\break

\begin{noteblock}
Note

\end{noteblock}

\phantomsection\label{func.fname0.value}
\paragraph{Value}\label{value-10}

\hfill\break

\phantomsection\label{func.fname0.code}
\paragraph{Source Code}\label{source-code-11}

\hfill\break
The soure code of the \href{}{function} function is shown below:

\begin{noteblock}
The source code of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L96}{} is also available in the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L95}{Regularization} section of the \href{https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UM-effect.functions.R\#L96}{UM-effect.functions.R} script.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{}{fname03} Function}{fname03 Function}}\label{func.fname03}

\hfill\break

\phantomsection\label{func.fname03.signature}
\paragraph{Signature}\label{signature-7}

\hfill\break

\phantomsection\label{func.fname03.params}
\paragraph{Parameters}\label{parameters-12}

\hfill\break
- \textbf{param1:} description;
- \textbf{param2:} description.

\phantomsection\label{func.fname03.details}
\paragraph{Details}\label{details-12}

\hfill\break

\begin{noteblock}
Note

\end{noteblock}

\phantomsection\label{func.fname03.value}
\paragraph{Value}\label{value-11}

\hfill\break

\phantomsection\label{func.fname03.code}
\paragraph{Source Code}\label{source-code-12}

\hfill\break
The soure code of the \href{}{function} function is shown below:

\begin{noteblock}
The source code of the \href{}{} is also available in the \href{}{Regularization} section of the \href{}{UM-effect.functions.R} script.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{}{fname1} Function}{fname1 Function}}\label{func.fname1}

\hfill\break

\phantomsection\label{func.fname1.signature}
\paragraph{Signature}\label{signature-8}

\hfill\break

\phantomsection\label{func.fname1.params}
\paragraph{Parameters}\label{parameters-13}

\hfill\break
- \textbf{param1:} description;
- \textbf{param2:} description.

\phantomsection\label{func.fname1.details}
\paragraph{Details}\label{details-13}

\hfill\break

\begin{noteblock}
Note

\end{noteblock}

\phantomsection\label{func.fname1.value}
\paragraph{Value}\label{value-12}

\hfill\break

\phantomsection\label{func.fname1.code}
\paragraph{Source Code}\label{source-code-13}

\hfill\break
The soure code of the \href{}{function} function is shown below:

\begin{noteblock}
The source code of the \href{}{} is also available in the \href{}{Regularization} section of the \href{}{UM-effect.functions.R} script.

\end{noteblock}

\subsection{Other Function Templates}\label{other-function-templates}

\hfill\break

\subsubsection{\texorpdfstring{\href{}{fname2} Function}{fname2 Function}}\label{func.fname2}

\hfill\break

\phantomsection\label{func.fname2.signature}
\paragraph{Signature}\label{signature-9}

\hfill\break

\phantomsection\label{func.fname2.params}
\paragraph{Parameters}\label{parameters-14}

\hfill\break
- \textbf{param1:} description;
- \textbf{param2:} description.

\phantomsection\label{func.fname2.details}
\paragraph{Details}\label{details-14}

\hfill\break

\begin{noteblock}
Note

\end{noteblock}

\phantomsection\label{func.fname2.value}
\paragraph{Value}\label{value-13}

\hfill\break

\phantomsection\label{func.fname2.code}
\paragraph{Source Code}\label{source-code-14}

\hfill\break
The soure code of the \href{}{function} function is shown below:

\begin{noteblock}
The source code of the \href{}{} is also available in the \href{}{Regularization} section of the \href{}{UM-effect.functions.R} script.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{}{fname3} Function}{fname3 Function}}\label{func.fname3}

\hfill\break

\phantomsection\label{func.fname3.signature}
\paragraph{Signature}\label{signature-10}

\hfill\break

\phantomsection\label{func.fname3.params}
\paragraph{Parameters}\label{parameters-15}

\hfill\break
- \textbf{param1:} description;
- \textbf{param2:} description.

\phantomsection\label{func.fname3.details}
\paragraph{Details}\label{details-15}

\hfill\break

\begin{noteblock}
Note

\end{noteblock}

\phantomsection\label{func.fname3.value}
\paragraph{Value}\label{value-14}

\hfill\break

\phantomsection\label{func.fname3.code}
\paragraph{Source Code}\label{source-code-15}

\hfill\break
The soure code of the \href{}{function} function is shown below:

\begin{noteblock}
The source code of the \href{}{} is also available in the \href{}{Regularization} section of the \href{}{UM-effect.functions.R} script.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{}{fname4} Function}{fname4 Function}}\label{func.fname4}

\hfill\break

\phantomsection\label{func.fname4.signature}
\paragraph{Signature}\label{signature-11}

\hfill\break

\phantomsection\label{func.fname4.params}
\paragraph{Parameters}\label{parameters-16}

\hfill\break
- \textbf{param1:} description;
- \textbf{param2:} description.

\phantomsection\label{func.fname4.details}
\paragraph{Details}\label{details-16}

\hfill\break

\begin{noteblock}
Note

\end{noteblock}

\phantomsection\label{func.fname4.value}
\paragraph{Value}\label{value-15}

\hfill\break

\phantomsection\label{func.fname4.code}
\paragraph{Source Code}\label{source-code-16}

\hfill\break
The soure code of the \href{}{function} function is shown below:

\begin{noteblock}
The source code of the \href{}{} is also available in the \href{}{Regularization} section of the \href{}{UM-effect.functions.R} script.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{}{fname5} Function}{fname5 Function}}\label{func.fname5}

\hfill\break

\phantomsection\label{func.fname5.signature}
\paragraph{Signature}\label{signature-12}

\hfill\break

\phantomsection\label{func.fname5.params}
\paragraph{Parameters}\label{parameters-17}

\hfill\break
- \textbf{param1:} description;
- \textbf{param2:} description.

\phantomsection\label{func.fname5.details}
\paragraph{Details}\label{details-17}

\hfill\break

\begin{noteblock}
Note

\end{noteblock}

\phantomsection\label{func.fname5.value}
\paragraph{Value}\label{value-16}

\hfill\break

\phantomsection\label{func.fname5.code}
\paragraph{Source Code}\label{source-code-17}

\hfill\break
The soure code of the \href{}{function} function is shown below:

\begin{noteblock}
The source code of the \href{}{} is also available in the \href{}{Regularization} section of the \href{}{UM-effect.functions.R} script.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{}{fname6} Function}{fname6 Function}}\label{func.fname6}

\hfill\break

\phantomsection\label{func.fname6.signature}
\paragraph{Signature}\label{signature-13}

\hfill\break

\phantomsection\label{func.fname6.params}
\paragraph{Parameters}\label{parameters-18}

\hfill\break
- \textbf{param1:} description;
- \textbf{param2:} description.

\phantomsection\label{func.fname6.details}
\paragraph{Details}\label{details-18}

\hfill\break

\begin{noteblock}
Note

\end{noteblock}

\phantomsection\label{func.fname6.value}
\paragraph{Value}\label{value-17}

\hfill\break

\phantomsection\label{func.fname6.code}
\paragraph{Source Code}\label{source-code-18}

\hfill\break
The soure code of the \href{}{function} function is shown below:

\begin{noteblock}
The source code of the \href{}{} is also available in the \href{}{Regularization} section of the \href{}{UM-effect.functions.R} script.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{}{fname7} Function}{fname7 Function}}\label{func.fname7}

\hfill\break

\phantomsection\label{func.fname7.signature}
\paragraph{Signature}\label{signature-14}

\hfill\break

\phantomsection\label{func.fname7.params}
\paragraph{Parameters}\label{parameters-19}

\hfill\break
- \textbf{param1:} description;
- \textbf{param2:} description.

\phantomsection\label{func.fname7.details}
\paragraph{Details}\label{details-19}

\hfill\break

\begin{noteblock}
Note

\end{noteblock}

\phantomsection\label{func.fname7.value}
\paragraph{Value}\label{value-18}

\hfill\break

\phantomsection\label{func.fname7.code}
\paragraph{Source Code}\label{source-code-19}

\hfill\break
The soure code of the \href{}{function} function is shown below:

\begin{noteblock}
The source code of the \href{}{} is also available in the \href{}{Regularization} section of the \href{}{UM-effect.functions.R} script.

\end{noteblock}

\subsubsection{\texorpdfstring{\href{}{fname8} Function}{fname8 Function}}\label{func.fname8}

\hfill\break

\phantomsection\label{func.fname8.signature}
\paragraph{Signature}\label{signature-15}

\hfill\break

\phantomsection\label{func.fname8.params}
\paragraph{Parameters}\label{parameters-20}

\hfill\break
- \textbf{param1:} description;
- \textbf{param2:} description.

\phantomsection\label{func.fname8.details}
\paragraph{Details}\label{details-20}

\hfill\break

\begin{noteblock}
Note

\end{noteblock}

\phantomsection\label{func.fname8.value}
\paragraph{Value}\label{value-19}

\hfill\break

\phantomsection\label{func.fname8.code}
\paragraph{Source Code}\label{source-code-20}

\hfill\break
The soure code of the \href{}{function} function is shown below:

\begin{noteblock}
The source code of the \href{}{} is also available in the \href{}{Regularization} section of the \href{}{UM-effect.functions.R} script.

\end{noteblock}

\printbibliography

\end{document}
