## User+Movie+Genre+Year+Day Effect (UMGYDE) Model
\
### Mathematical Description of the UMGYDE Model
\

If we define $d_{i,j}$ as the _number of days since the earliest record_ in the `edx` dataset for movie $j$ rated by user $i$, then the formula \@ref(eq:UMGYDE-model) describing the _UMGYDE Model_, for the current model, takes the form:

\begin{equation}
Y_{i,j} = \mu + \alpha_i + \beta_j + g_{i,j} + \gamma(v_{i,j}) + s(d_{i,j}) + \varepsilon_{i,j}
(\#eq:UMGYDE-model)
\end{equation}

with $s$ a _smoothed day_ function of $d_{i,j}$

Therefore, the formula \@ref(eq:year-effect) for calculation the prediction of a _year effect_ as a residual, for a _smoothed day effect_ 
$$
\hat{s}(d_{i,j}) = s(d_{i,j}) + \varepsilon_{i,j}
$$

takes the following form:

\begin{equation}
\hat{s}(d_{i,j}) = Y_{i,j} - (\mu + \alpha_i + \beta_j + g_{i,j} + \gamma(v_{i,j}))
(\#eq:smoothed-day-effect)
\end{equation}

\newpage

### UMGYDE Model: Support Functions
\

::: {#sec.umgydem.support_functions.note.lambda .noteblock data-latex=""}
Some of the functions described in this section accepts the `lambda` parameter, which we will need later for the _Model Regularization_ method. We use the [mean_reg](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/common-helper.functions.R#L63) function call as well, which we will also need for the *Regularization* techniques to apply to our models (for details, see the  [mean_reg](#func.mean_reg) function description in the [Regularization: Common Helper Functions](#appndx_a.rglr.common_helper.functions) section of the [Appendix] to this report).
We have already explained that in the [UME Model Regularization] section. 
For now, we omit the `lambda` parameter, implicitly using its default value `lambda = 0`. Let's recall that in this case, the [mean_reg](#func.mean_reg) function is equivalent to the standard R function [base::mean](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/mean).
:::

#### [calc_day_general_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L2) Function {#func.calc_day_general_effect}
\

This is a helper function that calculates the _Day General Effect_ of user ratings on a _given day since the earliest record_ in the `edx` dataset and is intended to be used in other functions and scripts (such as [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect)) described below.

##### Parameters
\

###### ***train_set***
\
The _Train Set_ dataset.

###### ***lambda***
\
As explained [above](#sec.umgydem.support_functions.note.lambda) in this section, this parameter is used for the _Regularization_ techniques. Otherwise, it is omitted, meaning its default (zero) value is used. 

##### Source Code
\

The following is a simplified version of the function's source code:
```{r eval=FALSE}
calc_day_general_effect <- function(train_set, lambda = 0){
  train_set |> 
    left_join(edx.user_effect, by = "userId") |>
    left_join(rglr.UM_effect, by = "movieId") |>
    left_join(rglr.UMG_effect, by = "movieId") |>
    left_join(date_days_map, by = "timestamp") |>
    left_join(rglr.UMGY_effect, by='year') |>
    mutate(resid = rating - (mu + a + b + g + ye)) |>
    group_by(days) |>
    summarise(de = mean_reg(resid, lambda), 
              year = mean(year))
}
```

::: {.noteblock data-latex=""}
The complete version of the source code of the [calc_day_general_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L2) function is available in the [UMGYDE Model Support Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L1) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L2) script on _GitHub_.
:::

##### Return
\
A data frame object representing the _Day General Effect_. 

\newpage

#### [calc_day_general_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L31) Function {#func.calc_day_general_effect.cv}
\

This is a helper function that calculates the _Day General Effect_ of user ratings on a _given day since the earliest record_ in the `edx` dataset using the _5-Fold Cross Validation_ and is intended to be used in other functions and scripts (such as [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv)) described below.

##### Parameters
\

###### ***lambda***
\
As explained [above](#sec.umgydem.support_functions.note.lambda) in this section, this parameter is used for the _Regularization_ techniques. Otherwise, it is omitted, meaning its default (zero) value is used. 

##### Souurce Code
\

::: {.noteblock data-latex=""}
The complete version of the source code of the [calc_day_general_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L31) function is available in the [UMGYDE Model Support Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L1) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L30) script on _GitHub_.
:::

The following is a simplified version of the function's source code:
```{r eval=FALSE}
calc_day_general_effect.cv <- function(lambda = 0){
  gday_effect_ls <- lapply(edx_CV,  function(cv_fold_dat){
    cv_fold_dat$train_set |> calc_day_general_effect(lambda)
  })

  gday_effect_united <- union_cv_results(gday_effect_ls)

  gday_effect_united |>
    group_by(days) |>
    summarise(de = mean(de), year = mean(year))
}
```

::: {.noteblock data-latex=""}
Here we use the function call [union_cv_results](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L432) to aggregate the _5-Fold Cross Validation_ results (for details, see the [union_cv_results](#func.union_cv_results) function description in the [Data Helper Functions](#appndx_a.data_helper.functions) section of the [Appendix] to this report).
:::

##### Return
\
A data frame object representing the _Day General Effect_. 

\newpage


#### [loess_de](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L69) Function {#func.loess_de}
\

This is a helper function that calculates the _Smoothed Day Effect_ of user ratings and is intended to be used in other functions and scripts (such as [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect)) described below.

##### Parameters
\

###### ***de_bias.dat***
\
A data frame object representing the _Day General Effect_. It can be returned by the following functions described above:

  - [calc_day_general_effect](#func.calc_day_general_effect);
  - [calc_day_general_effect.cv](#func.calc_day_general_effect.cv).


###### ***degree***
\
A parameter to pass to the internally called [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) function (see the [Details](#func.loess_de.details) section below), meaning the degree of the polynomials to be used.

###### ***span***
\
A parameter to pass to the internally called [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) function (see the [Details](#func.loess_de.details) section below) to control the degree of smoothing.

::: { #func.loess_de.details .sidebar }
##### Details
\
The function is a wrapper for the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) and calls it under the hood.
:::

##### Source Code
\

The following is the source code of the function:
```{r eval=FALSE}
loess_de <- function(de_bias.dat, degree = NA, span = NA){
  if(is.na(degree)) degree = 2
  if(is.na(span)) span = 0.75
  loess(de ~ days, span = span, degree = degree, data = de_bias.dat)
}
```


::: {.noteblock data-latex=""}
The source code of the [loess_de](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L69) function is also available in the [UMGYDE Model Support Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L1) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L69) script on _GitHub_.
:::

##### Return
\
An object of class `loess` returned by the internally called function [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) (see the [Details](#func.loess_de.details) section above).

\newpage

#### [calc_UMGY_SmoothedDay_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L74) Function {#func.calc_UMGY_SmoothedDay_effect}
\

This is a helper function that calculates the _Smoothed Day Effect_ of the user ratings and is intended to be used in other functions and scripts (such as [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect)) described below.

##### Parameters
\

::: { #func.calc_UMGY_SmoothedDay_effect.params.day_gen_effect .sidebar }
###### ***day_gen_effect***
\
A data frame object representing the _Day General Effect_. It can be returned by the following functions described above:

  - [calc_day_general_effect](#func.calc_day_general_effect);
  - [calc_day_general_effect.cv](#func.calc_day_general_effect.cv).

:::

###### ***degree***
\
A parameter to pass to the internally called [loess_de](#func.loess_de) function (see the [Details](#func.calc_UMGY_SmoothedDay_effect.details) section below), meaning the degree of the polynomials to be used.

###### ***span***
\
A parameter to pass to the internally called [loess_de](#func.loess_de) function (see the [Details](#func.calc_UMGY_SmoothedDay_effect.details) section below) to control the degree of smoothing.

::: { #func.calc_UMGY_SmoothedDay_effect.details .sidebar }
##### Details
\
Under the hood, the function internally calls the [loess_de](#func.loess_de) described above and constructs the _User+Movie+Genre+Year+(Smoothed)Day (UMGYD) Effect_ data object based on the object of class `loess` it returns along with the data passed by the [day_gen_effect](#func.calc_UMGY_SmoothedDay_effect.params.day_gen_effect) parameter.
:::

##### Source Code
\

The following is the source code of the function:
```{r eval=FALSE}
calc_UMGY_SmoothedDay_effect <- function(day_gen_effect, 
                                         degree = NA, 
                                         span = NA){
  put_log2("Function `calc_UMGY_SmoothedDay_effect`: 
Training model using `loess` function with the following parameters:
degree: %1;
span: %2
...",
           degree,
           span)
  # browser()
  fit <- day_gen_effect |> loess_de(degree, span)
  smth_day_effect <- day_gen_effect |> mutate(de_smoothed = fit$fitted)
  
  put_log2("Function `calc_UMGY_SmoothedDay_effect`: 
Model has been trained using `loess` function with the following parameters:
degree: %1;
span: %2.",
           degree,
           span)
  
  smth_day_effect
}

```


::: {.noteblock data-latex=""}
The source code of the [calc_UMGY_SmoothedDay_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L74) function is also available in the [UMGYDE Model Support Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L1) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L74) script on _GitHub_.
:::

##### Return
\
A data frame object representing the _User+Movie+Genre+Year+(Smoothed)Day (UMGYD) Effect_. 

\newpage

#### [train_UMGY_SmoothedDay_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L97) Function {#func.train_UMGY_SmoothedDay_effect}
\

This is a helper function that calculates the _Smoothed Day Effect_ of the user ratings and is intended to be used in other functions and scripts (such as [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect)) described below.

##### Parameters
\

###### ***train_set***
\
The _Train Set_ dataset.


::: { #func.train_UMGY_SmoothedDay_effect.params.degree .sidebar }
###### ***degree***
\
A parameter to pass to the internally called [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) function (see the [Details](#func.train_UMGY_SmoothedDay_effect.details) section below), meaning the degree of the polynomials to be used.
:::

::: { #func.train_UMGY_SmoothedDay_effect.params.span .sidebar }
###### ***span***
\
A parameter to pass to the internally called [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) function (see the [Details](#func.train_UMGY_SmoothedDay_effect.details) section below) to control the degree of smoothing.
:::

###### ***lambda***
\
As explained [above](#sec.umgydem.support_functions.note.lambda) in this section, this parameter is used for the _Regularization_ techniques. Otherwise, it is omitted, meaning its default (zero) value is used. 

::: { #func.train_UMGY_SmoothedDay_effect.details .sidebar }
##### Details
\
Under the hood, the function internally calls the [calc_day_general_effect](#func.calc_day_general_effect) and then [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) described above, and returns the _User+Movie+Genre+Year+(Smoothed)Day (UMGYD) Effect_ data object that the latter inner function returns.
:::

##### Source Code
\

The following is the source code of the function:
```{r eval=FALSE}
train_UMGY_SmoothedDay_effect <- function(train_set, 
                                          degree = NA, 
                                          span = NA,
                                          lambda = 0){
  if (is.na(lambda)) {
    stop("Function: train_UMGY_SmoothedDay_effect
`lambda` is `NA`")
  }
  
  train_set |> 
    calc_day_general_effect(lambda) |>
    train_UMGY_SmoothedDay_effect(degree, span)
}
```


::: {.noteblock data-latex=""}
The source code of the [train_UMGY_SmoothedDay_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L97) function is also available in the [UMGYDE Model Support Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L1) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L97) script on _GitHub_.
:::

##### Return
\
A data frame object representing the _User+Movie+Genre+Year+(Smoothed)Day (UMGYD) Effect_. 

\newpage

#### [train_UMGY_SmoothedDay_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L111) Function {#func.train_UMGY_SmoothedDay_effect.cv}
\

This is a helper function that calculates the _Smoothed Day Effect_ of the user ratings and is intended to be used in other functions and scripts (such as [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv)) described below.

##### Parameters
\

###### ***degree***
\
A parameter to pass to the internally called [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) function (see the [Details](#func.train_UMGY_SmoothedDay_effect.cv.details) section below), meaning the degree of the polynomials to be used.

###### ***span***
\
A parameter to pass to the internally called [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) function (see the [Details](#func.train_UMGY_SmoothedDay_effect.cv.details) section below) to control the degree of smoothing.

###### ***lambda***
\
As explained [above](#sec.umgydem.support_functions.note.lambda) in this section, this parameter is used for the _Regularization_ techniques. Otherwise, it is omitted, meaning its default (zero) value is used. 

::: { #func.train_UMGY_SmoothedDay_effect.cv.details .sidebar }
##### Details
\
Under the hood, the function internally calls the [calc_day_general_effect.cv](#func.calc_day_general_effect.cv) and then [calc_UMGY_SmoothedDay_effect](#func.calc_UMGY_SmoothedDay_effect) described above, and returns the _User+Movie+Genre+Year+(Smoothed)Day (UMGYD) Effect_ data object that the latter inner function returns.
:::

##### Source Code
\

The following is the source code of the function:
```{r eval=FALSE}
train_UMGY_SmoothedDay_effect.cv <- function(degree = NA, 
                                             span = NA,
                                             lambda = 0){
  if (is.na(lambda)) {
    stop("Function: train_UMGY_SmoothedDay_effect.cv
`lambda` is `NA`")
  }
  
  calc_day_general_effect.cv.cv(lambda) |>
    calc_UMGY_SmoothedDay_effect(degree, span)
}

```


::: {.noteblock data-latex=""}
The source code of the [train_UMGY_SmoothedDay_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L111) function is also available in the [UMGYDE Model Support Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L1) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L111) script on _GitHub_.
:::

##### Return
\
A data frame object representing the _User+Movie+Genre+Year+(Smoothed)Day (UMGYD) Effect_. 

#### [UMGY_SmoothedDay_effect.predict](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L123) Function {#func.UMGY_SmoothedDay_effect.predict}
\

This is a helper function that predicts user rating values on the _Test Set_ passed by the [test_set](#func.UMGY_SmoothedDay_effect.predict.params.test_set) parameter, taking into account the _User+Movie+Genre+Year+(Smoothed)Day (UMGYD) Effect_ passed by the [day_smoothed_effect](#func.UMGY_SmoothedDay_effect.predict.params.day_smoothed_effect) parameter.

##### Parameters
\

::: { #func.UMGY_SmoothedDay_effect.predict.params.test_set .sidebar }
###### ***test_set***
\
A _Test Set_ dataset for the _UMGYDE Model_ validation.
:::

::: { #func.UMGY_SmoothedDay_effect.predict.params.day_smoothed_effect .sidebar }
###### ***day_smoothed_effect***
\
A data object representing the _UMGYD Effect_, which can be returned by any of the following functions described above:

  - [calc_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect);
  - [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect);
  - [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv).

:::



##### Source Code
\

Below is the source code of the function:
```{r eval=FALSE}
UMGY_SmoothedDay_effect.predict <- function(test_set, day_smoothed_effect) {
  test_set |>
    left_join(edx.user_effect, by = "userId") |>
    left_join(rglr.UM_effect, by = "movieId") |>
    left_join(rglr.UMG_effect, by = "movieId") |>
    left_join(date_days_map, by = "timestamp") |>
    left_join(rglr.UMGY_effect, by='year') |>
    left_join(day_smoothed_effect, by='days') |>
    mutate(predicted = clamp(mu + a + b + g + 
                               ifelse(is.na(ye), 0, ye) +
                               ifelse(is.na(de_smoothed), 
                                      0, 
                                      de_smoothed))) |> 
    select(userId, movieId, timestamp, rating, predicted)
}
```

::: {.noteblock data-latex=""}
The source code of the [UMGY_SmoothedDay_effect.predict](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L123) function is also available in the [UMGYDE Model Support Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L1) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L123) script on _GitHub_.
:::

##### Return
\

A data frame object containing predicted values. 

\newpage






#### [calc_UMGY_SmoothedDay_effect.MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L139) Function {#func.calc_UMGY_SmoothedDay_effect.MSE}
\

The function calculates the _Mean Squared Error (MSE)_ of the _UMGYDE Model_ for the given _Test Set_ passed by the [test_set](#func.calc_UMGY_SmoothedDay_effect.MSE.params.test_set) parameter.

##### Parameters
\

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.params.test_set .sidebar }
###### ***test_set***
\
A _Test Set_ dataset for the _UMGYDE Model_ validation.
:::

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.params.day_smoothed_effect .sidebar }
###### ***day_smoothed_effect***
\
A data object representing the _UMGYD Effect_, which can be returned by any of the following functions described above:

  - [calc_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect);
  - [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect);
  - [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv).

:::

##### Source Code
\

The source code of the function is provided below:
```{r eval=FALSE}
calc_UMGY_SmoothedDay_effect.MSE <- function(test_set, day_smoothed_effect) {
  test_set |>
    UMGY_SmoothedDay_effect.predict(day_smoothed_effect) |>
    mutate(resid = rating - predicted) |> 
    pull(resid) |> mse()
}
```

::: {.noteblock data-latex=""}
The source code of the function [calc_UMGY_SmoothedDay_effect.MSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L139) is also available in the [UMGYDE Model Support Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L1) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L139) script on _GitHub_. 
:::

##### Return
\
The _Mean Squared Error (MSE)_ value of the _UMGYDE Model_ computed on the _Test Set_ passed by the [test_set](#func.calc_UMGY_SmoothedDay_effect.MSE.params.test_set) parameter.

#### [calc_UMGY_SmoothedDay_effect.MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L145) Function {#func.calc_UMGY_SmoothedDay_effect.MSE.cv}
\

The function calculates the _5-Fold Cross Validation MSE_ result for the _UMGYD Effect_ data passed by the [day_smoothed_effect](#func.calc_UMGY_SmoothedDay_effect.MSE.cv.params.day_smoothed_effect) parameter. 

##### Parameters
\

::: { #func.calc_UMGY_SmoothedDay_effect.MSE.cv.params.day_smoothed_effect .sidebar }
###### ***day_smoothed_effect***
\
A data object representing the _UMGYD Effect_, which can be returned by any of the following functions described above:

  - [calc_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect);
  - [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect);
  - [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv).

:::


##### Source Code
\

Below is a simplified version of the function's source code:
```{r eval=FALSE}
calc_UMGY_SmoothedDay_effect.MSE.cv <- function(day_smoothed_effect){
  smth_day_effect_MSEs <- sapply(edx_CV, function(cv_fold_dat){
    cv_fold_dat$validation_set |> 
      calc_UMGY_SmoothedDay_effect.MSE(day_smoothed_effect)
  })
  
  mean(smth_day_effect_MSEs)
}

```

::: {.noteblock data-latex=""}
The complete version of the source code of the [calc_UMGY_SmoothedDay_effect.MSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L145) function is available in the [UMGYDE Model Support Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L1) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L145) script on _GitHub_.
:::

##### Return
\
The _Mean Squared Error (MSE)_ value of the _UMGYDE Model_ computed as the mean of the _5-Fold Cross Validation_ results.



#### [calc_UMGY_SmoothedDay_effect.RMSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L161) Function {#func.calc_UMGY_SmoothedDay_effect.RMSE}
\

The function calculates the _Root Mean Squared Error (RMSE)_ of the _UMGYDE Model_ for the given _Test Set_ passed by the [test_set](#func.calc_UMGY_SmoothedDay_effect.RMSE.params.test_set) parameter.

##### Parameters
\

::: { #func.calc_UMGY_SmoothedDay_effect.RMSE.params.test_set .sidebar }
###### ***test_set***
\
A _Test Set_ dataset for the _UMGYDE Model_ validation.
:::

::: { #func.calc_UMGY_SmoothedDay_effect.RMSE.params.day_smoothed_effect .sidebar }
###### ***day_smoothed_effect***
\
A data object representing the _UMGYD Effect_, which can be returned by any of the following functions described above:

  - [calc_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect);
  - [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect);
  - [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv).

:::

##### Source Code
\

The source code of the function is provided below:
```{r eval=FALSE}
calc_UMGY_SmoothedDay_effect.RMSE <- function(test_set, day_smoothed_effect){
  day_smth_effect_MSe <- test_set |> 
    calc_UMGY_SmoothedDay_effect.MSE(day_smoothed_effect)
  
  sqrt(day_smth_effect_MSe)
}
```

::: {.noteblock data-latex=""}
The source code of the function [calc_UMGY_SmoothedDay_effect.RMSE](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L161) is also available in the [UMGYDE Model Support Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L1) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L161) script. 
:::

##### Return
\
The _Root Mean Squared Error (RMSE)_ value of the _UMGYDE Model_ computed on the _Test Set_ passed by the [test_set](#func.calc_UMGY_SmoothedDay_effect.RMSE.params.test_set) parameter.

#### [calc_UMGY_SmoothedDay_effect.RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L167) Function {#func.calc_UMGY_SmoothedDay_effect.RMSE.cv}
\

The function calculates the _5-Fold Cross Validation RMSE_ result for the _UMGYD Effect_ data passed by the [day_smoothed_effect](#func.calc_UMGY_SmoothedDay_effect.RMSE.cv.params.day_smoothed_effect) parameter. 

##### Parameters
\

::: { #func.calc_UMGY_SmoothedDay_effect.RMSE.cv.params.day_smoothed_effect .sidebar }
###### ***day_smoothed_effect***
\
A data object representing the _UMGYD Effect_, which can be returned by any of the following functions described above:

  - [calc_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect);
  - [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect);
  - [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv).

:::

##### Source Code
\

The source code of the function is provided below:
```{r eval=FALSE}
calc_UMGY_SmoothedDay_effect.RMSE.cv <- function(day_smoothed_effect){
  sqrt(calc_UMGY_SmoothedDay_effect.MSE.cv(day_smoothed_effect))
}
```

::: {.noteblock data-latex=""}
The source code of the function [calc_UMGY_SmoothedDay_effect.RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L167) is also available in the [UMGYDE Model Support Functions](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L1) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L167)  script. 
:::

##### Return
\
The _Root Mean Squared Error (RMSE)_ of the _UMGYD Model_ computed as the square root of the _5-Fold Cross Validation MSE_ result.

\newpage

### UMGYDE Model Building
\

::: {.noteblock data-latex=""}
The complete source code of building and training the current model is available in the [UMGYDE Model (UMGYDEM) Building](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1745) section of the [capstone-movielens.main.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1745) script on _GitHub_.
:::

Below, we provide the most significant line of the code for training our model using the `5-Fold Cross Validation` method:
```{r, eval=FALSE}
```
```{r}
```

::: {.noteblock data-latex=""}
We use the [train_UMGYD_effect.cv](#func.train_UMGYD_effect.cv) function described above to compute the _UMGYD Effect_.
:::

We can now construct predictors and calculate the _RMSE_ of the current model using the [calc_UMGYD_effect_RMSE.cv](#func.calc_UMGYD_effect_RMSE.cv) function described above:

```{r, eval=FALSE}
```
```{r}
RMSE_kable(RMSEs.ResultTibble.UMGYDE)
```

::: {.noteblock data-latex=""}
Now, we have a bit better result than one for the previous model.
:::

\newpage

### UMGYDE Model Tuning
\

#### UMGYDE Model Tuning: Support Functions
\

##### [train_UMGY_SmoothedDay_effect.RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L171) Function {#func.train_UMGY_SmoothedDay_effect.RMSE.cv}
\
The function is designed to tune the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) function's parameters ([degree](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.params.degree) and [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.params.span)), which is ultimately called internally under the hood.

###### Parameters
\

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.params.degree .sidebar }
  - ***degree:***
A parameter to pass to the internally called [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv) function (see the [Details](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.details) section below) and, ultimately under the hood, to the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) to specify the degree of the polynomials to be used.

:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.params.span .sidebar }
  - ***span:***
A parameter to pass to the internally called [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv) function (see the [Details](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.details) section below) and, ultimately under the hood, to the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) to control the degree of smoothing.

:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.details .sidebar }
###### Details
\
Under the hood, the function internally calls the [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv) and then [calc_UMGY_SmoothedDay_effect.RMSE.cv](#func.calc_UMGY_SmoothedDay_effect.RMSE.cv) described above to compute the `RMSE` of the model to be tuned.
:::

###### Source Code
\
Below is a simplified version of the function's source code:
```{r eval=FALSE}
train_UMGY_SmoothedDay_effect.RMSE.cv <- function(degree = NA, span = NA) {
  train_UMGY_SmoothedDay_effect.cv(degree, span) |>
    calc_UMGY_SmoothedDay_effect.RMSE.cv()
}
```

::: {.noteblock data-latex=""}
The complete version of the source code of the [train_UMGY_SmoothedDay_effect.RMSE.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L171) function is available in the [Tuning `loess` Parameters](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L170) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L171) script on _GitHub_.
:::

###### Return
\
The _Root Mean Squared Error (RMSE)_ of the _UMGYD Model_. 

##### [train_UMGY_SmoothedDay_effect.RMSE.cv.degree0](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L190) Function {#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0}
\
The overloaded version of the [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) function described above with the fixed [degree](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.params.degree) parameter value of 0.

###### Parameters
\

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0.params.span .sidebar }
  - ***span:***
A parameter to pass to the internally called [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) function (see the [Details](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0.details) section below) and, ultimately under the hood, to the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) to control the degree of smoothing.

:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0.details .sidebar }
###### Details
\
Under the hood, the function internally calls the [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) described above with the fixed [degree](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.params.degree) parameter value of 0 and the [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.params.span) parameter value taken from the [parameter of the same name](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0.params.span) of this function to compute the `RMSE` of the model to be tuned.
:::

###### Source Code
\
Below is the function's source code:
```{r eval=FALSE}
train_UMGY_SmoothedDay_effect.RMSE.cv.degree0 <- function(span) {
  train_UMGY_SmoothedDay_effect.RMSE.cv(degree = 0, span)
}
```

::: {.noteblock data-latex=""}
The source code of the [train_UMGY_SmoothedDay_effect.RMSE.cv.degree0](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L190) function is also available in the [Tuning `loess` Parameters](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L170) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L190) script on _GitHub_.
:::

###### Return
\
_Root Mean Square Error (RMSE)_ of the _UMGYD_ model trained using the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) function called with the given [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree0.params.span) parameter and the `degree` parameter value equal to 0.

\newpage

##### [train_UMGY_SmoothedDay_effect.RMSE.cv.degree1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L193) Function {#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1}
\
The overloaded version of the [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) function described above with the fixed [degree](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.params.degree) parameter value of 1.

###### Parameters
\

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1.params.span .sidebar }
  - ***span:***
A parameter to pass to the internally called [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) function (see the [Details](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1.details) section below) and, ultimately under the hood, to the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) to control the degree of smoothing.

:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1.details .sidebar }
###### Details
\
Under the hood, the function internally calls the [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) described above with the fixed [degree](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.params.degree) parameter value of 1 and the [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.params.span) parameter value taken from the [parameter of the same name](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1.params.span) of this function to compute the `RMSE` of the model to be tuned.
:::

###### Source Code
\
Below is the function's source code:
```{r eval=FALSE}
train_UMGY_SmoothedDay_effect.RMSE.cv.degree1 <- function(span) {
  train_UMGY_SmoothedDay_effect.RMSE.cv(degree = 1, span)
}
```

::: {.noteblock data-latex=""}
The source code of the [train_UMGY_SmoothedDay_effect.RMSE.cv.degree1](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L193) function is also available in the [Tuning `loess` Parameters](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L170) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L193) script on _GitHub_.
:::

###### Return
\
_Root Mean Square Error (RMSE)_ of the _UMGYD_ model trained using the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) function called with the given [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree1.params.span) parameter and the `degree` parameter value equal to 1. 

##### [train_UMGY_SmoothedDay_effect.RMSE.cv.degree2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L196) Function {#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2}
\
The overloaded version of the [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) function described above with the fixed [degree](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.params.degree) parameter value of 2.

###### Parameters
\

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2.params.span .sidebar }
  - ***span:***
A parameter to pass to the internally called [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) function (see the [Details](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2.details) section below) and, ultimately under the hood, to the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) to control the degree of smoothing.

:::

::: { #func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2.details .sidebar }
###### Details
\
Under the hood, the function internally calls the [train_UMGY_SmoothedDay_effect.RMSE.cv](#func.train_UMGY_SmoothedDay_effect.RMSE.cv) described above with the fixed [degree](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.params.degree) parameter value of 2 and the [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.params.span) parameter value taken from the [parameter of the same name](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2.params.span) of this function to compute the `RMSE` of the model to be tuned.
:::

###### Source Code
\
Below is the function's source code:
```{r eval=FALSE}
train_UMGY_SmoothedDay_effect.RMSE.cv.degree2 <- function(span) {
  train_UMGY_SmoothedDay_effect.RMSE.cv(degree = 2, span)
}
```

::: {.noteblock data-latex=""}
The source code of the [train_UMGY_SmoothedDay_effect.RMSE.cv.degree2](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L196) function is also available in the [Tuning `loess` Parameters](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L170) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L196) script on _GitHub_.
:::

###### Return
\
_Root Mean Square Error (RMSE)_ of the _UMGYD_ model trained using the [stats::loess](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess) function called with the given [span](#func.train_UMGY_SmoothedDay_effect.RMSE.cv.degree2.params.span) parameter and the `degree` parameter value of 2. 

\newpage

### UMGYDE Model Regularization
\

#### UMGYDE Model Regularization: Mathematical Description
\

We have already explained the idea of _Linear Model Regularization_ in the [UME Model Regularization] section above. We have also seen how the formula \@ref(eq:ME-penalty) for adding a penalty to the _UME Model_ is transformed into the formula \@ref(eq:GE-penalty) for the _UMGE Model_ and then into the formula \@ref(eq:GYE-penalty) for the _UMGYDE Model_. For the current model, this formula takes the form:

\begin{equation}
\sum_{i,j} \left(y_{u,i} - \mu - \alpha_i - \beta_j - g_{i,j} - \gamma(v_{i,j}) - s(d_{i,j})\right)^2 + \lambda \sum_{i,j} s(d_{i,j})^2
(\#eq:DE-penalty)
\end{equation}

And the formula \@ref(eq:ME-regularized) for calculating the values of the _treatment effect_ that minimizes the equation will take the form:

\begin{equation}
\hat{s}(d_{i,j}, \lambda) = \frac{1}{\lambda + n_d} \sum_{r=1}^{n_{d}} \left(Y_{i,j} - \mu - \alpha_i - \beta_j - g_{i,j} - \gamma(v_{i,j})\right)
(\#eq:DE-regularized)
\end{equation}

where $n_d$ is the number of ratings made on the day $d$. 

As with the previous models, we implement the _Regularization_ method for the current model in the following three steps:

  1. **Pre-configuration:** Preliminary determination of the optimal range of $\lambda$ values for the `5-Fold Cross Validation` samples;
  
  2. **Fine-tuning:** figuring out the value of $\lambda$ that minimizes the model's RMSE.
  
  3. **Retraining:** retraining the model with the best value of the parameter $\lambda$ obtained in the previous step.

\newpage

#### UMGYDE Model Regularization: Support Functions
\

##### [regularize.train_UMGYD_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L223) Function {#func.regularize.train_UMGYD_effect}
\

The function is an overloaded version of the [train_UMGY_SmoothedDay_effect](#func.train_UMGY_SmoothedDay_effect) function described above, with the fixed values of the [degree](#func.train_UMGY_SmoothedDay_effect.params.degree) and [span](#func.train_UMGY_SmoothedDay_effect.params.span) parameters set to the best values figured out during the tuning process described in the [UMGYDE Model Tuning] section above.

###### Parameters
\

::: { #func.regularize.train_UMGYD_effect.params.train_set .sidebar }
  - ***train_set:***
The _Train Set_ dataset .

:::

::: { #func.regularize.train_UMGYD_effect.params.lambda .sidebar }
  - ***lambda:***
  In accordance with the description in the [UMGYDE Model Regularization: Mathematical Description] section above, this is the _Regularization parameter_ $\lambda$ used for the _UMGYDE Model Regularization_ process.

:::


###### Source Code
\

The following is the source code of the function:
```{r eval=FALSE}
regularize.train_UMGYD_effect <- function(train_set, lambda) {
  best_degree <- lss.UMGYDE.best_params["degree"]
  best_span <- lss.UMGYDE.best_params["span"]
  
  train_set |>
    train_UMGY_SmoothedDay_effect(best_degree, 
                                  best_span, 
                                  lambda)
}
```

::: {.noteblock data-latex=""}
The source code of the [regularize.train_UMGYD_effect](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L223) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L222) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L223) script on _GitHub_.
:::

###### Return
\
A data frame object representing the _UMGYD Effect_. 

\newpage

##### [regularize.train_UMGYD_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L232) Function {#func.regularize.train_UMGYD_effect.cv}
\

::: {.noteblock data-latex=""}
The source code of the [regularize.train_UMGYD_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L232) function is defined in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L222) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L232) script on _GitHub_.
:::

The function is an overloaded version of the [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv) function described above, with the fixed values of the [degree](#func.train_UMGY_SmoothedDay_effect.cv.params.degree) and [span](#func.train_UMGY_SmoothedDay_effect.cv.params.span) parameters set to the best values figured out during the tuning process described in the [UMGYDE Model Tuning] section above.


###### Parameters
\

::: { #func.regularize.train_UMGYD_effect.cv.params.lambda .sidebar }
  - ***lambda:***
  In accordance with the description in the [UMGYDE Model Regularization: Mathematical Description] section above, this is the _Regularization parameter_ $\lambda$ used for the _UMGYDE Model Regularization_ process.

:::

###### Source Code
\
The source code of the function is provided below:
```{r eval=FALSE}
regularize.train_UMGYD_effect.cv <- function(lambda) {
  best_degree <- lss.UMGYDE.best_params["degree"]
  best_span <- lss.UMGYDE.best_params["span"]

  train_UMGY_SmoothedDay_effect.cv(best_degree, 
                                   best_span, 
                                   lambda)
}
```

::: {.noteblock data-latex=""}
Note that we reuse the function [train_UMGY_SmoothedDay_effect.cv](#func.train_UMGY_SmoothedDay_effect.cv) calling it internally from the [regularize.train_UMGYD_effect.cv](#func.regularize.train_UMGYD_effect.cv), but now with the $\lambda$ parameter different from the default ('lambda = 0') value.
:::

###### Return
\
A data frame object representing the _UMGYD Effect_. 

\newpage

##### [regularize.test_lambda.UMGYD_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L240) Function {#func.regularize.test_lambda.UMGYD_effect.cv}
\

The function calculates _RMSE_ of the _UMGYDE Model_ using _5-Fold Cross Validation_ for the given $\lambda$ parameter value.

::: { #func.regularize.test_lambda.UMGYD_effect.cv.params.lambda .sidebar }
  - ***lambda:***
  In accordance with the description in the [UMGYDE Model Regularization: Mathematical Description] section above, this is the _Regularization parameter_ $\lambda$ used for the _UMGYDE Model Regularization_ process.

:::


::: { #func.regularize.test_lambda.UMGYD_effect.cv.details .sidebar }
##### Details
\
Under the hood, the function internally calls the [regularize.train_UMGYD_effect.cv](#func.regularize.train_UMGYD_effect.cv) and then [calc_UMGY_SmoothedDay_effect.RMSE.cv](#func.calc_UMGY_SmoothedDay_effect.RMSE.cv) described above, and returns the _RMSE_ value that the latter inner function calculates for the given [lambda](#func.regularize.test_lambda.UMGYD_effect.cv.params.lambda) parameter value passed to the former one.
:::


###### Source Code
\
The source code of the function is provided below:
```{r, eval=FALSE}
regularize.test_lambda.UMGYD_effect.cv <- function(lambda){
  if (is.na(lambda)) {
    stop("Function: regularize.test_lambda.UMGY_effect.cv
`lambda` is `NA`")
  }
  
  regularize.train_UMGYD_effect.cv(lambda) |>
    calc_UMGY_SmoothedDay_effect.RMSE.cv()
}
```

::: {.noteblock data-latex=""}
The source code of the [regularize.test_lambda.UMGYD_effect.cv](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L240) function is also available in the [Regularization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L222) section of the [UMGYD-effect.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/UMGYD-effect.functions.R#L240) script on _GitHub_.
:::

###### Return
\
_Root Mean Squared Error (RMSE)_ of the _UMGYD Model_ trained for the given [lambda](#func.regularize.train_UMGYD_effect.cv.params.span) parameter value.

\newpage

#### UMGYDE Model Regularization: Pre-configuration
\

Let's perform the preconfiguration to determine the appropriate range of $\lambda$ for subsequent fine-tuning of our current model:

We are going to use the [tune.model_param](#func.tune.model_param) function described in the [Regularization: Common Helper Functions](#appndx_a.rglr.common_helper.functions) section of the [Appendix] to this report, passing the [regularize.test_lambda.UMGYD_effect.cv](#func.regularize.test_lambda.UMGYD_effect.cv) function as the value of the [fn_tune.test.param_value](#func.tune.model_param.params.fn_tune.test.param_value) parameter.

Below we provide the most significant part of the code that performs this operation:
```{r, eval=FALSE}
```
```{r}
str(cv.UMGYDE.preset.result)
cv.UMGYDE.preset.result$best_result
```

::: {.noteblock data-latex=""}
The complete version of the source code provided in this section can be found in the [UMGYDE Model Regularization: Pre-configuration](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1493) section of the [capstone-movielens.main.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1493) script on _GitHub_.
:::

Now, let's visualize the results of the $\lambda$ range preconfiguration:
``` {r}
cv.UMGYDE.preset.result$tuned.result |>
  data.plot(title = TeX(r'[UMGYDE Model Regularization: $\lambda$ Range Pre-configuration]'),
              xname = "parameter.value", 
              yname = "RMSE", 
              xlabel = TeX(r'[$\lambda$]'), 
              ylabel = "RMSE")
```

::: {.noteblock data-latex=""}
We use the custom data visualization function [data.plot](#func.data.plot) described in the [Data Helper Functions](#appndx_a.data_helper.functions) section of the [Appendix] to this report, which is defined in the [Data Visualization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L447) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L592) script on _GitHub_.
:::

\newpage

#### UMGYDE Model Regularization: Fine-tuning
\

::: {.noteblock data-latex=""}
The complete version of the source code provided in this section can be found in the [Fine-tuning Step of the Regularization Method for the User+Movie Model](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L867) section of the [capstone-movielens.main.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R) script on _GitHub_.
:::

We are now ready to perform the fine-tuning step of our model _regularization_ process to determine the best value for the $\lambda$ parameter.

Here we are going to use the [model.tune.param_range](#func.model.tune.param_range) function described in the [Regularization: Common Helper Functions](#appndx_a.rglr.common_helper.functions) section of the [Appendix] to this report, passing the [regularize.test_lambda.UMGYD_effect.cv](#func.regularize.test_lambda.UMGYD_effect.cv) function as the value of the [fn_tune.test.param_value](#func.model.tune.param_range.params.fn_tune.test.param_value) parameter.

Below we provide the most significant part of the code that performs this operation:
```{r, eval=FALSE}
```
```{r}
str(UMGYDE.rglr.fine_tune.results)
UMGYDE.rglr.fine_tune.results$best_result
```

::: {.noteblock data-latex=""}
Under the hood, this code block internally calls the helper function [get_fine_tune.param.endpoints](#func.get_fine_tune.param.endpoints) described in the [Regularization: Common Helper Functions](#appndx_a.rglr.common_helper.functions) section of the [Appendix] to this report to figure out the boundaries of the range of values from the nearest neighborhood of the value corresponding to the best `RMSE` in the data passed in as a parameter.
:::

\newpage

Let's visualize the fine-tuning results:
```{r}
UMGYDE.rglr.fine_tune.results$tuned.result |>
  data.plot(title = "UMGYDE Model Regularization: Fine-tuned result",
              xname = "parameter.value",
              yname = "RMSE",
              xlabel = TeX(r'[$\lambda$]'),
              ylabel = str_glue("Deviation from the best RMSE value (",
                                as.character(round(UMGYDE.rglr.fine_tune.RMSE.best, digits = 7)),
                                ")"),
              normalize = TRUE)
```

::: {.noteblock data-latex=""}
We use the custom data visualization function [data.plot](#func.data.plot) described in the [Data Helper Functions](#appndx_a.data_helper.functions) section of the [Appendix] to this report, which is defined in the [Data Visualization](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L447) section of the [data.helper.functions.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/support-functions/data.helper.functions.R#L592) script on _GitHub_.
:::

\newpage

#### UMGYDE Model Regularization: Retraining Model with the best $\lambda$
\

::: {.noteblock data-latex=""}
The complete version of the source code provided in this section are available in the [Re-train Regularized UMGYDE Model for the best `lambda`](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1589) section of the [capstone-movielens.main.R](https://github.com/AzKurban-edX-DS/Capstone-MovieLens/blob/main/r/src/capstone-movielens.main.R#L1589) script on _GitHub_.
:::

Now, we can calculate the _Regularized UMGYDE Effect_ by retraining our model on the entire `edx` dataset with the best value of the $\lambda$ parameter we just calculated, for the definitive _Root Mean Squared Error_ calculation and use in subsequent models.

```{r, eval=FALSE}

```

::: {.noteblock data-latex=""}
Here we use the helper function [train_UMGYD_effect](#func.train_UMGYD_effect) described above in the [UMGYDE Model Regularization: Support Functions] section.
:::

We calculate the _Root Mean Squared Error_ for the ultimately computed _UMGYDE Effect_ using the helper function [calc_UMGYD_effect_RMSE.cv](#func.calc_UMGYD_effect_RMSE.cv) described above in the [UMGYDE Model Regularization: Support Functions] section as follows:
```{r, eval=FALSE}
```

Finally, we add the definitive result for the current model to our _Result Table_:
```{r, eval=FALSE}
```
```{r}
```

\newpage

